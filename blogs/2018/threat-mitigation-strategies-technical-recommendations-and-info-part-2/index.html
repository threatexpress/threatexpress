
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Threatexpress Blog">
      
      
      
      
        <link rel="prev" href="../threat-gets-a-vote-applying-a-threat-based-approach-to-security-testing/">
      
      
        <link rel="next" href="../automating-cobalt-strike-profiles-apache-mod_rewrite-htaccess-files-intelligent-c2-redirection/">
      
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Threat Mitagation Strategies - Part 2 - Threatexpress</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#threat-mitigation-strategies-part-2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Threatexpress" class="md-header__button md-logo" aria-label="Threatexpress" data-md-component="logo">
      
  <img src="../../../img/threatexpress_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Threatexpress
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Threat Mitagation Strategies - Part 2
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/threatexpress" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    threatexpress/threatexpress
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Threatexpress" class="md-nav__button md-logo" aria-label="Threatexpress" data-md-component="logo">
      
  <img src="../../../img/threatexpress_logo.png" alt="logo">

    </a>
    Threatexpress
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/threatexpress" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    threatexpress/threatexpress
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://redteam.guide" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    REDTEAM.GUIDE
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Posts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2020
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            2020
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2020/threatbox-standard-attack-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ThreatBox - Standard Attack Platform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2020/red-team-development-and-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Team Development and Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2019
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            2019
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2019/event-data-collector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Data Collector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2019/c2-agent-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C2 Agent Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2019/git-clone-entire-org/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git clone all organizational repos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2019/penetration-testing-pasties/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Penetration Testing Pasties
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2018
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            2018
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../a-deep-dive-into-cobalt-strike-malleable-c2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    A Deep Dive into Cobalt Strike Malleable C2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../threat-gets-a-vote-applying-a-threat-based-approach-to-security-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threat Get's a Vote - Applying a Threat-Based Approach to Security Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Threat Mitagation Strategies - Part 2
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Threat Mitagation Strategies - Part 2
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#account-management" class="md-nav__link">
    <span class="md-ellipsis">
      Account Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Account Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-password-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust Password Policy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adjust Password Policy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-the-password-policy-using-gpo" class="md-nav__link">
    <span class="md-ellipsis">
      Setting the Password Policy using GPO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#krbtgt-password-reset" class="md-nav__link">
    <span class="md-ellipsis">
      KRBTGT password reset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-laps-to-manage-the-local-administrator-rid-500-password" class="md-nav__link">
    <span class="md-ellipsis">
      Use LAPS to manage the local Administrator (RID 500) password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-managed-service-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Managed Service Accounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protected-lsa" class="md-nav__link">
    <span class="md-ellipsis">
      Protected LSA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Protected LSA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#protect-lsa-via-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Protect LSA Via policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protect-lsa-via-registry-entry" class="md-nav__link">
    <span class="md-ellipsis">
      Protect LSA Via Registry Entry
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#application-log" class="md-nav__link">
    <span class="md-ellipsis">
      Application log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-log" class="md-nav__link">
    <span class="md-ellipsis">
      Security log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-log" class="md-nav__link">
    <span class="md-ellipsis">
      Setup log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-log" class="md-nav__link">
    <span class="md-ellipsis">
      System log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forwardedevents-log" class="md-nav__link">
    <span class="md-ellipsis">
      ForwardedEvents log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applications-and-services-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Applications and Services Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applications and Services Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#admin" class="md-nav__link">
    <span class="md-ellipsis">
      Admin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operational" class="md-nav__link">
    <span class="md-ellipsis">
      Operational
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analytic" class="md-nav__link">
    <span class="md-ellipsis">
      Analytic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug" class="md-nav__link">
    <span class="md-ellipsis">
      Debug
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-audit-policy-should-focus-on-these-in-no-specific-order" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Audit Policy should focus on these (in no specific order)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Audit Policy should focus on these (in no specific order)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-command-line-logging-must-include-ms15-015-kb3031432" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Command Line Logging (Must include MS15-015 KB3031432)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#account-honeytoken-manual" class="md-nav__link">
    <span class="md-ellipsis">
      Account HoneyToken (manual)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#account-honeytoken-network" class="md-nav__link">
    <span class="md-ellipsis">
      Account HoneyToken (network)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spn-honeytoken" class="md-nav__link">
    <span class="md-ellipsis">
      SPN HoneyToken
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-module-logging" class="md-nav__link">
    <span class="md-ellipsis">
      PowerShell Module Logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PowerShell Module Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-parsing" class="md-nav__link">
    <span class="md-ellipsis">
      Log Parsing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse-powershell-events-for-the-following-mimikatz-indicators" class="md-nav__link">
    <span class="md-ellipsis">
      Parse PowerShell events for the following Mimikatz indicators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-offensive-powershell-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Offensive PowerShell Tools
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disable-windows-legacy-typically-unused-features" class="md-nav__link">
    <span class="md-ellipsis">
      Disable Windows Legacy &amp; Typically Unused Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Disable Windows Legacy &amp; Typically Unused Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#force-group-policy-to-reapply-settings-during-refresh" class="md-nav__link">
    <span class="md-ellipsis">
      Force Group Policy to reapply settings during "refresh"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-unneeded-services" class="md-nav__link">
    <span class="md-ellipsis">
      Disable Unneeded Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-net-session-enumeration-netcease" class="md-nav__link">
    <span class="md-ellipsis">
      Disable Net Session Enumeration (NetCease)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-wpad" class="md-nav__link">
    <span class="md-ellipsis">
      Disable WPAD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-llmnr" class="md-nav__link">
    <span class="md-ellipsis">
      Disable LLMNR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-wdigest" class="md-nav__link">
    <span class="md-ellipsis">
      Disable WDigest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-the-use-of-ntlm-v1" class="md-nav__link">
    <span class="md-ellipsis">
      Remove the use of NTLM v1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consider-other-mitigations" class="md-nav__link">
    <span class="md-ellipsis">
      Consider other Mitigations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-security-back-port-patch-kb2871997" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy security back-port patch (KB2871997)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevent-local-administrator-accounts-from-authenticating-over-the-network" class="md-nav__link">
    <span class="md-ellipsis">
      Prevent local "administrator" accounts from authenticating over the network
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prevent local &#34;administrator&#34; accounts from authenticating over the network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-through-group-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Configure through Group Policy:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Remote Connections
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Remote Connections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rdp-restricted-admin-connect-to-only-1-resource" class="md-nav__link">
    <span class="md-ellipsis">
      RDP Restricted Admin (Connect to only 1 resource)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RDP Restricted Admin (Connect to only 1 resource)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-restricted-admin-via-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Restricted Admin via Registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-restricted-admin-via-gpo" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Restricted Admin via GPO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdp-windows-defender-remote-credential-guard-connect-to-multiple-resources" class="md-nav__link">
    <span class="md-ellipsis">
      RDP Windows Defender Remote Credential Guard (Connect to multiple resources)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RDP Windows Defender Remote Credential Guard (Connect to multiple resources)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-windows-defender-credential-guard-via-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Windows Defender Credential Guard via Registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-windef-cred-guard-via-gpo" class="md-nav__link">
    <span class="md-ellipsis">
      Enable WinDef Cred Guard via GPO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit-client-to-client-communication-implement-and-configure-host-based-firewalls" class="md-nav__link">
    <span class="md-ellipsis">
      Limit Client-to-Client Communication (Implement and Configure Host Based Firewalls)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Limit Client-to-Client Communication (Implement and Configure Host Based Firewalls)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-firewall" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Firewall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blockcontrol-tcpudp-access-from-the-internal-network-and-dmz" class="md-nav__link">
    <span class="md-ellipsis">
      Block/control TCP/UDP access from the Internal network and DMZ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block-out-bound-tcpudp-access-from-the-client-systems-to-outbound-networks" class="md-nav__link">
    <span class="md-ellipsis">
      Block out bound TCP/UDP access from the Client systems to outbound networks.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-a-proxy-for-all-outbound-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      Implement a Proxy for All Outbound Traffic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement a Proxy for All Outbound Traffic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-new-gpo-to-manage-the-proxy-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Create a new GPO to manage the proxy settings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configurations" class="md-nav__link">
    <span class="md-ellipsis">
      Configurations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoruns" class="md-nav__link">
    <span class="md-ellipsis">
      AutoRuns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-whiteblack-listing" class="md-nav__link">
    <span class="md-ellipsis">
      Application White/Black listing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applocker" class="md-nav__link">
    <span class="md-ellipsis">
      Applocker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applocker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#applocker-executable-path-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      AppLocker Executable Path Restrictions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AppLocker Executable Path Restrictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interesting-paths" class="md-nav__link">
    <span class="md-ellipsis">
      Interesting Paths
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explicit-whitelisting" class="md-nav__link">
    <span class="md-ellipsis">
      Explicit Whitelisting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interesting-file-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Interesting file extensions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-hunting-and-detection-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Hunting and Detection Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual Hunting and Detection Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtering-event-logs-via-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Filtering Event Logs via PowerShell
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filtering Event Logs via PowerShell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-locations-on-disk-only-use-event-viewer-or-cli-to-copy" class="md-nav__link">
    <span class="md-ellipsis">
      Log locations on disk (only use event viewer or cli to copy)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-times-service-was-installed-all-evtx-files-should-be-system-and-count" class="md-nav__link">
    <span class="md-ellipsis">
      Get times Service was installed (all evtx files, should be system) and count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-blocked-events" class="md-nav__link">
    <span class="md-ellipsis">
      Get blocked events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-windowsdefender-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Get WindowsDefender actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-windowsdefender-detections" class="md-nav__link">
    <span class="md-ellipsis">
      Get WindowsDefender detections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-files-by-extension-with-search-from-application-crash" class="md-nav__link">
    <span class="md-ellipsis">
      Get files (by extension) with search from Application (crash)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-emet-events" class="md-nav__link">
    <span class="md-ellipsis">
      Get EMET events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-service-installs-and-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Get service installs and errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-usb-loading" class="md-nav__link">
    <span class="md-ellipsis">
      Search for USB loading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-errorwarninginfo" class="md-nav__link">
    <span class="md-ellipsis">
      Search for error/warning/info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-remote-eventlog-caution-this-drops-credentials-onto-remote-system" class="md-nav__link">
    <span class="md-ellipsis">
      Get remote eventlog (caution this drops credentials onto remote system)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-log-within-x-hours" class="md-nav__link">
    <span class="md-ellipsis">
      Get log within X hours
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-logs-during-downtime" class="md-nav__link">
    <span class="md-ellipsis">
      Get logs during "downtime"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-wevtutil-to-export-logs-export-log" class="md-nav__link">
    <span class="md-ellipsis">
      Use wevtutil to export logs (export-log)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-wevutil-to-get-last-20-startups-use-rcomputer-for-remote-and-qe-for-short-query" class="md-nav__link">
    <span class="md-ellipsis">
      Use wevutil to get last 20 startups (use /r:computer for remote and qe for short query)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-consolidated-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Windows consolidated logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows consolidated logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-a-detailed-list-of-all-security-auditing-event-entries-use-an-elevated-prompt" class="md-nav__link">
    <span class="md-ellipsis">
      Get a detailed list of all security-auditing event entries (use an elevated prompt)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-a-list-of-all-security-auditing-categories-and-subcategories-use-an-elevated-prompt" class="md-nav__link">
    <span class="md-ellipsis">
      Return a list of all security-auditing categories and subcategories (use an elevated prompt)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    <span class="md-ellipsis">
      Network
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network-flow-basics" class="md-nav__link">
    <span class="md-ellipsis">
      Network Flow Basics:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-pcap-carving-nix" class="md-nav__link">
    <span class="md-ellipsis">
      Basic PCAP Carving (*nix)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic PCAP Carving (*nix)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-certificates-from-pcap-use-bro-if-possible" class="md-nav__link">
    <span class="md-ellipsis">
      Get certificates from pcap (use BRO if possible)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-certificates-see-bro" class="md-nav__link">
    <span class="md-ellipsis">
      View certificates (see BRO)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-dns-queries-from-pcap-and-count-instances" class="md-nav__link">
    <span class="md-ellipsis">
      Get DNS queries from pcap and count instances
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-dns-queries-from-nx-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Get DNS queries from NX domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      DNS Response Codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-user-agents-from-pcap" class="md-nav__link">
    <span class="md-ellipsis">
      Get User-Agents from pcap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-info-for-frame-containing-search-dataf" class="md-nav__link">
    <span class="md-ellipsis">
      Get info for frame containing search dataf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-string-in-tcp-data-finds-data-not-in-field-ie-ua-in-json" class="md-nav__link">
    <span class="md-ellipsis">
      Search for string in tcp data (finds data not in field i.e. UA in json)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-strings-in-pcap" class="md-nav__link">
    <span class="md-ellipsis">
      Find strings in pcap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-frame-that-contains-string" class="md-nav__link">
    <span class="md-ellipsis">
      Get the frame that contains string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-packet-data-by-field" class="md-nav__link">
    <span class="md-ellipsis">
      Show packet data by field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-data-hex-from-first-two-packets-in-pcap" class="md-nav__link">
    <span class="md-ellipsis">
      Get data &amp; hex from first two packets in pcap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frames-that-have-tcp-header-length-gt-20-and-port-25" class="md-nav__link">
    <span class="md-ellipsis">
      Get frames that have tcp header length gt 20 and port 25
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-data-in-frames-that-have-tcp-header-length-gt-20-and-port-25" class="md-nav__link">
    <span class="md-ellipsis">
      Get data in frames that have tcp header length gt 20 and port 25
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frames-with-hex-data-0x7932" class="md-nav__link">
    <span class="md-ellipsis">
      Get frames with hex data 0x7932
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frames-and-show-hex-data" class="md-nav__link">
    <span class="md-ellipsis">
      Get frames and show hex data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-all-arp-request-and-count-request1-reply2" class="md-nav__link">
    <span class="md-ellipsis">
      Get all arp request and count (request=1, reply=2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-iplen-less-than-46-64-for-ethernet-minus-14-header-and-4-trailer-icmp-of-0" class="md-nav__link">
    <span class="md-ellipsis">
      Get ip.len less than 46 (64 for ethernet minus 14 header and 4 trailer) &amp; icmp of 0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-ip-option-of-loose-src-routing-with-offset-starting-at-ip-options" class="md-nav__link">
    <span class="md-ellipsis">
      Get ip option of loose src routing with offset starting at ip options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-info" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frame-with-ip-src-and-ack-flag-set" class="md-nav__link">
    <span class="md-ellipsis">
      Get frame with IP src and ACK flag set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frame-with-ip-src-and-ack-or-rst-flag-set" class="md-nav__link">
    <span class="md-ellipsis">
      Get frame with IP src and ACK or RST flag set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frame-with-dst-port-0-and-df-flag-set" class="md-nav__link">
    <span class="md-ellipsis">
      Get frame with dst port 0 and DF flag set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frame-with-net-1010101024" class="md-nav__link">
    <span class="md-ellipsis">
      Get frame with net 10.10.10.10/24
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frames-by-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Get frames by ip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-specific-frame-verbose-note-tcp-stream-index-number" class="md-nav__link">
    <span class="md-ellipsis">
      View specific frame verbose (note tcp stream index number)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#follow-tcp-stream-0-ascii-raw-hex" class="md-nav__link">
    <span class="md-ellipsis">
      Follow tcp stream 0 (ascii, raw, hex)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flow-data-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Flow Data Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flow Data Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-rwfilter-to-analyze-flow-data-by-ip-and-port" class="md-nav__link">
    <span class="md-ellipsis">
      Use rwfilter to analyze flow data by IP and port
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-detail-of-flow-data-by-ip-and-port" class="md-nav__link">
    <span class="md-ellipsis">
      View detail of flow data by IP and port
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-all-udp-from-flow-then-pipe-to-get-field-4-4dst-port-3srcport-5proto-6packets-etc" class="md-nav__link">
    <span class="md-ellipsis">
      Extract all UDP from flow then pipe to get field 4 (4=dst port, 3=srcport, 5=proto, 6=packets, etc)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-connections-from-108-with-a-reset-to-close-then-pipe-to-get-srcip-count" class="md-nav__link">
    <span class="md-ellipsis">
      Extract connections from 10/8 with a reset to close then pipe to get srcIP count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-rwstats-to-get-flow-data-of-top-5-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Use rwstats to get flow data of top 5 flows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-records-not-icmp-tcp-or-udp-note-fail-and-have-src-ip-of-1010101" class="md-nav__link">
    <span class="md-ellipsis">
      Extract records not ICMP, TCP or UDP (note fail) and have src IP of 10.10.10.1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-top-5-ip-with-data-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      Get top 5 IP with data transfer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-flows-with-larger-than-100000-bytes" class="md-nav__link">
    <span class="md-ellipsis">
      Get flows with larger than 100,000 bytes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-queries" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA (BRO queries)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ELSA (BRO queries)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elsa-most-common-svc" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA most common svc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-nx-domains" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO nx domains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-common-fqdn" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO common FQDN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-sites-hosting-exe" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO Sites hosting EXE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-uri-with-exe-downloads" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO URI with EXE downloads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-internal-ip-exe-download" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO Internal IP EXE download
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-connections-wo-ua-group-by-source-ip" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO connections w/o UA group by source IP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro" class="md-nav__link">
    <span class="md-ellipsis">
      BRO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BRO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bro-logs" class="md-nav__link">
    <span class="md-ellipsis">
      BRO Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-log-hunting" class="md-nav__link">
    <span class="md-ellipsis">
      BRO Log Hunting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-protocol-logs" class="md-nav__link">
    <span class="md-ellipsis">
      BRO Protocol Logs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-carving" class="md-nav__link">
    <span class="md-ellipsis">
      BRO Carving
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BRO Carving">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#read-and-output-bro-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Read and output bro logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-source-src-ip-dst-ip-dst-port-and-bytes-in-that-order" class="md-nav__link">
    <span class="md-ellipsis">
      Get source src ip, dst ip, dst port, and bytes (in that order)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#same-as-above-but-sort-by-bytes-field-5-reverse-by-number" class="md-nav__link">
    <span class="md-ellipsis">
      Same as above but sort by bytes (field 5 reverse by number)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-http-on-non-standard-ports-ssl" class="md-nav__link">
    <span class="md-ellipsis">
      Get http on non-standard ports (ssl?)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-dns-info-from-bro-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Extract DNS info from bro logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-user-agents" class="md-nav__link">
    <span class="md-ellipsis">
      Get User-Agents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-mime-types" class="md-nav__link">
    <span class="md-ellipsis">
      Get Mime Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-bro-outbound-signature-stored-in-sig-file-read-with-s" class="md-nav__link">
    <span class="md-ellipsis">
      Get bro outbound signature stored in .sig file (read with -s)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-bro-windows-shell-signature-stored-in-sig-file-read-with-s" class="md-nav__link">
    <span class="md-ellipsis">
      Get bro Windows Shell signature stored in .sig file (read with -s)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-bro-with-sig-file" class="md-nav__link">
    <span class="md-ellipsis">
      Run bro with sig file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-dst-addresses-in-signature-file" class="md-nav__link">
    <span class="md-ellipsis">
      View dst addresses in signature file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-event-script-to-find-user-agent-outboundbro" class="md-nav__link">
    <span class="md-ellipsis">
      BRO event script to find User-Agent (outbound.bro)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-event-file-to-view-user-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Run event file to view user-agent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-extract-common-files-from-pcap" class="md-nav__link">
    <span class="md-ellipsis">
      BRO extract common files from pcap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-ssl-info" class="md-nav__link">
    <span class="md-ellipsis">
      Extract ssl info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-extract-unique-ssl-certificate-data" class="md-nav__link">
    <span class="md-ellipsis">
      BRO extract unique SSL certificate data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-extract-ssl-issuer-data-from-certificate-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      BRO extract SSL issuer data from certificate extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-show-shortest-issuer-from-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      BRO show shortest issuer from extraction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modsecurity-rules" class="md-nav__link">
    <span class="md-ellipsis">
      ModSecurity rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ModSecurity rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#errorlog-ua-not-starting-with-mozilla" class="md-nav__link">
    <span class="md-ellipsis">
      error.log UA not starting with Mozilla
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-visiting-ip-url" class="md-nav__link">
    <span class="md-ellipsis">
      error.log visiting IP URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-blank-ua" class="md-nav__link">
    <span class="md-ellipsis">
      error.log blank UA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-ua-starting-with-mozilla" class="md-nav__link">
    <span class="md-ellipsis">
      error.log UA starting with mozilla
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-visiting-by-ip-log-ua-used" class="md-nav__link">
    <span class="md-ellipsis">
      error.log visiting by IP log UA used
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-no-ua-not-blank-but-none" class="md-nav__link">
    <span class="md-ellipsis">
      error.log no UA (not blank but none)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-note-param-entry" class="md-nav__link">
    <span class="md-ellipsis">
      error.log note param entry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-trigger-on-keyword-can-use-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      error.log trigger on keyword (can use pattern)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splunk" class="md-nav__link">
    <span class="md-ellipsis">
      Splunk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Splunk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-unauthorized-service" class="md-nav__link">
    <span class="md-ellipsis">
      New unauthorized service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-process-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting process abuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-process-abuse-simplified-requires-one-entry-per-process" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting process abuse (simplified, requires one entry per process)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-starts-and-connects-to-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Process starts and connects to IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-smb-traffic-between-clients" class="md-nav__link">
    <span class="md-ellipsis">
      Detect SMB traffic between clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-named-pipes" class="md-nav__link">
    <span class="md-ellipsis">
      Detect Named Pipes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-wmi" class="md-nav__link">
    <span class="md-ellipsis">
      Detect WMI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-powershell-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Detect PowerShell Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detect PowerShell Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alert-on-remote-files-copied-via-cmd-line" class="md-nav__link">
    <span class="md-ellipsis">
      Alert on remote files copied via cmd line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alert-on-c-or-admin-share-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Alert on C or Admin share enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-file-delivery" class="md-nav__link">
    <span class="md-ellipsis">
      Search for file delivery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-registry-run-or-runonce-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Search for Registry Run (or RunOnce) Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-file-system-persistence" class="md-nav__link">
    <span class="md-ellipsis">
      Search for file system persistence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-credential-harvesting" class="md-nav__link">
    <span class="md-ellipsis">
      Detect credential harvesting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#potential-privilege-escalation" class="md-nav__link">
    <span class="md-ellipsis">
      Potential Privilege Escalation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#potential-beaconing-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Potential Beaconing Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-webshell-activity-note-this-should-be-updated-at-implementation-and-often" class="md-nav__link">
    <span class="md-ellipsis">
      Detect webshell activity (note this should be updated at implementation and often)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-potential-sqli" class="md-nav__link">
    <span class="md-ellipsis">
      Detect potential SQLi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-http-post-with-response" class="md-nav__link">
    <span class="md-ellipsis">
      View HTTP POST with response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-weird-user-agents" class="md-nav__link">
    <span class="md-ellipsis">
      Find Weird User-Agents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-high-severity-epo-events" class="md-nav__link">
    <span class="md-ellipsis">
      Get high severity EPO events
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snort" class="md-nav__link">
    <span class="md-ellipsis">
      Snort
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Snort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detect-psexec" class="md-nav__link">
    <span class="md-ellipsis">
      Detect psexec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-packets-with-with-port-4444-port-0" class="md-nav__link">
    <span class="md-ellipsis">
      Detect packets with with port 4444 (port 0?)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snort-appid-list" class="md-nav__link">
    <span class="md-ellipsis">
      Snort appid list
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interesting-file-extensions-note-this-is-the-same-list-as-above-placed-here-for-use-in-monitoring-via-snort" class="md-nav__link">
    <span class="md-ellipsis">
      Interesting file extensions (Note this is the same list as above, placed here for use in monitoring via Snort)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-useful-info" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Useful Info
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Additional Useful Info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-methods-from-accesslog" class="md-nav__link">
    <span class="md-ellipsis">
      Get methods from access.log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decode-encoded-url-line-290" class="md-nav__link">
    <span class="md-ellipsis">
      Decode %encoded url (line 290)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gather-information-on-windows-host" class="md-nav__link">
    <span class="md-ellipsis">
      Gather Information on Windows host
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gather Information on Windows host">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-task-services" class="md-nav__link">
    <span class="md-ellipsis">
      List task services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-modules-for-task" class="md-nav__link">
    <span class="md-ellipsis">
      Show modules for task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verbose-task-information" class="md-nav__link">
    <span class="md-ellipsis">
      Verbose task information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-information-about-processes" class="md-nav__link">
    <span class="md-ellipsis">
      Get information about processes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#look-for-code-injected-into-memory" class="md-nav__link">
    <span class="md-ellipsis">
      Look for code injected into memory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automating-cobalt-strike-profiles-apache-mod_rewrite-htaccess-files-intelligent-c2-redirection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automating Cobalt Strike Profiles Apache mod_rewrite htaccess Files for Intelligent C2 Redirection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../threat-mitigation-strategies-observations-recommendations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threat Mitagation Strategies - Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hostenum-updates-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HostEnum - Updates and Usage Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2017
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            2017
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/metatwin-borrowing-microsoft-metadata-and-digital-signatures-to-hide-binaries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Borrowing Microsoft MetaData and Signatures to Hide Binary Payloads
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/install-bloodhound-ubuntu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install BloodHound on Ubuntu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/empire-modifying-server-c2-indicators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Empire Modifying Server C2 Indicators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/invoke-hostenum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Invoke-Hostenum
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2017/leveraging-expired-domains-for-red-team-engagements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Leveraging Expired Domains for Red Team Engagements
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2016
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            2016
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2016/slack-notifications-for-cobalt-strike/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slack Notifications for Cobalt Strike
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2016/web-shells-covert-channel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SubShell and TinyShell - Custom Covert Webshells
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2016/new-information-security-red-teaming-blog-threat-express-minis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    New Information Security and Red Teaming Blog Threat Express by MINIS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Red Teaming
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Red Teaming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    What is Red Teaming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/red_vs_pen_vs_vuln/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red vs Pen vs Vuln
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/rolesandrelationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Roles and Relationships
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/mitre_attack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Teaming and MITRE ATT&CK
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Red Team Planning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Red Team Planning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteamplanning/goalplanning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Goal Planing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteamplanning/redteamchecklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Team Checklist
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteamplanning/roeguide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Team ROE Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/redteamplanning/tradecraft/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tradecraft Guidance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Red Team IOCs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Red Team IOCs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/tool_ioc/tinyshell_ioc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TinyShell IOCs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/tool_ioc/psexec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PSEXEC IOCs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://jpcertcc.github.io/ToolAnalysisResultSheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JPCert IOCs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://digital-forensics.sans.org/media/SANS_Poster_2018_Hunt_Evil_FINAL.pdf" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SANS Hunt Evil
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Red Team Resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Red Team Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/cheatsheets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cheatsheets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    General Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/windowsactivedirectory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Attack Active Directory
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteaming/videos/videos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Team Videos
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../archive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Post Archive
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributors
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#account-management" class="md-nav__link">
    <span class="md-ellipsis">
      Account Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Account Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-password-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust Password Policy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adjust Password Policy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-the-password-policy-using-gpo" class="md-nav__link">
    <span class="md-ellipsis">
      Setting the Password Policy using GPO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#krbtgt-password-reset" class="md-nav__link">
    <span class="md-ellipsis">
      KRBTGT password reset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-laps-to-manage-the-local-administrator-rid-500-password" class="md-nav__link">
    <span class="md-ellipsis">
      Use LAPS to manage the local Administrator (RID 500) password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-managed-service-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Managed Service Accounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protected-lsa" class="md-nav__link">
    <span class="md-ellipsis">
      Protected LSA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Protected LSA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#protect-lsa-via-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Protect LSA Via policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protect-lsa-via-registry-entry" class="md-nav__link">
    <span class="md-ellipsis">
      Protect LSA Via Registry Entry
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#application-log" class="md-nav__link">
    <span class="md-ellipsis">
      Application log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-log" class="md-nav__link">
    <span class="md-ellipsis">
      Security log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-log" class="md-nav__link">
    <span class="md-ellipsis">
      Setup log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-log" class="md-nav__link">
    <span class="md-ellipsis">
      System log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forwardedevents-log" class="md-nav__link">
    <span class="md-ellipsis">
      ForwardedEvents log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applications-and-services-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Applications and Services Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applications and Services Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#admin" class="md-nav__link">
    <span class="md-ellipsis">
      Admin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operational" class="md-nav__link">
    <span class="md-ellipsis">
      Operational
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analytic" class="md-nav__link">
    <span class="md-ellipsis">
      Analytic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug" class="md-nav__link">
    <span class="md-ellipsis">
      Debug
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-audit-policy-should-focus-on-these-in-no-specific-order" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Audit Policy should focus on these (in no specific order)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Audit Policy should focus on these (in no specific order)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-command-line-logging-must-include-ms15-015-kb3031432" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Command Line Logging (Must include MS15-015 KB3031432)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#account-honeytoken-manual" class="md-nav__link">
    <span class="md-ellipsis">
      Account HoneyToken (manual)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#account-honeytoken-network" class="md-nav__link">
    <span class="md-ellipsis">
      Account HoneyToken (network)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spn-honeytoken" class="md-nav__link">
    <span class="md-ellipsis">
      SPN HoneyToken
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-module-logging" class="md-nav__link">
    <span class="md-ellipsis">
      PowerShell Module Logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PowerShell Module Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-parsing" class="md-nav__link">
    <span class="md-ellipsis">
      Log Parsing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse-powershell-events-for-the-following-mimikatz-indicators" class="md-nav__link">
    <span class="md-ellipsis">
      Parse PowerShell events for the following Mimikatz indicators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-offensive-powershell-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Offensive PowerShell Tools
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disable-windows-legacy-typically-unused-features" class="md-nav__link">
    <span class="md-ellipsis">
      Disable Windows Legacy &amp; Typically Unused Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Disable Windows Legacy &amp; Typically Unused Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#force-group-policy-to-reapply-settings-during-refresh" class="md-nav__link">
    <span class="md-ellipsis">
      Force Group Policy to reapply settings during "refresh"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-unneeded-services" class="md-nav__link">
    <span class="md-ellipsis">
      Disable Unneeded Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-net-session-enumeration-netcease" class="md-nav__link">
    <span class="md-ellipsis">
      Disable Net Session Enumeration (NetCease)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-wpad" class="md-nav__link">
    <span class="md-ellipsis">
      Disable WPAD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-llmnr" class="md-nav__link">
    <span class="md-ellipsis">
      Disable LLMNR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-wdigest" class="md-nav__link">
    <span class="md-ellipsis">
      Disable WDigest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-the-use-of-ntlm-v1" class="md-nav__link">
    <span class="md-ellipsis">
      Remove the use of NTLM v1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consider-other-mitigations" class="md-nav__link">
    <span class="md-ellipsis">
      Consider other Mitigations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-security-back-port-patch-kb2871997" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy security back-port patch (KB2871997)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevent-local-administrator-accounts-from-authenticating-over-the-network" class="md-nav__link">
    <span class="md-ellipsis">
      Prevent local "administrator" accounts from authenticating over the network
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prevent local &#34;administrator&#34; accounts from authenticating over the network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-through-group-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Configure through Group Policy:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Remote Connections
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Remote Connections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rdp-restricted-admin-connect-to-only-1-resource" class="md-nav__link">
    <span class="md-ellipsis">
      RDP Restricted Admin (Connect to only 1 resource)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RDP Restricted Admin (Connect to only 1 resource)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-restricted-admin-via-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Restricted Admin via Registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-restricted-admin-via-gpo" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Restricted Admin via GPO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdp-windows-defender-remote-credential-guard-connect-to-multiple-resources" class="md-nav__link">
    <span class="md-ellipsis">
      RDP Windows Defender Remote Credential Guard (Connect to multiple resources)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RDP Windows Defender Remote Credential Guard (Connect to multiple resources)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-windows-defender-credential-guard-via-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Windows Defender Credential Guard via Registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-windef-cred-guard-via-gpo" class="md-nav__link">
    <span class="md-ellipsis">
      Enable WinDef Cred Guard via GPO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit-client-to-client-communication-implement-and-configure-host-based-firewalls" class="md-nav__link">
    <span class="md-ellipsis">
      Limit Client-to-Client Communication (Implement and Configure Host Based Firewalls)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Limit Client-to-Client Communication (Implement and Configure Host Based Firewalls)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-firewall" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Firewall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blockcontrol-tcpudp-access-from-the-internal-network-and-dmz" class="md-nav__link">
    <span class="md-ellipsis">
      Block/control TCP/UDP access from the Internal network and DMZ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block-out-bound-tcpudp-access-from-the-client-systems-to-outbound-networks" class="md-nav__link">
    <span class="md-ellipsis">
      Block out bound TCP/UDP access from the Client systems to outbound networks.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-a-proxy-for-all-outbound-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      Implement a Proxy for All Outbound Traffic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement a Proxy for All Outbound Traffic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-new-gpo-to-manage-the-proxy-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Create a new GPO to manage the proxy settings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configurations" class="md-nav__link">
    <span class="md-ellipsis">
      Configurations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoruns" class="md-nav__link">
    <span class="md-ellipsis">
      AutoRuns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-whiteblack-listing" class="md-nav__link">
    <span class="md-ellipsis">
      Application White/Black listing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applocker" class="md-nav__link">
    <span class="md-ellipsis">
      Applocker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applocker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#applocker-executable-path-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      AppLocker Executable Path Restrictions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AppLocker Executable Path Restrictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interesting-paths" class="md-nav__link">
    <span class="md-ellipsis">
      Interesting Paths
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explicit-whitelisting" class="md-nav__link">
    <span class="md-ellipsis">
      Explicit Whitelisting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interesting-file-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Interesting file extensions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-hunting-and-detection-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Hunting and Detection Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual Hunting and Detection Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtering-event-logs-via-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Filtering Event Logs via PowerShell
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filtering Event Logs via PowerShell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-locations-on-disk-only-use-event-viewer-or-cli-to-copy" class="md-nav__link">
    <span class="md-ellipsis">
      Log locations on disk (only use event viewer or cli to copy)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-times-service-was-installed-all-evtx-files-should-be-system-and-count" class="md-nav__link">
    <span class="md-ellipsis">
      Get times Service was installed (all evtx files, should be system) and count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-blocked-events" class="md-nav__link">
    <span class="md-ellipsis">
      Get blocked events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-windowsdefender-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Get WindowsDefender actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-windowsdefender-detections" class="md-nav__link">
    <span class="md-ellipsis">
      Get WindowsDefender detections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-files-by-extension-with-search-from-application-crash" class="md-nav__link">
    <span class="md-ellipsis">
      Get files (by extension) with search from Application (crash)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-emet-events" class="md-nav__link">
    <span class="md-ellipsis">
      Get EMET events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-service-installs-and-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Get service installs and errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-usb-loading" class="md-nav__link">
    <span class="md-ellipsis">
      Search for USB loading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-errorwarninginfo" class="md-nav__link">
    <span class="md-ellipsis">
      Search for error/warning/info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-remote-eventlog-caution-this-drops-credentials-onto-remote-system" class="md-nav__link">
    <span class="md-ellipsis">
      Get remote eventlog (caution this drops credentials onto remote system)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-log-within-x-hours" class="md-nav__link">
    <span class="md-ellipsis">
      Get log within X hours
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-logs-during-downtime" class="md-nav__link">
    <span class="md-ellipsis">
      Get logs during "downtime"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-wevtutil-to-export-logs-export-log" class="md-nav__link">
    <span class="md-ellipsis">
      Use wevtutil to export logs (export-log)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-wevutil-to-get-last-20-startups-use-rcomputer-for-remote-and-qe-for-short-query" class="md-nav__link">
    <span class="md-ellipsis">
      Use wevutil to get last 20 startups (use /r:computer for remote and qe for short query)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-consolidated-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Windows consolidated logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows consolidated logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-a-detailed-list-of-all-security-auditing-event-entries-use-an-elevated-prompt" class="md-nav__link">
    <span class="md-ellipsis">
      Get a detailed list of all security-auditing event entries (use an elevated prompt)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-a-list-of-all-security-auditing-categories-and-subcategories-use-an-elevated-prompt" class="md-nav__link">
    <span class="md-ellipsis">
      Return a list of all security-auditing categories and subcategories (use an elevated prompt)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    <span class="md-ellipsis">
      Network
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network-flow-basics" class="md-nav__link">
    <span class="md-ellipsis">
      Network Flow Basics:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-pcap-carving-nix" class="md-nav__link">
    <span class="md-ellipsis">
      Basic PCAP Carving (*nix)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic PCAP Carving (*nix)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-certificates-from-pcap-use-bro-if-possible" class="md-nav__link">
    <span class="md-ellipsis">
      Get certificates from pcap (use BRO if possible)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-certificates-see-bro" class="md-nav__link">
    <span class="md-ellipsis">
      View certificates (see BRO)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-dns-queries-from-pcap-and-count-instances" class="md-nav__link">
    <span class="md-ellipsis">
      Get DNS queries from pcap and count instances
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-dns-queries-from-nx-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Get DNS queries from NX domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      DNS Response Codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-user-agents-from-pcap" class="md-nav__link">
    <span class="md-ellipsis">
      Get User-Agents from pcap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-info-for-frame-containing-search-dataf" class="md-nav__link">
    <span class="md-ellipsis">
      Get info for frame containing search dataf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-string-in-tcp-data-finds-data-not-in-field-ie-ua-in-json" class="md-nav__link">
    <span class="md-ellipsis">
      Search for string in tcp data (finds data not in field i.e. UA in json)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-strings-in-pcap" class="md-nav__link">
    <span class="md-ellipsis">
      Find strings in pcap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-frame-that-contains-string" class="md-nav__link">
    <span class="md-ellipsis">
      Get the frame that contains string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-packet-data-by-field" class="md-nav__link">
    <span class="md-ellipsis">
      Show packet data by field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-data-hex-from-first-two-packets-in-pcap" class="md-nav__link">
    <span class="md-ellipsis">
      Get data &amp; hex from first two packets in pcap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frames-that-have-tcp-header-length-gt-20-and-port-25" class="md-nav__link">
    <span class="md-ellipsis">
      Get frames that have tcp header length gt 20 and port 25
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-data-in-frames-that-have-tcp-header-length-gt-20-and-port-25" class="md-nav__link">
    <span class="md-ellipsis">
      Get data in frames that have tcp header length gt 20 and port 25
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frames-with-hex-data-0x7932" class="md-nav__link">
    <span class="md-ellipsis">
      Get frames with hex data 0x7932
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frames-and-show-hex-data" class="md-nav__link">
    <span class="md-ellipsis">
      Get frames and show hex data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-all-arp-request-and-count-request1-reply2" class="md-nav__link">
    <span class="md-ellipsis">
      Get all arp request and count (request=1, reply=2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-iplen-less-than-46-64-for-ethernet-minus-14-header-and-4-trailer-icmp-of-0" class="md-nav__link">
    <span class="md-ellipsis">
      Get ip.len less than 46 (64 for ethernet minus 14 header and 4 trailer) &amp; icmp of 0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-ip-option-of-loose-src-routing-with-offset-starting-at-ip-options" class="md-nav__link">
    <span class="md-ellipsis">
      Get ip option of loose src routing with offset starting at ip options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-info" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frame-with-ip-src-and-ack-flag-set" class="md-nav__link">
    <span class="md-ellipsis">
      Get frame with IP src and ACK flag set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frame-with-ip-src-and-ack-or-rst-flag-set" class="md-nav__link">
    <span class="md-ellipsis">
      Get frame with IP src and ACK or RST flag set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frame-with-dst-port-0-and-df-flag-set" class="md-nav__link">
    <span class="md-ellipsis">
      Get frame with dst port 0 and DF flag set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frame-with-net-1010101024" class="md-nav__link">
    <span class="md-ellipsis">
      Get frame with net 10.10.10.10/24
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-frames-by-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Get frames by ip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-specific-frame-verbose-note-tcp-stream-index-number" class="md-nav__link">
    <span class="md-ellipsis">
      View specific frame verbose (note tcp stream index number)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#follow-tcp-stream-0-ascii-raw-hex" class="md-nav__link">
    <span class="md-ellipsis">
      Follow tcp stream 0 (ascii, raw, hex)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flow-data-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Flow Data Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flow Data Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-rwfilter-to-analyze-flow-data-by-ip-and-port" class="md-nav__link">
    <span class="md-ellipsis">
      Use rwfilter to analyze flow data by IP and port
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-detail-of-flow-data-by-ip-and-port" class="md-nav__link">
    <span class="md-ellipsis">
      View detail of flow data by IP and port
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-all-udp-from-flow-then-pipe-to-get-field-4-4dst-port-3srcport-5proto-6packets-etc" class="md-nav__link">
    <span class="md-ellipsis">
      Extract all UDP from flow then pipe to get field 4 (4=dst port, 3=srcport, 5=proto, 6=packets, etc)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-connections-from-108-with-a-reset-to-close-then-pipe-to-get-srcip-count" class="md-nav__link">
    <span class="md-ellipsis">
      Extract connections from 10/8 with a reset to close then pipe to get srcIP count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-rwstats-to-get-flow-data-of-top-5-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Use rwstats to get flow data of top 5 flows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-records-not-icmp-tcp-or-udp-note-fail-and-have-src-ip-of-1010101" class="md-nav__link">
    <span class="md-ellipsis">
      Extract records not ICMP, TCP or UDP (note fail) and have src IP of 10.10.10.1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-top-5-ip-with-data-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      Get top 5 IP with data transfer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-flows-with-larger-than-100000-bytes" class="md-nav__link">
    <span class="md-ellipsis">
      Get flows with larger than 100,000 bytes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-queries" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA (BRO queries)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ELSA (BRO queries)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elsa-most-common-svc" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA most common svc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-nx-domains" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO nx domains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-common-fqdn" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO common FQDN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-sites-hosting-exe" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO Sites hosting EXE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-uri-with-exe-downloads" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO URI with EXE downloads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-internal-ip-exe-download" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO Internal IP EXE download
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elsa-bro-connections-wo-ua-group-by-source-ip" class="md-nav__link">
    <span class="md-ellipsis">
      ELSA BRO connections w/o UA group by source IP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro" class="md-nav__link">
    <span class="md-ellipsis">
      BRO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BRO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bro-logs" class="md-nav__link">
    <span class="md-ellipsis">
      BRO Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-log-hunting" class="md-nav__link">
    <span class="md-ellipsis">
      BRO Log Hunting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-protocol-logs" class="md-nav__link">
    <span class="md-ellipsis">
      BRO Protocol Logs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-carving" class="md-nav__link">
    <span class="md-ellipsis">
      BRO Carving
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BRO Carving">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#read-and-output-bro-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Read and output bro logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-source-src-ip-dst-ip-dst-port-and-bytes-in-that-order" class="md-nav__link">
    <span class="md-ellipsis">
      Get source src ip, dst ip, dst port, and bytes (in that order)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#same-as-above-but-sort-by-bytes-field-5-reverse-by-number" class="md-nav__link">
    <span class="md-ellipsis">
      Same as above but sort by bytes (field 5 reverse by number)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-http-on-non-standard-ports-ssl" class="md-nav__link">
    <span class="md-ellipsis">
      Get http on non-standard ports (ssl?)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-dns-info-from-bro-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Extract DNS info from bro logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-user-agents" class="md-nav__link">
    <span class="md-ellipsis">
      Get User-Agents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-mime-types" class="md-nav__link">
    <span class="md-ellipsis">
      Get Mime Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-bro-outbound-signature-stored-in-sig-file-read-with-s" class="md-nav__link">
    <span class="md-ellipsis">
      Get bro outbound signature stored in .sig file (read with -s)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-bro-windows-shell-signature-stored-in-sig-file-read-with-s" class="md-nav__link">
    <span class="md-ellipsis">
      Get bro Windows Shell signature stored in .sig file (read with -s)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-bro-with-sig-file" class="md-nav__link">
    <span class="md-ellipsis">
      Run bro with sig file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-dst-addresses-in-signature-file" class="md-nav__link">
    <span class="md-ellipsis">
      View dst addresses in signature file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-event-script-to-find-user-agent-outboundbro" class="md-nav__link">
    <span class="md-ellipsis">
      BRO event script to find User-Agent (outbound.bro)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-event-file-to-view-user-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Run event file to view user-agent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-extract-common-files-from-pcap" class="md-nav__link">
    <span class="md-ellipsis">
      BRO extract common files from pcap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-ssl-info" class="md-nav__link">
    <span class="md-ellipsis">
      Extract ssl info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-extract-unique-ssl-certificate-data" class="md-nav__link">
    <span class="md-ellipsis">
      BRO extract unique SSL certificate data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-extract-ssl-issuer-data-from-certificate-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      BRO extract SSL issuer data from certificate extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bro-show-shortest-issuer-from-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      BRO show shortest issuer from extraction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modsecurity-rules" class="md-nav__link">
    <span class="md-ellipsis">
      ModSecurity rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ModSecurity rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#errorlog-ua-not-starting-with-mozilla" class="md-nav__link">
    <span class="md-ellipsis">
      error.log UA not starting with Mozilla
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-visiting-ip-url" class="md-nav__link">
    <span class="md-ellipsis">
      error.log visiting IP URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-blank-ua" class="md-nav__link">
    <span class="md-ellipsis">
      error.log blank UA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-ua-starting-with-mozilla" class="md-nav__link">
    <span class="md-ellipsis">
      error.log UA starting with mozilla
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-visiting-by-ip-log-ua-used" class="md-nav__link">
    <span class="md-ellipsis">
      error.log visiting by IP log UA used
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-no-ua-not-blank-but-none" class="md-nav__link">
    <span class="md-ellipsis">
      error.log no UA (not blank but none)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-note-param-entry" class="md-nav__link">
    <span class="md-ellipsis">
      error.log note param entry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorlog-trigger-on-keyword-can-use-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      error.log trigger on keyword (can use pattern)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splunk" class="md-nav__link">
    <span class="md-ellipsis">
      Splunk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Splunk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-unauthorized-service" class="md-nav__link">
    <span class="md-ellipsis">
      New unauthorized service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-process-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting process abuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-process-abuse-simplified-requires-one-entry-per-process" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting process abuse (simplified, requires one entry per process)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-starts-and-connects-to-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Process starts and connects to IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-smb-traffic-between-clients" class="md-nav__link">
    <span class="md-ellipsis">
      Detect SMB traffic between clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-named-pipes" class="md-nav__link">
    <span class="md-ellipsis">
      Detect Named Pipes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-wmi" class="md-nav__link">
    <span class="md-ellipsis">
      Detect WMI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-powershell-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Detect PowerShell Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detect PowerShell Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alert-on-remote-files-copied-via-cmd-line" class="md-nav__link">
    <span class="md-ellipsis">
      Alert on remote files copied via cmd line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alert-on-c-or-admin-share-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Alert on C or Admin share enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-file-delivery" class="md-nav__link">
    <span class="md-ellipsis">
      Search for file delivery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-registry-run-or-runonce-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Search for Registry Run (or RunOnce) Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-for-file-system-persistence" class="md-nav__link">
    <span class="md-ellipsis">
      Search for file system persistence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-credential-harvesting" class="md-nav__link">
    <span class="md-ellipsis">
      Detect credential harvesting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#potential-privilege-escalation" class="md-nav__link">
    <span class="md-ellipsis">
      Potential Privilege Escalation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#potential-beaconing-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Potential Beaconing Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-webshell-activity-note-this-should-be-updated-at-implementation-and-often" class="md-nav__link">
    <span class="md-ellipsis">
      Detect webshell activity (note this should be updated at implementation and often)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-potential-sqli" class="md-nav__link">
    <span class="md-ellipsis">
      Detect potential SQLi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-http-post-with-response" class="md-nav__link">
    <span class="md-ellipsis">
      View HTTP POST with response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-weird-user-agents" class="md-nav__link">
    <span class="md-ellipsis">
      Find Weird User-Agents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-high-severity-epo-events" class="md-nav__link">
    <span class="md-ellipsis">
      Get high severity EPO events
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snort" class="md-nav__link">
    <span class="md-ellipsis">
      Snort
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Snort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detect-psexec" class="md-nav__link">
    <span class="md-ellipsis">
      Detect psexec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detect-packets-with-with-port-4444-port-0" class="md-nav__link">
    <span class="md-ellipsis">
      Detect packets with with port 4444 (port 0?)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snort-appid-list" class="md-nav__link">
    <span class="md-ellipsis">
      Snort appid list
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interesting-file-extensions-note-this-is-the-same-list-as-above-placed-here-for-use-in-monitoring-via-snort" class="md-nav__link">
    <span class="md-ellipsis">
      Interesting file extensions (Note this is the same list as above, placed here for use in monitoring via Snort)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-useful-info" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Useful Info
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Additional Useful Info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-methods-from-accesslog" class="md-nav__link">
    <span class="md-ellipsis">
      Get methods from access.log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decode-encoded-url-line-290" class="md-nav__link">
    <span class="md-ellipsis">
      Decode %encoded url (line 290)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gather-information-on-windows-host" class="md-nav__link">
    <span class="md-ellipsis">
      Gather Information on Windows host
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gather Information on Windows host">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-task-services" class="md-nav__link">
    <span class="md-ellipsis">
      List task services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-modules-for-task" class="md-nav__link">
    <span class="md-ellipsis">
      Show modules for task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verbose-task-information" class="md-nav__link">
    <span class="md-ellipsis">
      Verbose task information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-information-about-processes" class="md-nav__link">
    <span class="md-ellipsis">
      Get information about processes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#look-for-code-injected-into-memory" class="md-nav__link">
    <span class="md-ellipsis">
      Look for code injected into memory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="threat-mitigation-strategies-part-2">Threat Mitigation Strategies: Part 2<a class="headerlink" href="#threat-mitigation-strategies-part-2" title="Permanent link">&para;</a></h1>
<p><strong>James Tubberville | May 15, 2018 | Tweet This Post: <a href="https://twitter.com/intent/tweet?url=http://threatexpress.com/blogs/2018/threat-mitigation-strategies-technical-recommendations-and-info-part-2/&amp;text=Threat Mitigation Strategies - Part 2"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg></span></a></strong></p>
<p><em>The following information was composed by Andrew Chiles (@andrewchiles), Joe Vest (@joevest) and myself (@minis_io) for quick and easy reference. Much of it was pulled together from a variety of sources with attempts to provide references for each. This post is intended to be more of a brain dump rather than a complete technical breakout.</em></p>
<p><img alt="minis_io defender" src="/img/20180515_094034_defend-300x300.png" /></p>
<p>As discussed in the Threat Mitigation Strategies Part 1 <a href="http://threatexpress.com/blogs/2018/threat-mitigation-strategies-observations-recommendations/">http://threatexpress.com/blogs/2018/threat-mitigation-strategies-observations-recommendations/</a>, there is commonality between the inherent weaknesses and the actions a threat might perform within an information system or network. The following recommendations and informational snippets were derived from many offensive and defensive efforts that continue to support these correlations. Each recommendation and snippet can <strong>and very likely should</strong> be applied to all networks. Some systems and networks will have exceptions; however, these are exceptions (not the status quo) and should be handled as such. Also note the exact syntax and use will vary with the network construct, operating system/version, and legal/regulatory security requirements.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>Technical recommendations within this blog entry will be periodically updated on <a href="https://github.com/threatexpress/threat-mitigation">ThreatExpress' GitHub</a></p>
<hr />
<h2 id="account-management">Account Management<a class="headerlink" href="#account-management" title="Permanent link">&para;</a></h2>
<p>Accounts should have specific roles.</p>
<p><strong>General Guidelines</strong></p>
<ul>
<li>Domain Administrators perform management of Windows Active Directory. They do not manage servers or workstations.</li>
<li>Server Administrators perform management of servers. They do not manage workstations.</li>
<li>Workstation Administrators perform management of workstation. They do not manage servers.</li>
<li>Privileged accounts should NOT have external communications (Internet, email, etc.)</li>
<li>Standard users should NOT have elevated access (use secondary accounts if required)</li>
</ul>
<h3 id="adjust-password-policy">Adjust Password Policy<a class="headerlink" href="#adjust-password-policy" title="Permanent link">&para;</a></h3>
<p>Adjust password policy to conform to "800-63-3: Digital Identity Guidelines".</p>
<ul>
<li>Remove periodic password change requirements</li>
<li>Passwords should only be changed if forgotten or suspected compromise</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
</div>
<p>I don't agree with the two above and recommend maintaining a reasonable duration for password change requirements</p>
<ul>
<li>Remove complexity requirements (Upper/Lower/Number/Special character)</li>
<li>Require a minimum password length of</li>
<li>A minimum length of 8 is required by NIST, but minimum of <strong>16</strong> is recommended for user accounts</li>
<li>A minimum length of 20 (28+ is recommended) for service accounts</li>
<li>Suggest the use of pass-phrases (such as four random lowercase words). <strong>Example:</strong> "correct horse battery staple!"</li>
<li>Screen passwords against password compromise lists</li>
<li>Screen passwords against keyboard walks</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>Meeting the complexity recommendation may not be possible due to current compliance requirements.</p>
<h4 id="setting-the-password-policy-using-gpo">Setting the Password Policy using GPO<a class="headerlink" href="#setting-the-password-policy-using-gpo" title="Permanent link">&para;</a></h4>
<p>Edit the "Domain Password Policy" GPO to configure the appropriate password length</p>
<div class="highlight"><pre><span></span><code>1. Open Group Policy
2. Computer Configurations &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Account Policy &gt; Password Policy
3. Minimum password length: 20
</code></pre></div>
<h3 id="krbtgt-password-reset">KRBTGT password reset<a class="headerlink" href="#krbtgt-password-reset" title="Permanent link">&para;</a></h3>
<p>Regularly reset the KRBTGT password to minimize stolen credentials from be used in the future.</p>
<div class="highlight"><pre><span></span><code>Review the reset tool guide &quot;Guide to Running New-CtmADKrbtgtKeys&quot; (see references)
Use the the PowerShell script New-CtmADKrbtgtKeys.ps1 to reset the KRBTGT
Wait 24 hours and execute the change a 2nd time
Recommend running on a regular schedule. This should be monthly, quarterly (at most), or after an incident where compromise is suspected.
</code></pre></div>
<p><strong>References</strong></p>
<ul>
<li><a href="https://gallery.technet.microsoft.com/Reset-the-krbtgt-account-581a9e51">https://gallery.technet.microsoft.com/Reset-the-krbtgt-account-581a9e51</a></li>
<li><a href="https://adsecurity.org/?p=483">https://adsecurity.org/?p=483</a></li>
</ul>
<hr />
<h3 id="use-laps-to-manage-the-local-administrator-rid-500-password">Use LAPS to manage the local Administrator (RID 500) password<a class="headerlink" href="#use-laps-to-manage-the-local-administrator-rid-500-password" title="Permanent link">&para;</a></h3>
<ul>
<li>Install KB2871997</li>
<li>Follow details outlined at <a href="https://adsecurity.org/?p=1790">https://adsecurity.org/?p=1790</a></li>
</ul>
<p><strong>References</strong></p>
<ul>
<li><a href="https://adsecurity.org/?p=1790">https://adsecurity.org/?p=1790</a></li>
<li><a href="https://adsecurity.org/?p=559">https://adsecurity.org/?p=559</a></li>
</ul>
<hr />
<h3 id="implement-managed-service-accounts">Implement Managed Service Accounts<a class="headerlink" href="#implement-managed-service-accounts" title="Permanent link">&para;</a></h3>
<p>Windows Server 2008 R2 and Windows 7 introduced Managed Service Accounts. MSA's allow you to create an account in Active Directory that is tied to a specific computer. That account has its own complex password (see password policy) and is maintained automatically. This means that an MSA can run services on a computer in a secure and easy to maintain manner, while maintaining the capability to connect to network resources as a specific user principal.</p>
<p>Group level MSA's can be deployed in Windows 2012 or higher Domains.</p>
<p><strong>Reference</strong></p>
<ul>
<li><a href="https://blogs.technet.microsoft.com/askds/2009/09/10/managed-service-accounts-understanding-implementing-best-practices-and-troubleshooting/">https://blogs.technet.microsoft.com/askds/2009/09/10/managed-service-accounts-understanding-implementing-best-practices-and-troubleshooting/</a></li>
<li><a href="https://technet.microsoft.com/en-us/library/hh831782.aspx">https://technet.microsoft.com/en-us/library/hh831782.aspx</a></li>
</ul>
<hr />
<h3 id="protected-lsa">Protected LSA<a class="headerlink" href="#protected-lsa" title="Permanent link">&para;</a></h3>
<h4 id="protect-lsa-via-policy">Protect LSA Via policy<a class="headerlink" href="#protect-lsa-via-policy" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>1. Advanced Audit Policy Configuration &gt; Object Access &gt; Audit Kernel Object
2. Enable SACL L&quot;S:(AU;SAFA;0x0010;;;WD)&quot;
</code></pre></div>
<p>and</p>
<div class="highlight"><pre><span></span><code>1. Computer Configuration &gt; Preferences &gt; Windows Settings
2. Right-click Registry &gt; New &gt; Registry Item
3. Hive HKLM &gt; Path SYSTEMCurrentControlSetControlLsa
4. DWORD value RunAsPPL=00000001
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>LSA Protection prevents non-protected processes from interacting with LSASS. Mimikatz can still bypass this with a driver ("!+").</p>
<h4 id="protect-lsa-via-registry-entry">Protect LSA Via Registry Entry<a class="headerlink" href="#protect-lsa-via-registry-entry" title="Permanent link">&para;</a></h4>
<p><code>Manually create registry entry HKEY_LOCAL_MACHINESystemCurrentControlSetControlLsa DWORD RunAsPPL=00000001</code></p>
<p>or</p>
<p><code>reg add HKEY_LOCAL_MACHINESystemCurrentControlSetControlLsa /v RunAsPPL /d 00000001 /t REG_DWORD</code></p>
<hr />
<p>Windows Event Forwarding (WEF) reads any operational or administrative event log on a device in your organization and forwards the events you choose to a Windows Event Collector (WEC) server.</p>
<h2 id="windows-logs">Windows Logs<a class="headerlink" href="#windows-logs" title="Permanent link">&para;</a></h2>
<p>The Windows Logs category includes the logs that were available on previous versions of Windows: the Application, Security, and System logs. It also includes two new logs: the Setup log and the ForwardedEvents log. Windows logs are intended to store events from legacy applications and events that apply to the entire system.</p>
<h5 id="application-log">Application log<a class="headerlink" href="#application-log" title="Permanent link">&para;</a></h5>
<p>The Application log contains events logged by applications or programs. For example, a database program might record a file error in the application log. Program developers decide which events to log.</p>
<h5 id="security-log">Security log<a class="headerlink" href="#security-log" title="Permanent link">&para;</a></h5>
<p>The Security log contains events such as valid and invalid logon attempts, as well as events related to resource use, such as creating, opening, or deleting files or other objects. Administrators can specify what events are recorded in the security log. For example, if you have enabled logon auditing, attempts to log on to the system are recorded in the security log.</p>
<h5 id="setup-log">Setup log<a class="headerlink" href="#setup-log" title="Permanent link">&para;</a></h5>
<p>The Setup log contains events related to application setup.</p>
<h5 id="system-log">System log<a class="headerlink" href="#system-log" title="Permanent link">&para;</a></h5>
<p>The System log contains events logged by Windows system components. For example, the failure of a driver or other system component to load during startup is recorded in the system log. The event types logged by system components are predetermined by Windows.</p>
<h5 id="forwardedevents-log">ForwardedEvents log<a class="headerlink" href="#forwardedevents-log" title="Permanent link">&para;</a></h5>
<p>The ForwardedEvents log is used to store events collected from remote computers. To collect events from remote computers, you must create an event subscription. To learn about event subscriptions, see Event Subscriptions.</p>
<h4 id="applications-and-services-logs">Applications and Services Logs<a class="headerlink" href="#applications-and-services-logs" title="Permanent link">&para;</a></h4>
<p>Applications and Services logs are a new category of event logs. These logs store events from a single application or component rather than events that might have system wide impact.</p>
<p>This category of logs includes four subtypes: Admin, Operational, Analytic, and Debug logs. Events in Admin logs are of particular interest to IT Professionals using the Event Viewer to troubleshoot problems. Events in the Admin log should provide you with guidance about how to respond to them. Events in the Operational log are also useful for IT Professionals, but they are likely to require more interpretation.</p>
<p>Admin and Debug logs are not as user friendly. Analytic logs store events that trace an issue and, often, a high volume of events are logged. Debug logs are used by developers when debugging applications. Both Analytic and Debug logs are hidden and disabled by default. To make these logs visible, follow the steps in Show or Hide Analytic and Debug Logs. To enable these logs, follow the steps in Enable Analytic and Debug Logs.</p>
<h5 id="admin">Admin<a class="headerlink" href="#admin" title="Permanent link">&para;</a></h5>
<p>These events are primarily targeted at end users, administrators, and support personnel. The events that are found in the Admin channels indicate a problem and a well-defined solution that an administrator can act on. An example of an admin event is an event that occurs when an application fails to connect to a printer. These events are either well documented or have a message associated with them that gives the reader direct instructions of what must be done to rectify the problem.</p>
<h5 id="operational">Operational<a class="headerlink" href="#operational" title="Permanent link">&para;</a></h5>
<p>Operational events are used for analyzing and diagnosing a problem or occurrence. They can be used to trigger tools or tasks based on the problem or occurrence. An example of an operational event is an event that occurs when a printer is added or removed from a system.</p>
<h5 id="analytic">Analytic<a class="headerlink" href="#analytic" title="Permanent link">&para;</a></h5>
<p>Analytic events are published in high volume. They describe program operation and indicate problems that cannot be handled by user intervention.</p>
<h5 id="debug">Debug<a class="headerlink" href="#debug" title="Permanent link">&para;</a></h5>
<p>Debug events are used by developers troubleshooting issues with their programs.</p>
<hr />
<h3 id="advanced-audit-policy-should-focus-on-these-in-no-specific-order">Advanced Audit Policy should focus on these (in no specific order)<a class="headerlink" href="#advanced-audit-policy-should-focus-on-these-in-no-specific-order" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>1. A logon was attempted using explicit credentials: Event 552 and 4648
2. A member was added to a security-enabled global group: Event 4728
3. A member was added to a security-enabled local group: Event 4732
4. A member was added to a security-enabled universal group: Event 4756
5. An account failed to log on: Event 529-539 4625 (followed by a success 4624)
6. LogonAccount/TargetUserName is Administrator (Using RID-500): Event 4624, 4776
7. Scheduled Task Creation: Event 602, 4698
8. Log was cleared: Event 104 and 1102, 4949
9. EMET dies: Event 1 and 2
10. Application Error or Hang: Event 1000 and 1002
11. Windows Defender Errors: Event 1005, 1006, 1008, 1010, 2001, 2003, 2004, 3002, 5008
12. New process: User NOT admin and Event 4688
(arp, at, bcdedit, certutil, cscript, cmd, dsquery, hostname, ipconfig, msbuild, nbtstat, net, netsh, netstat, nslookup, ntdsutil, pcalua, ping, powershell, psexec, reg, regasm, regedit, regedt32, regsvr32, regsvcs, rundll32, set, sc, schtasks, systeminfo, tasklist, tracert, whoami, wmic, wscript, wsmprovhost)
13. Service creation/install: Event 601, 4697, 7045
14. Service changes: Event 7040
15. File share access/attempts (C$, ADMIN$, IPC$): Event 5140
16. PowerShell execution and module loading: Event 501 and 4104 respectively
17. External media detection: All Events 7045, 10000, 10001 or 10002, 10100, 20001, 20003, 24576, 24577, 24579
18. User creation: Event 4720
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
</div>
<p>It's a good idea to hide/exclude these events except specific conditions (See caveats above) as these are consistently rolling: 4688,4689,5156,5158</p>
<h5 id="enable-command-line-logging-must-include-ms15-015-kb3031432">Enable Command Line Logging (Must include MS15-015 KB3031432)<a class="headerlink" href="#enable-command-line-logging-must-include-ms15-015-kb3031432" title="Permanent link">&para;</a></h5>
<p><code>HKLMSoftwareMicrosoftWindowsCurrentVersionPoliciesSystemAudit DWORD ProcessCreationIncludeCmdLine_Enabled=1</code></p>
<h5 id="account-honeytoken-manual">Account HoneyToken (manual)<a class="headerlink" href="#account-honeytoken-manual" title="Permanent link">&para;</a></h5>
<p><code>echo "crazypassword" | runas /u:yourdomain.comXadmin /netonly ipconfig</code></p>
<p>Consider a check on 4625 where Xadmin is found</p>
<p>Also add hash of crazypassword to IDS and alert when seen</p>
<h5 id="account-honeytoken-network">Account HoneyToken (network)<a class="headerlink" href="#account-honeytoken-network" title="Permanent link">&para;</a></h5>
<p><code>Invoke-HoneyCreds.ps1</code></p>
<p>Reference: <a href="https://github.com/Ben0xA/PowerShellDefense/blob/master/Invoke-HoneyCreds.ps1">https://github.com/Ben0xA/PowerShellDefense/blob/master/Invoke-HoneyCreds.ps1</a></p>
<h5 id="spn-honeytoken">SPN HoneyToken<a class="headerlink" href="#spn-honeytoken" title="Permanent link">&para;</a></h5>
<p><code>Set-ADUser watchaccount -ServicePrincipalNames @{Add="MSSQLSvc/sql1:1433″}</code></p>
<hr />
<h3 id="powershell-module-logging">PowerShell Module Logging<a class="headerlink" href="#powershell-module-logging" title="Permanent link">&para;</a></h3>
<p>Ensure all Windows systems have PowerShell v3 or newer. Newer versions of PowerShell have better logging features, especially PowerShell v5. This will log all PowerShell activity including all PowerShell modules.</p>
<p>Enable PowerShell Module Logging</p>
<div class="highlight"><pre><span></span><code>1. Open Group Policy
2. Computer Configuration &gt; Policies &gt; Administrative Templates &gt; Windows Components &gt; Windows PowerShell
3. Turn on Module Logging
4. Enter &quot;*&quot; and click OK.`
</code></pre></div>
<h4 id="log-parsing">Log Parsing<a class="headerlink" href="#log-parsing" title="Permanent link">&para;</a></h4>
<p>If enabled, PowerShell activity will be logged to the Microsoft-Windows-PowerShell/Operational Log. Push or pull these events to a central logging server (via Windows Event Forwarding or similar) or SIEM.</p>
<h4 id="parse-powershell-events-for-the-following-mimikatz-indicators">Parse PowerShell events for the following Mimikatz indicators<a class="headerlink" href="#parse-powershell-events-for-the-following-mimikatz-indicators" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>&quot;System.Reflection.AssemblyName&quot;
&quot;System.Reflection.Emit.AssemblyBuilderAccess &quot;
&quot;System.Runtime.InteropServices.MarshalAsAttribute&quot;
&quot;TOKEN_PRIVILEGES&quot;
&quot;SE_PRIVILEGE_ENABLED&quot;`
</code></pre></div>
<h4 id="detecting-offensive-powershell-tools">Detecting Offensive PowerShell Tools<a class="headerlink" href="#detecting-offensive-powershell-tools" title="Permanent link">&para;</a></h4>
<p>Many PowerShell offensive tools use the following calls which are logged in PowerShell Module Logging.</p>
<div class="highlight"><pre><span></span><code>&quot;GetDelegateForFunctionPointer&quot;
&quot;System.Reflection.AssemblyName&quot;
&quot;System.Reflection.Emit.AssemblyBuilderAccess&quot;
&quot;System.Management.Automation.WindowsErrorReporting&quot;
&quot;MiniDumpWriteDump&quot;
&quot;TOKEN_IMPERSONATE&quot;
&quot;TOKEN_DUPLICATE&quot;
&quot;TOKEN_ADJUST_PRIVILEGES&quot;
&quot;TOKEN_PRIVILEGES&quot;`
</code></pre></div>
<p><strong>Reference</strong></p>
<ul>
<li><a href="https://github.com/palantir/windows-event-forwarding/tree/master/group-policy-objects">https://github.com/palantir/windows-event-forwarding/tree/master/group-policy-objects</a></li>
<li><a href="https://github.com/iadgov/Event-Forwarding-Guidance/tree/master/Subscriptions/samples">https://github.com/iadgov/Event-Forwarding-Guidance/tree/master/Subscriptions/samples</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/threat-protection/use-windows-event-forwarding-to-assist-in-instrusion-detection">https://docs.microsoft.com/en-us/windows/threat-protection/use-windows-event-forwarding-to-assist-in-instrusion-detection</a></li>
<li><a href="https://github.com/MicrosoftDocs/windows-itpro-docs/blob/master/windows/threat-protection/use-windows-event-forwarding-to-assist-in-instrusion-detection.md">https://github.com/MicrosoftDocs/windows-itpro-docs/blob/master/windows/threat-protection/use-windows-event-forwarding-to-assist-in-instrusion-detection.md</a></li>
</ul>
<hr />
<h2 id="disable-windows-legacy-typically-unused-features">Disable Windows Legacy &amp; <strong>Typically</strong> Unused Features<a class="headerlink" href="#disable-windows-legacy-typically-unused-features" title="Permanent link">&para;</a></h2>
<p>The reference (Securing Windows Workstations: Developing a Secure Baseline) located at <a href="https://adsecurity.org/?p=3299">https://adsecurity.org/?p=3299</a> contains a wealth of information to help reduce security risks in a Windows Domain. Key mitigations are highlighted below.</p>
<h3 id="force-group-policy-to-reapply-settings-during-refresh">Force Group Policy to reapply settings during "refresh"<a class="headerlink" href="#force-group-policy-to-reapply-settings-during-refresh" title="Permanent link">&para;</a></h3>
<p><code>Computer Configuration&gt;Policies&gt;Administrative Templates&gt;System&gt;Group Policy&gt;Configure security policy processing</code></p>
<p>Set to Enabled</p>
<p><code>Also check the box for "Process even if the Group Policy objects have not changed"</code></p>
<p>It's also recommended to configure the same settings for each of the following:</p>
<ul>
<li>Computer Configuration, Policies, Administrative Templates, System, Group Policy, Configure registry policy processing</li>
<li>Computer Configuration, Policies, Administrative Templates, System, Group Policy, Configure scripts policy processing</li>
<li>As well as any other policy settings as needed.</li>
</ul>
<hr />
<h3 id="disable-unneeded-services">Disable Unneeded Services<a class="headerlink" href="#disable-unneeded-services" title="Permanent link">&para;</a></h3>
<p>The document Service-management-WS2016.xlsx contains a list default services, their state, use, and if it is safe to disable.</p>
<ul>
<li>Review the Services outlined in the document Service-management-WS2016.xlsx</li>
<li>Create a list of service to disable, and enforce via GPO</li>
</ul>
<h3 id="disable-net-session-enumeration-netcease">Disable Net Session Enumeration (NetCease)<a class="headerlink" href="#disable-net-session-enumeration-netcease" title="Permanent link">&para;</a></h3>
<p>This hardening process prevents attackers from easily getting some valuable recon information to move laterally within their victim's network.</p>
<ul>
<li>Run the NetCease PowerShell script on Server</li>
<li>Include DCs, Fileservers, or other servers where Session information may be used by and attacker for enumeration</li>
</ul>
<p><strong>References</strong></p>
<ul>
<li><a href="https://gallery.technet.microsoft.com/Net-Cease-Blocking-Net-1e8dcb5b">https://gallery.technet.microsoft.com/Net-Cease-Blocking-Net-1e8dcb5b</a></li>
<li><a href="https://adsecurity.org/?p=3299">https://adsecurity.org/?p=3299</a></li>
</ul>
<hr />
<h3 id="disable-wpad">Disable WPAD<a class="headerlink" href="#disable-wpad" title="Permanent link">&para;</a></h3>
<p>Web Proxy Auto-Discovery Protocol (WPAD) is "a method used by clients to locate the URL of a configuration file using DHCP and/or DNS discovery methods. Once detection and download of the configuration file is complete, it can be executed to determine the proxy for a specified URL."</p>
<p>Disable WPAD via Group Policy by deploying the following registry change:</p>
<p><code>HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionInternet SettingsWpad
New DWORD (32-Bit Value) called "WpadOverride" and set to "1"</code></p>
<p>Disable the service "WinHTTP Web Proxy Auto-Discovery Service"</p>
<p><code>Computer Configuration&gt;Policies&gt;Windows Settings&gt;Security Settings&gt;System Services
Set WinHTTP Web Proxy Auto-Discovery Service to Disabled</code></p>
<p>Note:
Partial mitigation of WPAD issues is possible by installing the Microsoft patch KB3165191 (MS16-077). This patch hardens the WPAD process and when the system responds to NetBIOS requests.</p>
<hr />
<h3 id="disable-llmnr">Disable LLMNR<a class="headerlink" href="#disable-llmnr" title="Permanent link">&para;</a></h3>
<p>Link-Local Multicast Name Resolution (LLMNR):
In a nutshell, Link-Local Multicast Name Resolution (LLMNR) resolves single label names (like: COMPUTER1), on the local subnet, when DNS is unable to resolve the name.</p>
<p>Disable LLMNR via Group Policy by deploying the following:</p>
<p><code>Group Policy:Computer Configuration/Administrative Templates/Network/DNS Client
Set "Turn Off Multicast Name Resolution" to "Enabled"</code></p>
<hr />
<h3 id="disable-wdigest">Disable WDigest<a class="headerlink" href="#disable-wdigest" title="Permanent link">&para;</a></h3>
<p>WDigest provides support for Digest authentication which is: "An industry standard that is used in Windows Server 2003 for Lightweight Directory Access Protocol (LDAP) and Web authentication. Digest Authentication transmits credentials across the network as an MD5 hash or message digest."</p>
<p>Prior to Windows 8.1 and Windows Server 2012 R2, Wdigest was enabled which placed the user's "clear text" password in LSASS memory space in order to support basic authentication scenarios. Windows 8.1 and Windows Server 2012 R2 and newer have WDigest disabled by default.</p>
<p>Disable WDigest via Group Policy by deploying the following registry change:</p>
<p><code>HKEY_LOCAL_MACHINESystemCurrentControlSetControlSecurityProvidersWdigestUseLogonCredential = "0"</code></p>
<p><strong>References</strong></p>
<ul>
<li><a href="https://adsecurity.org/?p=3299">https://adsecurity.org/?p=3299</a></li>
</ul>
<hr />
<h3 id="remove-the-use-of-ntlm-v1">Remove the use of NTLM v1<a class="headerlink" href="#remove-the-use-of-ntlm-v1" title="Permanent link">&para;</a></h3>
<p>Windows Server 2008 R2 included features to help identify NTLM authentication use on the network. It is important to completely remove these legacy authentication protocols since they are insecure. Removal and prevention of LM and NTLMv1 use can be activated through the use of Group Policy security settings.
Plan to move to NTLMv2 and Kerberos at the least, with the long-term goal being Kerberos only.</p>
<ul>
<li>Audit the use of NTLM v1 on the network</li>
<li>Determine the risks and need to support NTLM v1</li>
<li>Disable the use of NTLM v1</li>
</ul>
<p><strong>Reference</strong></p>
<ul>
<li><a href="https://technet.microsoft.com/en-us/library/jj865674(v=ws.10).aspx">https://technet.microsoft.com/en-us/library/jj865674(v=ws.10).aspx</a></li>
<li><a href="https://technet.microsoft.com/en-us/library/dd560653%28v=ws.10%29.aspx">https://technet.microsoft.com/en-us/library/dd560653%28v=ws.10%29.aspx</a></li>
</ul>
<h3 id="consider-other-mitigations">Consider other Mitigations<a class="headerlink" href="#consider-other-mitigations" title="Permanent link">&para;</a></h3>
<p>Consider other mitigations detailed at <a href="https://adsecurity.org/?p=3299">https://adsecurity.org/?p=3299</a></p>
<p><strong>References</strong></p>
<ul>
<li><a href="https://adsecurity.org/?p=3299">https://adsecurity.org/?p=3299</a></li>
</ul>
<hr />
<h3 id="deploy-security-back-port-patch-kb2871997">Deploy security back-port patch (KB2871997)<a class="headerlink" href="#deploy-security-back-port-patch-kb2871997" title="Permanent link">&para;</a></h3>
<p>Ensure all Windows systems prior to Windows 8.1 &amp; Windows Server 2012 R2 have the KB2871997 patch installed. This patch updates earlier supported versions of Windows with security enhancements baked into Windows 8.1 &amp; Windows Server 2012 R2.</p>
<p><strong>References</strong></p>
<ul>
<li><a href="https://adsecurity.org/?p=559">https://adsecurity.org/?p=559</a></li>
<li><a href="https://blogs.technet.microsoft.com/kfalde/2014/11/01/kb2871997-and-wdigest-part-1/">https://blogs.technet.microsoft.com/kfalde/2014/11/01/kb2871997-and-wdigest-part-1/</a></li>
</ul>
<h3 id="prevent-local-administrator-accounts-from-authenticating-over-the-network">Prevent local "administrator" accounts from authenticating over the network<a class="headerlink" href="#prevent-local-administrator-accounts-from-authenticating-over-the-network" title="Permanent link">&para;</a></h3>
<p>While the local Administrator (RID 500) account on two different computers has a different SID, if they have the same account name and password, the local Administrator account from one can authenticate as Administrator on the other. The same is true with any local account that is duplicated on multiple computers.
This presents a security issue if multiple (or all) workstations in an organization have the same account name and password since compromise of one workstation results in compromise of all.</p>
<p>Windows 8.1 &amp; Windows 2012 R2 and newer introduced two new local SIDs:
S-1-5-113: NT AUTHORITYLocal account
S-1-5-114: NT AUTHORITYLocal account and member of Administrators group
These SIDs are also added in earlier supported versions of Windows by installing the KB2871997 patch.</p>
<p><code>Install patch KB2871997</code></p>
<h4 id="configure-through-group-policy">Configure through Group Policy:<a class="headerlink" href="#configure-through-group-policy" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>1. Open Group Policy Management (gpmc.msc or via MMC Group Policy Object Editor)
2. Computer Configuration &gt; Windows Settings &gt; Local Policies &gt; User Rights Assignment
3. Deny access to this computer from the network: Local account and member of Administrators group
4. Deny log on through Remote Desktop Services: Local account and member of Administrators group
</code></pre></div>
<hr />
<h3 id="remote-connections">Remote Connections<a class="headerlink" href="#remote-connections" title="Permanent link">&para;</a></h3>
<h4 id="rdp-restricted-admin-connect-to-only-1-resource">RDP Restricted Admin (Connect to only 1 resource)<a class="headerlink" href="#rdp-restricted-admin-connect-to-only-1-resource" title="Permanent link">&para;</a></h4>
<p><code>mstsc /v:server /restrictedAdmin</code></p>
<h5 id="enable-restricted-admin-via-registry">Enable Restricted Admin via Registry<a class="headerlink" href="#enable-restricted-admin-via-registry" title="Permanent link">&para;</a></h5>
<p><code>Manually create registry entry HKEY_LOCAL_MACHINESystemCurrentControlSetControlLsa DWORD DisableRestrictedAdmin=0</code></p>
<p>or</p>
<p><code>reg add HKEY_LOCAL_MACHINESystemCurrentControlSetControlLsa /v DisableRestrictedAdmin /d 0 /t REG_DWORD</code></p>
<h5 id="enable-restricted-admin-via-gpo">Enable Restricted Admin via GPO<a class="headerlink" href="#enable-restricted-admin-via-gpo" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>1. Open Group Policy Management (gpmc.msc or via MMC Group Policy Object Editor)
2. Computer Configurations &gt; Policies &gt; Administrative Templates &gt; System &gt; Credential Delegation
3. Set &quot;Restrict Delegation of credential to remote servers&quot; to enable
</code></pre></div>
<h4 id="rdp-windows-defender-remote-credential-guard-connect-to-multiple-resources">RDP Windows Defender Remote Credential Guard (Connect to multiple resources)<a class="headerlink" href="#rdp-windows-defender-remote-credential-guard-connect-to-multiple-resources" title="Permanent link">&para;</a></h4>
<p><code>mstsc /v:server /remoteguard</code></p>
<h5 id="enable-windows-defender-credential-guard-via-registry">Enable Windows Defender Credential Guard via Registry<a class="headerlink" href="#enable-windows-defender-credential-guard-via-registry" title="Permanent link">&para;</a></h5>
<p><code>Manually create registry entry HKEY_LOCAL_MACHINESystemCurrentControlSetControlLsa DWORD DisableRestrictedAdmin=0</code></p>
<p>or</p>
<p><code>reg add HKEY_LOCAL_MACHINESystemCurrentControlSetControlLsa /v DisableRestrictedAdmin /d 0 /t REG_DWORD</code></p>
<h5 id="enable-windef-cred-guard-via-gpo">Enable WinDef Cred Guard via GPO<a class="headerlink" href="#enable-windef-cred-guard-via-gpo" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>1. Open Group Policy Management (gpmc.msc or via MMC Group Policy Object Editor)
2. Computer Configurations &gt; Policies &gt; Administrative Templates &gt; System &gt; Credential Delegation
3. Set &quot;Restrict Delegation of credential to remote servers&quot; to enable
4. In Options, Under use the following restricted mode: Choose &quot;Prefer Windows Defender Remote Credential Guard&quot;
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>If all systems are Windows 10/2016, Choose "Require Remote Credential Guard"</p>
<hr />
<h3 id="limit-client-to-client-communication-implement-and-configure-host-based-firewalls">Limit Client-to-Client Communication (Implement <em>and Configure</em> Host Based Firewalls)<a class="headerlink" href="#limit-client-to-client-communication-implement-and-configure-host-based-firewalls" title="Permanent link">&para;</a></h3>
<ul>
<li>Clients and Server should be split into separate OU's</li>
<li>Enable the Windows Firewall through GPO</li>
<li>(Optional) Add exceptions to systems that are used to manage other hosts such as Sysadmins. Use a jump host to minimize exposure.</li>
</ul>
<h4 id="enable-firewall">Enable Firewall<a class="headerlink" href="#enable-firewall" title="Permanent link">&para;</a></h4>
<p><strong>PowerShell</strong></p>
<ol>
<li>Create a GPO to hold the Workstation FW settings (workstation_fw)</li>
</ol>
<p>Example</p>
<div class="highlight"><pre><span></span><code>Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled True –PolicyStore example_domain.localworkstation_fw
Set-NetFirewallProfile -DefaultInboundAction Block -DefaultOutboundAction Allow –NotifyOnListen True -AllowUnicastResponseToMulticast True –LogFileName %SystemRoot%System32LogFilesFirewallpfirewall.log –PolicyStore example_domain.localworkstation_fw
</code></pre></div>
<ol>
<li>Assign the GPO to a Workstation Container</li>
</ol>
<p><strong>References</strong></p>
<ul>
<li><a href="https://technet.microsoft.com/en-us/library/hh831755(v=ws.11).aspx">https://technet.microsoft.com/en-us/library/hh831755(v=ws.11).aspx</a></li>
</ul>
<h3 id="blockcontrol-tcpudp-access-from-the-internal-network-and-dmz">Block/control TCP/UDP access from the Internal network and DMZ<a class="headerlink" href="#blockcontrol-tcpudp-access-from-the-internal-network-and-dmz" title="Permanent link">&para;</a></h3>
<ul>
<li>Evaluate the need for servers to connect to the Internet.</li>
<li>Create a list of systems outside the network that require access. Limit access using this whitelist.</li>
<li>Configure firewall rules to enforce these traffic policies.</li>
</ul>
<hr />
<h3 id="block-out-bound-tcpudp-access-from-the-client-systems-to-outbound-networks">Block out bound TCP/UDP access from the Client systems to outbound networks.<a class="headerlink" href="#block-out-bound-tcpudp-access-from-the-client-systems-to-outbound-networks" title="Permanent link">&para;</a></h3>
<p>Clients generally only need a few ports to connect out bound. Limit access from client workstations to these ports.</p>
<ul>
<li>Create a list of ports required by clients to communicate outside the network. Limit access using this whitelist.</li>
<li>Configure firewall rules to enforce these traffic policies.</li>
<li>Rule can be managed at the HOST level via GPO or the network level via firewall rules.</li>
</ul>
<hr />
<h3 id="implement-a-proxy-for-all-outbound-traffic">Implement a Proxy for All Outbound Traffic<a class="headerlink" href="#implement-a-proxy-for-all-outbound-traffic" title="Permanent link">&para;</a></h3>
<p>Force systems to traverse an proxy to communicate outbound. It is preferred to only allow authenticated communications. This prevents privilege users (SYSTEM, root) from communicating outbound.</p>
<ul>
<li>At a minimum, force all client's HTTP(S) and DNS through a proxy</li>
<li>If possible, require user authentication</li>
<li>Prevent outbound access if a client or system attempts to connect to external port directly using network firewall rules</li>
</ul>
<h4 id="create-a-new-gpo-to-manage-the-proxy-settings">Create a new GPO to manage the proxy settings<a class="headerlink" href="#create-a-new-gpo-to-manage-the-proxy-settings" title="Permanent link">&para;</a></h4>
<p>Edit the GPO</p>
<p><code>User Configuration&gt;Windows Settings&gt;Internet Explorer Maintenance&gt;Connection</code></p>
<div class="highlight"><pre><span></span><code>Select Proxy Server
Enter the Proxy IP address and Port
</code></pre></div>
<p>Prevent Users from Changing Settings</p>
<div class="highlight"><pre><span></span><code>User Configuration&gt;Administrative Templates&gt;Windows Components&gt;Internet Explorer&gt;Internet Control Panel
Set Disable the Connections Page to Enabled
</code></pre></div>
<hr />
<h2 id="configurations">Configurations<a class="headerlink" href="#configurations" title="Permanent link">&para;</a></h2>
<h3 id="autoruns">AutoRuns<a class="headerlink" href="#autoruns" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>1. De-select &quot;Hide Microsoft Entries&quot;
2. De-select &quot;Hide Windows Entries&quot;
3. Under Scan Options, enable &quot;Verify code signatures&quot;
4. Under Scan Options, enable &quot;Check VirusTotal.com&quot; (note this shouldn&#39;t be done on GOV or otherwise sensitive networks)
5. Review all entries with multiple parameters
</code></pre></div>
<hr />
<h3 id="application-whiteblack-listing">Application White/Black listing<a class="headerlink" href="#application-whiteblack-listing" title="Permanent link">&para;</a></h3>
<p>A number of solutions exist to limit the applications a user can use on a system. AppLocker allows you to specify which users or groups can run particular applications in your organization based on unique identities of files. If you use AppLocker, you can create rules to allow or deny applications from running.</p>
<hr />
<h3 id="applocker">Applocker<a class="headerlink" href="#applocker" title="Permanent link">&para;</a></h3>
<h4 id="applocker-executable-path-restrictions">AppLocker Executable Path Restrictions<a class="headerlink" href="#applocker-executable-path-restrictions" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>1. Open Group Policy Management (gpmc.msc or via MMC Group Policy Object Editor)
2. Computer Configuration &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Application Control Policies &gt; AppLocker
3. Configure rule enforcement
4. Executable rules, Check Configured, Enforce rules
5. Overview &gt; Executable Rules &gt; Right Click Create New Rule
6. Permissions &gt; Deny &gt; Domain Users
7. Conditions &gt; Path
8. Exceptions &gt; Add as/if required
9. Create &gt; Yes
</code></pre></div>
<h5 id="interesting-paths">Interesting Paths<a class="headerlink" href="#interesting-paths" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>1. &lt;drive letter&gt;users&lt;username&gt;appdata (%AppData% or for extension %AppData%*.exe 5AppData%**.exe)
2. usersppdatalocal
3. usersppdatalocaltemp
4. usersppdataroaming
5. programdata
</code></pre></div>
<h4 id="explicit-whitelisting">Explicit Whitelisting<a class="headerlink" href="#explicit-whitelisting" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>1. Open Group Policy Management (gpmc.msc or via MMC Group Policy Object Editor)
2. Computer Configuration &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Software Restriction Policies
3. Security Level Disallowed
4. In additional rules allow
a. %HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindowsNTCurrentVersionSystemRoot%
b. %HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindowsCurrentVersionProgramFilesDir (x86)%
c. %HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindowsCurrentVersionProgramFilesDir%
d. *.lnk
</code></pre></div>
<h4 id="interesting-file-extensions">Interesting file extensions<a class="headerlink" href="#interesting-file-extensions" title="Permanent link">&para;</a></h4>
<p><code>.ade, .adp, .ani, .bas, .bat, .chm, .cmd, .com, .cpl, .crt, .exe, .hlp, .ht, .hta, .inf, .ins, .isp, .jar, .job, .js, .jse, .lnk, .mda, .mdb, .mde, .mdz, .msc, .msi, .msp, .mst, .ocx, .pcd, .ps1, .reg, .scr, .sct, .shs, .svg, .url, .vb, .vbe, .vbs, .wbk, .wsc, .ws, .wsf, .wsh, .exe, .pif, .pub, .ip</code></p>
<p><strong>References</strong></p>
<ul>
<li><a href="https://technet.microsoft.com/en-us/library/dd759117(v=ws.11).aspx">https://technet.microsoft.com/en-us/library/dd759117(v=ws.11).aspx</a></li>
<li><a href="https://technet.microsoft.com/en-us/library/dd759123(v=ws.11).aspx">https://technet.microsoft.com/en-us/library/dd759123(v=ws.11).aspx</a></li>
<li><a href="https://technet.microsoft.com/en-us/library/dd759116(v=ws.11).aspx">https://technet.microsoft.com/en-us/library/dd759116(v=ws.11).aspx</a></li>
</ul>
<hr />
<h2 id="manual-hunting-and-detection-examples">Manual Hunting and Detection Examples<a class="headerlink" href="#manual-hunting-and-detection-examples" title="Permanent link">&para;</a></h2>
<h3 id="filtering-event-logs-via-powershell">Filtering Event Logs via PowerShell<a class="headerlink" href="#filtering-event-logs-via-powershell" title="Permanent link">&para;</a></h3>
<h5 id="log-locations-on-disk-only-use-event-viewer-or-cli-to-copy">Log locations on disk (only use event viewer or cli to copy)<a class="headerlink" href="#log-locations-on-disk-only-use-event-viewer-or-cli-to-copy" title="Permanent link">&para;</a></h5>
<ol>
<li>XP or older: %windir%system32config</li>
<li>Vista or newer: %windir%system32winevtlogs</li>
</ol>
<h5 id="get-times-service-was-installed-all-evtx-files-should-be-system-and-count">Get times Service was installed (all evtx files, should be system) and count<a class="headerlink" href="#get-times-service-was-installed-all-evtx-files-should-be-system-and-count" title="Permanent link">&para;</a></h5>
<p><code>Get-WinEvent -FilterHashtable @{Path="*.evtx"; ID=7045}|Measure-Object -Line</code></p>
<h5 id="get-blocked-events">Get blocked events<a class="headerlink" href="#get-blocked-events" title="Permanent link">&para;</a></h5>
<p><code>Get-WinEvent -FilterHashtable @{Path="AppLocker.evtx"; ID=8004}| Format-Table -Wrap</code></p>
<h5 id="get-windowsdefender-actions">Get WindowsDefender actions<a class="headerlink" href="#get-windowsdefender-actions" title="Permanent link">&para;</a></h5>
<p><code>Get-WinEvent -FilterHashtable @{Path="WindowsDefender.evtx"; ID=1117}| Format-Table</code></p>
<h5 id="get-windowsdefender-detections">Get WindowsDefender detections<a class="headerlink" href="#get-windowsdefender-detections" title="Permanent link">&para;</a></h5>
<p><code>Get-WinEvent -FilterHashtable @{Path="WindowsDefender.evtx"; ID=1116}| Format-Table</code></p>
<h5 id="get-files-by-extension-with-search-from-application-crash">Get files (by extension) with search from Application (crash)<a class="headerlink" href="#get-files-by-extension-with-search-from-application-crash" title="Permanent link">&para;</a></h5>
<p><code>Get-WinEvent -FilterHashtable @{Path="application.evtx"}|Where {$_.Message -like "*pdf*"}|Format-Table -Wrap</code></p>
<h5 id="get-emet-events">Get EMET events<a class="headerlink" href="#get-emet-events" title="Permanent link">&para;</a></h5>
<p><code>Get-WinEvent -FilterHashtable @{Path="Win7-Application.evtx"; providername="EMET"}|Format-Table -Wrap</code></p>
<h5 id="get-service-installs-and-errors">Get service installs and errors<a class="headerlink" href="#get-service-installs-and-errors" title="Permanent link">&para;</a></h5>
<p><code>Get-WinEvent -FilterHashtable @{Path="system.evtx"; ID=7030,7045}| fl</code></p>
<h5 id="search-for-usb-loading">Search for USB loading<a class="headerlink" href="#search-for-usb-loading" title="Permanent link">&para;</a></h5>
<p><code>Get-WinEvent -FilterHashtable @{Path="system.evtx"; ID=7045,10000,10001,10100,20001,20002,30003,24576,24577,24579}|Where {$_.Message -like "*USB*"}|fl</code></p>
<h5 id="search-for-errorwarninginfo">Search for error/warning/info<a class="headerlink" href="#search-for-errorwarninginfo" title="Permanent link">&para;</a></h5>
<p><code>Get-WinEvent -FilterHashtable @{Path="application.evtx"; level=2}</code></p>
<h5 id="get-remote-eventlog-caution-this-drops-credentials-onto-remote-system">Get remote eventlog (caution this drops credentials onto remote system)<a class="headerlink" href="#get-remote-eventlog-caution-this-drops-credentials-onto-remote-system" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>Get-EventLog -List -ComputerName &lt;ip&gt;
Get-EventLog -LogName System -ComputerName
</code></pre></div>
<h5 id="get-log-within-x-hours">Get log within X hours<a class="headerlink" href="#get-log-within-x-hours" title="Permanent link">&para;</a></h5>
<p><code>Get-EventLog System -after (get-date).addhours(-12) | Where {$_.entrytype -eq "warning"}</code></p>
<h5 id="get-logs-during-downtime">Get logs during "downtime"<a class="headerlink" href="#get-logs-during-downtime" title="Permanent link">&para;</a></h5>
<p><code>Get-EventLog -LogName security | ? {$_.EventId -eq 4624 –and ($_.TimeGenerated.TimeOfDay -gt '20:00:00' -or $_.TimeGenerated.TimeOfDay -lt '08:00:00' ) } | export-csv offhours.csv</code></p>
<h5 id="use-wevtutil-to-export-logs-export-log">Use wevtutil to export logs (export-log)<a class="headerlink" href="#use-wevtutil-to-export-logs-export-log" title="Permanent link">&para;</a></h5>
<p><code>wevtutil.exe epl system system.evtx</code></p>
<h5 id="use-wevutil-to-get-last-20-startups-use-rcomputer-for-remote-and-qe-for-short-query">Use wevutil to get last 20 startups (use /r:computer for remote and qe for short query)<a class="headerlink" href="#use-wevutil-to-get-last-20-startups-use-rcomputer-for-remote-and-qe-for-short-query" title="Permanent link">&para;</a></h5>
<p><code>wevutil query-events System /count:20 /rd:true /format:text /q:"Event[System[(EventID=12)]]"</code></p>
<h4 id="windows-consolidated-logging">Windows consolidated logging<a class="headerlink" href="#windows-consolidated-logging" title="Permanent link">&para;</a></h4>
<ol>
<li>enable winrm</li>
<li><code>winrm qc</code></li>
<li>enable wecutil</li>
<li><code>wecutil qc</code></li>
<li>Create subscriptions and select events/filters in event viewer</li>
<li>via event viewer or</li>
<li>by PowerShell<ul>
<li><code>wecutil cs "Creates a subscription"</code></li>
<li><code>wecutil ss "Sets a subscription"</code></li>
<li><code>wecutil es "Views subscriptions"</code></li>
</ul>
</li>
</ol>
<h5 id="get-a-detailed-list-of-all-security-auditing-event-entries-use-an-elevated-prompt">Get a detailed list of all security-auditing event entries (use an elevated prompt)<a class="headerlink" href="#get-a-detailed-list-of-all-security-auditing-event-entries-use-an-elevated-prompt" title="Permanent link">&para;</a></h5>
<p><code>wevtutil gp Microsoft-Windows-Security-Auditing /ge /gm:true</code></p>
<h5 id="return-a-list-of-all-security-auditing-categories-and-subcategories-use-an-elevated-prompt">Return a list of all security-auditing categories and subcategories (use an elevated prompt)<a class="headerlink" href="#return-a-list-of-all-security-auditing-categories-and-subcategories-use-an-elevated-prompt" title="Permanent link">&para;</a></h5>
<p><code>auditpol /list /subcategory:*</code></p>
<hr />
<h3 id="network">Network<a class="headerlink" href="#network" title="Permanent link">&para;</a></h3>
<h4 id="network-flow-basics">Network Flow Basics:<a class="headerlink" href="#network-flow-basics" title="Permanent link">&para;</a></h4>
<ol>
<li>Prevent traffic on uncommon ports (not if a good threat)</li>
<li>Establish commonality in traffic (size, frequency, browser headers, etc.)</li>
<li>Consistently review outlying DNS entries (very few connections or host traffic)</li>
<li>Identify and investigate unique User-Agent strings</li>
<li>Identify and investigate Base64 encoded strings within the URL</li>
<li>Identify and investigate executables being downloaded and traversing the network</li>
</ol>
<h4 id="basic-pcap-carving-nix">Basic PCAP Carving (*nix)<a class="headerlink" href="#basic-pcap-carving-nix" title="Permanent link">&para;</a></h4>
<p>Note: The snippets below are examples for pcap carving. I'd highly recommend using bro/ for traffic analysis.</p>
<h5 id="get-certificates-from-pcap-use-bro-if-possible">Get certificates from pcap (use BRO if possible)<a class="headerlink" href="#get-certificates-from-pcap-use-bro-if-possible" title="Permanent link">&para;</a></h5>
<p><code>tshark -nr file.pcap -2 -R "ssl.handshake.certificate" -V &gt; cert.txt</code></p>
<p>or</p>
<p><code>ssldump -Nr /path/file.pcap | awk 'BEGIN {c=0;} { if ($0 ~ /^[ ]+Certificate$/) {c=1; print "========================================";} if ($0 !~ /^ +/ ) {c=0;} if (c==1) print $0; }'</code></p>
<h5 id="view-certificates-see-bro">View certificates (see BRO)<a class="headerlink" href="#view-certificates-see-bro" title="Permanent link">&para;</a></h5>
<p><code>openssl x509 -in certsname.der -inform der -text -noout</code></p>
<h5 id="get-dns-queries-from-pcap-and-count-instances">Get DNS queries from pcap and count instances<a class="headerlink" href="#get-dns-queries-from-pcap-and-count-instances" title="Permanent link">&para;</a></h5>
<p><code>tshark -r /path/file.pcap -T fields -e ip.src -e dns.qry.name -2 -R "dns.flags.response eq 0"</code></p>
<p>or</p>
<p><code>tcpdump –n –r file.pcap "port 53" 2&gt;/dev/null|grep –E 'A?'|awk '{print $(NF-1)}'|sort|uniq –c|sort –n</code></p>
<h5 id="get-dns-queries-from-nx-domain">Get DNS queries from NX domain<a class="headerlink" href="#get-dns-queries-from-nx-domain" title="Permanent link">&para;</a></h5>
<p><code>tshark -r /path/file.pcap -T fields -e ip.src -e dns.qry.name -2 -R "dns.flags.rcode eq 3"</code></p>
<h5 id="dns-response-codes">DNS Response Codes<a class="headerlink" href="#dns-response-codes" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>RCODE</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>NoError</td>
<td>No Error</td>
</tr>
<tr>
<td>1</td>
<td>FormErr</td>
<td>Format Error</td>
</tr>
<tr>
<td>2</td>
<td>ServFail</td>
<td>Server Failure</td>
</tr>
<tr>
<td>3</td>
<td>NXDomain</td>
<td>Non-Existent Domain</td>
</tr>
<tr>
<td>4</td>
<td>NotImp</td>
<td>Not Implemented</td>
</tr>
<tr>
<td>5</td>
<td>Refused</td>
<td>Query Refused</td>
</tr>
<tr>
<td>6</td>
<td>YXDomain</td>
<td>Name Exists when it should not</td>
</tr>
<tr>
<td>7</td>
<td>YXRRSet</td>
<td>RR Set Exists when it should not</td>
</tr>
<tr>
<td>8</td>
<td>NXRRSet</td>
<td>RR Set that should exist does not</td>
</tr>
<tr>
<td>9</td>
<td>NotAuth</td>
<td>Server Not Authoritative for zone</td>
</tr>
<tr>
<td>9</td>
<td>NotAuth</td>
<td>Not Authorized</td>
</tr>
<tr>
<td>10</td>
<td>NotZone</td>
<td>Name not contained in zone</td>
</tr>
<tr>
<td>16</td>
<td>BADVERS</td>
<td>Bad OPT Version</td>
</tr>
<tr>
<td>16</td>
<td>BADSIG</td>
<td>TSIG Signature Failure</td>
</tr>
<tr>
<td>17</td>
<td>BADKEY</td>
<td>Key not recognized</td>
</tr>
<tr>
<td>18</td>
<td>BADTIME</td>
<td>Signature out of time window</td>
</tr>
<tr>
<td>19</td>
<td>BADMODE</td>
<td>Bad TKEY Mode</td>
</tr>
<tr>
<td>20</td>
<td>BADNAME</td>
<td>Duplicate key name</td>
</tr>
<tr>
<td>21</td>
<td>BADALG</td>
<td>Algorithm not supported</td>
</tr>
<tr>
<td>22</td>
<td>BADTRUNC</td>
<td>Bad Truncation</td>
</tr>
<tr>
<td>23</td>
<td>BADCOOKIE</td>
<td>Bad/missing Server Cookie</td>
</tr>
</tbody>
</table>
<h5 id="get-user-agents-from-pcap">Get User-Agents from pcap<a class="headerlink" href="#get-user-agents-from-pcap" title="Permanent link">&para;</a></h5>
<p><code>tshark -r /path/file.pcap -T fields -e http.user_agent|sort -n -k1|uniq -c|sort -n</code></p>
<p>or</p>
<p><code>tcpdump –n –A –r file.pcap 'tcp port 80'|egrep –I "User-Agent"|sort|uniq –c|sort -n</code></p>
<p>or</p>
<p><code>strings /path/file.pcap |grep -i User-Agent|uniq -c|sort -n</code></p>
<h5 id="get-info-for-frame-containing-search-dataf">Get info for frame containing search dataf<a class="headerlink" href="#get-info-for-frame-containing-search-dataf" title="Permanent link">&para;</a></h5>
<p><code>tshark -r /tmp/10.10.10.52:1082_10.10.19.32:80-6.raw -2 -R 'frame contains "MZ"'</code></p>
<h5 id="search-for-string-in-tcp-data-finds-data-not-in-field-ie-ua-in-json">Search for string in tcp data (finds data not in field i.e. UA in json)<a class="headerlink" href="#search-for-string-in-tcp-data-finds-data-not-in-field-ie-ua-in-json" title="Permanent link">&para;</a></h5>
<p><code>tshark -r /path/file.pcap -T pdml -T fields -e tcp.data -2 -R 'tcp contains "User-Agent"'|sed s/://g|xxd -p -r|grep -a User-Agent|uniq -c</code></p>
<h5 id="find-strings-in-pcap">Find strings in pcap<a class="headerlink" href="#find-strings-in-pcap" title="Permanent link">&para;</a></h5>
<p><code>tshark -r file.pcap -T pdml -T fields -e irc.response -Y 'frame contains "badguy"'</code></p>
<p>or</p>
<p><code>tshark -r file.pcap -T pdml -Y 'frame contains "badguy"'|grep badguy</code></p>
<p>or</p>
<p><code>ngrep -q -I /path/file.pcap "badguy"</code></p>
<p>or</p>
<p><code>strings /path/file.pcap |grep -i User-Agent |sort -u</code></p>
<p>or</p>
<p><code>tshark -r /path/file.pcap -T pdml -2 -R 'frame contains "User-Agent"'|grep User-Agent</code></p>
<h5 id="get-the-frame-that-contains-string">Get the frame that contains string<a class="headerlink" href="#get-the-frame-that-contains-string" title="Permanent link">&para;</a></h5>
<p><code>tshark -r file.pcap -2 -R 'frame contains "badguy"</code></p>
<h5 id="show-packet-data-by-field">Show packet data by field<a class="headerlink" href="#show-packet-data-by-field" title="Permanent link">&para;</a></h5>
<p><code>tshark -nr /path/file.pcap -T fields -e http.user_agent -2 -R http.user_agent</code></p>
<h5 id="get-data-hex-from-first-two-packets-in-pcap">Get data &amp; hex from first two packets in pcap<a class="headerlink" href="#get-data-hex-from-first-two-packets-in-pcap" title="Permanent link">&para;</a></h5>
<p><code>tcpdump -n -r /path/file.pcap -c2 -x -v</code></p>
<h5 id="get-frames-that-have-tcp-header-length-gt-20-and-port-25">Get frames that have tcp header length gt 20 and port 25<a class="headerlink" href="#get-frames-that-have-tcp-header-length-gt-20-and-port-25" title="Permanent link">&para;</a></h5>
<p><code>tshark -r /path/file.pcap -Y 'tcp.hdr_len &gt; 20 &amp;&amp; tcp.port == 25'</code></p>
<h5 id="get-data-in-frames-that-have-tcp-header-length-gt-20-and-port-25">Get data in frames that have tcp header length gt 20 and port 25<a class="headerlink" href="#get-data-in-frames-that-have-tcp-header-length-gt-20-and-port-25" title="Permanent link">&para;</a></h5>
<p><code>tshark -r /path/file.pcap -T pdml -T fields -e tcp.port -e tcp.hdr_len -Y 'tcp.hdr_len &gt; 20 &amp;&amp; tcp.port == 25'</code></p>
<h5 id="get-frames-with-hex-data-0x7932">Get frames with hex data 0x7932<a class="headerlink" href="#get-frames-with-hex-data-0x7932" title="Permanent link">&para;</a></h5>
<p><code>tshark -r /path/file.pcap -Y 'ip.id == 0x7932'</code></p>
<h5 id="get-frames-and-show-hex-data">Get frames and show hex data<a class="headerlink" href="#get-frames-and-show-hex-data" title="Permanent link">&para;</a></h5>
<p><code>tshark -r /path/file.pcap -T pdml -T fields -e ip.id -Y 'ip.id == 0x7932'</code></p>
<h5 id="get-all-arp-request-and-count-request1-reply2">Get all arp request and count (request=1, reply=2)<a class="headerlink" href="#get-all-arp-request-and-count-request1-reply2" title="Permanent link">&para;</a></h5>
<p><code>tshark -r file.pcap -Y 'arp.opcode == 1'|wc -l</code></p>
<h5 id="get-iplen-less-than-46-64-for-ethernet-minus-14-header-and-4-trailer-icmp-of-0">Get ip.len less than 46 (64 for ethernet minus 14 header and 4 trailer) &amp; icmp of 0<a class="headerlink" href="#get-iplen-less-than-46-64-for-ethernet-minus-14-header-and-4-trailer-icmp-of-0" title="Permanent link">&para;</a></h5>
<p><code>tshark -r file.pcap -Y 'ip.len &lt; 46 &amp;&amp; icmp.type == 0'</code></p>
<h5 id="get-ip-option-of-loose-src-routing-with-offset-starting-at-ip-options">Get ip option of loose src routing with offset starting at ip options<a class="headerlink" href="#get-ip-option-of-loose-src-routing-with-offset-starting-at-ip-options" title="Permanent link">&para;</a></h5>
<p><code>tshark -r file.pcap -Y 'ip[20] == 0x83 &amp;&amp; ip.hdr_len &gt;20'</code></p>
<h5 id="filter-info">Filter Info<a class="headerlink" href="#filter-info" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>URG = 32 or 0x20
ACK = 16 or 0x10
PSH = 8 or 0x08
RST = 4 or 0x04
SYN = 2 or 0x02
FIN = 1 or 0x01
All = 0xFF
</code></pre></div>
<p>Examples:
<code>'tcp[13] &amp; 2 !=0' Get all SYN</code></p>
<p><code>'tcp[13] &amp; 4 !=0' Get all RST</code></p>
<p><code>'tcp[13] &amp; 16 !=0' Get all ACK</code></p>
<h5 id="get-frame-with-ip-src-and-ack-flag-set">Get frame with IP src and ACK flag set<a class="headerlink" href="#get-frame-with-ip-src-and-ack-flag-set" title="Permanent link">&para;</a></h5>
<p><code>tshark -n -r /path/file.pcap '((ip.src == 192.168.10.1) and (tcp.flags.ack==1))'</code></p>
<p>or</p>
<p><code>tshark -n -r /path/file.pcap 'tcp[13] == 0x10 &amp;&amp; ip.src == 192.168.10.1'</code></p>
<p>or</p>
<p><code>tcpdump -n -r /path/file.pcap 'src host 192.168.10.1 and tcp[13] = 0x10'</code></p>
<h5 id="get-frame-with-ip-src-and-ack-or-rst-flag-set">Get frame with IP src and ACK or RST flag set<a class="headerlink" href="#get-frame-with-ip-src-and-ack-or-rst-flag-set" title="Permanent link">&para;</a></h5>
<p><code>tshark -n -r /path/file.pcap '((ip.src == 192.168.10.1) and (tcp.flags.syn==1 or tcp.flags.reset==1))'</code></p>
<p>or</p>
<p><code>tshark -n -r /path/file.pcap 'ip.src == 192.168.10.1 &amp;&amp; tcp[13] == 0x14 or tcp[13] == 0x10 or tcp[13] == 0x04'</code></p>
<p>or</p>
<p><code>tcpdump -n -r /path/file.pcap 'src host 192.168.10.1 and tcp[13] &amp; 0x14 !=0'</code></p>
<h5 id="get-frame-with-dst-port-0-and-df-flag-set">Get frame with dst port 0 and DF flag set<a class="headerlink" href="#get-frame-with-dst-port-0-and-df-flag-set" title="Permanent link">&para;</a></h5>
<p><code>tshark -n -r /path/file.pcap 'tcp.port == 0 &amp;&amp; ip[6] == 0x40'</code></p>
<h5 id="get-frame-with-net-1010101024">Get frame with net 10.10.10.10/24<a class="headerlink" href="#get-frame-with-net-1010101024" title="Permanent link">&para;</a></h5>
<p><code>tcpdump -n -r /path/file.pcap 'dst net 10.10.10 and ip[19] &amp; 0xd0 = 0xd0'</code></p>
<h5 id="get-frames-by-ip">Get frames by ip<a class="headerlink" href="#get-frames-by-ip" title="Permanent link">&para;</a></h5>
<p><code>tshark -n -r file.pcap '((ip.addr == 10.10.10.10) and (ip.addr == 192.168.10.11))'</code></p>
<h5 id="view-specific-frame-verbose-note-tcp-stream-index-number">View specific frame verbose (note tcp stream index number)<a class="headerlink" href="#view-specific-frame-verbose-note-tcp-stream-index-number" title="Permanent link">&para;</a></h5>
<p><code>tshark -n -r file.pcap -Y frame.number==12 -V</code></p>
<h5 id="follow-tcp-stream-0-ascii-raw-hex">Follow tcp stream 0 (ascii, raw, hex)<a class="headerlink" href="#follow-tcp-stream-0-ascii-raw-hex" title="Permanent link">&para;</a></h5>
<p><code>tshark -n -r file.pcap -z "follow,tcp,ascii,0"</code></p>
<h4 id="flow-data-analysis">Flow Data Analysis<a class="headerlink" href="#flow-data-analysis" title="Permanent link">&para;</a></h4>
<h5 id="use-rwfilter-to-analyze-flow-data-by-ip-and-port">Use rwfilter to analyze flow data by IP and port<a class="headerlink" href="#use-rwfilter-to-analyze-flow-data-by-ip-and-port" title="Permanent link">&para;</a></h5>
<p><code>rwfilter suspicious.silk --any-address=192.168.10.10 --aport=1088 --print-stat</code></p>
<h5 id="view-detail-of-flow-data-by-ip-and-port">View detail of flow data by IP and port<a class="headerlink" href="#view-detail-of-flow-data-by-ip-and-port" title="Permanent link">&para;</a></h5>
<p><code>rwfilter suspicious.silk --any-address=192.168.10.10 --aport=1088 --pass=stdout|rwcut</code></p>
<h5 id="extract-all-udp-from-flow-then-pipe-to-get-field-4-4dst-port-3srcport-5proto-6packets-etc">Extract all UDP from flow then pipe to get field 4 (4=dst port, 3=srcport, 5=proto, 6=packets, etc)<a class="headerlink" href="#extract-all-udp-from-flow-then-pipe-to-get-field-4-4dst-port-3srcport-5proto-6packets-etc" title="Permanent link">&para;</a></h5>
<p><code>rwfilter suspicious.silk --proto=17 --pass=stdout|rwuniq --fields=4</code></p>
<h5 id="extract-connections-from-108-with-a-reset-to-close-then-pipe-to-get-srcip-count">Extract connections from 10/8 with a reset to close then pipe to get srcIP count<a class="headerlink" href="#extract-connections-from-108-with-a-reset-to-close-then-pipe-to-get-srcip-count" title="Permanent link">&para;</a></h5>
<p><code>rwfilter suspicious.silk --any-address=10.10.0.0/16 --flags-all=R/R --pass=stdout|rwuniq --fields=1</code></p>
<h5 id="use-rwstats-to-get-flow-data-of-top-5-flows">Use rwstats to get flow data of top 5 flows<a class="headerlink" href="#use-rwstats-to-get-flow-data-of-top-5-flows" title="Permanent link">&para;</a></h5>
<p><code>rwstats suspicious.silk --fields sIP --bytes --count=5</code></p>
<h5 id="extract-records-not-icmp-tcp-or-udp-note-fail-and-have-src-ip-of-1010101">Extract records not ICMP, TCP or UDP (note fail) and have src IP of 10.10.10.1<a class="headerlink" href="#extract-records-not-icmp-tcp-or-udp-note-fail-and-have-src-ip-of-1010101" title="Permanent link">&para;</a></h5>
<p><code>rwfilter suspicious.silk --proto=1,6,17 --fail=stdout|rwfilter --input-pipe=stdin --saddress=10.10.10.1 --pass=stdout | rwcut</code></p>
<p>or</p>
<p><code>rwfilter suspicious.silk --proto=0,2-5,7-16,18- --saddress=10.10.10.1 --pass=stdout | rwcut</code></p>
<h5 id="get-top-5-ip-with-data-transfer">Get top 5 IP with data transfer<a class="headerlink" href="#get-top-5-ip-with-data-transfer" title="Permanent link">&para;</a></h5>
<p><code>rwstats phishing-attack.silk --fields=sip --top --bytes --count 5</code></p>
<h5 id="get-flows-with-larger-than-100000-bytes">Get flows with larger than 100,000 bytes<a class="headerlink" href="#get-flows-with-larger-than-100000-bytes" title="Permanent link">&para;</a></h5>
<p><code>rwfilter phishing-attack.silk --proto=6 --bytes=100000- --pass=stdout |rwcut -f 1-8</code></p>
<hr />
<h4 id="elsa-bro-queries">ELSA (BRO queries)<a class="headerlink" href="#elsa-bro-queries" title="Permanent link">&para;</a></h4>
<h5 id="elsa-most-common-svc">ELSA most common svc<a class="headerlink" href="#elsa-most-common-svc" title="Permanent link">&para;</a></h5>
<p><code>class=BRO_CONN groupby:service</code></p>
<h5 id="elsa-bro-nx-domains">ELSA BRO nx domains<a class="headerlink" href="#elsa-bro-nx-domains" title="Permanent link">&para;</a></h5>
<p><code>class=BRO_DNS nxdomain groupby:hostname</code></p>
<h5 id="elsa-bro-common-fqdn">ELSA BRO common FQDN<a class="headerlink" href="#elsa-bro-common-fqdn" title="Permanent link">&para;</a></h5>
<p><code>class=BRO_HTTP "-" groupby:site</code></p>
<h5 id="elsa-bro-sites-hosting-exe">ELSA BRO Sites hosting EXE<a class="headerlink" href="#elsa-bro-sites-hosting-exe" title="Permanent link">&para;</a></h5>
<p><code>class=BRO_HTTP BRO_HTTP.mime_type="x-dosexec" groupby:site</code></p>
<h5 id="elsa-bro-uri-with-exe-downloads">ELSA BRO URI with EXE downloads<a class="headerlink" href="#elsa-bro-uri-with-exe-downloads" title="Permanent link">&para;</a></h5>
<p><code>class=BRO_HTTP BRO_HTTP.mime_type="x-dosexec" groupby:BRO_HTTP.uri</code></p>
<h5 id="elsa-bro-internal-ip-exe-download">ELSA BRO Internal IP EXE download<a class="headerlink" href="#elsa-bro-internal-ip-exe-download" title="Permanent link">&para;</a></h5>
<p><code>class=BRO_FILES "-" mime_type="application/x-dosexec" groupby:rx_hosts</code></p>
<h5 id="elsa-bro-connections-wo-ua-group-by-source-ip">ELSA BRO connections w/o UA group by source IP<a class="headerlink" href="#elsa-bro-connections-wo-ua-group-by-source-ip" title="Permanent link">&para;</a></h5>
<p><code>class=BRO_HTTP "-" user_agent="-" groupby:srcipt</code></p>
<hr />
<h4 id="bro">BRO<a class="headerlink" href="#bro" title="Permanent link">&para;</a></h4>
<h5 id="bro-logs">BRO Logs<a class="headerlink" href="#bro-logs" title="Permanent link">&para;</a></h5>
<p>Just a few logs that can be used to gather information. Note, custom logs can be created and referenced using the BRO.</p>
<h5 id="bro-log-hunting">BRO Log Hunting<a class="headerlink" href="#bro-log-hunting" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>BRO log</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn.log</td>
<td>IP/protocol connections</td>
</tr>
<tr>
<td>conn-summary.log</td>
<td>Statistics/summarizes activity</td>
</tr>
<tr>
<td>known_hosts.log</td>
<td>New hosts within past hour</td>
</tr>
<tr>
<td>known_serices.log</td>
<td>New services within past hour</td>
</tr>
<tr>
<td>dpd.log</td>
<td>Dynamic protocol detection</td>
</tr>
<tr>
<td>weird.log</td>
<td>Anomalous activity</td>
</tr>
<tr>
<td>loaded_scripts.log</td>
<td>Scripts loaded on start</td>
</tr>
<tr>
<td>reporter.log</td>
<td>Severity of issues with bro</td>
</tr>
<tr>
<td>software.log</td>
<td>Determines version of detected protocol</td>
</tr>
<tr>
<td>various protocols (http,dns,ssl,etc)</td>
<td>Activity log per protocol</td>
</tr>
</tbody>
</table>
<h5 id="bro-protocol-logs">BRO Protocol Logs<a class="headerlink" href="#bro-protocol-logs" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>BRO log</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn.log</td>
<td>TCP/UDP/ICMP connections</td>
</tr>
<tr>
<td>dce_rpc.log</td>
<td>Distributed Computing Environment/RPC</td>
</tr>
<tr>
<td>dhcp.log</td>
<td>DHCP leases</td>
</tr>
<tr>
<td>dnp3.log</td>
<td>DNP3 requests and replies</td>
</tr>
<tr>
<td>dns.log</td>
<td>DNS activity</td>
</tr>
<tr>
<td>ftp.log</td>
<td>FTP activity</td>
</tr>
<tr>
<td>http.log</td>
<td>HTTP requests and replies</td>
</tr>
<tr>
<td>irc.log</td>
<td>IRC commands and responses</td>
</tr>
<tr>
<td>kerberos.log</td>
<td>Kerberos</td>
</tr>
<tr>
<td>modbus.log</td>
<td>Modbus commands and responses</td>
</tr>
<tr>
<td>modbus_register_change.log</td>
<td>Tracks changes to Modbus holding registers</td>
</tr>
<tr>
<td>mysql.log</td>
<td>MySQL</td>
</tr>
<tr>
<td>ntlm.log</td>
<td>NT LAN Manager (NTLM)</td>
</tr>
<tr>
<td>radius.log</td>
<td>RADIUS authentication attempts</td>
</tr>
<tr>
<td>rdp.log</td>
<td>RDP RDP</td>
</tr>
<tr>
<td>rfb.log</td>
<td>Remote Framebuffer (RFB)</td>
</tr>
<tr>
<td>sip.log</td>
<td>SIP</td>
</tr>
<tr>
<td>smb_cmd.log</td>
<td>SMB commands</td>
</tr>
<tr>
<td>smb_files.log</td>
<td>SMB files</td>
</tr>
<tr>
<td>smb_mapping.log</td>
<td>SMB trees</td>
</tr>
<tr>
<td>smtp.log</td>
<td>SMTP transactions</td>
</tr>
<tr>
<td>snmp.log</td>
<td>SNMP messages</td>
</tr>
<tr>
<td>socks.log</td>
<td>SOCKS proxy requests</td>
</tr>
<tr>
<td>ssh.log</td>
<td>SSH connections</td>
</tr>
<tr>
<td>ssl.log</td>
<td>SSL/TLS handshake info</td>
</tr>
<tr>
<td>syslog.log</td>
<td>Syslog messages</td>
</tr>
<tr>
<td>tunnel.log</td>
<td>Tunneling protocol events</td>
</tr>
</tbody>
</table>
<p><strong>BRO Log Reference</strong>
– <a href="https://www.bro.org/sphinx-git/script-reference/log-files.html">https://www.bro.org/sphinx-git/script-reference/log-files.html</a></p>
<h4 id="bro-carving">BRO Carving<a class="headerlink" href="#bro-carving" title="Permanent link">&para;</a></h4>
<h5 id="read-and-output-bro-logs">Read and output bro logs<a class="headerlink" href="#read-and-output-bro-logs" title="Permanent link">&para;</a></h5>
<p><code>bro -r file.pcap</code></p>
<h5 id="get-source-src-ip-dst-ip-dst-port-and-bytes-in-that-order">Get source src ip, dst ip, dst port, and bytes (in that order)<a class="headerlink" href="#get-source-src-ip-dst-ip-dst-port-and-bytes-in-that-order" title="Permanent link">&para;</a></h5>
<p><code>cat conn.log |bro-cut id.orig_h id.resp_h id.resp_p orig_bytes |head -2</code></p>
<h5 id="same-as-above-but-sort-by-bytes-field-5-reverse-by-number">Same as above but sort by bytes (field 5 reverse by number)<a class="headerlink" href="#same-as-above-but-sort-by-bytes-field-5-reverse-by-number" title="Permanent link">&para;</a></h5>
<p><code>cat conn.log |bro-cut id.orig_h id.orig_p id.resp_h id.resp_p orig_bytes|sort -k 5 -rn</code></p>
<h5 id="get-http-on-non-standard-ports-ssl">Get http on non-standard ports (ssl?)<a class="headerlink" href="#get-http-on-non-standard-ports-ssl" title="Permanent link">&para;</a></h5>
<p><code>cat conn.log | bro-cut service id.resp_p id.resp_h | awk '$1 == "http" &amp;&amp; ! ($2 == 80 || $2 == 8080) { print $3 }' | sort -u</code></p>
<h5 id="extract-dns-info-from-bro-logs">Extract DNS info from bro logs<a class="headerlink" href="#extract-dns-info-from-bro-logs" title="Permanent link">&para;</a></h5>
<p><code>cat dns.log |bro-cut query | sort -u</code></p>
<p>and</p>
<p><code>cat dns.log | bro-cut -d answers | sort -u</code></p>
<h5 id="get-user-agents">Get User-Agents<a class="headerlink" href="#get-user-agents" title="Permanent link">&para;</a></h5>
<p><code>cat http.log | bro-cut user_agent | sort | uniq -c |sort -n</code></p>
<h5 id="get-mime-types">Get Mime Types<a class="headerlink" href="#get-mime-types" title="Permanent link">&para;</a></h5>
<p><code>cat http.log | bro-cut orig_mime_type | sort | uniq -c |sort -n</code></p>
<h5 id="get-bro-outbound-signature-stored-in-sig-file-read-with-s">Get bro outbound signature stored in .sig file (read with -s)<a class="headerlink" href="#get-bro-outbound-signature-stored-in-sig-file-read-with-s" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>signature outbound-sig {
ip-proto == tcp
src-ip == 192.168.0.0/16
dst-ip != 192.168.0.0/16
dst-port == 80
http-request-header /^User-Agent:.*/
event &quot;Outbound HTTP traffic&quot;
}
</code></pre></div>
<h5 id="get-bro-windows-shell-signature-stored-in-sig-file-read-with-s">Get bro Windows Shell signature stored in .sig file (read with -s)<a class="headerlink" href="#get-bro-windows-shell-signature-stored-in-sig-file-read-with-s" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>signature windows_reverse_shell {
ip-proto == tcp
tcp-state established,originator
event &quot;ATTACK-RESPONSES Microsoft cmd.exe banner (reverse-shell originator)&quot;
payload /.*Microsoft Windows.*x28Cx29 Copyright 1985-.*Microsoft Corp/
}
</code></pre></div>
<div class="highlight"><pre><span></span><code>signature windows_shell {
ip-proto == tcp
tcp-state established,responder
event &quot;ATTACK-RESPONSES Microsoft cmd.exe banner (normal-shell responder)&quot;
payload /.*Microsoft Windows.*x28Cx29 Copyright 1985-.*Microsoft Corp/
}
</code></pre></div>
<h5 id="run-bro-with-sig-file">Run bro with sig file<a class="headerlink" href="#run-bro-with-sig-file" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>bro -r file.pcap -s outbound.sig
</code></pre></div>
<h5 id="view-dst-addresses-in-signature-file">View dst addresses in signature file<a class="headerlink" href="#view-dst-addresses-in-signature-file" title="Permanent link">&para;</a></h5>
<p><code>cat signatures.log |bro-cut dst_addr | sort | uniq -c |sort -n</code></p>
<h5 id="bro-event-script-to-find-user-agent-outboundbro">BRO event script to find User-Agent (outbound.bro)<a class="headerlink" href="#bro-event-script-to-find-user-agent-outboundbro" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>event http_header(c: connection, is_orig: bool, name: string, value: string)
{
local snet = 192.168.0.0/16;
if (c$id$orig_h in snet)
{
if (c$id$resp_h !in snet)
{
if (c$id$resp_p == 80/tcp &amp;&amp; name == &quot;USER-AGENT&quot;)
{
print fmt (&quot;source IP %s, destination IP/port %s %s, USER-AGENT content %s&quot;,
c$id$orig_h,c$id$resp_h,c$id$resp_p,value);
}
}
}
}
</code></pre></div>
<p><strong>BRO Scripting Reference</strong>
– <a href="https://www.bro.org/sphinx/scripting/">https://www.bro.org/sphinx/scripting/</a></p>
<h5 id="run-event-file-to-view-user-agent">Run event file to view user-agent<a class="headerlink" href="#run-event-file-to-view-user-agent" title="Permanent link">&para;</a></h5>
<p><code>bro -r file.pcap outbound-event.bro</code></p>
<h5 id="bro-extract-common-files-from-pcap">BRO extract common files from pcap<a class="headerlink" href="#bro-extract-common-files-from-pcap" title="Permanent link">&para;</a></h5>
<p><code>sudo bro -r file.pcap /opt/bro/share/bro/file-extraction/extract.bro</code></p>
<h5 id="extract-ssl-info">Extract ssl info<a class="headerlink" href="#extract-ssl-info" title="Permanent link">&para;</a></h5>
<p><code>cat ssl.log | bro-cut server_name, subject, issuer_subject</code></p>
<h5 id="bro-extract-unique-ssl-certificate-data">BRO extract unique SSL certificate data<a class="headerlink" href="#bro-extract-unique-ssl-certificate-data" title="Permanent link">&para;</a></h5>
<p><code>bro -C -r file.pcap &gt; cert_data.txt</code></p>
<h5 id="bro-extract-ssl-issuer-data-from-certificate-extraction">BRO extract SSL issuer data from certificate extraction<a class="headerlink" href="#bro-extract-ssl-issuer-data-from-certificate-extraction" title="Permanent link">&para;</a></h5>
<p><code>cat ssl.log|bro-cut issuer_subject|sort -u &gt; /tmp/bro/data.txt</code></p>
<h5 id="bro-show-shortest-issuer-from-extraction">BRO show shortest issuer from extraction<a class="headerlink" href="#bro-show-shortest-issuer-from-extraction" title="Permanent link">&para;</a></h5>
<p><code>cat /tmp/bro/data.txt |awk '{print length, $0}'|sort -nr</code></p>
<hr />
<h4 id="modsecurity-rules">ModSecurity rules<a class="headerlink" href="#modsecurity-rules" title="Permanent link">&para;</a></h4>
<h5 id="errorlog-ua-not-starting-with-mozilla">error.log UA not starting with Mozilla<a class="headerlink" href="#errorlog-ua-not-starting-with-mozilla" title="Permanent link">&para;</a></h5>
<p><code>SecRule REQUEST_HEADERS:User-Agent "!^Mozilla/d.d" "log,msg:'User-Agent without Mozilla/#.#'"</code></p>
<h5 id="errorlog-visiting-ip-url">error.log visiting IP URL<a class="headerlink" href="#errorlog-visiting-ip-url" title="Permanent link">&para;</a></h5>
<p><code>SecRule REQUEST_HEADERS:Host "^[d.:]+$" "log,msg:'Host used an IP address'"</code></p>
<h5 id="errorlog-blank-ua">error.log blank UA<a class="headerlink" href="#errorlog-blank-ua" title="Permanent link">&para;</a></h5>
<p><code>SecRule REQUEST_HEADERS:User-Agent "^$" "log,msg:'Request has blank UA'"</code></p>
<h5 id="errorlog-ua-starting-with-mozilla">error.log UA starting with mozilla<a class="headerlink" href="#errorlog-ua-starting-with-mozilla" title="Permanent link">&para;</a></h5>
<p><code>SecRule REQUEST_HEADERS:User-Agent "^mozilla" "log,msg:'Request has mozilla UA'"</code></p>
<h5 id="errorlog-visiting-by-ip-log-ua-used">error.log visiting by IP log UA used<a class="headerlink" href="#errorlog-visiting-by-ip-log-ua-used" title="Permanent link">&para;</a></h5>
<p><code>SecRule REQUEST_HEADERS:Host "^[d.:]+$" "log,msg:'Host used an IP address check errorlog for UA',logdata:'User-Agent:%{REQUEST_HEADERS.User-Agent}'"</code></p>
<h5 id="errorlog-no-ua-not-blank-but-none">error.log no UA (not blank but none)<a class="headerlink" href="#errorlog-no-ua-not-blank-but-none" title="Permanent link">&para;</a></h5>
<p><code>SecRule &amp;REQUEST_HEADERS:User-Agent "@eq 0" "log,msg:'Request missing UA',logdata:'User-Agent:%{REQUEST_HEADERS.User-Agent}'"</code></p>
<h5 id="errorlog-note-param-entry">error.log note param entry<a class="headerlink" href="#errorlog-note-param-entry" title="Permanent link">&para;</a></h5>
<p><code>SecRule &amp;ARGS:password "@gt 1" "log,msg:'PW data',logdata:'params:%{REQUEST_LINE}'"</code></p>
<h5 id="errorlog-trigger-on-keyword-can-use-pattern">error.log trigger on keyword (can use pattern)<a class="headerlink" href="#errorlog-trigger-on-keyword-can-use-pattern" title="Permanent link">&para;</a></h5>
<p><code>#Trigger on EXFIL from body (phase:4 is the Response Body)
SecRule RESPONSE_BODY "badguy" "phase:4, msg:'HoneyToken Exfil Detected', tag:'HONEYTOKEN EXFIL'"</code></p>
<hr />
<h4 id="splunk">Splunk<a class="headerlink" href="#splunk" title="Permanent link">&para;</a></h4>
<p>Note these are examples and are mainly illustrated as templates for creating your own internal searches</p>
<h5 id="new-unauthorized-service">New unauthorized service<a class="headerlink" href="#new-unauthorized-service" title="Permanent link">&para;</a></h5>
<p><code>index=windows LogName=System EventCode=7045 NOT (Service_Name=&lt;yourscanner&gt;) | eval Message=split(Message,".") | eval Short_Message=mvindex(Message,0) | table_time, host, Service_Name, Service_Type, Service_Start_Type, Service_Account, Short_Message</code></p>
<h5 id="detecting-process-abuse">Detecting process abuse<a class="headerlink" href="#detecting-process-abuse" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon SourceType="WinEventLog:Microsoft-Windows-Sysmon/Operational" ProcessCreate (whoami OR netstat OR etc) | search EventCode=1 Image="*\whoami.exe" OR Image="* etstat.exe" OR Image="* asklist.exe" | bin )time span=5m | rex field=Message ".*User:(xxx|NT AUTHORITY)\(?&lt;USER&gt;.*)" | stats dc(Image) AS CNT_CMDS values(CommandLine) values(ParentImage) values(ParentCommandLine) count by _time ComputerName USER</code></p>
<h5 id="detecting-process-abuse-simplified-requires-one-entry-per-process">Detecting process abuse (simplified, requires one entry per process)<a class="headerlink" href="#detecting-process-abuse-simplified-requires-one-entry-per-process" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon Image="* et.exe" (CommandLine="*net group*" OR CommandLine="*net localgroup*" OR CommandLine="*net user*") | stats count by Computer,CommandLine</code></p>
<h5 id="process-starts-and-connects-to-ip">Process starts and connects to IP<a class="headerlink" href="#process-starts-and-connects-to-ip" title="Permanent link">&para;</a></h5>
<p><code>index=windows LogName=System EventCode=5156 NOT (Source_Address="10.10.10.15") NOT (Application_Name="path:file.exe") | eval Message=split(Message,".") | table_time, host, Application_Name, Source_Address, Destination_Address, Direction</code></p>
<h5 id="detect-smb-traffic-between-clients">Detect SMB traffic between clients<a class="headerlink" href="#detect-smb-traffic-between-clients" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon SourceName="Microsoft-Windows-Sysmon" EventCode=3 Initiated=true SourceIp!=DestinationIp DestinationPort=445 Image!=System (SourceHostname="fileserver1" DestinationHostname="client1") OR (Source_Address="10.10.1.5" Destination_Address="10.10.10.15") | stats by ComputerName ProcessGuid | fields ComputerName ProcessGuid</code></p>
<h5 id="detect-named-pipes">Detect Named Pipes<a class="headerlink" href="#detect-named-pipes" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational" (PipeEvent "Pipe Created") | search (EventCode=17 (PipeName="\*")) | stats values (Image) AS Images values(PipeName) AS PipeNames count by TaskCategory ComputerName</code></p>
<h4 id="detect-wmi">Detect WMI<a class="headerlink" href="#detect-wmi" title="Permanent link">&para;</a></h4>
<p><code>index=sysmon Image="*\WMIC.exe" (CommandLine="*process call create*" OR CommandLine="*/NODE:*") | stats count by Computer,CommandLine</code></p>
<p>and</p>
<p><code>index=sysmon ParentImage="*\WmiPrvSE.exe" | stats count by Computer,CommandLine</code></p>
<h4 id="detect-powershell-commands">Detect PowerShell Commands<a class="headerlink" href="#detect-powershell-commands" title="Permanent link">&para;</a></h4>
<p><code>index=sysmon ParentImage="*wsmprovhost.exe" | stats count by Computer,CommandLine</code></p>
<p>and</p>
<p><code>index=sysmon Image="*powershell.exe" (CommandLine="*-EncodedCommand*" OR CommandLine="*-Enc*" OR CommandLine="*-e*" OR CommandLine="*new-object*" OR CommandLine="*-nop*" OR CommandLine="*-noprofile" OR CommandLine="*-Command*" OR COmmandLine="*-c*" OR CommandLine="*Invoke-Command*" OR CommandLine="*download*" OR CommandLine="*IEX*" OR CommandLine="*exec*")| stats count by Computer,CommandLine</code></p>
<h5 id="alert-on-remote-files-copied-via-cmd-line">Alert on remote files copied via cmd line<a class="headerlink" href="#alert-on-remote-files-copied-via-cmd-line" title="Permanent link">&para;</a></h5>
<p><code>index=windows LogName=Security EventCode=5145 Object_Type=File Share_Name=*$ (Access_Mask=0x100180 OR Access_Mask=0x80 OR Access_Mask=0x130197) |bucket span=1s _time |rex "(?(0x100180|0x80|0x130197))" |stats values(Relative_Target_Name) AS Relative_Target_Name, values(Account_Name) AS Account_Name, values(Source_Address) AS Source_Address, dc(thingtype) AS distinct_things by ComputerName, _time |search distinct_things=3</code></p>
<h5 id="alert-on-c-or-admin-share-enumeration">Alert on C or Admin share enumeration<a class="headerlink" href="#alert-on-c-or-admin-share-enumeration" title="Permanent link">&para;</a></h5>
<p><code>index=windows LogName=Security EventCode=5145 Share_Name=*c$ OR *ADMIN$ (Access_Mask=0x100180) NOT (Source_Address="10.10.10.15")|bucket span=1s _time |rex "(?(0x100180))" |stats values(Relative_Target_Name) AS Relative_Target_Name, values(Account_Name) AS Account_Name, values(Source_Address) AS Source_Address, dc(thingtype) AS distinct_things by ComputerName, _time |search distinct_things=3</code></p>
<h5 id="search-for-file-delivery">Search for file delivery<a class="headerlink" href="#search-for-file-delivery" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon SourceName="Microsoft-Windows-Sysmon" FileCreateStreamHash badfile.exe | search EventCode=15 | rex field=TargetFilename ".*\(?&lt;TargFilename&gt;[^\]*)" | rex field=Image ".*\(?&lt;ImageFilename[^\]*)" | rex field=Hash ".*MD5=(?&lt;MD5&gt;[A-F0-9]*),IMPHASH=(?&lt;IMPHASH&gt;[A-F0-9]*)" | stats values(TargFilename) values(ComputerName) AS Clients count by TaskCategory ImageFilename MD5</code></p>
<h5 id="search-for-registry-run-or-runonce-keys">Search for Registry Run (or RunOnce) Keys<a class="headerlink" href="#search-for-registry-run-or-runonce-keys" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon SourceName="Microsoft-Windows-Sysmon" RegistryEvent CurrentVersion Run | search EventCode=13 "*\Windows\CurrentVersion\Run*" | rex field=Image ".*\(?Image_EXE&gt;[^\]*)" | rex field=TargetObject ".*\CurrentVersion\(?&lt;TargetObj_PATH&gt;.*)" | strcat "Image="" IMage_EXE "", TargetObject="" TargetObj_PATH "", Details="" Details """ Image_TargetObj_Details | stats dc(ComputerName) AS Clients values(Image_TragetObj_Details) count by TaskCategory Image_EXE</code></p>
<h5 id="search-for-file-system-persistence">Search for file system persistence<a class="headerlink" href="#search-for-file-system-persistence" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon SourceName="Microsoft-Windows-Sysmon" ProcessCreate "Start Menu" Programs Startup | search Image="*\Microsoft\Windows\Start Menu\Programs\Startup\*" | rex field=Image ".*\Programs\Startup\(?&lt;Startup_Image&gt;[^\]*)" | rex field=Hash ".*MD5=(?&lt;MD5&gt;[A-F0-9]*),IMPHASH=(?&lt;IMPHASH&gt;[A-F0-9]*)" | stats values(ComputerName) AS Clients vlaues(MD5) count by IMPHASH Startup_Image</code></p>
<h5 id="detect-credential-harvesting">Detect credential harvesting<a class="headerlink" href="#detect-credential-harvesting" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon ParentImage="*\services.exe" | regex CommandLine="\[a-z0-9]{8}-[a-z0-9]{4}-[az0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}.exe-S$"</code></p>
<p>and</p>
<p><code>index=sysmon CommandLine="*privileges::debug*" OR CommandLine="*sekurlsa::*" OR CommandLine="*kerberos::*" OR CommandLine="*crypto::*" OR CommandLine="*lsadump::*" OR CommandLine="*process::*"</code></p>
<h5 id="potential-privilege-escalation">Potential Privilege Escalation<a class="headerlink" href="#potential-privilege-escalation" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=4688 Token_Elevation_Type="*(2)"</code></p>
<h5 id="potential-beaconing-detection">Potential Beaconing Detection<a class="headerlink" href="#potential-beaconing-detection" title="Permanent link">&para;</a></h5>
<p><code>index=proxy sourcetype=bluecoat:proxysg:access:syslog url=* | eval current_time=_time | sort 0 + current_time | streamstats global=f window=2 current=f last(current_time) AS previous_time by src, url | eval diff_time=current_time-previous_time| eventstats count, stdev(diff_time) AS std by src, url</code></p>
<h5 id="detect-webshell-activity-note-this-should-be-updated-at-implementation-and-often">Detect webshell activity (note this should be updated at implementation and often)<a class="headerlink" href="#detect-webshell-activity-note-this-should-be-updated-at-implementation-and-often" title="Permanent link">&para;</a></h5>
<p><code>index=sysmon ParentImage="*pache*" ParentImage="* omcat*" ParentImage="* ginx*" ParentImage="*\httpd*" ParentImage="*\php-cgi*" ParentImage="*\w3wp*" CommandLine="*whoami*" CommandLine="*net*" CommandLine="*ipconfig*" CommandLine="*hostname*" CommandLine="*systeminfo*" CommandLine="*cmd*" CommandLine="*sh*" CommandLine="*bash*" CommandLine="*powershell*"</code></p>
<h5 id="detect-potential-sqli">Detect potential SQLi<a class="headerlink" href="#detect-potential-sqli" title="Permanent link">&para;</a></h5>
<p><code>index=weblogs sourcetype=MSWindows:2008R2:IIS | regex cs_uri_query="(?i)(?:--|;|/*|@|@@version|char|alter|begin|cast|create|cursor|declare|delete|drop|end|exec|fetch|insert|kill|open|select|sys|table|update)" | stats count by host c_ip cs_uri_stem cs_uri_query | rex field=cs_uri_query "(?i)(?&lt;suspect&gt;--|;|/*|@|@@version|char|alter|begin|cast|create|cursor|declare|delete|drop|end|exec|fetch|insert|kill|open|select|sys|table|update)" max_match=0</code></p>
<h5 id="view-http-post-with-response">View HTTP POST with response<a class="headerlink" href="#view-http-post-with-response" title="Permanent link">&para;</a></h5>
<p><code>index=json_bro eventtype=bro_http method=POST AND status &lt;=403 AND uri=*.php OR uri=*.jsp OR uri=*.cfm OR uri=*.asp OR uri=*.aspx |stats values(id.orig_h) AS Source, values,(hostname) AS Destination by uri</code></p>
<h5 id="find-weird-user-agents">Find Weird User-Agents<a class="headerlink" href="#find-weird-user-agents" title="Permanent link">&para;</a></h5>
<p><code>index=json_bro eventtype-bro_http |stats count by user_agent | sort -count | reverse</code></p>
<h5 id="get-high-severity-epo-events">Get high severity EPO events<a class="headerlink" href="#get-high-severity-epo-events" title="Permanent link">&para;</a></h5>
<p><code>index=av sourcetype=mcafee:epo (severity=critical OR severity=high) | stats values(event_description) AS desc, values(signature) AS signature, values(file_name) AS file_path, count AS result BY dest | eval dd="index=av sourcetype=mcafee:epo (severity=critical OR severity=high) dest=".dest</code></p>
<hr />
<h4 id="snort">Snort<a class="headerlink" href="#snort" title="Permanent link">&para;</a></h4>
<p>Note these are examples and are mainly illustrated as templates for creating your own internal searches</p>
<h5 id="detect-psexec">Detect psexec<a class="headerlink" href="#detect-psexec" title="Permanent link">&para;</a></h5>
<p><code>alert tcp any any -&gt; $HOME_NET [139,445] (msg:"ET POLICY PsExec? service created"; flow:to_server, established; content:"5c 00 50 00 53 00 45 00 58 00 45 00 53 00 56 00 43 00 2e 00 45 00 58 00 45"; reference: url, xinn.org/Snort-psexec.html; reference:url, doc.emerginthreats.net/2010781:classtype:suspicious-filename-detect:sid:201781; rev:2;)</code></p>
<h5 id="detect-packets-with-with-port-4444-port-0">Detect packets with with port 4444 (port 0?)<a class="headerlink" href="#detect-packets-with-with-port-4444-port-0" title="Permanent link">&para;</a></h5>
<p><code>alert tcp $EXTERNAL_NET any &lt;&gt; $HOME_NET 4444 (msg:"BAD-TRAFFIC tcp port 4444 traffic"; flow:stateless; classtype:misc-activity; sid:524; rev:8;)"</code></p>
<h5 id="snort-appid-list">Snort appid list<a class="headerlink" href="#snort-appid-list" title="Permanent link">&para;</a></h5>
<p><code>sudo u2openappid /var/log/snort/appstats-unified.log.1455060958 |egrep -v '"http"|"https"|"dns"|"internet_explor"'|cut -d"," -f2|sort|uniq -c|sort -nr</code></p>
<h4 id="interesting-file-extensions-note-this-is-the-same-list-as-above-placed-here-for-use-in-monitoring-via-snort">Interesting file extensions (Note this is the same list as above, placed here for use in monitoring via Snort)<a class="headerlink" href="#interesting-file-extensions-note-this-is-the-same-list-as-above-placed-here-for-use-in-monitoring-via-snort" title="Permanent link">&para;</a></h4>
<p><code>.ade, .adp, .ani, .bas, .bat, .chm, .cmd, .com, .cpl, .crt, .exe, .hlp, .ht, .hta, .inf, .ins, .isp, .jar, .job, .js, .jse, .lnk, .mda, .mdb, .mde, .mdz, .msc, .msi, .msp, .mst, .ocx, .pcd, .ps1, .reg, .scr, .sct, .shs, .svg, .url, .vb, .vbe, .vbs, .wbk, .wsc, .ws, .wsf, .wsh, .exe, .pif, .pub, .ip</code></p>
<hr />
<h4 id="additional-useful-info">Additional Useful Info<a class="headerlink" href="#additional-useful-info" title="Permanent link">&para;</a></h4>
<h5 id="get-methods-from-accesslog">Get methods from access.log<a class="headerlink" href="#get-methods-from-accesslog" title="Permanent link">&para;</a></h5>
<p><code>cat access.log | cut -d" -f2 | cut -d' ' -f1 | sort -u</code></p>
<h5 id="decode-encoded-url-line-290">Decode %encoded url (line 290)<a class="headerlink" href="#decode-encoded-url-line-290" title="Permanent link">&para;</a></h5>
<p><code>awk ' {if (length($0) &gt; max){max=length($0);maxline=$0}} END {print maxline }' access.log|cut -d" " -f7|sed s/%//g|sed s/+//g|sed s/?//g|xxd -r -p</code></p>
<p>or</p>
<p><code>cat access.log |grep POST|grep cgi-bin|cut -d'"' -f2|sort -u|sed s/%//g|sed s/+//g|cut -d"?" -f2|awk -F"HTTP/1.1" '{print $1}'|xxd -r -p</code></p>
<h4 id="gather-information-on-windows-host">Gather Information on Windows host<a class="headerlink" href="#gather-information-on-windows-host" title="Permanent link">&para;</a></h4>
<h5 id="list-task-services">List task services<a class="headerlink" href="#list-task-services" title="Permanent link">&para;</a></h5>
<p><code>tasklist /svc /fi "imagename eq file.exe"</code></p>
<h5 id="show-modules-for-task">Show modules for task<a class="headerlink" href="#show-modules-for-task" title="Permanent link">&para;</a></h5>
<p><code>tasklist /m /fi "imagename eq file.exe"</code></p>
<h5 id="verbose-task-information">Verbose task information<a class="headerlink" href="#verbose-task-information" title="Permanent link">&para;</a></h5>
<p><code>tasklist /v /fi "imagename eq file.exe"</code></p>
<h5 id="get-information-about-processes">Get information about processes<a class="headerlink" href="#get-information-about-processes" title="Permanent link">&para;</a></h5>
<p><code>get-wmiobject -class Win32_Process -Filter 'Name="file.exe"'</code></p>
<p>and</p>
<p><code>get-process | select * |Where-Object {$_.ID -eq PID}</code></p>
<p>and</p>
<p><code>gwmi Win32_Process|Select ProcessName,ProcessID,ParentProcessID,CommandLine,@{e={$_.GetOwner().User}}|ft -wrap;netstat ano</code></p>
<h5 id="look-for-code-injected-into-memory">Look for code injected into memory<a class="headerlink" href="#look-for-code-injected-into-memory" title="Permanent link">&para;</a></h5>
<p><code>Get-InjectedThread.ps1</code></p>
<p><strong>Reference</strong>
– <a href="https://gist.github.com/jaredcatkinson/23905d34537ce4b5b1818c3e6405c1d2">https://gist.github.com/jaredcatkinson/23905d34537ce4b5b1818c3e6405c1d2</a></p>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../threat-gets-a-vote-applying-a-threat-based-approach-to-security-testing/" title="Threat Get's a Vote - Applying a Threat-Based Approach to Security Testing" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Threat Get's a Vote - Applying a Threat-Based Approach to Security Testing
              </span>
            </div>
          </a>
        
        
          <a href="../automating-cobalt-strike-profiles-apache-mod_rewrite-htaccess-files-intelligent-c2-redirection/" title="Automating Cobalt Strike Profiles Apache mod_rewrite htaccess Files for Intelligent C2 Redirection" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Automating Cobalt Strike Profiles Apache mod_rewrite htaccess Files for Intelligent C2 Redirection
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            © 2019 Threatexpress
          </div>
        
      </div>
      <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/threatexpress" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/joevest" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://platform.twitter.com/widgets.js"></script>
      
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
      
        <script src="../../../js/extra.js"></script>
      
    
  </body>
</html>